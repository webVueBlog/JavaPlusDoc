(window.webpackJsonp=window.webpackJsonp||[]).push([[301],{1118:function(s,t,a){"use strict";a.r(t);var r=a(1),e=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"docker镜像管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像管理"}},[s._v("#")]),s._v(" Docker镜像管理")]),s._v(" "),t("h2",{attrs:{id:"什么是docker镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是docker镜像"}},[s._v("#")]),s._v(" 什么是Docker镜像")]),s._v(" "),t("p",[s._v("Docker镜像是一个只读的模板，用于创建Docker容器。镜像可以理解为一个包含了应用程序及其依赖环境的文件系统，它是容器的基础。Docker镜像由多个层（layers）组成，每层都是只读的，这些层堆叠在一起形成最终的镜像。")]),s._v(" "),t("h2",{attrs:{id:"镜像的特点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像的特点"}},[s._v("#")]),s._v(" 镜像的特点")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("分层结构")]),s._v("：Docker镜像由多个层组成，每层代表Dockerfile中的一条指令")]),s._v(" "),t("li",[t("strong",[s._v("共享层")]),s._v("：不同的镜像可以共享相同的层，节省存储空间")]),s._v(" "),t("li",[t("strong",[s._v("只读")]),s._v("：镜像层是只读的，容器运行时会在最上层添加一个可写层")]),s._v(" "),t("li",[t("strong",[s._v("版本控制")]),s._v("：镜像支持标签（tag）机制，可以对不同版本进行管理")])]),s._v(" "),t("h2",{attrs:{id:"镜像命名与标签"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像命名与标签"}},[s._v("#")]),s._v(" 镜像命名与标签")]),s._v(" "),t("p",[s._v("镜像的完整名称由以下部分组成：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[registry-host]:[port]/[username]/[repository]:[tag]\n")])])]),t("ul",[t("li",[t("strong",[s._v("registry-host:port")]),s._v("：镜像仓库地址，默认为Docker Hub")]),s._v(" "),t("li",[t("strong",[s._v("username")]),s._v("：用户名或组织名")]),s._v(" "),t("li",[t("strong",[s._v("repository")]),s._v("：镜像名称")]),s._v(" "),t("li",[t("strong",[s._v("tag")]),s._v("：镜像标签，默认为latest")])]),s._v(" "),t("p",[s._v("例如："),t("code",[s._v("docker.io/nginx:1.19.0")]),s._v("、"),t("code",[s._v("registry.example.com:5000/myapp:v1.0")])]),s._v(" "),t("h2",{attrs:{id:"镜像基本操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像基本操作"}},[s._v("#")]),s._v(" 镜像基本操作")]),s._v(" "),t("h3",{attrs:{id:"查看本地镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看本地镜像"}},[s._v("#")]),s._v(" 查看本地镜像")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出本地所有镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看镜像详细信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image inspect nginx:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看镜像历史")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" nginx:latest\n")])])]),t("h3",{attrs:{id:"搜索镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搜索镜像"}},[s._v("#")]),s._v(" 搜索镜像")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搜索Docker Hub上的镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 限制搜索结果数量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只显示官方镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"is-official=true"')]),s._v(" nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按星级筛选")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stars=1000"')]),s._v(" nginx\n")])])]),t("h3",{attrs:{id:"拉取镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[s._v("#")]),s._v(" 拉取镜像")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取最新版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取指定版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx:1.19.0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取指定仓库的镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull registry.example.com:5000/myapp:v1.0\n")])])]),t("h3",{attrs:{id:"推送镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像"}},[s._v("#")]),s._v(" 推送镜像")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录到Docker Hub")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 标记本地镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag myapp:latest username/myapp:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送到Docker Hub")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push username/myapp:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送到私有仓库")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push registry.example.com:5000/myapp:latest\n")])])]),t("h3",{attrs:{id:"删除镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除镜像"}},[s._v("#")]),s._v(" 删除镜像")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi nginx:latest\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginx:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制删除")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除未使用的镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除所有未使用的镜像（包括未标记的）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])])]),t("h2",{attrs:{id:"构建自定义镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建自定义镜像"}},[s._v("#")]),s._v(" 构建自定义镜像")]),s._v(" "),t("h3",{attrs:{id:"使用dockerfile构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用dockerfile构建"}},[s._v("#")]),s._v(" 使用Dockerfile构建")]),s._v(" "),t("ol",[t("li",[s._v("创建Dockerfile")])]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:latest")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./html /usr/share/nginx/html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("构建镜像")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基本构建命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" myapp:latest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定Dockerfile路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" myapp:latest "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /path/to/Dockerfile "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加构建参数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" myapp:latest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不使用缓存构建")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --no-cache "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" myapp:latest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),t("h3",{attrs:{id:"使用现有容器创建镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用现有容器创建镜像"}},[s._v("#")]),s._v(" 使用现有容器创建镜像")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从运行中的容器创建镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" commit "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Added new files"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Author"')]),s._v(" container_id username/myapp:latest\n")])])]),t("h2",{attrs:{id:"镜像优化技巧"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像优化技巧"}},[s._v("#")]),s._v(" 镜像优化技巧")]),s._v(" "),t("h3",{attrs:{id:"减小镜像大小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#减小镜像大小"}},[s._v("#")]),s._v(" 减小镜像大小")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("使用轻量级基础镜像")])]),s._v(" "),t("ul",[t("li",[s._v("使用Alpine Linux作为基础镜像")]),s._v(" "),t("li",[s._v("使用特定语言的精简版镜像（如node:alpine）")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("多阶段构建")])])])]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建阶段")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" maven:3.8.1-openjdk-11-slim "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" build")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" pom.xml .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" src ./src")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mvn package -DskipTests")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行阶段")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:11-jre-slim")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("build")])]),s._v(" /app/target/myapp.jar .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myapp.jar"')]),s._v("]")]),s._v("\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[t("strong",[s._v("合并RUN指令")])])]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不推荐")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get install -y package1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get install -y package2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get clean")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推荐")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get install -y package1 package2 && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get clean && "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    rm -rf /var/lib/apt/lists/*")]),s._v("\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[t("strong",[s._v("使用.dockerignore文件")])])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v(".git\nnode_modules\ntmp\nlog\n*.md\n")])])]),t("h3",{attrs:{id:"提高构建效率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提高构建效率"}},[s._v("#")]),s._v(" 提高构建效率")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("合理安排Dockerfile指令顺序")])]),s._v(" "),t("ul",[t("li",[s._v("将不常变化的指令放在前面")]),s._v(" "),t("li",[s._v("将频繁变化的指令放在后面")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("利用构建缓存")])]),s._v(" "),t("ul",[t("li",[s._v("避免不必要的"),t("code",[s._v("--no-cache")]),s._v("选项")]),s._v(" "),t("li",[s._v("使用"),t("code",[s._v("COPY")]),s._v("代替"),t("code",[s._v("ADD")]),s._v("（除非需要自动解压）")])])])]),s._v(" "),t("h2",{attrs:{id:"镜像安全最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像安全最佳实践"}},[s._v("#")]),s._v(" 镜像安全最佳实践")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("使用官方镜像")])]),s._v(" "),t("ul",[t("li",[s._v("优先使用Docker官方认证的镜像")]),s._v(" "),t("li",[s._v("检查镜像的下载量和星级")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("定期更新基础镜像")])]),s._v(" "),t("ul",[t("li",[s._v("使用CI/CD自动构建最新版本")]),s._v(" "),t("li",[s._v("设置镜像扫描机制")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("不在镜像中存储敏感信息")])]),s._v(" "),t("ul",[t("li",[s._v("使用环境变量或Docker secrets")]),s._v(" "),t("li",[s._v("避免在Dockerfile中硬编码密钥")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("以非root用户运行")])])])]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:14-alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建非root用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" addgroup -S appgroup && adduser -S appuser -G appgroup")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换到非root用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" appuser")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.js"')]),s._v("]")]),s._v("\n")])])]),t("h2",{attrs:{id:"镜像仓库管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像仓库管理"}},[s._v("#")]),s._v(" 镜像仓库管理")]),s._v(" "),t("h3",{attrs:{id:"docker-hub"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-hub"}},[s._v("#")]),s._v(" Docker Hub")]),s._v(" "),t("ul",[t("li",[s._v("公共镜像仓库，提供免费和付费计划")]),s._v(" "),t("li",[s._v("支持自动构建、团队协作等功能")])]),s._v(" "),t("h3",{attrs:{id:"私有仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#私有仓库"}},[s._v("#")]),s._v(" 私有仓库")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("Docker Registry")])])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动本地Registry")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" registry registry:2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送镜像到本地Registry")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag myapp:latest localhost:5000/myapp:latest\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push localhost:5000/myapp:latest\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[t("strong",[s._v("Harbor")]),s._v(" "),t("ul",[t("li",[s._v("企业级Registry，提供RBAC、漏洞扫描等功能")]),s._v(" "),t("li",[s._v("支持多租户、镜像复制等高级特性")])])])]),s._v(" "),t("h2",{attrs:{id:"常见问题与解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见问题与解决方案"}},[s._v("#")]),s._v(" 常见问题与解决方案")]),s._v(" "),t("h3",{attrs:{id:"拉取镜像失败"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像失败"}},[s._v("#")]),s._v(" 拉取镜像失败")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("网络问题")])]),s._v(" "),t("ul",[t("li",[s._v("检查网络连接")]),s._v(" "),t("li",[s._v("配置镜像加速器")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("权限问题")])]),s._v(" "),t("ul",[t("li",[s._v("确认已登录到私有仓库")]),s._v(" "),t("li",[s._v("检查用户权限")])])])]),s._v(" "),t("h3",{attrs:{id:"镜像构建失败"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像构建失败"}},[s._v("#")]),s._v(" 镜像构建失败")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("上下文问题")])]),s._v(" "),t("ul",[t("li",[s._v("确保构建上下文正确")]),s._v(" "),t("li",[s._v("使用.dockerignore排除不需要的文件")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("依赖问题")])]),s._v(" "),t("ul",[t("li",[s._v("检查网络连接")]),s._v(" "),t("li",[s._v("确保依赖包可访问")])])])]),s._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("Docker镜像是容器化应用的基础，掌握镜像的管理和优化技巧对于高效使用Docker至关重要。通过合理构建和管理镜像，可以显著提高开发和部署效率，同时保证应用的安全性和可靠性。")]),s._v(" "),t("h2",{attrs:{id:"下一步学习"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下一步学习"}},[s._v("#")]),s._v(" 下一步学习")]),s._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/docker/docker-containers.html"}},[s._v("Docker容器管理")])],1),s._v(" "),t("li",[t("RouterLink",{attrs:{to:"/docker/docker-network.html"}},[s._v("Docker网络配置")])],1),s._v(" "),t("li",[t("RouterLink",{attrs:{to:"/docker/docker-volumes.html"}},[s._v("Docker数据卷管理")])],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);