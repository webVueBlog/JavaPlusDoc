(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{1400:function(t,a,s){"use strict";s.r(a);var n=s(1),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"elfk生产集群搭建指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elfk生产集群搭建指南"}},[t._v("#")]),t._v(" ELFK生产集群搭建指南")]),t._v(" "),a("h2",{attrs:{id:"_1-elfk架构概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-elfk架构概述"}},[t._v("#")]),t._v(" 1. ELFK架构概述")]),t._v(" "),a("p",[t._v("ELFK是一个强大的日志收集、处理、存储和可视化的解决方案，由以下组件组成：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Elasticsearch")]),t._v("：分布式搜索和分析引擎，用于存储和检索日志数据")]),t._v(" "),a("li",[a("strong",[t._v("Logstash")]),t._v("：数据处理管道，用于收集、转换和发送日志数据")]),t._v(" "),a("li",[a("strong",[t._v("Filebeat")]),t._v("：轻量级日志收集器，部署在各个服务器上收集日志文件")]),t._v(" "),a("li",[a("strong",[t._v("Kafka")]),t._v("：分布式消息队列，作为日志数据的缓冲层，提高系统的可靠性和扩展性")]),t._v(" "),a("li",[a("strong",[t._v("Kibana")]),t._v("：数据可视化平台，提供日志数据的搜索、分析和展示功能")])]),t._v(" "),a("p",[t._v("在ELFK架构中，Filebeat收集日志并发送到Kafka，Logstash从Kafka消费数据并进行处理后存入Elasticsearch，最后通过Kibana进行可视化展示。")]),t._v(" "),a("p",[a("img",{attrs:{src:s(873),alt:"ELFK架构图"}})]),t._v(" "),a("h2",{attrs:{id:"_2-环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-环境准备"}},[t._v("#")]),t._v(" 2. 环境准备")]),t._v(" "),a("h3",{attrs:{id:"_2-1-服务器规划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-服务器规划"}},[t._v("#")]),t._v(" 2.1 服务器规划")]),t._v(" "),a("p",[t._v("对于生产环境，建议至少准备以下服务器：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("服务器角色")]),t._v(" "),a("th",[t._v("数量")]),t._v(" "),a("th",[t._v("配置建议")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Elasticsearch主节点")]),t._v(" "),a("td",[t._v("3台")]),t._v(" "),a("td",[t._v("8核16G内存")]),t._v(" "),a("td",[t._v("负责集群管理")])]),t._v(" "),a("tr",[a("td",[t._v("Elasticsearch数据节点")]),t._v(" "),a("td",[t._v("3+台")]),t._v(" "),a("td",[t._v("16核32G内存，大容量SSD")]),t._v(" "),a("td",[t._v("存储和检索数据")])]),t._v(" "),a("tr",[a("td",[t._v("Kafka集群")]),t._v(" "),a("td",[t._v("3+台")]),t._v(" "),a("td",[t._v("8核16G内存")]),t._v(" "),a("td",[t._v("消息队列")])]),t._v(" "),a("tr",[a("td",[t._v("Logstash服务器")]),t._v(" "),a("td",[t._v("2+台")]),t._v(" "),a("td",[t._v("8核16G内存")]),t._v(" "),a("td",[t._v("数据处理")])]),t._v(" "),a("tr",[a("td",[t._v("Kibana服务器")]),t._v(" "),a("td",[t._v("2台")]),t._v(" "),a("td",[t._v("4核8G内存")]),t._v(" "),a("td",[t._v("可视化界面")])])])]),t._v(" "),a("h3",{attrs:{id:"_2-2-网络规划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-网络规划"}},[t._v("#")]),t._v(" 2.2 网络规划")]),t._v(" "),a("ul",[a("li",[t._v("所有服务器应该在同一内网环境")]),t._v(" "),a("li",[t._v("配置合适的防火墙规则，只开放必要的端口")]),t._v(" "),a("li",[t._v("建议使用专用网络接口用于集群内部通信")])]),t._v(" "),a("h3",{attrs:{id:"_2-3-操作系统优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-操作系统优化"}},[t._v("#")]),t._v(" 2.3 操作系统优化")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改系统限制，添加到/etc/sysctl.conf")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("vm.max_map_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("262144")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("net.core.somaxconn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32768")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("net.ipv4.tcp_max_syn_backlog")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8192")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("net.ipv4.tcp_slow_start_after_idle")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("net.ipv4.tcp_tw_reuse")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("net.ipv4.ip_local_port_range")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改文件描述符限制，添加到/etc/security/limits.conf")]),t._v("\n* soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65536")]),t._v("\n* hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65536")]),t._v("\n* soft nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32768")]),t._v("\n* hard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32768")]),t._v("\n")])])]),a("h2",{attrs:{id:"_3-elasticsearch集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-elasticsearch集群部署"}},[t._v("#")]),t._v(" 3. Elasticsearch集群部署")]),t._v(" "),a("h3",{attrs:{id:"_3-1-安装elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-安装elasticsearch"}},[t._v("#")]),t._v(" 3.1 安装Elasticsearch")]),t._v(" "),a("p",[t._v("我们使用Docker方式部署Elasticsearch集群。首先创建docker-compose.yml文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("es01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.elastic.co/elasticsearch/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.17.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" es01\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node.name=es01\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cluster.name=es"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" discovery.seed_hosts=es02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cluster.initial_master_nodes=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" bootstrap.memory_lock=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ES_JAVA_OPTS=-Xms8g -Xmx8g"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ulimits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memlock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("soft")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hard")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" esdata01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/share/elasticsearch/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 9200"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9200")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" elastic\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("es02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.elastic.co/elasticsearch/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.17.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" es02\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node.name=es02\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cluster.name=es"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" discovery.seed_hosts=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cluster.initial_master_nodes=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" bootstrap.memory_lock=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ES_JAVA_OPTS=-Xms8g -Xmx8g"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ulimits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memlock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("soft")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hard")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" esdata02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/share/elasticsearch/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" elastic\n      \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("es03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.elastic.co/elasticsearch/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.17.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" es03\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node.name=es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cluster.name=es"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" discovery.seed_hosts=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es02\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cluster.initial_master_nodes=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" bootstrap.memory_lock=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ES_JAVA_OPTS=-Xms8g -Xmx8g"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ulimits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memlock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("soft")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hard")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" esdata03"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/share/elasticsearch/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" elastic\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("esdata01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("esdata02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("esdata03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("elastic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n")])])]),a("p",[t._v("启动Elasticsearch集群：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-2-配置elasticsearch安全认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-配置elasticsearch安全认证"}},[t._v("#")]),t._v(" 3.2 配置Elasticsearch安全认证")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" es01 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置密码")]),t._v("\n./bin/elasticsearch-setup-passwords auto\n")])])]),a("p",[t._v("记录下生成的密码，后续配置需要使用。")]),t._v(" "),a("h3",{attrs:{id:"_3-3-配置elasticsearch集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-配置elasticsearch集群"}},[t._v("#")]),t._v(" 3.3 配置Elasticsearch集群")]),t._v(" "),a("p",[t._v("创建索引生命周期管理策略：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9200/_ilm/policy/logs-policy?pretty"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'\n{\n  "policy": {\n    "phases": {\n      "hot": {\n        "min_age": "0ms",\n        "actions": {\n          "rollover": {\n            "max_age": "1d",\n            "max_size": "50gb"\n          },\n          "set_priority": {\n            "priority": 100\n          }\n        }\n      },\n      "warm": {\n        "min_age": "3d",\n        "actions": {\n          "shrink": {\n            "number_of_shards": 1\n          },\n          "forcemerge": {\n            "max_num_segments": 1\n          },\n          "set_priority": {\n            "priority": 50\n          }\n        }\n      },\n      "cold": {\n        "min_age": "30d",\n        "actions": {\n          "set_priority": {\n            "priority": 0\n          }\n        }\n      },\n      "delete": {\n        "min_age": "90d",\n        "actions": {\n          "delete": {}\n        }\n      }\n    }\n  }\n}\'')]),t._v("\n")])])]),a("p",[t._v("创建索引模板：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9200/_template/logs-template?pretty"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'\n{\n  "index_patterns": ["logs-*"],\n  "settings": {\n    "number_of_shards": 3,\n    "number_of_replicas": 1,\n    "index.lifecycle.name": "logs-policy",\n    "index.lifecycle.rollover_alias": "logs"\n  },\n  "mappings": {\n    "properties": {\n      "@timestamp": { "type": "date" },\n      "message": { "type": "text" },\n      "level": { "type": "keyword" },\n      "service": { "type": "keyword" },\n      "host": { "type": "keyword" }\n    }\n  }\n}\'')]),t._v("\n")])])]),a("h2",{attrs:{id:"_4-kafka集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-kafka集群部署"}},[t._v("#")]),t._v(" 4. Kafka集群部署")]),t._v(" "),a("h3",{attrs:{id:"_4-1-安装kafka"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-安装kafka"}},[t._v("#")]),t._v(" 4.1 安装Kafka")]),t._v(" "),a("p",[t._v("创建docker-compose.yml文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" confluentinc/cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_CLIENT_PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_TICK_TIME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_SERVER_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_SERVERS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3888;zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3888;zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3888")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2181:2181"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/zookeeper/data\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/zookeeper/log\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" confluentinc/cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_CLIENT_PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_TICK_TIME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_SERVER_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_SERVERS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3888;zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3888;zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3888")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/zookeeper/data\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/zookeeper/log\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" confluentinc/cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_CLIENT_PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_TICK_TIME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_SERVER_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ZOOKEEPER_SERVERS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3888;zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3888;zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3888")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/zookeeper/data\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/zookeeper/log\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" confluentinc/cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9092:9092"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_BROKER_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_ZOOKEEPER_CONNECT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_ADVERTISED_LISTENERS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("29092")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PLAINTEXT_HOST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9092")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_LISTENER_SECURITY_PROTOCOL_MAP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PLAINTEXT_HOST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("PLAINTEXT\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_INTER_BROKER_LISTENER_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_AUTO_CREATE_TOPICS_ENABLE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/kafka/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" confluentinc/cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9093:9093"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_BROKER_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_ZOOKEEPER_CONNECT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_ADVERTISED_LISTENERS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("29093")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PLAINTEXT_HOST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9093")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_LISTENER_SECURITY_PROTOCOL_MAP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PLAINTEXT_HOST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("PLAINTEXT\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_INTER_BROKER_LISTENER_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_AUTO_CREATE_TOPICS_ENABLE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/kafka/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" confluentinc/cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9094:9094"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_BROKER_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_ZOOKEEPER_CONNECT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_ADVERTISED_LISTENERS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("29094")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PLAINTEXT_HOST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9094")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_LISTENER_SECURITY_PROTOCOL_MAP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("PLAINTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PLAINTEXT_HOST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("PLAINTEXT\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_INTER_BROKER_LISTENER_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PLAINTEXT\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("KAFKA_AUTO_CREATE_TOPICS_ENABLE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/kafka/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-1-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-1-log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-2-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-2-log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-3-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper-3-log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-1-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-2-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-3-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-net")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n")])])]),a("p",[t._v("启动Kafka集群：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-2-创建kafka主题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-创建kafka主题"}},[t._v("#")]),t._v(" 4.2 创建Kafka主题")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入Kafka容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" kafka-1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建日志主题，3个分区，3个副本")]),t._v("\nkafka-topics "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--topic")]),t._v(" app-logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--partitions")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" --replication-factor "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" --bootstrap-server kafka-1:29092\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建系统日志主题")]),t._v("\nkafka-topics "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--topic")]),t._v(" system-logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--partitions")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" --replication-factor "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" --bootstrap-server kafka-1:29092\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看主题列表")]),t._v("\nkafka-topics "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--list")]),t._v(" --bootstrap-server kafka-1:29092\n")])])]),a("h2",{attrs:{id:"_5-logstash部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-logstash部署"}},[t._v("#")]),t._v(" 5. Logstash部署")]),t._v(" "),a("h3",{attrs:{id:"_5-1-安装logstash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-安装logstash"}},[t._v("#")]),t._v(" 5.1 安装Logstash")]),t._v(" "),a("p",[t._v("创建Logstash配置文件 "),a("code",[t._v("logstash.conf")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-conf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('input {\n  kafka {\n    bootstrap_servers => "kafka-1:29092,kafka-2:29093,kafka-3:29094"\n    topics => ["app-logs", "system-logs"]\n    group_id => "logstash"\n    auto_offset_reset => "latest"\n    consumer_threads => 3\n    decorate_events => true\n  }\n}\n\nfilter {\n  if [kafka][topic] == "app-logs" {\n    json {\n      source => "message"\n    }\n    date {\n      match => [ "timestamp", "ISO8601" ]\n      target => "@timestamp"\n    }\n    mutate {\n      remove_field => [ "timestamp" ]\n    }\n  } else if [kafka][topic] == "system-logs" {\n    grok {\n      match => { "message" => "%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{DATA:syslog_program}(?:\\[%{POSINT:syslog_pid}\\])?: %{GREEDYDATA:syslog_message}" }\n    }\n    date {\n      match => [ "syslog_timestamp", "MMM  d HH:mm:ss", "MMM dd HH:mm:ss" ]\n      target => "@timestamp"\n    }\n  }\n  \n  # 添加处理节点信息\n  mutate {\n    add_field => { "logstash_node" => "${HOSTNAME}" }\n  }\n}\n\noutput {\n  if [kafka][topic] == "app-logs" {\n    elasticsearch {\n      hosts => ["es01:9200", "es02:9200", "es03:9200"]\n      user => "elastic"\n      password => "${ELASTIC_PASSWORD}"\n      index => "app-logs-%{+YYYY.MM.dd}"\n      ilm_enabled => true\n      ilm_rollover_alias => "app-logs"\n      ilm_pattern => "{now/d}-000001"\n      ilm_policy => "logs-policy"\n    }\n  } else if [kafka][topic] == "system-logs" {\n    elasticsearch {\n      hosts => ["es01:9200", "es02:9200", "es03:9200"]\n      user => "elastic"\n      password => "${ELASTIC_PASSWORD}"\n      index => "system-logs-%{+YYYY.MM.dd}"\n      ilm_enabled => true\n      ilm_rollover_alias => "system-logs"\n      ilm_pattern => "{now/d}-000001"\n      ilm_policy => "logs-policy"\n    }\n  }\n}\n')])])]),a("p",[t._v("创建docker-compose.yml文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logstash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.elastic.co/logstash/logstash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.17.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" logstash\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./logstash.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/share/logstash/pipeline/logstash.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./logstash.yml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/share/logstash/config/logstash.yml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LS_JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-Xmx1g -Xms1g"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ELASTIC_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your_elastic_password"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" elastic\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("elastic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-net")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("p",[t._v("创建logstash.yml配置文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack.monitoring.elasticsearch.hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://es01:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://es02:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://es03:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack.monitoring.elasticsearch.username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" elastic\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack.monitoring.elasticsearch.password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ELASTIC_PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack.monitoring.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipeline.workers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipeline.batch.size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipeline.batch.delay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("queue.type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" persisted\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("queue.max_bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1gb\n")])])]),a("p",[t._v("启动Logstash：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n")])])]),a("h2",{attrs:{id:"_6-filebeat部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-filebeat部署"}},[t._v("#")]),t._v(" 6. Filebeat部署")]),t._v(" "),a("h3",{attrs:{id:"_6-1-创建filebeat配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-创建filebeat配置"}},[t._v("#")]),t._v(" 6.1 创建Filebeat配置")]),t._v(" "),a("p",[t._v("创建filebeat.yml配置文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/log/app/"),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log_type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields_under_root")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("json.keys_under_root")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("json.message_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("json.add_error_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/log/system/"),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log_type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" system\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields_under_root")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("processors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("add_host_metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("add_cloud_metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.kafka")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kafka-1:29092"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kafka-2:29093"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kafka-3:29094"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%{[log_type]}-logs'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("partition.round_robin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reachable_only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required_acks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max_message_bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logging.level")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" info\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logging.to_files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logging.files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/log/filebeat\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keepfiles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("permissions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0644")]),t._v("\n")])])]),a("h3",{attrs:{id:"_6-2-部署filebeat到应用服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-部署filebeat到应用服务器"}},[t._v("#")]),t._v(" 6.2 部署Filebeat到应用服务器")]),t._v(" "),a("p",[t._v("创建docker-compose.yml文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.elastic.co/beats/filebeat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.17.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./filebeat.yml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/share/filebeat/filebeat.yml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/lib/docker/containers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/docker/containers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/docker.sock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/run/docker.sock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" strict.perms=false\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kafka-net")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("p",[t._v("启动Filebeat：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n")])])]),a("h2",{attrs:{id:"_7-kibana部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-kibana部署"}},[t._v("#")]),t._v(" 7. Kibana部署")]),t._v(" "),a("h3",{attrs:{id:"_7-1-安装kibana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-安装kibana"}},[t._v("#")]),t._v(" 7.1 安装Kibana")]),t._v(" "),a("p",[t._v("创建docker-compose.yml文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kibana")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.elastic.co/kibana/kibana"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.17.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kibana\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ELASTICSEARCH_HOSTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"http://es01:9200","http://es02:9200","http://es03:9200"\'')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ELASTICSEARCH_USERNAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" elastic\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ELASTICSEARCH_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your_elastic_password"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 5601"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5601")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" elastic\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("elastic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("p",[t._v("启动Kibana：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n")])])]),a("h3",{attrs:{id:"_7-2-配置kibana仪表板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-配置kibana仪表板"}},[t._v("#")]),t._v(" 7.2 配置Kibana仪表板")]),t._v(" "),a("ol",[a("li",[t._v("访问Kibana界面："),a("code",[t._v("http://your-kibana-host:5601")])]),t._v(" "),a("li",[t._v("创建索引模式：\n"),a("ul",[a("li",[t._v("导航到 Management > Stack Management > Kibana > Index Patterns")]),t._v(" "),a("li",[t._v("创建索引模式 "),a("code",[t._v("app-logs-*")]),t._v(" 和 "),a("code",[t._v("system-logs-*")])]),t._v(" "),a("li",[t._v("设置时间字段为 "),a("code",[t._v("@timestamp")])])])]),t._v(" "),a("li",[t._v("创建可视化和仪表板：\n"),a("ul",[a("li",[t._v("导航到 Dashboard")]),t._v(" "),a("li",[t._v("创建新仪表板")]),t._v(" "),a("li",[t._v("添加各种可视化组件，如日志计数、错误率、响应时间等")])])])]),t._v(" "),a("h2",{attrs:{id:"_8-系统监控与告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-系统监控与告警"}},[t._v("#")]),t._v(" 8. 系统监控与告警")]),t._v(" "),a("h3",{attrs:{id:"_8-1-设置elasticsearch监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-设置elasticsearch监控"}},[t._v("#")]),t._v(" 8.1 设置Elasticsearch监控")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9200/_cluster/settings"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'\n{\n  "persistent": {\n    "xpack.monitoring.collection.enabled": true\n  }\n}\'')]),t._v("\n")])])]),a("h3",{attrs:{id:"_8-2-配置kibana告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-配置kibana告警"}},[t._v("#")]),t._v(" 8.2 配置Kibana告警")]),t._v(" "),a("ol",[a("li",[t._v("导航到 Management > Stack Management > Alerts and Insights > Rules")]),t._v(" "),a("li",[t._v("创建新规则，例如：\n"),a("ul",[a("li",[t._v("当错误日志数量在5分钟内超过100条时发送告警")]),t._v(" "),a("li",[t._v("当集群健康状态变为黄色或红色时发送告警")]),t._v(" "),a("li",[t._v("当磁盘使用率超过85%时发送告警")])])])]),t._v(" "),a("h3",{attrs:{id:"_8-3-配置通知渠道"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-配置通知渠道"}},[t._v("#")]),t._v(" 8.3 配置通知渠道")]),t._v(" "),a("ol",[a("li",[t._v("导航到 Management > Stack Management > Alerts and Insights > Connectors")]),t._v(" "),a("li",[t._v("添加通知渠道，如Email、Slack、WebHook等")])]),t._v(" "),a("h2",{attrs:{id:"_9-性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-性能优化"}},[t._v("#")]),t._v(" 9. 性能优化")]),t._v(" "),a("h3",{attrs:{id:"_9-1-elasticsearch性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-elasticsearch性能优化"}},[t._v("#")]),t._v(" 9.1 Elasticsearch性能优化")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加到elasticsearch.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("indices.memory.index_buffer_size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 30%\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("indices.queries.cache.size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10%\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("thread_pool.write.queue_size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("thread_pool.search.queue_size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n")])])]),a("h3",{attrs:{id:"_9-2-kafka性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-kafka性能优化"}},[t._v("#")]),t._v(" 9.2 Kafka性能优化")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加到server.properties")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("num.io.threads")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("16")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("num.network.threads")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("socket.send.buffer.bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1048576")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("socket.receive.buffer.bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1048576")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("socket.request.max.bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("104857600")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log.flush.interval.messages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log.flush.interval.ms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log.retention.hours")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("168")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log.segment.bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1073741824")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log.cleaner.enable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n")])])]),a("h3",{attrs:{id:"_9-3-logstash性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-logstash性能优化"}},[t._v("#")]),t._v(" 9.3 Logstash性能优化")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加到logstash.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipeline.workers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipeline.batch.size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipeline.batch.delay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("queue.type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" persisted\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("queue.max_bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 2gb\n")])])]),a("h2",{attrs:{id:"_10-备份与恢复策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-备份与恢复策略"}},[t._v("#")]),t._v(" 10. 备份与恢复策略")]),t._v(" "),a("h3",{attrs:{id:"_10-1-elasticsearch快照备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-elasticsearch快照备份"}},[t._v("#")]),t._v(" 10.1 Elasticsearch快照备份")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注册快照仓库")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9200/_snapshot/backup_repo"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'\n{\n  "type": "fs",\n  "settings": {\n    "location": "/usr/share/elasticsearch/backup"\n  }\n}\'')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建快照")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9200/_snapshot/backup_repo/snapshot_1?wait_for_completion=true"')]),t._v("\n")])])]),a("h3",{attrs:{id:"_10-2-自动备份脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-自动备份脚本"}},[t._v("#")]),t._v(" 10.2 自动备份脚本")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" +%Y%m%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SNAPSHOT_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"snapshot_'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${DATE}")]),t._v('"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建快照")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:9200/_snapshot/backup_repo/'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${SNAPSHOT_NAME}")]),t._v('?wait_for_completion=true"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'\n{\n  "indices": "*",\n  "ignore_unavailable": true,\n  "include_global_state": true\n}\'')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除7天前的快照")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("OLD_DATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"7 days ago"')]),t._v(" +%Y%m%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("OLD_SNAPSHOT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"snapshot_'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OLD_DATE}")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" DELETE "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:9200/_snapshot/backup_repo/'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OLD_SNAPSHOT}")]),t._v('"')]),t._v("\n")])])]),a("h2",{attrs:{id:"_11-故障排除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-故障排除"}},[t._v("#")]),t._v(" 11. 故障排除")]),t._v(" "),a("h3",{attrs:{id:"_11-1-常见问题及解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-常见问题及解决方案"}},[t._v("#")]),t._v(" 11.1 常见问题及解决方案")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("Elasticsearch集群状态为黄色或红色")])]),t._v(" "),a("ul",[a("li",[t._v("检查节点是否正常运行")]),t._v(" "),a("li",[t._v("检查磁盘空间")]),t._v(" "),a("li",[t._v("查看日志文件中的错误信息")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Kafka消息积压")])]),t._v(" "),a("ul",[a("li",[t._v("增加Logstash实例数量")]),t._v(" "),a("li",[t._v("优化Logstash配置，提高处理效率")]),t._v(" "),a("li",[t._v("检查Elasticsearch写入性能")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Filebeat无法发送日志到Kafka")])]),t._v(" "),a("ul",[a("li",[t._v("检查网络连接")]),t._v(" "),a("li",[t._v("验证Kafka集群状态")]),t._v(" "),a("li",[t._v("查看Filebeat日志")])])])]),t._v(" "),a("h3",{attrs:{id:"_11-2-日志分析命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-日志分析命令"}},[t._v("#")]),t._v(" 11.2 日志分析命令")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看Elasticsearch集群健康状态")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" GET "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9200/_cluster/health?pretty"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看Elasticsearch索引状态")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" GET "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9200/_cat/indices?v"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看Kafka消费组状态")]),t._v("\nkafka-consumer-groups --bootstrap-server kafka-1:29092 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--describe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--group")]),t._v(" logstash\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看Logstash处理延迟")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" GET "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9600/_node/stats/pipeline?pretty"')]),t._v("\n")])])]),a("h2",{attrs:{id:"_12-扩展与升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-扩展与升级"}},[t._v("#")]),t._v(" 12. 扩展与升级")]),t._v(" "),a("h3",{attrs:{id:"_12-1-扩展elasticsearch集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-扩展elasticsearch集群"}},[t._v("#")]),t._v(" 12.1 扩展Elasticsearch集群")]),t._v(" "),a("ol",[a("li",[t._v("准备新节点，安装Elasticsearch")]),t._v(" "),a("li",[t._v("配置与现有集群相同的集群名称")]),t._v(" "),a("li",[t._v("设置discovery.seed_hosts指向现有节点")]),t._v(" "),a("li",[t._v("启动新节点，它将自动加入集群")])]),t._v(" "),a("h3",{attrs:{id:"_12-2-升级elfk组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-升级elfk组件"}},[t._v("#")]),t._v(" 12.2 升级ELFK组件")]),t._v(" "),a("p",[t._v("升级Elasticsearch：")]),t._v(" "),a("ol",[a("li",[t._v("备份数据")]),t._v(" "),a("li",[t._v("逐个节点升级，先升级从节点，最后升级主节点")]),t._v(" "),a("li",[t._v("每次升级后验证集群健康状态")])]),t._v(" "),a("p",[t._v("升级Kafka：")]),t._v(" "),a("ol",[a("li",[t._v("逐个升级Kafka broker")]),t._v(" "),a("li",[t._v("确保每个broker升级后正常工作再升级下一个")])]),t._v(" "),a("p",[t._v("升级Logstash和Filebeat：")]),t._v(" "),a("ol",[a("li",[t._v("升级配置文件以兼容新版本")]),t._v(" "),a("li",[t._v("逐个升级实例")])]),t._v(" "),a("h2",{attrs:{id:"_13-安全加固"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-安全加固"}},[t._v("#")]),t._v(" 13. 安全加固")]),t._v(" "),a("h3",{attrs:{id:"_13-1-网络安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-1-网络安全"}},[t._v("#")]),t._v(" 13.1 网络安全")]),t._v(" "),a("ol",[a("li",[t._v("使用专用网络隔离ELFK集群")]),t._v(" "),a("li",[t._v("配置防火墙，只允许必要的端口访问")]),t._v(" "),a("li",[t._v("使用TLS加密集群内部通信")])]),t._v(" "),a("h3",{attrs:{id:"_13-2-认证与授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-认证与授权"}},[t._v("#")]),t._v(" 13.2 认证与授权")]),t._v(" "),a("ol",[a("li",[t._v("启用Elasticsearch安全功能")]),t._v(" "),a("li",[t._v("创建不同角色的用户，遵循最小权限原则")]),t._v(" "),a("li",[t._v("使用API密钥进行服务间认证")])]),t._v(" "),a("h3",{attrs:{id:"_13-3-数据安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-3-数据安全"}},[t._v("#")]),t._v(" 13.3 数据安全")]),t._v(" "),a("ol",[a("li",[t._v("启用传输和存储加密")]),t._v(" "),a("li",[t._v("实施数据脱敏，保护敏感信息")]),t._v(" "),a("li",[t._v("定期审计访问日志")])]),t._v(" "),a("h2",{attrs:{id:"_14-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-总结"}},[t._v("#")]),t._v(" 14. 总结")]),t._v(" "),a("p",[t._v("本文详细介绍了如何搭建生产级ELFK集群，包括：")]),t._v(" "),a("ul",[a("li",[t._v("Elasticsearch集群部署与配置")]),t._v(" "),a("li",[t._v("Kafka集群部署与主题创建")]),t._v(" "),a("li",[t._v("Logstash配置与优化")]),t._v(" "),a("li",[t._v("Filebeat部署到应用服务器")]),t._v(" "),a("li",[t._v("Kibana安装与仪表板配置")]),t._v(" "),a("li",[t._v("系统监控与告警设置")]),t._v(" "),a("li",[t._v("性能优化建议")]),t._v(" "),a("li",[t._v("备份与恢复策略")]),t._v(" "),a("li",[t._v("故障排除指南")]),t._v(" "),a("li",[t._v("扩展与升级方法")]),t._v(" "),a("li",[t._v("安全加固措施")])]),t._v(" "),a("p",[t._v("通过遵循本指南，您可以构建一个高可用、高性能、安全可靠的ELFK日志系统，为应用程序提供强大的日志收集、处理、存储和分析能力。")])])}),[],!1,null,null,null);a.default=e.exports},873:function(t,a,s){t.exports=s.p+"assets/img/elfk-architecture.3c9d15c5.svg"}}]);