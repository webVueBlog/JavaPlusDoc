(window.webpackJsonp=window.webpackJsonp||[]).push([[538],{1408:function(e,a,s){"use strict";s.r(a);var r=s(1),t=Object(r.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("blockquote",[a("p",[e._v("点击勘误"),a("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[e._v("issues"),a("OutboundLink")],1),e._v("，哪吒感谢大家的阅读")])]),e._v(" "),a("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),e._v(" "),a("h2",{attrs:{id:"安装rocketmq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装rocketmq"}},[e._v("#")]),e._v(" 安装RocketMQ")]),e._v(" "),a("p",[e._v("准备工作")]),e._v(" "),a("p",[e._v("开通端口")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("firewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("9876")]),e._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--permanent")]),e._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10911")]),e._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--permanent")]),e._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("19876")]),e._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--permanent")]),e._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--reload")]),e._v("\n\n")])])]),a("p",[e._v("创建目录")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" /home/docker/rocketmq/namesrv/logs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" /home/docker/rocketmq/broker1/conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" /home/docker/rocketmq/broker1/logs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" /home/docker/rocketmq/broker1/store\n\n")])])]),a("p",[e._v("创建配置文件")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /home/docker/rocketmq/broker1/conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("touch")]),e._v(" broker.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" broker.conf\n\n")])])]),a("p",[e._v("配置文件")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 所属集群名称，如果节点较多可以配置多个")]),e._v("\nbrokerClusterName "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" DefaultCluster\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#broker名称，master和slave使用相同的名称，表明他们的主从关系")]),e._v("\nbrokerName "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" broker1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#0表示Master，大于0表示不同的slave")]),e._v("\nbrokerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#表示几点做消息删除动作，默认是凌晨4点")]),e._v("\ndeleteWhen "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" 04\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#在磁盘上保留消息的时长，单位是小时")]),e._v("\nfileReservedTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("48")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；")]),e._v("\nbrokerRole "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" ASYNC_MASTER\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；")]),e._v("\nflushDiskType "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" ASYNC_FLUSH\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 设置broker节点所在服务器的ip地址（**这个非常重要,主从模式下，从节点会根据主节点的brokerIP2来同步数据，如果不配置，主从无法同步，brokerIP1设置为自己外网能访问的ip，服务器双网卡情况下必须配置，比如阿里云这种，主节点需要配置ip1和ip2，从节点只需要配置ip1即可）")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 此ip由使用环境决定 本机使用 127 局域网使用 192 外网使用 外网ip")]),e._v("\nbrokerIP1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),e._v(".1.71\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#nameServer地址，分号分割")]),e._v("\nnamesrvAddr "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9876\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#Broker 对外服务的监听端口,")]),e._v("\nlistenPort "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10911")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#是否允许Broker自动创建Topic")]),e._v("\nautoCreateTopicEnable "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#是否允许 Broker 自动创建订阅组")]),e._v("\nautoCreateSubscriptionGroup "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#linux开启epoll")]),e._v("\nuseEpollNativeSelector "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n\n")])])]),a("p",[e._v("分配权限（最重要） 为所有目录包括子目录分配读写权限 没有写权限无法存储 会报错无法启动")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-R")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("777")]),e._v(" /docker/rocketmq\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-R")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("777")]),e._v(" /home/docker/rocketmq/namesrv/logs\n")])])]),a("p",[e._v("docker-compose")]),e._v(" "),a("p",[e._v("docker-compose.yaml")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"3"')]),e._v("\nservices:\n  mqnamesrv:\n    image: apache/rocketmq:4.9.3\n    container_name: mqnamesrv\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"9876:9876"')]),e._v("\n    environment:\n      JAVA_OPT: "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-server")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-Xms512m")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-Xmx512m")]),e._v("\n    command: "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sh")]),e._v(" mqnamesrv\n    volumes:\n      - /home/docker/rocketmq/namesrv/logs:/home/rocketmq/logs/rocketmqlogs\n    network_mode: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"host"')]),e._v("\n\n  mqbroker1:\n    image: apache/rocketmq:4.9.3\n    container_name: mqbroker1\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"10911:10911"')]),e._v("\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"10909:10909"')]),e._v("\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"10912:10912"')]),e._v("\n    environment:\n      JAVA_OPT_EXT: "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-server")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-Xms512M")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-Xmx512M")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-Xmn256m")]),e._v("\n    command: "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sh")]),e._v(" mqbroker "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-c")]),e._v(" /home/rocketmq/rocketmq-4.9.3/conf/broker.conf\n    depends_on:\n      - mqnamesrv\n    volumes:\n      - /home/docker/rocketmq/broker1/conf/broker.conf:/home/rocketmq/rocketmq-4.9.3/conf/broker.conf\n      - /home/docker/rocketmq/broker1/logs:/home/rocketmq/logs/rocketmqlogs\n      - /home/docker/rocketmq/broker1/store:/home/rocketmq/store\n    network_mode: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"host"')]),e._v("\n\n  mqconsole:\n    image: styletang/rocketmq-console-ng\n    container_name: mqconsole\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"19876:19876"')]),e._v("\n    environment:\n      JAVA_OPTS: "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-Dserver.port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("19876")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-Drocketmq.namesrv.addr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9876 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-Dcom.rocketmq.sendMessageWithVIPChannel")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("false\n    depends_on:\n      - mqnamesrv\n    network_mode: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"host"')]),e._v("\n\n")])])]),a("p",[e._v("启动服务")]),e._v(" "),a("p",[e._v("docker-compose up -d mqnamesrv mqbroker1 mqconsole")]),e._v(" "),a("p",[e._v("访问控制台：http://ip:19876/#/")])])}),[],!1,null,null,null);a.default=t.exports}}]);