(window.webpackJsonp=window.webpackJsonp||[]).push([[309],{1124:function(a,s,t){"use strict";t.r(s);var e=t(1),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"docker数据卷管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker数据卷管理"}},[a._v("#")]),a._v(" Docker数据卷管理")]),a._v(" "),s("h2",{attrs:{id:"什么是docker数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是docker数据卷"}},[a._v("#")]),a._v(" 什么是Docker数据卷")]),a._v(" "),s("p",[a._v("Docker数据卷是一种持久化数据的机制，它允许在容器和宿主机之间共享文件和目录。数据卷是独立于容器的特殊目录，具有以下特点：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("数据持久化")]),a._v("：容器删除后，数据卷仍然存在")]),a._v(" "),s("li",[s("strong",[a._v("数据共享")]),a._v("：多个容器可以共享同一个数据卷")]),a._v(" "),s("li",[s("strong",[a._v("数据隔离")]),a._v("：数据卷与容器的生命周期解耦")]),a._v(" "),s("li",[s("strong",[a._v("性能优化")]),a._v("：数据卷的I/O性能通常优于容器内部文件系统")]),a._v(" "),s("li",[s("strong",[a._v("跨平台支持")]),a._v("：数据卷在不同操作系统上工作方式一致")])]),a._v(" "),s("h2",{attrs:{id:"数据管理方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据管理方式"}},[a._v("#")]),a._v(" 数据管理方式")]),a._v(" "),s("p",[a._v("Docker提供了三种主要的数据管理方式：")]),a._v(" "),s("ol",[s("li",[s("strong",[a._v("数据卷（Volumes）")]),a._v("：由Docker管理的宿主机文件系统的一部分（通常在"),s("code",[a._v("/var/lib/docker/volumes/")]),a._v("）")]),a._v(" "),s("li",[s("strong",[a._v("绑定挂载（Bind Mounts）")]),a._v("：将宿主机上的任意目录或文件挂载到容器中")]),a._v(" "),s("li",[s("strong",[a._v("tmpfs挂载（tmpfs Mounts）")]),a._v("：将数据存储在宿主机的内存中，而不是磁盘上")])]),a._v(" "),s("h2",{attrs:{id:"docker数据卷操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker数据卷操作"}},[a._v("#")]),a._v(" Docker数据卷操作")]),a._v(" "),s("h3",{attrs:{id:"创建和管理数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建和管理数据卷"}},[a._v("#")]),a._v(" 创建和管理数据卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create my-volume\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看所有数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看数据卷详细信息")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume inspect my-volume\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" my-volume\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除所有未使用的数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume prune\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建带标签的数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--label")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("production my-volume\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建使用特定驱动的数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--driver")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v(" my-volume\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建带选项的数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("nfs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("o")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.1,rw "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("device")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(":/path/to/dir my-nfs-volume\n")])])]),s("h3",{attrs:{id:"在容器中使用数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在容器中使用数据卷"}},[a._v("#")]),a._v(" 在容器中使用数据卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用数据卷启动容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" my-volume:/app/data nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用只读数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" my-volume:/app/data:ro nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用新语法挂载数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("source")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("my-volume,target"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/data nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用匿名数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /app/data nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用临时数据卷（容器删除后自动删除）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("source")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("my-volume,target"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/data,tmpfs"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true nginx\n")])])]),s("h2",{attrs:{id:"绑定挂载操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#绑定挂载操作"}},[a._v("#")]),a._v(" 绑定挂载操作")]),a._v(" "),s("p",[a._v("绑定挂载允许将宿主机上的任意路径挂载到容器中。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 基本绑定挂载")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /host/path:/container/path nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用只读绑定挂载")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /host/path:/container/path:ro nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用新语法进行绑定挂载")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("bind,source"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/host/path,target"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/container/path nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 挂载单个文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /host/file.conf:/container/file.conf nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用相对路径（不推荐）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("/config:/container/config nginx\n")])])]),s("h2",{attrs:{id:"tmpfs挂载操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tmpfs挂载操作"}},[a._v("#")]),a._v(" tmpfs挂载操作")]),a._v(" "),s("p",[a._v("tmpfs挂载将数据存储在宿主机的内存中，适用于存储非持久化的敏感数据。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 基本tmpfs挂载")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tmpfs")]),a._v(" /app/temp nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定tmpfs选项")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tmpfs")]),a._v(" /app/temp:rw,noexec,nosuid,size"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("100m nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用新语法进行tmpfs挂载")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("tmpfs,destination"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/temp nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定tmpfs大小")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("tmpfs,destination"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/temp,tmpfs-size"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("100m nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定tmpfs模式")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("tmpfs,destination"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/temp,tmpfs-mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1770")]),a._v(" nginx\n")])])]),s("h2",{attrs:{id:"数据卷使用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷使用场景"}},[a._v("#")]),a._v(" 数据卷使用场景")]),a._v(" "),s("h3",{attrs:{id:"数据库持久化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库持久化"}},[a._v("#")]),a._v(" 数据库持久化")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建MySQL数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create mysql-data\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动MySQL容器并使用数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("password "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" mysql-data:/var/lib/mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  mysql:5.7\n")])])]),s("h3",{attrs:{id:"配置文件管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件管理"}},[a._v("#")]),a._v(" 配置文件管理")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建配置数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create nginx-conf\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 从容器复制默认配置到宿主机")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" nginx-conf:/nginx nginx "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"cp -a /etc/nginx/. /nginx/"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用自定义配置启动容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" nginx-conf:/etc/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  nginx\n")])])]),s("h3",{attrs:{id:"应用数据共享"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用数据共享"}},[a._v("#")]),a._v(" 应用数据共享")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建共享数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create shared-data\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动多个容器共享数据")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" app1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" shared-data:/app/data nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" app2 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" shared-data:/app/data nginx\n")])])]),s("h3",{attrs:{id:"开发环境代码挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发环境代码挂载"}},[a._v("#")]),a._v(" 开发环境代码挂载")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 挂载源代码目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" node-app "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/app "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" /app "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v(":3000 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  node:14 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" start\n")])])]),s("h2",{attrs:{id:"数据卷备份与恢复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷备份与恢复"}},[a._v("#")]),a._v(" 数据卷备份与恢复")]),a._v(" "),s("h3",{attrs:{id:"备份数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份数据卷"}},[a._v("#")]),a._v(" 备份数据卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用临时容器备份数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" my-volume:/source "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/backup "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  alpine "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-czvf")]),a._v(" /backup/my-volume-backup.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /source "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),s("h3",{attrs:{id:"恢复数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恢复数据卷"}},[a._v("#")]),a._v(" 恢复数据卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建新数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create my-new-volume\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用临时容器恢复数据")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" my-new-volume:/target "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/backup "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  alpine "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tar -xzvf /backup/my-volume-backup.tar.gz -C /target"')]),a._v("\n")])])]),s("h2",{attrs:{id:"数据卷驱动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷驱动"}},[a._v("#")]),a._v(" 数据卷驱动")]),a._v(" "),s("p",[a._v("Docker支持多种数据卷驱动，用于扩展数据卷功能。")]),a._v(" "),s("h3",{attrs:{id:"本地驱动-local"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地驱动-local"}},[a._v("#")]),a._v(" 本地驱动（local）")]),a._v(" "),s("p",[a._v("默认的数据卷驱动，将数据存储在宿主机本地文件系统中。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--driver")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v(" my-volume\n")])])]),s("h3",{attrs:{id:"nfs驱动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nfs驱动"}},[a._v("#")]),a._v(" NFS驱动")]),a._v(" "),s("p",[a._v("允许使用NFS服务器作为数据卷存储。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装NFS驱动")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" plugin "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" --grant-all-permissions vieux/sshfs\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建NFS数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--driver")]),a._v(" vieux/sshfs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("sshcmd")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("user@host:/path "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("password "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  sshfs-volume\n")])])]),s("h3",{attrs:{id:"其他第三方驱动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他第三方驱动"}},[a._v("#")]),a._v(" 其他第三方驱动")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("Flocker")]),a._v("：用于多主机环境")]),a._v(" "),s("li",[s("strong",[a._v("GlusterFS")]),a._v("：分布式文件系统")]),a._v(" "),s("li",[s("strong",[a._v("Ceph")]),a._v("：分布式存储系统")]),a._v(" "),s("li",[s("strong",[a._v("NetApp")]),a._v("：企业级存储解决方案")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装第三方驱动")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" plugin "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("driver-name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建使用第三方驱动的数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--driver")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("driver-name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("key")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("value my-volume\n")])])]),s("h2",{attrs:{id:"数据卷在docker-compose中的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷在docker-compose中的使用"}},[a._v("#")]),a._v(" 数据卷在Docker Compose中的使用")]),a._v(" "),s("h3",{attrs:{id:"基本用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本用法"}},[a._v("#")]),a._v(" 基本用法")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3'")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" web"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/usr/share/nginx/html\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./config/nginx.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/nginx/nginx.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("ro\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /var/log/nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/log/nginx\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("web-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" local\n")])])]),s("h3",{attrs:{id:"外部数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#外部数据卷"}},[a._v("#")]),a._v(" 外部数据卷")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3'")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.7")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/mysql\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("db-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("external")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n")])])]),s("h3",{attrs:{id:"带选项的数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#带选项的数据卷"}},[a._v("#")]),a._v(" 带选项的数据卷")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3'")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" web"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/usr/share/nginx/html\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("web-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" local\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver_opts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nfs\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("o")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" addr=192.168.1.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("rw\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("device")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('":/path/to/dir"')]),a._v("\n")])])]),s("h2",{attrs:{id:"数据卷最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷最佳实践"}},[a._v("#")]),a._v(" 数据卷最佳实践")]),a._v(" "),s("h3",{attrs:{id:"命名约定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命名约定"}},[a._v("#")]),a._v(" 命名约定")]),a._v(" "),s("p",[a._v("使用有意义的名称命名数据卷，反映其用途和内容。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 好的命名示例")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create mysql-prod-data\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create nginx-conf-staging\n")])])]),s("h3",{attrs:{id:"数据卷标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷标签"}},[a._v("#")]),a._v(" 数据卷标签")]),a._v(" "),s("p",[a._v("使用标签组织和管理数据卷。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 添加标签")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--label")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("production "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--label")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql mysql-data\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 根据标签筛选")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--filter")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("label")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("environment"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("production\n")])])]),s("h3",{attrs:{id:"数据卷权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷权限"}},[a._v("#")]),a._v(" 数据卷权限")]),a._v(" "),s("p",[a._v("确保容器内的用户对挂载的数据卷有适当的权限。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 在容器启动前设置权限")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" my-volume:/data alpine "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(":1000 /data\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用entrypoint脚本设置权限")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" entrypoint.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'EOF'\n#!/bin/sh\nchown -R user:user /app/data\nexec \"$@\"\nEOF")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Dockerfile中设置")]),a._v("\nCOPY entrypoint.sh /entrypoint.sh\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /entrypoint.sh\nENTRYPOINT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/entrypoint.sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nginx"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-g"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"daemon off;"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("h3",{attrs:{id:"数据卷清理策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷清理策略"}},[a._v("#")]),a._v(" 数据卷清理策略")]),a._v(" "),s("p",[a._v("定期清理未使用的数据卷，防止磁盘空间浪费。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查找未使用的数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("dangling")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除未使用的数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume prune\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建定期清理的cron作业")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0 0 * * * docker volume prune -f"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" /etc/crontab\n")])])]),s("h2",{attrs:{id:"数据卷安全考虑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷安全考虑"}},[a._v("#")]),a._v(" 数据卷安全考虑")]),a._v(" "),s("h3",{attrs:{id:"敏感数据处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#敏感数据处理"}},[a._v("#")]),a._v(" 敏感数据处理")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用tmpfs存储敏感数据")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tmpfs")]),a._v(" /app/secrets:rw,noexec,nosuid,size"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1m nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用Docker Secrets（在Swarm模式下）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" secret create my-secret /path/to/secret/file\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--secret")]),a._v(" my-secret nginx\n")])])]),s("h3",{attrs:{id:"访问控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问控制"}},[a._v("#")]),a._v(" 访问控制")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 限制数据卷访问权限")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" my-volume:/app/data:ro nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用非root用户访问数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" my-volume:/app/data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(":1000 nginx\n")])])]),s("h3",{attrs:{id:"加密数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加密数据"}},[a._v("#")]),a._v(" 加密数据")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用加密文件系统")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--driver")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("btrfs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("device")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/dev/mapper/encrypted-device "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  encrypted-volume\n")])])]),s("h2",{attrs:{id:"常见问题与解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见问题与解决方案"}},[a._v("#")]),a._v(" 常见问题与解决方案")]),a._v(" "),s("h3",{attrs:{id:"权限问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#权限问题"}},[a._v("#")]),a._v(" 权限问题")]),a._v(" "),s("p",[s("strong",[a._v("问题")]),a._v("：容器内无法写入挂载的数据卷")]),a._v(" "),s("p",[s("strong",[a._v("解决方案")]),a._v("：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("调整宿主机上的权限")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(":1000 /path/to/volume\n")])])])]),a._v(" "),s("li",[s("p",[a._v("在容器内调整权限")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" container_id "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" user:user /app/data\n")])])])]),a._v(" "),s("li",[s("p",[a._v("使用相同的UID/GID")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /host/path:/container/path nginx\n")])])])])]),a._v(" "),s("h3",{attrs:{id:"数据卷无法删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷无法删除"}},[a._v("#")]),a._v(" 数据卷无法删除")]),a._v(" "),s("p",[s("strong",[a._v("问题")]),a._v("：尝试删除数据卷时出现错误")]),a._v(" "),s("p",[s("strong",[a._v("解决方案")]),a._v("：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("确保没有容器使用该数据卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--filter")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("volume")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("my-volume\n")])])])]),a._v(" "),s("li",[s("p",[a._v("强制删除（谨慎使用）")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" my-volume\n")])])])]),a._v(" "),s("li",[s("p",[a._v("重启Docker服务")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])])])]),a._v(" "),s("h3",{attrs:{id:"性能问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能问题"}},[a._v("#")]),a._v(" 性能问题")]),a._v(" "),s("p",[s("strong",[a._v("问题")]),a._v("：数据卷操作性能较低")]),a._v(" "),s("p",[s("strong",[a._v("解决方案")]),a._v("：")]),a._v(" "),s("ol",[s("li",[a._v("使用数据卷而不是绑定挂载")]),a._v(" "),s("li",[a._v("减少挂载点数量")]),a._v(" "),s("li",[a._v("考虑使用内存挂载（tmpfs）用于临时数据")]),a._v(" "),s("li",[a._v("使用性能更好的存储驱动")])]),a._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),s("p",[a._v("Docker数据卷是容器化应用中管理持久数据的关键机制。通过合理使用数据卷、绑定挂载和tmpfs挂载，可以实现数据持久化、共享和隔离，同时保持容器的轻量级和可移植性。掌握数据卷的创建、管理和最佳实践，对于构建健壮的容器化应用至关重要。")]),a._v(" "),s("h2",{attrs:{id:"下一步学习"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下一步学习"}},[a._v("#")]),a._v(" 下一步学习")]),a._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/docker/docker-compose.html"}},[a._v("Docker Compose详解")])],1),a._v(" "),s("li",[s("RouterLink",{attrs:{to:"/docker/docker-swarm.html"}},[a._v("Docker Swarm集群")])],1),a._v(" "),s("li",[s("RouterLink",{attrs:{to:"/docker/docker-security.html"}},[a._v("Docker安全最佳实践")])],1),a._v(" "),s("li",[s("RouterLink",{attrs:{to:"/docker/docker-production.html"}},[a._v("Docker生产环境部署")])],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);