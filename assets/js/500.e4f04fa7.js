(window.webpackJsonp=window.webpackJsonp||[]).push([[500],{1349:function(a,s,t){"use strict";t.r(s);var n=t(1),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[a._v("点击勘误"),s("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[a._v("issues"),s("OutboundLink")],1),a._v("，哪吒感谢大家的阅读")])]),a._v(" "),s("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),a._v(" "),s("h2",{attrs:{id:"服务器被挖矿后的应急处理与安全加固指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器被挖矿后的应急处理与安全加固指南"}},[a._v("#")]),a._v(" 服务器被挖矿后的应急处理与安全加固指南")]),a._v(" "),s("h3",{attrs:{id:"_1-挖矿病毒的特征识别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-挖矿病毒的特征识别"}},[a._v("#")]),a._v(" 1. 挖矿病毒的特征识别")]),a._v(" "),s("p",[a._v("服务器被挖矿病毒感染通常会表现出以下特征：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("异常的系统资源占用")]),a._v("：CPU使用率异常高（通常接近100%），即使在服务器空闲时也是如此")]),a._v(" "),s("li",[s("strong",[a._v("系统性能下降")]),a._v("：服务器响应缓慢，应用程序运行卡顿")]),a._v(" "),s("li",[s("strong",[a._v("硬件异常")]),a._v("：服务器发热严重，风扇持续高速运转")]),a._v(" "),s("li",[s("strong",[a._v("异常网络连接")]),a._v("：存在与未知IP地址（尤其是境外IP）的连接")]),a._v(" "),s("li",[s("strong",[a._v("隐藏进程")]),a._v("：使用常规工具（如top、htop）无法看到高CPU占用的进程")]),a._v(" "),s("li",[s("strong",[a._v("自动恢复机制")]),a._v("：即使杀死可疑进程，短时间内又会自动重启")])]),a._v(" "),s("h3",{attrs:{id:"_2-应急响应流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-应急响应流程"}},[a._v("#")]),a._v(" 2. 应急响应流程")]),a._v(" "),s("h4",{attrs:{id:"_2-1-紧急隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-紧急隔离"}},[a._v("#")]),a._v(" 2.1 紧急隔离")]),a._v(" "),s("p",[a._v("一旦确认服务器被挖矿病毒感染，应立即采取以下措施：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1. 断开网络连接（物理断网或禁用网络接口）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ifconfig")]),a._v(" eth0 down  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 禁用网络接口（请根据实际情况替换接口名）")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2. 修改所有用户密码，特别是root密码")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("passwd")]),a._v(" root\n")])])]),s("blockquote",[s("p",[s("strong",[a._v("重要提示")]),a._v("：在处理过程中，建议使用Live CD启动系统进行操作，避免在已感染的系统中直接操作，因为：")]),a._v(" "),s("ul",[s("li",[a._v("修改的密码可能被监听")]),a._v(" "),s("li",[a._v("修复的文件可能被隐藏的病毒改回")]),a._v(" "),s("li",[a._v("使用的工具可能已被篡改")]),a._v(" "),s("li",[a._v("操作过程可能被全程监控")])])]),a._v(" "),s("h4",{attrs:{id:"_2-2-确认感染情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-确认感染情况"}},[a._v("#")]),a._v(" 2.2 确认感染情况")]),a._v(" "),s("h5",{attrs:{id:"_2-2-1-检查高cpu占用进程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-检查高cpu占用进程"}},[a._v("#")]),a._v(" 2.2.1 检查高CPU占用进程")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用top命令查看高CPU占用进程")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("top")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 在top界面按下'c'键可按CPU使用率排序")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用ps命令查看高CPU占用进程")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-eo")]),a._v(" cmd,pcpu,pid,user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sort")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-pcpu")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 对于隐藏进程，可使用专用工具")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装sysdig工具")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" sysdig  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Debian/Ubuntu系统")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" sysdig  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS/RHEL系统")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用sysdig查看CPU占用排行")]),a._v("\nsysdig "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" topprocs_cpu\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装unhide工具")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" unhide  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Debian/Ubuntu系统")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" unhide  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS/RHEL系统")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用unhide查找隐藏进程")]),a._v("\nunhide proc\n")])])]),s("h5",{attrs:{id:"_2-2-2-检查异常网络连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-检查异常网络连接"}},[a._v("#")]),a._v(" 2.2.2 检查异常网络连接")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看所有TCP连接")]),a._v("\nss "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-anpt")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或使用netstat（如果可用）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("netstat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-antp")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看所有UDP连接")]),a._v("\nss "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-anpu")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用lsof查看网络连接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("lsof")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用tcpdump抓包分析")]),a._v("\ntcpdump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("网卡名"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("host")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("本地IP"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" and port "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("可疑端口"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("h5",{attrs:{id:"_2-2-3-检查定时任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-检查定时任务"}},[a._v("#")]),a._v(" 2.2.3 检查定时任务")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看当前用户的定时任务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看所有用户的定时任务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" /var/spool/cron/*\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看系统定时任务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/crontab\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" /etc/cron.d/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" /etc/cron.hourly/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" /etc/cron.daily/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" /etc/cron.weekly/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" /etc/cron.monthly/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看定时任务日志")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tail")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /var/log/cron\n")])])]),s("h5",{attrs:{id:"_2-2-4-检查启动项和服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-检查启动项和服务"}},[a._v("#")]),a._v(" 2.2.4 检查启动项和服务")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查开机启动脚本")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/rc.d/rc.local\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查systemd服务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" /etc/systemd/system/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" /etc/systemd/system/multi-user.target.wants/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 对于可疑进程，查看其关联的服务")]),a._v("\nsystemctl status "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("PID"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("h5",{attrs:{id:"_2-2-5-检查异常文件和动态链接库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-检查异常文件和动态链接库"}},[a._v("#")]),a._v(" 2.2.5 检查异常文件和动态链接库")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查/etc/ld.so.preload文件（该文件默认为空）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/ld.so.preload\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查可疑的二进制文件（按修改时间排序）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Athl")]),a._v(" /usr/bin\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Athl")]),a._v(" /usr/sbin\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查可疑的二进制文件（按文件大小排序）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-AShl")]),a._v(" /usr/bin\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-AShl")]),a._v(" /usr/sbin\n")])])]),s("h5",{attrs:{id:"_2-2-6-检查ssh配置和异常公钥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-6-检查ssh配置和异常公钥"}},[a._v("#")]),a._v(" 2.2.6 检查SSH配置和异常公钥")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查SSH授权密钥")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" ~/.ssh/authorized_keys\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查SSH配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" AuthorizedKeysFile /etc/ssh/sshd_config\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" Root /etc/ssh/sshd_config\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" Password /etc/ssh/sshd_config\n")])])]),s("h3",{attrs:{id:"_3-清除挖矿病毒"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-清除挖矿病毒"}},[a._v("#")]),a._v(" 3. 清除挖矿病毒")]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("警告")]),a._v("：在执行以下操作前，请确保已备份重要数据。对于严重感染的系统，建议在清理后重装系统。")])]),a._v(" "),s("h4",{attrs:{id:"_3-1-解锁系统文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-解锁系统文件"}},[a._v("#")]),a._v(" 3.1 解锁系统文件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解除系统文件的隐藏属性")]),a._v("\nchattr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-iRa")]),a._v(" /usr/ /etc/\n")])])]),s("h4",{attrs:{id:"_3-2-终止恶意进程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-终止恶意进程"}},[a._v("#")]),a._v(" 3.2 终止恶意进程")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 终止挖矿进程")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("kill")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-9")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("PID"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果进程由服务启动，先停止并禁用服务")]),a._v("\nsystemctl stop "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("服务名"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(".service\nsystemctl disable "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("服务名"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(".service\n")])])]),s("h4",{attrs:{id:"_3-3-清除恶意文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-清除恶意文件"}},[a._v("#")]),a._v(" 3.3 清除恶意文件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 清空/etc/ld.so.preload文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/ld.so.preload\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除恶意定时任务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/spool/cron/*\nchattr +i /var/spool/cron/  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 锁定目录防止再次写入")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /etc/cron.d/*\nchattr +i /etc/cron.d/  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 锁定目录防止再次写入")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除常见挖矿病毒文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /usr/local/lib/libs.so\nchattr +i /usr/local/lib  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 锁定目录防止再次写入")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /var/tmp/kworkerds*\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /var/tmp/1.so\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /tmp/kworkerds*\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /tmp/1.so\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /var/tmp/wc.conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /tmp/wc.conf\n")])])]),s("h4",{attrs:{id:"_3-4-清除异常ssh公钥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-清除异常ssh公钥"}},[a._v("#")]),a._v(" 3.4 清除异常SSH公钥")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查并删除可疑的SSH公钥")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" ~/.ssh/authorized_keys\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 手动编辑文件删除可疑公钥")]),a._v("\n")])])]),s("h3",{attrs:{id:"_4-系统安全加固"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-系统安全加固"}},[a._v("#")]),a._v(" 4. 系统安全加固")]),a._v(" "),s("h4",{attrs:{id:"_4-1-更新系统和软件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-更新系统和软件"}},[a._v("#")]),a._v(" 4.1 更新系统和软件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Debian/Ubuntu系统")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" upgrade "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS/RHEL系统")]),a._v("\nyum update "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v("\n")])])]),s("h4",{attrs:{id:"_4-2-加固ssh服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-加固ssh服务"}},[a._v("#")]),a._v(" 4.2 加固SSH服务")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 编辑SSH配置文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/ssh/sshd_config\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 推荐的安全配置")]),a._v("\nPermitRootLogin no           "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 禁止root直接登录")]),a._v("\nPasswordAuthentication no    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 禁用密码认证，使用密钥认证")]),a._v("\nPort "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22345")]),a._v("                   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改默认SSH端口")]),a._v("\nAllowUsers user1 user2       "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 限制允许登录的用户")]),a._v("\nMaxAuthTries "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("               "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 最大认证尝试次数")]),a._v("\nClientAliveInterval "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("300")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 客户端活跃检测间隔")]),a._v("\nClientAliveCountMax "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 客户端活跃检测计数")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重启SSH服务")]),a._v("\nsystemctl restart sshd\n")])])]),s("h4",{attrs:{id:"_4-3-配置防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-配置防火墙"}},[a._v("#")]),a._v(" 4.3 配置防火墙")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装并启用防火墙")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Debian/Ubuntu系统")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" ufw\nufw "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v("\nufw default deny incoming\nufw default allow outgoing\nufw allow "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22345")]),a._v("/tcp  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许SSH端口（使用修改后的端口）")]),a._v("\nufw allow "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许HTTP端口（根据需要配置）")]),a._v("\nufw allow "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("/tcp    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许HTTPS端口（根据需要配置）")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS/RHEL系统")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" firewalld\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" firewalld\nsystemctl start firewalld\nfirewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" --add-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22345")]),a._v("/tcp  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许SSH端口（使用修改后的端口）")]),a._v("\nfirewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" --add-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许HTTP端口（根据需要配置）")]),a._v("\nfirewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" --add-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("/tcp    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许HTTPS端口（根据需要配置）")]),a._v("\nfirewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--reload")]),a._v("\n")])])]),s("h4",{attrs:{id:"_4-4-安装入侵检测和防御工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-安装入侵检测和防御工具"}},[a._v("#")]),a._v(" 4.4 安装入侵检测和防御工具")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装Fail2Ban防止暴力破解")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Debian/Ubuntu系统")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" fail2ban\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS/RHEL系统")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" epel-release\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" fail2ban\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置Fail2Ban")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /etc/fail2ban/jail.conf /etc/fail2ban/jail.local\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/fail2ban/jail.local\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动Fail2Ban")]),a._v("\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" fail2ban\nsystemctl start fail2ban\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装ClamAV防病毒软件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Debian/Ubuntu系统")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" clamav clamav-daemon\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS/RHEL系统")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" epel-release\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" clamav clamav-update\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 更新病毒库")]),a._v("\nfreshclam\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 扫描系统")]),a._v("\nclamscan "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--bell")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" /\n")])])]),s("h4",{attrs:{id:"_4-5-锁定关键目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-锁定关键目录"}},[a._v("#")]),a._v(" 4.5 锁定关键目录")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用chattr命令锁定关键目录和文件")]),a._v("\nchattr +i /etc/passwd\nchattr +i /etc/shadow\nchattr +i /etc/group\nchattr +i /etc/gshadow\nchattr +i /etc/ssh/sshd_config\n")])])]),s("h3",{attrs:{id:"_5-长期防护措施"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-长期防护措施"}},[a._v("#")]),a._v(" 5. 长期防护措施")]),a._v(" "),s("h4",{attrs:{id:"_5-1-定期更新和补丁管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-定期更新和补丁管理"}},[a._v("#")]),a._v(" 5.1 定期更新和补丁管理")]),a._v(" "),s("ul",[s("li",[a._v("建立定期更新系统和应用程序的计划")]),a._v(" "),s("li",[a._v("关注安全公告，及时应用安全补丁")]),a._v(" "),s("li",[a._v("对于关键系统，在应用补丁前进行测试")])]),a._v(" "),s("h4",{attrs:{id:"_5-2-定期备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-定期备份"}},[a._v("#")]),a._v(" 5.2 定期备份")]),a._v(" "),s("ul",[s("li",[a._v("实施3-2-1备份策略：3份数据副本，2种不同的存储介质，1份异地备份")]),a._v(" "),s("li",[a._v("定期测试备份的可恢复性")]),a._v(" "),s("li",[a._v("确保备份数据的安全性（加密、访问控制）")])]),a._v(" "),s("h4",{attrs:{id:"_5-3-安全监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-安全监控"}},[a._v("#")]),a._v(" 5.3 安全监控")]),a._v(" "),s("ul",[s("li",[a._v("部署集中式日志管理系统")]),a._v(" "),s("li",[a._v("配置关键事件的告警机制")]),a._v(" "),s("li",[a._v("定期审查系统日志和安全事件")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装auditd进行系统审计")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Debian/Ubuntu系统")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" auditd\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS/RHEL系统")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" audit\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启用auditd服务")]),a._v("\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" auditd\nsystemctl start auditd\n")])])]),s("h4",{attrs:{id:"_5-4-最小权限原则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-最小权限原则"}},[a._v("#")]),a._v(" 5.4 最小权限原则")]),a._v(" "),s("ul",[s("li",[a._v("仅安装必要的软件包")]),a._v(" "),s("li",[a._v("关闭不需要的服务和端口")]),a._v(" "),s("li",[a._v("为用户分配最小必要的权限")]),a._v(" "),s("li",[a._v("使用非特权用户运行应用程序")])]),a._v(" "),s("h4",{attrs:{id:"_5-5-定期安全审计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-定期安全审计"}},[a._v("#")]),a._v(" 5.5 定期安全审计")]),a._v(" "),s("ul",[s("li",[a._v("定期进行漏洞扫描")]),a._v(" "),s("li",[a._v("执行安全基线检查")]),a._v(" "),s("li",[a._v("进行渗透测试评估系统安全性")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用Lynis进行安全审计")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Debian/Ubuntu系统")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" lynis\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS/RHEL系统")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" lynis\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 运行Lynis审计")]),a._v("\nlynis audit system\n")])])]),s("h3",{attrs:{id:"_6-总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-总结"}},[a._v("#")]),a._v(" 6. 总结")]),a._v(" "),s("p",[a._v("服务器被挖矿病毒感染后的处理不仅仅是清除病毒，更重要的是找出入侵途径并加以修复，同时加强系统安全防护。对于严重感染的系统，建议在备份重要数据后重装系统，以确保彻底清除所有恶意代码。")]),a._v(" "),s("p",[a._v("安全是一个持续的过程，需要定期的维护、更新和审计。通过实施本文提供的安全加固措施，可以显著降低服务器被挖矿病毒感染的风险。")]),a._v(" "),s("h3",{attrs:{id:"_7-参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-参考资料"}},[a._v("#")]),a._v(" 7. 参考资料")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.secpulse.com/archives/76825.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Linux应急响应：挖矿病毒处理"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.yunweipai.com/47241.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Linux服务器挖矿病毒清除全攻略"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://wlaq.xjtu.edu.cn/info/1008/1945.htm",target:"_blank",rel:"noopener noreferrer"}},[a._v("挖矿病毒处置（Linux篇)"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);