(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{1233:function(t,s,a){"use strict";a.r(s);var n=a(1),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("ç‚¹å‡»å‹˜è¯¯"),s("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues"),s("OutboundLink")],1),t._v("ï¼Œå“ªå’æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»")])]),t._v(" "),s("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),t._v(" "),s("h2",{attrs:{id:"è¿ç»´æœåŠ¡å™¨6å¹´ç»éªŒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¿ç»´æœåŠ¡å™¨6å¹´ç»éªŒ"}},[t._v("#")]),t._v(" è¿ç»´æœåŠ¡å™¨6å¹´ç»éªŒ")]),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸€ã€å¸¸ç”¨-linux-å‘½ä»¤åˆ†ç±»-é‡ç‚¹å¸¸è§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸€ã€å¸¸ç”¨-linux-å‘½ä»¤åˆ†ç±»-é‡ç‚¹å¸¸è§"}},[t._v("#")]),t._v(" âœ… ä¸€ã€å¸¸ç”¨ Linux å‘½ä»¤åˆ†ç±»ï¼ˆé‡ç‚¹å¸¸è§ï¼‰ï¼š")]),t._v(" "),s("h3",{attrs:{id:"ğŸ”¹-ç³»ç»Ÿèµ„æºç›‘æ§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”¹-ç³»ç»Ÿèµ„æºç›‘æ§"}},[t._v("#")]),t._v(" ğŸ”¹ ç³»ç»Ÿèµ„æºç›‘æ§")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("å‘½ä»¤")]),t._v(" "),s("th",[t._v("ä½œç”¨")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("top")])]),t._v(" "),s("td",[t._v("å®æ—¶æŸ¥çœ‹ CPUã€å†…å­˜ã€è¿›ç¨‹å ç”¨ç­‰")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("htop")])]),t._v(" "),s("td",[s("code",[t._v("top")]),t._v(" çš„å¢å¼ºç‰ˆï¼Œå›¾å½¢åŒ–æ˜¾ç¤º")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ps")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹å½“å‰ç³»ç»Ÿè¿›ç¨‹çŠ¶æ€")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("uptime")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¶é•¿ä¸è´Ÿè½½æƒ…å†µ")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("vmstat")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹å†…å­˜ã€CPUã€IO ç­‰ç³»ç»Ÿæ€§èƒ½")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("iostat")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç£ç›˜ IO ä½¿ç”¨ç‡ï¼ˆæ¥è‡ª "),s("code",[t._v("sysstat")]),t._v(" åŒ…ï¼‰")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("free")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("sar")])]),t._v(" "),s("td",[t._v("æ”¶é›†ç³»ç»Ÿæ€§èƒ½å†å²ï¼ˆéœ€å®‰è£… "),s("code",[t._v("sysstat")]),t._v("ï¼‰")])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ”¹-ç½‘ç»œç›¸å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”¹-ç½‘ç»œç›¸å…³"}},[t._v("#")]),t._v(" ğŸ”¹ ç½‘ç»œç›¸å…³")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("å‘½ä»¤")]),t._v(" "),s("th",[t._v("ä½œç”¨")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("netstat")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç½‘ç»œè¿æ¥ã€ç«¯å£ç›‘å¬ç­‰ï¼ˆå»ºè®®ç”¨ "),s("code",[t._v("ss")]),t._v(" æ›¿ä»£ï¼‰")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ss")])]),t._v(" "),s("td",[t._v("æ›´å¿«æ›´å‡†ç¡®çš„æ›¿ä»£ "),s("code",[t._v("netstat")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ping")])]),t._v(" "),s("td",[t._v("æµ‹è¯•ç½‘ç»œè¿é€šæ€§")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("traceroute")])]),t._v(" "),s("td",[t._v("è·¯ç”±è¿½è¸ª")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("dig/nslookup")])]),t._v(" "),s("td",[t._v("åŸŸåè§£æå·¥å…·")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("curl/wget")])]),t._v(" "),s("td",[t._v("ç½‘ç»œè¯·æ±‚æµ‹è¯•")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("tcpdump")])]),t._v(" "),s("td",[t._v("æŠ“åŒ…å·¥å…·")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("iftop")])]),t._v(" "),s("td",[t._v("å®æ—¶ç½‘ç»œå¸¦å®½ç›‘æ§")])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ”¹-ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”¹-ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿ"}},[t._v("#")]),t._v(" ğŸ”¹ ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿ")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("å‘½ä»¤")]),t._v(" "),s("th",[t._v("ä½œç”¨")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("df")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç£ç›˜æŒ‚è½½ä¸å‰©ä½™ç©ºé—´")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("du")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç›®å½•/æ–‡ä»¶å ç”¨å¤§å°")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("lsblk")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç£ç›˜æŒ‚è½½ç»“æ„")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("mount/umount")])]),t._v(" "),s("td",[t._v("æŒ‚è½½/å¸è½½ç£ç›˜")])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ”¹-æ–‡ä»¶ä¸ç³»ç»Ÿæ“ä½œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”¹-æ–‡ä»¶ä¸ç³»ç»Ÿæ“ä½œ"}},[t._v("#")]),t._v(" ğŸ”¹ æ–‡ä»¶ä¸ç³»ç»Ÿæ“ä½œ")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("å‘½ä»¤")]),t._v(" "),s("th",[t._v("ä½œç”¨")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("ls")]),t._v(", "),s("code",[t._v("cd")]),t._v(", "),s("code",[t._v("cat")]),t._v(", "),s("code",[t._v("cp")]),t._v(", "),s("code",[t._v("mv")]),t._v(", "),s("code",[t._v("rm")])]),t._v(" "),s("td",[t._v("æ–‡ä»¶æ“ä½œ")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("find")]),t._v(", "),s("code",[t._v("grep")]),t._v(", "),s("code",[t._v("awk")]),t._v(", "),s("code",[t._v("sed")])]),t._v(" "),s("td",[t._v("æŸ¥æ‰¾ä¸æ–‡æœ¬å¤„ç†")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("chmod")]),t._v(", "),s("code",[t._v("chown")])]),t._v(" "),s("td",[t._v("ä¿®æ”¹æƒé™ä¸æ‰€æœ‰è€…")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("tar")]),t._v(", "),s("code",[t._v("zip")]),t._v(", "),s("code",[t._v("unzip")])]),t._v(" "),s("td",[t._v("å‹ç¼©è§£å‹")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("systemctl")]),t._v(", "),s("code",[t._v("service")])]),t._v(" "),s("td",[t._v("æœåŠ¡ç®¡ç†")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("journalctl")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("crontab")])]),t._v(" "),s("td",[t._v("å®šæ—¶ä»»åŠ¡")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("kill")]),t._v(", "),s("code",[t._v("killall")]),t._v(", "),s("code",[t._v("xargs")])]),t._v(" "),s("td",[t._v("æ€è¿›ç¨‹")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-äºŒã€ä½ æåˆ°çš„å‘½ä»¤è¯¦è§£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-äºŒã€ä½ æåˆ°çš„å‘½ä»¤è¯¦è§£"}},[t._v("#")]),t._v(" âœ… äºŒã€ä½ æåˆ°çš„å‘½ä»¤è¯¦è§£")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("å‘½ä»¤")]),t._v(" "),s("th",[t._v("ç”¨é€”è¯´æ˜")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("top")])]),t._v(" "),s("td",[t._v("å®æ—¶æŸ¥çœ‹ CPUã€å†…å­˜å ç”¨ã€å„è¿›ç¨‹è¿è¡ŒçŠ¶æ€ï¼Œå¸¸ç”¨äºæ’æŸ¥ç³»ç»Ÿè´Ÿè½½é«˜çš„é—®é¢˜")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ps aux")])]),t._v(" "),s("td",[t._v("å¿«ç…§æ–¹å¼æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çŠ¶æ€ï¼Œå¯ç»“åˆ "),s("code",[t._v("grep")]),t._v(" æ‰¾å…³é”®è¿›ç¨‹")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("netstat -tulnp")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç›‘å¬ç«¯å£ä¸ç»‘å®šæœåŠ¡ï¼ˆè¢« "),s("code",[t._v("ss")]),t._v(" å–ä»£ï¼‰")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("df -h")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹å„æŒ‚è½½åˆ†åŒºçš„å‰©ä½™ç©ºé—´ã€ä½¿ç”¨ç‡ï¼Œåˆ¤æ–­ç£ç›˜æ˜¯å¦æ»¡")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("du -sh *")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹å„å­ç›®å½•/æ–‡ä»¶å¤§å°ï¼Œå®šä½â€œè°å æ»¡äº†ç£ç›˜â€")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("iostat -x 1")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç£ç›˜è¯»å†™é€Ÿç‡ã€IO ç­‰å¾…æƒ…å†µï¼Œåˆ†æ IO ç“¶é¢ˆé—®é¢˜ï¼ˆéœ€å®‰è£… "),s("code",[t._v("sysstat")]),t._v("ï¼‰")])])])]),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸€ã€linux-è¿ç»´æ’æŸ¥å‘½ä»¤é€ŸæŸ¥è¡¨-åˆ†ç±»-åœºæ™¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸€ã€linux-è¿ç»´æ’æŸ¥å‘½ä»¤é€ŸæŸ¥è¡¨-åˆ†ç±»-åœºæ™¯"}},[t._v("#")]),t._v(" âœ… ä¸€ã€Linux è¿ç»´æ’æŸ¥å‘½ä»¤é€ŸæŸ¥è¡¨ï¼ˆåˆ†ç±» + åœºæ™¯ï¼‰")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("åˆ†ç±»")]),t._v(" "),s("th",[t._v("å‘½ä»¤ç¤ºä¾‹")]),t._v(" "),s("th",[t._v("ä½¿ç”¨åœºæ™¯è¯´æ˜")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ğŸ”§ "),s("strong",[t._v("CPU/å†…å­˜æ’æŸ¥")])]),t._v(" "),s("td",[s("code",[t._v("top")]),t._v(", "),s("code",[t._v("htop")]),t._v(", "),s("code",[t._v("ps aux --sort=-%cpu")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹é«˜è´Ÿè½½è¿›ç¨‹ã€å†…å­˜æ³„æ¼ã€è¿›ç¨‹å¼‚å¸¸")])]),t._v(" "),s("tr",[s("td",[t._v("ğŸ”§ "),s("strong",[t._v("ç£ç›˜æ’æŸ¥")])]),t._v(" "),s("td",[s("code",[t._v("df -h")]),t._v(", "),s("code",[t._v("du -sh *")]),t._v(", "),s("code",[t._v("lsof")]),t._v(", "),s("code",[t._v("ncdu")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç£ç›˜æ˜¯å¦æ»¡ã€å“ªäº›æ–‡ä»¶å ç”¨æœ€å¤§ç©ºé—´")])]),t._v(" "),s("tr",[s("td",[t._v("ğŸ”§ "),s("strong",[t._v("IO æ’æŸ¥")])]),t._v(" "),s("td",[s("code",[t._v("iostat -x 1")]),t._v(", "),s("code",[t._v("iotop")]),t._v(", "),s("code",[t._v("vmstat 1")])]),t._v(" "),s("td",[t._v("åˆ¤æ–­ç£ç›˜ IO æ˜¯å¦ç“¶é¢ˆã€IO ç­‰å¾…é«˜")])]),t._v(" "),s("tr",[s("td",[t._v("ğŸ”§ "),s("strong",[t._v("ç½‘ç»œæ’æŸ¥")])]),t._v(" "),s("td",[s("code",[t._v("netstat -tulnp")]),t._v(", "),s("code",[t._v("ss -lntp")]),t._v(", "),s("code",[t._v("lsof -i:ç«¯å£")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç«¯å£ç›‘å¬æƒ…å†µã€ç½‘ç»œè¿æ¥çŠ¶æ€")])]),t._v(" "),s("tr",[s("td",[t._v("ğŸŒ "),s("strong",[t._v("è¿é€šæ€§æµ‹è¯•")])]),t._v(" "),s("td",[s("code",[t._v("ping")]),t._v(", "),s("code",[t._v("traceroute")]),t._v(", "),s("code",[t._v("curl")]),t._v(", "),s("code",[t._v("dig")]),t._v(", "),s("code",[t._v("telnet")])]),t._v(" "),s("td",[t._v("ç½‘ç»œæ˜¯å¦é€šï¼ŒDNS è§£ææ˜¯å¦æ­£å¸¸")])]),t._v(" "),s("tr",[s("td",[t._v("ğŸ“‚ "),s("strong",[t._v("æ–‡ä»¶å®šä½")])]),t._v(" "),s("td",[s("code",[t._v('find . -type f -name "*.log"')]),t._v(", "),s("code",[t._v("du -ah | sort -rh")])]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("ğŸ” "),s("strong",[t._v("æ—¥å¿—æŸ¥çœ‹")])]),t._v(" "),s("td",[s("code",[t._v("tail -f /var/log/messages")]),t._v(", "),s("code",[t._v("journalctl -xe")])]),t._v(" "),s("td",[t._v("å®æ—¶æŸ¥çœ‹ç³»ç»Ÿ/æœåŠ¡æ—¥å¿—ï¼ŒæŸ¥å¯åŠ¨å¤±è´¥")])]),t._v(" "),s("tr",[s("td",[t._v("ğŸ” "),s("strong",[t._v("æƒé™æ’æŸ¥")])]),t._v(" "),s("td",[s("code",[t._v("ls -l")]),t._v(", "),s("code",[t._v("chmod")]),t._v(", "),s("code",[t._v("chown")])]),t._v(" "),s("td",[t._v("æ–‡ä»¶/ç›®å½•æƒé™é”™è¯¯å¯¼è‡´æ— æ³•è®¿é—®")])]),t._v(" "),s("tr",[s("td",[t._v("âš™ï¸ "),s("strong",[t._v("è¿›ç¨‹æ§åˆ¶")])]),t._v(" "),s("td",[s("code",[t._v("ps")]),t._v(", "),s("code",[t._v("kill")]),t._v(", "),s("code",[t._v("killall")]),t._v(", "),s("code",[t._v("xargs")])]),t._v(" "),s("td",[t._v("æŸ¥æ‰¾å¹¶ç»ˆæ­¢å¼‚å¸¸è¿›ç¨‹")])]),t._v(" "),s("tr",[s("td",[t._v("ğŸ“† "),s("strong",[t._v("å®šæ—¶ä»»åŠ¡")])]),t._v(" "),s("td",[s("code",[t._v("crontab -l")]),t._v(", "),s("code",[t._v("systemctl list-timers")])]),t._v(" "),s("td",[t._v("å®šæ—¶è„šæœ¬æœªè§¦å‘æˆ–é…ç½®é”™è¯¯")])])])]),t._v(" "),s("h3",{attrs:{id:"cpu-é£™é«˜æ’æŸ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cpu-é£™é«˜æ’æŸ¥"}},[t._v("#")]),t._v(" CPU é£™é«˜æ’æŸ¥")]),t._v(" "),s("blockquote",[s("p",[t._v("æœ‰ä¸€æ¬¡çº¿ä¸Šç³»ç»Ÿ CPU é£™åˆ° 100%ï¼Œæˆ‘ä½¿ç”¨ "),s("code",[t._v("top")]),t._v(" æŸ¥çœ‹æ˜¯æŸä¸ª Java è¿›ç¨‹å æ»¡ CPUï¼Œå†ç»“åˆ "),s("code",[t._v("ps -ef")]),t._v(" ç¡®è®¤ PIDï¼Œä¹‹åç”¨ "),s("code",[t._v("jstack")]),t._v(" dump æ ˆåˆ†ææ˜¯æŸä¸ªçº¿ç¨‹æ­»å¾ªç¯ã€‚ä¿®å¤å CPU é™å›æ­£å¸¸ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ç£ç›˜æ‰“æ»¡å¯¼è‡´æœåŠ¡æŒ‚æ‰"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç£ç›˜æ‰“æ»¡å¯¼è‡´æœåŠ¡æŒ‚æ‰"}},[t._v("#")]),t._v(" ç£ç›˜æ‰“æ»¡å¯¼è‡´æœåŠ¡æŒ‚æ‰")]),t._v(" "),s("blockquote",[s("p",[t._v("æŸæ¬¡æœåŠ¡çªç„¶æŒ‚æ‰ï¼Œ"),s("code",[t._v("df -h")]),t._v(" ä¸€çœ‹ "),s("code",[t._v("/var")]),t._v(" åˆ†åŒº 100%ï¼Œ"),s("code",[t._v("du -sh *")]),t._v(" é€çº§å®šä½ï¼Œå‘ç°æ˜¯æ—¥å¿—æ–‡ä»¶æ‰“æ»¡äº†ã€‚ç”¨ "),s("code",[t._v("logrotate")]),t._v(" åŠ äº†å‹ç¼©ä¸æ¸…ç†ç­–ç•¥ï¼Œé¿å…å†æ¬¡å‘ç”Ÿã€‚")])]),t._v(" "),s("h3",{attrs:{id:"æ•°æ®åº“è¿æ¥å¤±è´¥æ’æŸ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®åº“è¿æ¥å¤±è´¥æ’æŸ¥"}},[t._v("#")]),t._v(" æ•°æ®åº“è¿æ¥å¤±è´¥æ’æŸ¥")]),t._v(" "),s("blockquote",[s("p",[t._v("åº”ç”¨è¿ä¸ä¸Š MySQLï¼Œå…ˆç”¨ "),s("code",[t._v("ping")]),t._v(" ç¡®è®¤ç½‘ç»œé€šï¼Œå† "),s("code",[t._v("telnet host 3306")]),t._v(" å‘ç°ç«¯å£ä¸é€šï¼Œç”¨ "),s("code",[t._v("ss -lntp")]),t._v(" æŸ¥æœåŠ¡æœªç›‘å¬ï¼ŒåŸæ¥æ˜¯æ•°æ®åº“æœªå¯åŠ¨ï¼Œ"),s("code",[t._v("systemctl start mysql")]),t._v(" åæ¢å¤æ­£å¸¸ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"redis-å¤šå®ä¾‹ç«¯å£å†²çª"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-å¤šå®ä¾‹ç«¯å£å†²çª"}},[t._v("#")]),t._v(" Redis å¤šå®ä¾‹ç«¯å£å†²çª")]),t._v(" "),s("blockquote",[s("p",[t._v("å¤š Redis å®ä¾‹å¯åŠ¨å¤±è´¥ï¼Œ"),s("code",[t._v("netstat -tulnp")]),t._v(" æ˜¾ç¤ºç«¯å£å·²è¢«å ç”¨ï¼Œ"),s("code",[t._v("ps aux | grep redis")]),t._v(" æŸ¥å‡ºæ˜¯è€è¿›ç¨‹æœªå…³é—­ï¼Œ"),s("code",[t._v("kill")]),t._v(" åå†é‡å¯æˆåŠŸã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ç£ç›˜-io-æ€§èƒ½ç“¶é¢ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç£ç›˜-io-æ€§èƒ½ç“¶é¢ˆ"}},[t._v("#")]),t._v(" ç£ç›˜ IO æ€§èƒ½ç“¶é¢ˆ")]),t._v(" "),s("blockquote",[s("p",[t._v("æŸæœåŠ¡å“åº”æ…¢ä½† CPU å ç”¨ä½ï¼Œç”¨ "),s("code",[t._v("iostat -x 1")]),t._v(" æŸ¥çœ‹å‘ç°ç£ç›˜ "),s("code",[t._v("util")]),t._v(" é•¿æ—¶é—´æ¥è¿‘ 100%ï¼Œæ’æŸ¥æ˜¯é¢‘ç¹å†™å…¥æ—¥å¿—å¯¼è‡´ IO æ‹¥å¡ï¼Œä¼˜åŒ–åæ—¥å¿—æŒ‰çº§åˆ«å†™å…¥ï¼Œå“åº”æ¢å¤ã€‚")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("å‘½ä»¤")]),t._v(" "),s("th",[t._v("é¢è¯•ä¸­ç®€æ´æè¿°")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("top")])]),t._v(" "),s("td",[t._v("å®æ—¶ç›‘æ§è¿›ç¨‹ CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ps aux")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„é™æ€å¿«ç…§")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("netstat")]),t._v("/"),s("code",[t._v("ss")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç«¯å£ç›‘å¬ä¸ç½‘ç»œè¿æ¥")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("df -h")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç£ç›˜åˆ†åŒºä½¿ç”¨æƒ…å†µ")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("du -sh *")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç›®å½•å¤§å°ï¼Œæ’æŸ¥å¤§æ–‡ä»¶")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("iostat")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç£ç›˜ IO ä½¿ç”¨ä¸ç“¶é¢ˆ")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("tail -f")])]),t._v(" "),s("td",[t._v("å®æ—¶æŸ¥çœ‹æ—¥å¿—è¾“å‡º")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ping")]),t._v(", "),s("code",[t._v("curl")])]),t._v(" "),s("td",[t._v("æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ä¸æœåŠ¡æ˜¯å¦åœ¨çº¿")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("kill -9")])]),t._v(" "),s("td",[t._v("å¼ºåˆ¶ç»“æŸè¿›ç¨‹")])])])]),t._v(" "),s("h2",{attrs:{id:"ä¸€é”®å®‰è£…å·¥å…·å»ºè®®-è¿ç»´å¿…å¤‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€é”®å®‰è£…å·¥å…·å»ºè®®-è¿ç»´å¿…å¤‡"}},[t._v("#")]),t._v(" ä¸€é”®å®‰è£…å·¥å…·å»ºè®®ï¼ˆè¿ç»´å¿…å¤‡ï¼‰")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# IO å’Œç½‘ç»œå·¥å…·åˆé›†ï¼ˆDebian/Ubuntuï¼‰\nsudo apt install sysstat iotop iftop net-tools lsof\n\n# CentOS/RHEL\nsudo yum install sysstat iotop iftop net-tools lsof\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("æ’æŸ¥åœºæ™¯")]),t._v(" "),s("th",[t._v("ä½¿ç”¨å‘½ä»¤")]),t._v(" "),s("th",[t._v("ç›®çš„")]),t._v(" "),s("th",[t._v("å®é™…ä½œç”¨ / ç»“æœ")]),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Java è¿›ç¨‹ CPU é£™å‡")]),t._v(" "),s("td",[s("code",[t._v("top")]),t._v(" "),s("br"),t._v(" "),s("code",[t._v("ps aux --sort=-%cpu")]),t._v(" "),s("br"),t._v(" "),s("code",[t._v("jstack PID")])]),t._v(" "),s("td",[t._v("æ‰¾å‡ºé«˜ CPU å ç”¨è¿›ç¨‹ï¼Œå¹¶ç”¨ jstack æŠ“çº¿ç¨‹å †æ ˆ")]),t._v(" "),s("td",[t._v("ç¡®è®¤æ˜¯æŸçº¿ç¨‹æ­»å¾ªç¯å¯¼è‡´ CPU å æ»¡ï¼Œåˆ†æå®šä½ä¸šåŠ¡é€»è¾‘é—®é¢˜")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("ç£ç›˜å†™å…¥å¼‚å¸¸")]),t._v(" "),s("td",[s("code",[t._v("df -h")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹åˆ†åŒºæ˜¯å¦å·²æ»¡")]),t._v(" "),s("td",[s("code",[t._v("/var")]),t._v(" åˆ†åŒº 100%ï¼ŒæœåŠ¡æ—¥å¿—æ— æ³•å†™å…¥ï¼Œå¯¼è‡´æ¥å£æŠ¥é”™")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("å¤§æ–‡ä»¶å®šä½")]),t._v(" "),s("td",[s("code",[t._v("du -sh *")]),t._v(" "),s("br"),t._v(" `du -sh ./*")]),t._v(" "),s("td",[t._v("sort -rh")]),t._v(" "),s("td",[t._v("head`")]),t._v(" "),s("td",[t._v("å¿«é€Ÿå®šä½å¤§ç›®å½• / å¤§æ—¥å¿—æ–‡ä»¶")]),t._v(" "),s("td",[t._v("æ‰¾åˆ°æŸæ—¥å¿—æ–‡ä»¶è¶…è¿‡ 5Gï¼Œé…åˆ logrotate è®¾å®šåˆ‡å‰²ç­–ç•¥")])]),t._v(" "),s("tr",[s("td",[t._v("ç£ç›˜ IO æ€§èƒ½ç“¶é¢ˆ")]),t._v(" "),s("td",[s("code",[t._v("iostat -x 1")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ IO åˆ©ç”¨ç‡ã€ç­‰å¾…æ—¶é—´")]),t._v(" "),s("td",[s("code",[t._v("util")]),t._v(" é•¿æœŸ 90%+ï¼Œ"),s("code",[t._v("await")]),t._v(" æ—¶é—´é«˜ï¼Œç¡®è®¤å†™å…¥ç“¶é¢ˆåœ¨ç£ç›˜")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("ç«¯å£å†²çª / Redis æœªç›‘å¬")]),t._v(" "),s("td",[s("code",[t._v("netstat -tulnp")]),t._v(" "),s("br"),t._v(" "),s("code",[t._v("ss -lntp")])]),t._v(" "),s("td",[t._v("æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ")]),t._v(" "),s("td",[t._v("å‘ç° Redis é…ç½®ç›‘å¬ç«¯å£æœªå¯åŠ¨æˆ–ç«¯å£è¢«å…¶ä»–è¿›ç¨‹å ç”¨")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("è¿›ç¨‹æ˜¯å¦å­˜åœ¨ / å¤šå¼€")]),t._v(" "),s("td",[t._v("`ps aux")]),t._v(" "),s("td",[t._v("grep redis"),s("code",[t._v("<br>")]),t._v("pgrep -f redis`")]),t._v(" "),s("td",[t._v("ç¡®è®¤è¿›ç¨‹æ˜¯å¦å·²è¿è¡Œã€æ˜¯å¦é‡å¤å¯åŠ¨")]),t._v(" "),s("td",[t._v("é¿å…é‡å¤å¯åŠ¨ Redis æˆ– MySQL å®ä¾‹ï¼Œæˆ–ç¡®è®¤æ˜¯å¦æœªå¯åŠ¨æˆåŠŸ")]),t._v(" "),s("td")])])]),t._v(" "),s("p",[t._v("æœ‰æ¬¡çº¿ä¸Šç³»ç»Ÿå“åº”å˜æ…¢ï¼Œæˆ‘ç”¨ top æŸ¥åˆ° Java è¿›ç¨‹ CPU 99%ï¼Œç»“åˆ jstack æŠ“å–çº¿ç¨‹æ ˆï¼Œç¡®è®¤æŸæ­»å¾ªç¯é€»è¾‘å¯¼è‡´å ç”¨ï¼›ä¹Ÿé‡åˆ°ç£ç›˜å¼‚å¸¸ï¼Œdf å‘ç° /var åˆ†åŒºæ»¡äº†ï¼Œç”¨ du å¿«é€Ÿæ‰¾åˆ°æ˜¯æ—¥å¿—çˆ†é‡ï¼›å¦å¤–è¿˜ç”¨ iostat å®šä½ IO ç­‰å¾…é«˜ï¼Œç»“åˆæ—¥å¿—æ”¹å†™ç­–ç•¥ç¼“è§£äº†ç“¶é¢ˆã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:a(619),alt:"img_14.png"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(620),alt:"img_15.png"}})]),t._v(" "),s("p",[t._v("mongoï¼Œ")]),t._v(" "),s("p",[t._v("åœ¨ MongoDB ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šè¯´â€œåº“â€å’Œâ€œè¡¨â€ï¼Œè€Œæ˜¯ä½¿ç”¨ä»¥ä¸‹æœ¯è¯­ï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("é€šç”¨æ•°æ®åº“æœ¯è¯­")]),t._v(" "),s("th",[t._v("MongoDB ä¸­çš„æœ¯è¯­")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("æ•°æ®åº“ï¼ˆDatabaseï¼‰")]),t._v(" "),s("td",[t._v("æ•°æ®åº“ï¼ˆDatabaseï¼‰ âœ…")])]),t._v(" "),s("tr",[s("td",[t._v("è¡¨ï¼ˆTableï¼‰")]),t._v(" "),s("td",[t._v("é›†åˆï¼ˆCollectionï¼‰ âœ…")])]),t._v(" "),s("tr",[s("td",[t._v("è¡Œï¼ˆRowï¼‰")]),t._v(" "),s("td",[t._v("æ–‡æ¡£ï¼ˆDocumentï¼‰ âœ…")])]),t._v(" "),s("tr",[s("td",[t._v("åˆ—ï¼ˆColumnï¼‰")]),t._v(" "),s("td",[t._v("å­—æ®µï¼ˆFieldï¼‰ âœ…")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-mongodb-çš„åŸºæœ¬ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-mongodb-çš„åŸºæœ¬ç»“æ„"}},[t._v("#")]),t._v(" âœ… MongoDB çš„åŸºæœ¬ç»“æ„ï¼š")]),t._v(" "),s("div",{staticClass:"language-plaintext extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plaintext"}},[s("code",[t._v("MongoDB Server\n â””â”€â”€ Databaseï¼ˆæ•°æ®åº“ï¼‰\n      â””â”€â”€ Collectionï¼ˆé›†åˆï¼Œç›¸å½“äºè¡¨ï¼‰\n           â””â”€â”€ Documentï¼ˆæ–‡æ¡£ï¼Œç›¸å½“äºè¡Œï¼‰\n                â””â”€â”€ Fieldï¼ˆå­—æ®µï¼Œç›¸å½“äºåˆ—ï¼‰\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸¾ä¾‹è¯´æ˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸¾ä¾‹è¯´æ˜"}},[t._v("#")]),t._v(" âœ… ä¸¾ä¾‹è¯´æ˜")]),t._v(" "),s("h3",{attrs:{id:"åˆ›å»ºæ•°æ®åº“å’Œé›†åˆ-ç›¸å½“äº-å»ºåº“å»ºè¡¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºæ•°æ®åº“å’Œé›†åˆ-ç›¸å½“äº-å»ºåº“å»ºè¡¨"}},[t._v("#")]),t._v(" åˆ›å»ºæ•°æ®åº“å’Œé›†åˆï¼ˆç›¸å½“äºâ€œå»ºåº“å»ºè¡¨â€ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("use mydb              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é€‰æ‹©æˆ–åˆ›å»ºæ•°æ®åº“")]),t._v("\n\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCollection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºé›†åˆï¼Œç›¸å½“äºåˆ›å»ºè¡¨")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"æ’å…¥æ–‡æ¡£-ç›¸å½“äºæ’å…¥ä¸€è¡Œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ’å…¥æ–‡æ¡£-ç›¸å½“äºæ’å…¥ä¸€è¡Œ"}},[t._v("#")]),t._v(" æ’å…¥æ–‡æ¡£ï¼ˆç›¸å½“äºæ’å…¥ä¸€è¡Œï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"å¼ ä¸‰"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zhangsan@example.com"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"æŸ¥è¯¢æ–‡æ¡£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥è¯¢æ–‡æ¡£"}},[t._v("#")]),t._v(" æŸ¥è¯¢æ–‡æ¡£ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$gt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-mongodb-ç‰¹ç‚¹-vs-å…³ç³»å‹æ•°æ®åº“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-mongodb-ç‰¹ç‚¹-vs-å…³ç³»å‹æ•°æ®åº“"}},[t._v("#")]),t._v(" âœ… MongoDB ç‰¹ç‚¹ vs å…³ç³»å‹æ•°æ®åº“")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("MongoDBï¼ˆæ–‡æ¡£å‹ï¼‰")]),t._v(" "),s("th",[t._v("MySQL / PostgreSQLï¼ˆå…³ç³»å‹ï¼‰")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("æ— å›ºå®šè¡¨ç»“æ„")]),t._v(" "),s("td",[t._v("è¡¨ç»“æ„éœ€æå‰å®šä¹‰å­—æ®µç±»å‹")])]),t._v(" "),s("tr",[s("td",[t._v("æ”¯æŒåµŒå¥—æ–‡æ¡£ã€æ•°ç»„å­—æ®µ")]),t._v(" "),s("td",[t._v("ä¸æ”¯æŒåµŒå¥—å¯¹è±¡")])]),t._v(" "),s("tr",[s("td",[t._v("çµæ´»å†™å…¥ï¼Œå­—æ®µå¯ä¸åŒ")]),t._v(" "),s("td",[t._v("æ¯è¡Œå­—æ®µä¸€è‡´ï¼Œå¼ºç±»å‹çº¦æŸ")])]),t._v(" "),s("tr",[s("td",[t._v("ä½¿ç”¨ JSON/BSON å­˜å‚¨æ–‡æ¡£")]),t._v(" "),s("td",[t._v("ä½¿ç”¨è¡Œåˆ—å¼å­˜å‚¨")])])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("å¦‚æœä½ æƒ³æŸ¥çœ‹ Mongo å½“å‰æ‰€æœ‰åº“/è¡¨ï¼ˆé›†åˆï¼‰ï¼š")]),t._v(" "),s("h3",{attrs:{id:"æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“"}},[t._v("#")]),t._v(" æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("show dbs\n")])])]),s("h3",{attrs:{id:"æŸ¥çœ‹å½“å‰æ•°æ®åº“æ‰€æœ‰é›†åˆ-è¡¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹å½“å‰æ•°æ®åº“æ‰€æœ‰é›†åˆ-è¡¨"}},[t._v("#")]),t._v(" æŸ¥çœ‹å½“å‰æ•°æ®åº“æ‰€æœ‰é›†åˆï¼ˆè¡¨ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("show collections\n")])])]),s("hr"),t._v(" "),s("p",[t._v("ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ MongoDB ç¤ºä¾‹é¡¹ç›®ç»“æ„ï¼Œæ¨¡æ‹Ÿå¸¸è§çš„ "),s("strong",[t._v("ç”¨æˆ·ï¼ˆusersï¼‰+ è®¢å•ï¼ˆordersï¼‰")]),t._v(" æ¨¡å‹ï¼Œé€‚åˆå®é™…å¼€å‘ç”¨ä½œé¡¹ç›®åˆå§‹åŒ–ï¼š")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-é¡¹ç›®ç»“æ„è¯´æ˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-é¡¹ç›®ç»“æ„è¯´æ˜"}},[t._v("#")]),t._v(" âœ… é¡¹ç›®ç»“æ„è¯´æ˜")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æ•°æ®åº“ï¼š"),s("code",[t._v("demo_app")])])]),t._v(" "),s("li",[s("p",[t._v("é›†åˆï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("users")]),t._v("ï¼šç”¨æˆ·ä¿¡æ¯")]),t._v(" "),s("li",[s("code",[t._v("orders")]),t._v("ï¼šç”¨æˆ·è®¢å•ï¼ˆåŒ…å«ç”¨æˆ· ID ä½œä¸ºå¤–é”®ï¼‰")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-åˆå§‹åŒ–è„šæœ¬-mongo-shell-è¯­æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-åˆå§‹åŒ–è„šæœ¬-mongo-shell-è¯­æ³•"}},[t._v("#")]),t._v(" âœ… åˆå§‹åŒ–è„šæœ¬ï¼ˆMongo Shell è¯­æ³•ï¼‰")]),t._v(" "),s("p",[t._v("ä½ å¯ä»¥å¤åˆ¶ç²˜è´´åˆ° Mongo Shell / "),s("code",[t._v("mongosh")]),t._v(" ä¸­è¿è¡Œï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. åˆ‡æ¢æˆ–åˆ›å»ºæ•°æ®åº“")]),t._v("\nuse demo_app\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. åˆ›å»º users é›†åˆå¹¶æ’å…¥ç¤ºä¾‹æ–‡æ¡£")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCollection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertMany")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice@example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("phone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1234567890"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bob"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bob@example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("phone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9876543210"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. åˆ›å»º orders é›†åˆå¹¶æ’å…¥ç¤ºä¾‹æ–‡æ¡£")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCollection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertMany")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("item")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iPhone 15"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("price")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7999")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PAID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bob"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("item")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MacBook Air"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("price")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9999")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SHIPPED"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. å»ºç«‹ç´¢å¼•ï¼ˆå¦‚ç”¨æˆ·é‚®ç®±å”¯ä¸€ï¼‰")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createIndex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("unique")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createIndex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-æŸ¥è¯¢ç¤ºä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-æŸ¥è¯¢ç¤ºä¾‹"}},[t._v("#")]),t._v(" âœ… æŸ¥è¯¢ç¤ºä¾‹")]),t._v(" "),s("h3",{attrs:{id:"æŸ¥æ‰¾æŸç”¨æˆ·çš„è®¢å•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥æ‰¾æŸç”¨æˆ·çš„è®¢å•"}},[t._v("#")]),t._v(" æŸ¥æ‰¾æŸç”¨æˆ·çš„è®¢å•ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_id "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"æŸ¥è¯¢æ‰€æœ‰è®¢å•å¹¶å¸¦ä¸Šç”¨æˆ·ä¿¡æ¯-å…³è”æŸ¥è¯¢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥è¯¢æ‰€æœ‰è®¢å•å¹¶å¸¦ä¸Šç”¨æˆ·ä¿¡æ¯-å…³è”æŸ¥è¯¢"}},[t._v("#")]),t._v(" æŸ¥è¯¢æ‰€æœ‰è®¢å•å¹¶å¸¦ä¸Šç”¨æˆ·ä¿¡æ¯ï¼ˆå…³è”æŸ¥è¯¢ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$lookup")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("localField")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("foreignField")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userInfo"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$unwind")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$userInfo"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$project")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("item")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("price")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"userInfo.username"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"userInfo.email"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[t._v("å¦‚æœ MongoDB ä¸­çš„è®¢å•é›†åˆï¼ˆordersï¼‰è¶…è¿‡ 1000 ä¸‡æ¡æ•°æ®ï¼Œæƒ³è¦ç»´æŒæŸ¥è¯¢æ€§èƒ½å’Œç³»ç»Ÿå¯æ‰©å±•æ€§ï¼Œå¿…é¡»ä»å¤šä¸ªç»´åº¦è¿›è¡Œä¼˜åŒ–ï¼š")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸€ã€ç´¢å¼•ä¼˜åŒ–-æœ€å…³é”®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸€ã€ç´¢å¼•ä¼˜åŒ–-æœ€å…³é”®"}},[t._v("#")]),t._v(" âœ… ä¸€ã€ç´¢å¼•ä¼˜åŒ–ï¼ˆæœ€å…³é”®ï¼‰")]),t._v(" "),s("h3",{attrs:{id:"_1ï¸âƒ£-å»ºç«‹é«˜å‘½ä¸­ç‡çš„ç»„åˆç´¢å¼•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1ï¸âƒ£-å»ºç«‹é«˜å‘½ä¸­ç‡çš„ç»„åˆç´¢å¼•"}},[t._v("#")]),t._v(" 1ï¸âƒ£ å»ºç«‹"),s("strong",[t._v("é«˜å‘½ä¸­ç‡çš„ç»„åˆç´¢å¼•")])]),t._v(" "),s("p",[t._v("ä¾‹å¦‚å¸¸è§æŸ¥è¯¢æ¡ä»¶ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PAID"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("åº”å»ºç«‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createIndex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2ï¸âƒ£-å¸¸ç”¨å­—æ®µå¦‚-createdat-ç”¨äºåˆ†é¡µ-èŒƒå›´æŸ¥è¯¢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2ï¸âƒ£-å¸¸ç”¨å­—æ®µå¦‚-createdat-ç”¨äºåˆ†é¡µ-èŒƒå›´æŸ¥è¯¢"}},[t._v("#")]),t._v(" 2ï¸âƒ£ å¸¸ç”¨å­—æ®µå¦‚ "),s("code",[t._v("createdAt")]),t._v(" ç”¨äºåˆ†é¡µ/èŒƒå›´æŸ¥è¯¢ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$gte")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ISODate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2024-01-01'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("åº”å»ºç«‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createIndex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3ï¸âƒ£-æŸ¥è¯¢æ…¢æ—¶-ç”¨-explain-åˆ†æç´¢å¼•å‘½ä¸­"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3ï¸âƒ£-æŸ¥è¯¢æ…¢æ—¶-ç”¨-explain-åˆ†æç´¢å¼•å‘½ä¸­"}},[t._v("#")]),t._v(" 3ï¸âƒ£ æŸ¥è¯¢æ…¢æ—¶ï¼Œç”¨ "),s("code",[t._v("explain()")]),t._v(" åˆ†æç´¢å¼•å‘½ä¸­ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" xxx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("explain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"executionStats"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-äºŒã€åˆ†é¡µä¼˜åŒ–-é¿å…æ·±åº¦-skip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-äºŒã€åˆ†é¡µä¼˜åŒ–-é¿å…æ·±åº¦-skip"}},[t._v("#")]),t._v(" âœ… äºŒã€åˆ†é¡µä¼˜åŒ–ï¼ˆé¿å…æ·±åº¦ skipï¼‰")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("ä¸è¦ä½¿ç”¨ "),s("code",[t._v("skip")]),t._v(" æ·±åˆ†é¡µ")]),t._v("ï¼Œæ€§èƒ½ä¼šæŒ‡æ•°ä¸‹é™ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"âŒ-ä¸æ¨è"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âŒ-ä¸æ¨è"}},[t._v("#")]),t._v(" âŒ ä¸æ¨èï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("skip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"âœ…-æ¨è"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-æ¨è"}},[t._v("#")]),t._v(" âœ… æ¨èï¼š")]),t._v(" "),s("p",[t._v("ä½¿ç”¨ "),s("code",[t._v("createdAt")]),t._v(" æˆ– "),s("code",[t._v("_id")]),t._v(" åšæ¸¸æ ‡åˆ†é¡µï¼ˆåŸºäºâ€œä¸Šæ¬¡æœ€åä¸€æ¡â€ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$lt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ä¸Šä¸€é¡µæœ€åæ—¶é—´ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸‰ã€å†·çƒ­åˆ†ç¦»-åˆ†è¡¨ç­–ç•¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸‰ã€å†·çƒ­åˆ†ç¦»-åˆ†è¡¨ç­–ç•¥"}},[t._v("#")]),t._v(" âœ… ä¸‰ã€å†·çƒ­åˆ†ç¦» / åˆ†è¡¨ç­–ç•¥")]),t._v(" "),s("h3",{attrs:{id:"ğŸ”¹-1-å†·çƒ­æ•°æ®æ‹†åˆ†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”¹-1-å†·çƒ­æ•°æ®æ‹†åˆ†"}},[t._v("#")]),t._v(" ğŸ”¹ 1ï¼‰"),s("strong",[t._v("å†·çƒ­æ•°æ®æ‹†åˆ†")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("æœ€è¿‘ 6 ä¸ªæœˆ")]),t._v("çš„æ•°æ®ä¿ç•™åœ¨ä¸» "),s("code",[t._v("orders")]),t._v(" è¡¨ä¸­")]),t._v(" "),s("li",[s("strong",[t._v("å†å²è®¢å•å½’æ¡£")]),t._v("åˆ° "),s("code",[t._v("orders_history")]),t._v(" è¡¨ï¼ˆæˆ–å¦ä¸€ä¸ªåº“ï¼‰")])]),t._v(" "),s("p",[t._v("ä½¿ç”¨è„šæœ¬å®šæœŸå½’æ¡£ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$match")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$lt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ISODate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2024-01-01'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$merge")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("into")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders_history"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("ç„¶ååœ¨ "),s("code",[t._v("orders")]),t._v(" ä¸­åˆ é™¤è€æ•°æ®ã€‚")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"ğŸ”¹-2-æŒ‰æ—¶é—´-ç”¨æˆ·-id-åˆ†è¡¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”¹-2-æŒ‰æ—¶é—´-ç”¨æˆ·-id-åˆ†è¡¨"}},[t._v("#")]),t._v(" ğŸ”¹ 2ï¼‰"),s("strong",[t._v("æŒ‰æ—¶é—´/ç”¨æˆ· ID åˆ†è¡¨")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("orders_2024")]),t._v(", "),s("code",[t._v("orders_2023")])]),t._v(" "),s("li",[s("code",[t._v("orders_user_0")]),t._v(", "),s("code",[t._v("orders_user_1")]),t._v("ï¼ˆæŒ‰ userId hashï¼‰")])]),t._v(" "),s("p",[t._v("ç¼ºç‚¹ï¼šåº”ç”¨å±‚éœ€è¦åŠ¨æ€è·¯ç”±æŸ¥è¯¢é€»è¾‘ã€‚")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-å››ã€å‹ç¼©ä¸æ•°æ®ç²¾ç®€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-å››ã€å‹ç¼©ä¸æ•°æ®ç²¾ç®€"}},[t._v("#")]),t._v(" âœ… å››ã€å‹ç¼©ä¸æ•°æ®ç²¾ç®€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ”¸-1-å­—æ®µå‹ç¼©-ç²¾ç®€æ–‡æ¡£ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”¸-1-å­—æ®µå‹ç¼©-ç²¾ç®€æ–‡æ¡£ç»“æ„"}},[t._v("#")]),t._v(" ğŸ”¸ 1ï¼‰å­—æ®µå‹ç¼©ï¼ˆç²¾ç®€æ–‡æ¡£ç»“æ„ï¼‰")]),t._v(" "),s("ul",[s("li",[t._v("é¿å…å†—ä½™åµŒå¥—å­—æ®µ")]),t._v(" "),s("li",[t._v("å­—æ®µåç”¨çŸ­åï¼ˆå¦‚ "),s("code",[t._v("uid")]),t._v(" æ›¿ä»£ "),s("code",[t._v("userId")]),t._v("ï¼‰")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ”¸-2-å…³é—­ä¸å¿…è¦å­—æ®µç´¢å¼•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”¸-2-å…³é—­ä¸å¿…è¦å­—æ®µç´¢å¼•"}},[t._v("#")]),t._v(" ğŸ”¸ 2ï¼‰å…³é—­ä¸å¿…è¦å­—æ®µç´¢å¼•")]),t._v(" "),s("ul",[s("li",[t._v("ä¸æŸ¥è¯¢çš„å­—æ®µä¸è¦å»ºç´¢å¼•ï¼ˆæµªè´¹å†™å…¥æ€§èƒ½ + ç©ºé—´ï¼‰")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-äº”ã€å†™å…¥ä¼˜åŒ–"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-äº”ã€å†™å…¥ä¼˜åŒ–"}},[t._v("#")]),t._v(" âœ… äº”ã€å†™å…¥ä¼˜åŒ–")]),t._v(" "),s("h3",{attrs:{id:"æ‰¹é‡å†™å…¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ‰¹é‡å†™å…¥"}},[t._v("#")]),t._v(" æ‰¹é‡å†™å…¥ï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertMany")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"åˆç†è®¾ç½®-id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆç†è®¾ç½®-id"}},[t._v("#")]),t._v(" åˆç†è®¾ç½® "),s("code",[t._v("_id")])]),t._v(" "),s("p",[t._v("ä½¿ç”¨è‡ªå®šä¹‰é¡ºåºç”Ÿæˆ "),s("code",[t._v("_id")]),t._v("ï¼Œå¯é¿å…é»˜è®¤ ObjectId å¸¦æ¥çš„åˆ†å¸ƒå†™å…¥æ”¾å¤§é—®é¢˜ï¼ˆä½†é€šå¸¸å½±å“ä¸å¤§ï¼‰ã€‚")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-å…­ã€ç›‘æ§ä¸æ€§èƒ½åˆ†æå·¥å…·"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-å…­ã€ç›‘æ§ä¸æ€§èƒ½åˆ†æå·¥å…·"}},[t._v("#")]),t._v(" âœ… å…­ã€ç›‘æ§ä¸æ€§èƒ½åˆ†æå·¥å…·")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("db.orders.stats()")]),t._v(" æŸ¥çœ‹é›†åˆå¤§å°")]),t._v(" "),s("li",[s("code",[t._v("db.orders.totalIndexSize()")]),t._v(" æŸ¥çœ‹ç´¢å¼•ç©ºé—´")]),t._v(" "),s("li",[s("code",[t._v("mongotop")]),t._v(", "),s("code",[t._v("mongostat")]),t._v(", "),s("code",[t._v("Atlas Profiler")]),t._v(" å®æ—¶ç›‘æ§")]),t._v(" "),s("li",[s("code",[t._v("explain()")]),t._v(" å®šä½æ…¢æŸ¥è¯¢")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸ƒã€æ¶æ„å±‚æ‰©å±•-æç«¯é«˜å¹¶å‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸ƒã€æ¶æ„å±‚æ‰©å±•-æç«¯é«˜å¹¶å‘"}},[t._v("#")]),t._v(" âœ… ä¸ƒã€æ¶æ„å±‚æ‰©å±•ï¼ˆæç«¯é«˜å¹¶å‘ï¼‰")]),t._v(" "),s("p",[t._v("å¦‚æœæ•°æ®é‡å’Œå¹¶å‘å†æå‡ï¼Œå¯è€ƒè™‘ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("MongoDB åˆ†ç‰‡é›†ç¾¤ï¼ˆShardingï¼‰")]),t._v(" "),s("li",[t._v("çƒ­æ•°æ®ä½¿ç”¨ Redis ç¼“å­˜")]),t._v(" "),s("li",[t._v("å†å²æ•°æ®å½’æ¡£åˆ° ElasticSearch ç”¨äºæ£€ç´¢")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-æœ€ç»ˆå»ºè®®å°ç»“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-æœ€ç»ˆå»ºè®®å°ç»“"}},[t._v("#")]),t._v(" âœ… æœ€ç»ˆå»ºè®®å°ç»“")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ä¼˜åŒ–æ–¹å‘")]),t._v(" "),s("th",[t._v("å»ºè®®")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ç´¢å¼•")]),t._v(" "),s("td",[t._v("ç»„åˆç´¢å¼• + åˆ›å»ºæ—¶é—´ç´¢å¼•")])]),t._v(" "),s("tr",[s("td",[t._v("åˆ†é¡µ")]),t._v(" "),s("td",[t._v("æ¸¸æ ‡åˆ†é¡µä»£æ›¿ skip")])]),t._v(" "),s("tr",[s("td",[t._v("åˆ†è¡¨")]),t._v(" "),s("td",[t._v("çƒ­/å†·æ•°æ®åˆ†ç¦»æˆ–æŒ‰æ—¶é—´åˆ†è¡¨")])]),t._v(" "),s("tr",[s("td",[t._v("ç»“æ„ä¼˜åŒ–")]),t._v(" "),s("td",[t._v("å­—æ®µç²¾ç®€ã€å»å†—ä½™ã€æ–‡æ¡£å¤§å°æ§åˆ¶")])]),t._v(" "),s("tr",[s("td",[t._v("æŸ¥è¯¢ä¼˜åŒ–")]),t._v(" "),s("td",[t._v("ä½¿ç”¨ explain åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ")])]),t._v(" "),s("tr",[s("td",[t._v("æ‰©å±•æ–¹æ¡ˆ")]),t._v(" "),s("td",[t._v("æ•°æ®åˆ†ç‰‡ + Redis ç¼“å­˜ + ES æ£€ç´¢")])])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("ä½ æåˆ°çš„ä¸‰ç§æ¶æ„ä¼˜åŒ–ç­–ç•¥æ˜¯æ„å»º"),s("strong",[t._v("é«˜å¹¶å‘ + å¤§æ•°æ®é‡ç³»ç»Ÿ")]),t._v("çš„æ ¸å¿ƒæ–¹å¼ï¼Œé€‚ç”¨äºè®¢å•ç±»ç³»ç»Ÿã€æ—¥å¿—ç³»ç»Ÿã€äº¤æ˜“ç³»ç»Ÿç­‰åœºæ™¯ã€‚ä¸‹é¢æ˜¯å¯¹ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("MongoDB åˆ†ç‰‡é›†ç¾¤ï¼ˆShardingï¼‰")])]),t._v(" "),s("li",[s("strong",[t._v("Redis ç¼“å­˜çƒ­æ•°æ®")])]),t._v(" "),s("li",[s("strong",[t._v("ElasticSearch å½’æ¡£å†å²æ•°æ®")])])]),t._v(" "),s("p",[t._v("ä¸‰è€…çš„ "),s("strong",[t._v("ä½œç”¨ã€åŸç†ã€å®ç°æ–¹å¼")]),t._v(" çš„è¯¦è§£ï¼š")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸€ã€mongodb-åˆ†ç‰‡é›†ç¾¤-sharding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸€ã€mongodb-åˆ†ç‰‡é›†ç¾¤-sharding"}},[t._v("#")]),t._v(" âœ… ä¸€ã€MongoDB åˆ†ç‰‡é›†ç¾¤ï¼ˆShardingï¼‰")]),t._v(" "),s("h3",{attrs:{id:"ğŸ“Œ-ä½œç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ“Œ-ä½œç”¨"}},[t._v("#")]),t._v(" ğŸ“Œ ä½œç”¨ï¼š")]),t._v(" "),s("p",[t._v("å°† "),s("strong",[t._v("æµ·é‡æ•°æ®æ°´å¹³æ‹†åˆ†")]),t._v(" åˆ°å¤šä¸ªåˆ†ç‰‡èŠ‚ç‚¹ï¼ˆshardï¼‰ä¸Šï¼Œå®ç° "),s("strong",[t._v("è¯»å†™è´Ÿè½½å‡è¡¡ + æ— é™æ‰©å±•å®¹é‡")]),t._v("ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ§ -åŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ§ -åŸç†"}},[t._v("#")]),t._v(" ğŸ§  åŸç†ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æŒ‰ç…§ "),s("code",[t._v("shard key")]),t._v(" å°†æ•°æ®åˆ†å‘åˆ°ä¸åŒåˆ†ç‰‡")]),t._v(" "),s("li",[t._v("æŸ¥è¯¢ç”± Mongosï¼ˆè·¯ç”±å™¨ï¼‰æ ¹æ® key å®šå‘åˆ°æ­£ç¡® shard")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ“¦-æ¶æ„ç»„æˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ“¦-æ¶æ„ç»„æˆ"}},[t._v("#")]),t._v(" ğŸ“¦ æ¶æ„ç»„æˆï¼š")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("å®¢æˆ·ç«¯\n   â”‚\n â”Œâ”€â–¼â”€â”\n â”‚mongos è·¯ç”±å™¨â”‚â† å¤šä¸ªï¼Œå¯æ¨ªå‘æ‰©å±•\n â””â”€â–²â”€â”˜\n   â”‚\n â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n â”‚     Config Servers     â”‚ â† é…ç½®å…ƒæ•°æ®ï¼Œ3 ä¸ªæˆ–ä»¥ä¸Š\n â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   â”‚\n â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n â”‚    Shard1    â”‚     Shard2   â”‚  ... å¯æ‰©å±•\n â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n")])])]),s("h3",{attrs:{id:"ğŸ”§-ç¤ºä¾‹é…ç½®æ­¥éª¤-ç®€ç•¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”§-ç¤ºä¾‹é…ç½®æ­¥éª¤-ç®€ç•¥"}},[t._v("#")]),t._v(" ğŸ”§ ç¤ºä¾‹é…ç½®æ­¥éª¤ï¼ˆç®€ç•¥ï¼‰ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("é…ç½®åˆ†ç‰‡é›†ç¾¤ï¼š"),s("code",[t._v("mongod --shardsvr")])]),t._v(" "),s("li",[t._v("é…ç½® routerï¼š"),s("code",[t._v("mongos --configdb")])]),t._v(" "),s("li",[t._v("æ·»åŠ åˆ†ç‰‡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("sh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addShard")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shard1/host1:27017"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addShard")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shard2/host2:27017"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("å¯ç”¨åˆ†ç‰‡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("sh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enableSharding")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo_app"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("shardCollection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo_app.orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æˆ– createdAt")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-äºŒã€redis-ç¼“å­˜çƒ­æ•°æ®-è¯»å¤šå†™å°‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-äºŒã€redis-ç¼“å­˜çƒ­æ•°æ®-è¯»å¤šå†™å°‘"}},[t._v("#")]),t._v(" âœ… äºŒã€Redis ç¼“å­˜çƒ­æ•°æ®ï¼ˆè¯»å¤šå†™å°‘ï¼‰")]),t._v(" "),s("h3",{attrs:{id:"ğŸ“Œ-ä½œç”¨-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ“Œ-ä½œç”¨-2"}},[t._v("#")]),t._v(" ğŸ“Œ ä½œç”¨ï¼š")]),t._v(" "),s("p",[t._v("å°†"),s("strong",[t._v("é«˜é¢‘è¯»çš„æ•°æ®")]),t._v("ï¼ˆå¦‚ç”¨æˆ·æœ€æ–°è®¢å•ã€è®¢å•çŠ¶æ€ï¼‰ç¼“å­˜åˆ° Redisï¼Œé¿å… MongoDB é¢‘ç¹æŸ¥è¯¢ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ§ -é€‚åˆæ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ§ -é€‚åˆæ•°æ®"}},[t._v("#")]),t._v(" ğŸ§  é€‚åˆæ•°æ®ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æœ€è¿‘ 24 å°æ—¶çš„è®¢å•çŠ¶æ€")]),t._v(" "),s("li",[t._v("ç”¨æˆ·å¸¸è®¿é—®çš„è®¢å•è¯¦æƒ…")]),t._v(" "),s("li",[t._v("æŸ¥è¯¢ç»“æœç¼“å­˜ï¼ˆé˜²æ­¢é‡å¤åˆ†é¡µï¼‰")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ› ï¸-ç¼“å­˜ç­–ç•¥å»ºè®®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ› ï¸-ç¼“å­˜ç­–ç•¥å»ºè®®"}},[t._v("#")]),t._v(" ğŸ› ï¸ ç¼“å­˜ç­–ç•¥å»ºè®®ï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("é¡¹ç›®")]),t._v(" "),s("th",[t._v("è¯´æ˜")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Key è®¾è®¡")]),t._v(" "),s("td",[s("code",[t._v("order:{orderId}")]),t._v(" æˆ– "),s("code",[t._v("user:{id}:orders")])])]),t._v(" "),s("tr",[s("td",[t._v("å¤±æ•ˆç­–ç•¥")]),t._v(" "),s("td",[t._v("çƒ­ç‚¹æ•°æ®è®¾å®š 1hï½12h TTL æˆ– LRU")])]),t._v(" "),s("tr",[s("td",[t._v("ä¸€è‡´æ€§ç­–ç•¥")]),t._v(" "),s("td",[t._v("å†™å…¥ Mongo åç«‹å³å†™å…¥ Redisï¼Œæˆ–å»¶è¿Ÿä¸€è‡´æ€§åŒæ­¥")])]),t._v(" "),s("tr",[s("td",[t._v("ä½¿ç”¨æ–¹å¼")]),t._v(" "),s("td",[t._v("å…ˆæŸ¥ Redisï¼Œæ— æ•°æ®å†æŸ¥ Mongo")])])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¼ªä»£ç ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("order:")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("orderId"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" orderId "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("order:")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("orderId"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸‰ã€elasticsearch-å½’æ¡£å†å²æ•°æ®-å…¨æ–‡æ£€ç´¢-èšåˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸‰ã€elasticsearch-å½’æ¡£å†å²æ•°æ®-å…¨æ–‡æ£€ç´¢-èšåˆ"}},[t._v("#")]),t._v(" âœ… ä¸‰ã€ElasticSearch å½’æ¡£å†å²æ•°æ®ï¼ˆå…¨æ–‡æ£€ç´¢ + èšåˆï¼‰")]),t._v(" "),s("h3",{attrs:{id:"ğŸ“Œ-ä½œç”¨-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ“Œ-ä½œç”¨-3"}},[t._v("#")]),t._v(" ğŸ“Œ ä½œç”¨ï¼š")]),t._v(" "),s("p",[t._v("å°† "),s("strong",[t._v("è€è®¢å•æ•°æ®ï¼ˆå¦‚ 6 ä¸ªæœˆå‰ï¼‰")]),t._v(" å¯¼å…¥åˆ° ESï¼Œæ”¯æŒå¿«é€Ÿæœç´¢ã€åˆ†é¡µã€å¤æ‚ç»Ÿè®¡åˆ†æï¼Œè€Œä¸å½±å“ Mongo çš„è¯»å†™å‹åŠ›ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ§ -ä¸ºä»€ä¹ˆç”¨-es"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ§ -ä¸ºä»€ä¹ˆç”¨-es"}},[t._v("#")]),t._v(" ğŸ§  ä¸ºä»€ä¹ˆç”¨ ESï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å¿«é€Ÿå…¨æ–‡æœç´¢ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰")]),t._v(" "),s("li",[t._v("æ”¯æŒå¤æ‚èšåˆæŸ¥è¯¢ï¼ˆå¦‚è®¢å•é‡‘é¢ç»Ÿè®¡ï¼‰")]),t._v(" "),s("li",[t._v("è‡ªå¸¦å€’æ’ç´¢å¼•ï¼Œé€‚åˆæµ·é‡æ•°æ®")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ”§-å®ç°æ–¹å¼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”§-å®ç°æ–¹å¼"}},[t._v("#")]),t._v(" ğŸ”§ å®ç°æ–¹å¼ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("ä½¿ç”¨åŒæ­¥å·¥å…·å¯¼å…¥æ•°æ®ï¼Œå¦‚ï¼š")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("mongo-connector")]),t._v("ï¼ˆå·²è¿‡æ—¶ï¼‰")]),t._v(" "),s("li",[t._v("è‡ªå»ºåŒæ­¥ç¨‹åº")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.elastic.co/guide/en/logstash/current/plugins-inputs-mongodb.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Logstash + MongoDB input plugin"),s("OutboundLink")],1)])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ç¤ºä¾‹æ•°æ®ç»“æ„ï¼š")])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"orderId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc123"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"u001"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"item"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MacBook Air"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PAID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"createdAt"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2023-05-01T12:00:00"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("æŸ¥è¯¢ç¤ºä¾‹ï¼ˆDSLï¼‰ï¼š")])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"query"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"bool"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"must"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"match"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PAID"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"range"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"createdAt"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lt"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2024-01-01"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-æ¶æ„ååŒä½¿ç”¨å»ºè®®-ç”Ÿäº§å®è·µ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-æ¶æ„ååŒä½¿ç”¨å»ºè®®-ç”Ÿäº§å®è·µ"}},[t._v("#")]),t._v(" âœ… æ¶æ„ååŒä½¿ç”¨å»ºè®®ï¼ˆç”Ÿäº§å®è·µï¼‰")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("åœºæ™¯")]),t._v(" "),s("th",[t._v("ä½¿ç”¨æ–¹æ¡ˆ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("å®æ—¶å†™å…¥ã€è¯»å†™åˆ†å¸ƒå¼æ‰©å±•")]),t._v(" "),s("td",[t._v("MongoDB åˆ†ç‰‡é›†ç¾¤")])]),t._v(" "),s("tr",[s("td",[t._v("é«˜é¢‘è®¿é—®è®¢å•çŠ¶æ€æˆ–æœ€è¿‘åˆ—è¡¨")]),t._v(" "),s("td",[t._v("Redis ç¼“å­˜")])]),t._v(" "),s("tr",[s("td",[t._v("å†å²è®¢å•æ¨¡ç³Šæœç´¢ã€ç»Ÿè®¡åˆ†æ")]),t._v(" "),s("td",[t._v("ElasticSearch å­˜æ¡£+æŸ¥è¯¢")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸€å¼ å›¾æ€»ç»“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸€å¼ å›¾æ€»ç»“"}},[t._v("#")]),t._v(" âœ… ä¸€å¼ å›¾æ€»ç»“ï¼š")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("                +------------------------+\n                |      å‰ç«¯ / æ¥å£       |\n                +------------------------+\n                           |\n              +------------+------------+\n              |                         |\n     +--------â–¼--------+      +--------â–¼--------+\n     |    Redis ç¼“å­˜    |      |     MongoDB      |\n     | çƒ­ç‚¹è®¢å•/çŠ¶æ€    |      |   åˆ†ç‰‡è®¢å•ä¸»åº“   |\n     +--------+--------+      +--------+--------+\n              |                         |\n     +--------â–¼--------+      +--------â–¼--------+\n     |    ElasticSearch |      |   Mongo Archive |\n     | å†å²è®¢å•æ£€ç´¢/ç»Ÿè®¡ |      | å†å²æ•°æ®å†·å­˜å‚¨  |\n     +------------------+      +------------------+\n")])])]),s("hr"),t._v(" "),s("p",[t._v("ä½ æƒ³è¦çš„ Java å®ç°æ–¹æ¡ˆï¼Œå…¶ç›®æ ‡æ˜¯ï¼š")]),t._v(" "),s("blockquote",[s("p",[t._v("æ„å»ºä¸€ä¸ªç³»ç»Ÿï¼šä½¿ç”¨ MongoDB åˆ†ç‰‡é›†ç¾¤ä¿å­˜è®¢å•æ•°æ®ï¼ŒRedis ç¼“å­˜çƒ­æ•°æ®ï¼ŒElasticsearch å­˜å‚¨å†å²æ•°æ®ï¼Œå¹¶é€šè¿‡ Java æœåŠ¡è¯»å†™åè°ƒã€‚")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ç›®å½•ç»“æ„æ¦‚è§ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ç›®å½•ç»“æ„æ¦‚è§ˆ"}},[t._v("#")]),t._v(" âœ… ç›®å½•ç»“æ„æ¦‚è§ˆ")]),t._v(" "),s("p",[t._v("æˆ‘ä»¬å°†ä»ä»¥ä¸‹ 3 ä¸ªæ ¸å¿ƒç‚¹å®ç°ï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ç›®æ ‡æ¨¡å—")]),t._v(" "),s("th",[t._v("æŠ€æœ¯æ–¹æ¡ˆ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ğŸ”¹ MongoDB åˆ†ç‰‡è¯»å†™")]),t._v(" "),s("td",[t._v("ä½¿ç”¨ "),s("code",[t._v("MongoTemplate")]),t._v(" æˆ– "),s("code",[t._v("Spring Data Mongo")])])]),t._v(" "),s("tr",[s("td",[t._v("ğŸ”¹ Redis ç¼“å­˜åŠ é€Ÿ")]),t._v(" "),s("td",[t._v("ä½¿ç”¨ "),s("code",[t._v("Spring Cache")]),t._v(" æˆ– "),s("code",[t._v("Redisson")])])]),t._v(" "),s("tr",[s("td",[t._v("ğŸ”¹ ElasticSearch æŸ¥è¯¢")]),t._v(" "),s("td",[t._v("ä½¿ç”¨ "),s("code",[t._v("Spring Data Elasticsearch")]),t._v(" æˆ– "),s("code",[t._v("RestHighLevelClient")])])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸€ã€mongodb-åˆ†ç‰‡é›†ç¾¤è¿æ¥ä¸æ“ä½œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸€ã€mongodb-åˆ†ç‰‡é›†ç¾¤è¿æ¥ä¸æ“ä½œ"}},[t._v("#")]),t._v(" âœ… ä¸€ã€MongoDB åˆ†ç‰‡é›†ç¾¤è¿æ¥ä¸æ“ä½œ")]),t._v(" "),s("h3",{attrs:{id:"ğŸ“¦-maven-ä¾èµ–-mongodb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ“¦-maven-ä¾èµ–-mongodb"}},[t._v("#")]),t._v(" ğŸ“¦ Maven ä¾èµ–ï¼ˆMongoDBï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-data-mongodb"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"âš™ï¸-application-yml-é…ç½®è¿æ¥-å¯å¸¦å‰¯æœ¬é›†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âš™ï¸-application-yml-é…ç½®è¿æ¥-å¯å¸¦å‰¯æœ¬é›†"}},[t._v("#")]),t._v(" âš™ï¸ application.yml é…ç½®è¿æ¥ï¼ˆå¯å¸¦å‰¯æœ¬é›†ï¼‰")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mongodb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mongodb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//shard1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27017")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("shard2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27017")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("shard3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("27017/demo_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v("replicaSet=rs0\n")])])]),s("h3",{attrs:{id:"âœ…-ä½¿ç”¨-mongotemplate-æ“ä½œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä½¿ç”¨-mongotemplate-æ“ä½œ"}},[t._v("#")]),t._v(" âœ… ä½¿ç”¨ "),s("code",[t._v("MongoTemplate")]),t._v(" æ“ä½œï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OrderService")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MongoTemplate")]),t._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),t._v(" order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOrdersByUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),t._v(" query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Criteria")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("where")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("is")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-äºŒã€redis-ç¼“å­˜çƒ­ç‚¹è®¢å•æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-äºŒã€redis-ç¼“å­˜çƒ­ç‚¹è®¢å•æ•°æ®"}},[t._v("#")]),t._v(" âœ… äºŒã€Redis ç¼“å­˜çƒ­ç‚¹è®¢å•æ•°æ®")]),t._v(" "),s("h3",{attrs:{id:"ğŸ“¦-maven-ä¾èµ–"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ“¦-maven-ä¾èµ–"}},[t._v("#")]),t._v(" ğŸ“¦ Maven ä¾èµ–ï¼š")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-data-redis"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"âš™ï¸-application-yml-é…ç½®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âš™ï¸-application-yml-é…ç½®"}},[t._v("#")]),t._v(" âš™ï¸ application.yml é…ç½®ï¼š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" localhost\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n")])])]),s("h3",{attrs:{id:"âœ…-ä½¿ç”¨-redistemplate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä½¿ç”¨-redistemplate"}},[t._v("#")]),t._v(" âœ… ä½¿ç”¨ RedisTemplateï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringRedisTemplate")]),t._v(" redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrderWithCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" cacheKey "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" cached "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cached "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cached"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŸ¥è¯¢ MongoDB")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),t._v(" order "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toJSONString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofHours")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-ä¸‰ã€elasticsearch-æŸ¥è¯¢å†å²è®¢å•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-ä¸‰ã€elasticsearch-æŸ¥è¯¢å†å²è®¢å•"}},[t._v("#")]),t._v(" âœ… ä¸‰ã€Elasticsearch æŸ¥è¯¢å†å²è®¢å•")]),t._v(" "),s("h3",{attrs:{id:"ğŸ“¦-maven-ä¾èµ–-spring-boot-3-æ¨èç”¨æ–°å®¢æˆ·ç«¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ“¦-maven-ä¾èµ–-spring-boot-3-æ¨èç”¨æ–°å®¢æˆ·ç«¯"}},[t._v("#")]),t._v(" ğŸ“¦ Maven ä¾èµ–ï¼ˆSpring Boot 3 æ¨èç”¨æ–°å®¢æˆ·ç«¯ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("co.elastic.clients"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("elasticsearch-java"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("8.11.3"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"âœ…-åˆå§‹åŒ–-es-å®¢æˆ·ç«¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-åˆå§‹åŒ–-es-å®¢æˆ·ç«¯"}},[t._v("#")]),t._v(" âœ… åˆå§‹åŒ– ES å®¢æˆ·ç«¯ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EsConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticsearchClient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("elasticsearchClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestClient")]),t._v(" restClient "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticsearchTransport")]),t._v(" transport "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestClientTransport")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            restClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JacksonJsonpMapper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticsearchClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"âœ…-æŸ¥è¯¢å†å²è®¢å•-createdat-æŸæ—¶é—´"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-æŸ¥è¯¢å†å²è®¢å•-createdat-æŸæ—¶é—´"}},[t._v("#")]),t._v(" âœ… æŸ¥è¯¢å†å²è®¢å•ï¼ˆcreatedAt < æŸæ—¶é—´ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("searchOldOrders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalDateTime")]),t._v(" sixMonthsAgo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalDateTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("minusMonths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticsearchClient")]),t._v(" client "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" elasticsearchClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" s\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" q\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" b\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("must")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("term")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("field")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("must")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("field")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsonData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("of")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sixMonthsAgo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hits")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hits")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Hit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-å››ã€è°ƒåº¦å½’æ¡£-mongo-â†’-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-å››ã€è°ƒåº¦å½’æ¡£-mongo-â†’-elasticsearch"}},[t._v("#")]),t._v(" âœ… å››ã€è°ƒåº¦å½’æ¡£ï¼šMongo â†’ ElasticSearch")]),t._v(" "),s("p",[t._v("ä½ å¯ä»¥åœ¨å®šæ—¶ä»»åŠ¡ä¸­ï¼Œå®šæœŸå°† Mongo ä¸­çš„è€è®¢å•è¿ç§»åˆ° ESï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Scheduled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cron "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0 0 2 * * ?"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("archiveOldOrdersToES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),t._v(" query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Criteria")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("where")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalDateTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("minusMonths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" oldOrders "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    oldOrders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            elasticsearchClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" i\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("document")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"å½’æ¡£å¤±è´¥ï¼š{}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"âœ…-äº”ã€æ•´ä½“æ¶æ„å›é¡¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-äº”ã€æ•´ä½“æ¶æ„å›é¡¾"}},[t._v("#")]),t._v(" âœ… äº”ã€æ•´ä½“æ¶æ„å›é¡¾")]),t._v(" "),s("div",{staticClass:"language-plaintext extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plaintext"}},[s("code",[t._v("               +---------------------+\n               |   Java SpringBoot   |\n               +---------------------+\n                   |     |       |\n     Redis (ç¼“å­˜)  |     |       |  MongoDB (åˆ†ç‰‡ä¸»åº“)\n         çƒ­ç‚¹è®¢å•  |     |       |  å®æ—¶è¯»å†™\n                   â–¼     â–¼       â–¼\n               Elasticsearch       ï¼ˆå½’æ¡£ï¼‰\n             6æœˆå‰è€è®¢å•æœç´¢ã€ç»Ÿè®¡åˆ†æ\n")])])]),s("hr"),t._v(" "),s("p",[t._v("ä½¿ç”¨ MongoDB åˆ†ç‰‡é›†ç¾¤ä¿å­˜è®¢å•æ•°æ®ï¼ŒRedis ç¼“å­˜çƒ­æ•°æ®ï¼ŒElasticsearch å­˜å‚¨å†å²æ•°æ®ï¼Œå¹¶é€šè¿‡ Java æœåŠ¡è¯»å†™åè°ƒã€‚")])])}),[],!1,null,null,null);s.default=r.exports},619:function(t,s,a){t.exports=a.p+"assets/img/img_14.512c0408.png"},620:function(t,s,a){t.exports=a.p+"assets/img/img_15.bbbf02cc.png"}}]);