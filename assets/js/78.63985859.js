(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{1233:function(t,s,a){"use strict";a.r(s);var n=a(1),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("点击勘误"),s("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues"),s("OutboundLink")],1),t._v("，哪吒感谢大家的阅读")])]),t._v(" "),s("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),t._v(" "),s("h2",{attrs:{id:"运维服务器6年经验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运维服务器6年经验"}},[t._v("#")]),t._v(" 运维服务器6年经验")]),t._v(" "),s("h2",{attrs:{id:"✅-一、常用-linux-命令分类-重点常见"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-一、常用-linux-命令分类-重点常见"}},[t._v("#")]),t._v(" ✅ 一、常用 Linux 命令分类（重点常见）：")]),t._v(" "),s("h3",{attrs:{id:"🔹-系统资源监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔹-系统资源监控"}},[t._v("#")]),t._v(" 🔹 系统资源监控")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("命令")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("top")])]),t._v(" "),s("td",[t._v("实时查看 CPU、内存、进程占用等")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("htop")])]),t._v(" "),s("td",[s("code",[t._v("top")]),t._v(" 的增强版，图形化显示")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ps")])]),t._v(" "),s("td",[t._v("查看当前系统进程状态")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("uptime")])]),t._v(" "),s("td",[t._v("查看系统运行时长与负载情况")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("vmstat")])]),t._v(" "),s("td",[t._v("查看内存、CPU、IO 等系统性能")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("iostat")])]),t._v(" "),s("td",[t._v("查看磁盘 IO 使用率（来自 "),s("code",[t._v("sysstat")]),t._v(" 包）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("free")])]),t._v(" "),s("td",[t._v("查看内存使用情况")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("sar")])]),t._v(" "),s("td",[t._v("收集系统性能历史（需安装 "),s("code",[t._v("sysstat")]),t._v("）")])])])]),t._v(" "),s("h3",{attrs:{id:"🔹-网络相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔹-网络相关"}},[t._v("#")]),t._v(" 🔹 网络相关")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("命令")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("netstat")])]),t._v(" "),s("td",[t._v("查看网络连接、端口监听等（建议用 "),s("code",[t._v("ss")]),t._v(" 替代）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ss")])]),t._v(" "),s("td",[t._v("更快更准确的替代 "),s("code",[t._v("netstat")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ping")])]),t._v(" "),s("td",[t._v("测试网络连通性")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("traceroute")])]),t._v(" "),s("td",[t._v("路由追踪")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("dig/nslookup")])]),t._v(" "),s("td",[t._v("域名解析工具")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("curl/wget")])]),t._v(" "),s("td",[t._v("网络请求测试")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("tcpdump")])]),t._v(" "),s("td",[t._v("抓包工具")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("iftop")])]),t._v(" "),s("td",[t._v("实时网络带宽监控")])])])]),t._v(" "),s("h3",{attrs:{id:"🔹-磁盘与文件系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔹-磁盘与文件系统"}},[t._v("#")]),t._v(" 🔹 磁盘与文件系统")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("命令")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("df")])]),t._v(" "),s("td",[t._v("查看磁盘挂载与剩余空间")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("du")])]),t._v(" "),s("td",[t._v("查看目录/文件占用大小")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("lsblk")])]),t._v(" "),s("td",[t._v("查看磁盘挂载结构")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("mount/umount")])]),t._v(" "),s("td",[t._v("挂载/卸载磁盘")])])])]),t._v(" "),s("h3",{attrs:{id:"🔹-文件与系统操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔹-文件与系统操作"}},[t._v("#")]),t._v(" 🔹 文件与系统操作")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("命令")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("ls")]),t._v(", "),s("code",[t._v("cd")]),t._v(", "),s("code",[t._v("cat")]),t._v(", "),s("code",[t._v("cp")]),t._v(", "),s("code",[t._v("mv")]),t._v(", "),s("code",[t._v("rm")])]),t._v(" "),s("td",[t._v("文件操作")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("find")]),t._v(", "),s("code",[t._v("grep")]),t._v(", "),s("code",[t._v("awk")]),t._v(", "),s("code",[t._v("sed")])]),t._v(" "),s("td",[t._v("查找与文本处理")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("chmod")]),t._v(", "),s("code",[t._v("chown")])]),t._v(" "),s("td",[t._v("修改权限与所有者")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("tar")]),t._v(", "),s("code",[t._v("zip")]),t._v(", "),s("code",[t._v("unzip")])]),t._v(" "),s("td",[t._v("压缩解压")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("systemctl")]),t._v(", "),s("code",[t._v("service")])]),t._v(" "),s("td",[t._v("服务管理")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("journalctl")])]),t._v(" "),s("td",[t._v("查看系统日志")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("crontab")])]),t._v(" "),s("td",[t._v("定时任务")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("kill")]),t._v(", "),s("code",[t._v("killall")]),t._v(", "),s("code",[t._v("xargs")])]),t._v(" "),s("td",[t._v("杀进程")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-二、你提到的命令详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-二、你提到的命令详解"}},[t._v("#")]),t._v(" ✅ 二、你提到的命令详解")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("命令")]),t._v(" "),s("th",[t._v("用途说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("top")])]),t._v(" "),s("td",[t._v("实时查看 CPU、内存占用、各进程运行状态，常用于排查系统负载高的问题")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ps aux")])]),t._v(" "),s("td",[t._v("快照方式查看所有进程状态，可结合 "),s("code",[t._v("grep")]),t._v(" 找关键进程")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("netstat -tulnp")])]),t._v(" "),s("td",[t._v("查看监听端口与绑定服务（被 "),s("code",[t._v("ss")]),t._v(" 取代）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("df -h")])]),t._v(" "),s("td",[t._v("查看各挂载分区的剩余空间、使用率，判断磁盘是否满")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("du -sh *")])]),t._v(" "),s("td",[t._v("查看当前目录下各子目录/文件大小，定位“谁占满了磁盘”")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("iostat -x 1")])]),t._v(" "),s("td",[t._v("查看磁盘读写速率、IO 等待情况，分析 IO 瓶颈问题（需安装 "),s("code",[t._v("sysstat")]),t._v("）")])])])]),t._v(" "),s("h2",{attrs:{id:"✅-一、linux-运维排查命令速查表-分类-场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-一、linux-运维排查命令速查表-分类-场景"}},[t._v("#")]),t._v(" ✅ 一、Linux 运维排查命令速查表（分类 + 场景）")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("分类")]),t._v(" "),s("th",[t._v("命令示例")]),t._v(" "),s("th",[t._v("使用场景说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("🔧 "),s("strong",[t._v("CPU/内存排查")])]),t._v(" "),s("td",[s("code",[t._v("top")]),t._v(", "),s("code",[t._v("htop")]),t._v(", "),s("code",[t._v("ps aux --sort=-%cpu")])]),t._v(" "),s("td",[t._v("查看高负载进程、内存泄漏、进程异常")])]),t._v(" "),s("tr",[s("td",[t._v("🔧 "),s("strong",[t._v("磁盘排查")])]),t._v(" "),s("td",[s("code",[t._v("df -h")]),t._v(", "),s("code",[t._v("du -sh *")]),t._v(", "),s("code",[t._v("lsof")]),t._v(", "),s("code",[t._v("ncdu")])]),t._v(" "),s("td",[t._v("查看磁盘是否满、哪些文件占用最大空间")])]),t._v(" "),s("tr",[s("td",[t._v("🔧 "),s("strong",[t._v("IO 排查")])]),t._v(" "),s("td",[s("code",[t._v("iostat -x 1")]),t._v(", "),s("code",[t._v("iotop")]),t._v(", "),s("code",[t._v("vmstat 1")])]),t._v(" "),s("td",[t._v("判断磁盘 IO 是否瓶颈、IO 等待高")])]),t._v(" "),s("tr",[s("td",[t._v("🔧 "),s("strong",[t._v("网络排查")])]),t._v(" "),s("td",[s("code",[t._v("netstat -tulnp")]),t._v(", "),s("code",[t._v("ss -lntp")]),t._v(", "),s("code",[t._v("lsof -i:端口")])]),t._v(" "),s("td",[t._v("查看端口监听情况、网络连接状态")])]),t._v(" "),s("tr",[s("td",[t._v("🌐 "),s("strong",[t._v("连通性测试")])]),t._v(" "),s("td",[s("code",[t._v("ping")]),t._v(", "),s("code",[t._v("traceroute")]),t._v(", "),s("code",[t._v("curl")]),t._v(", "),s("code",[t._v("dig")]),t._v(", "),s("code",[t._v("telnet")])]),t._v(" "),s("td",[t._v("网络是否通，DNS 解析是否正常")])]),t._v(" "),s("tr",[s("td",[t._v("📂 "),s("strong",[t._v("文件定位")])]),t._v(" "),s("td",[s("code",[t._v('find . -type f -name "*.log"')]),t._v(", "),s("code",[t._v("du -ah | sort -rh")])]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("🔍 "),s("strong",[t._v("日志查看")])]),t._v(" "),s("td",[s("code",[t._v("tail -f /var/log/messages")]),t._v(", "),s("code",[t._v("journalctl -xe")])]),t._v(" "),s("td",[t._v("实时查看系统/服务日志，查启动失败")])]),t._v(" "),s("tr",[s("td",[t._v("🔐 "),s("strong",[t._v("权限排查")])]),t._v(" "),s("td",[s("code",[t._v("ls -l")]),t._v(", "),s("code",[t._v("chmod")]),t._v(", "),s("code",[t._v("chown")])]),t._v(" "),s("td",[t._v("文件/目录权限错误导致无法访问")])]),t._v(" "),s("tr",[s("td",[t._v("⚙️ "),s("strong",[t._v("进程控制")])]),t._v(" "),s("td",[s("code",[t._v("ps")]),t._v(", "),s("code",[t._v("kill")]),t._v(", "),s("code",[t._v("killall")]),t._v(", "),s("code",[t._v("xargs")])]),t._v(" "),s("td",[t._v("查找并终止异常进程")])]),t._v(" "),s("tr",[s("td",[t._v("📆 "),s("strong",[t._v("定时任务")])]),t._v(" "),s("td",[s("code",[t._v("crontab -l")]),t._v(", "),s("code",[t._v("systemctl list-timers")])]),t._v(" "),s("td",[t._v("定时脚本未触发或配置错误")])])])]),t._v(" "),s("h3",{attrs:{id:"cpu-飙高排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cpu-飙高排查"}},[t._v("#")]),t._v(" CPU 飙高排查")]),t._v(" "),s("blockquote",[s("p",[t._v("有一次线上系统 CPU 飙到 100%，我使用 "),s("code",[t._v("top")]),t._v(" 查看是某个 Java 进程占满 CPU，再结合 "),s("code",[t._v("ps -ef")]),t._v(" 确认 PID，之后用 "),s("code",[t._v("jstack")]),t._v(" dump 栈分析是某个线程死循环。修复后 CPU 降回正常。")])]),t._v(" "),s("h3",{attrs:{id:"磁盘打满导致服务挂掉"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#磁盘打满导致服务挂掉"}},[t._v("#")]),t._v(" 磁盘打满导致服务挂掉")]),t._v(" "),s("blockquote",[s("p",[t._v("某次服务突然挂掉，"),s("code",[t._v("df -h")]),t._v(" 一看 "),s("code",[t._v("/var")]),t._v(" 分区 100%，"),s("code",[t._v("du -sh *")]),t._v(" 逐级定位，发现是日志文件打满了。用 "),s("code",[t._v("logrotate")]),t._v(" 加了压缩与清理策略，避免再次发生。")])]),t._v(" "),s("h3",{attrs:{id:"数据库连接失败排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库连接失败排查"}},[t._v("#")]),t._v(" 数据库连接失败排查")]),t._v(" "),s("blockquote",[s("p",[t._v("应用连不上 MySQL，先用 "),s("code",[t._v("ping")]),t._v(" 确认网络通，再 "),s("code",[t._v("telnet host 3306")]),t._v(" 发现端口不通，用 "),s("code",[t._v("ss -lntp")]),t._v(" 查服务未监听，原来是数据库未启动，"),s("code",[t._v("systemctl start mysql")]),t._v(" 后恢复正常。")])]),t._v(" "),s("h3",{attrs:{id:"redis-多实例端口冲突"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-多实例端口冲突"}},[t._v("#")]),t._v(" Redis 多实例端口冲突")]),t._v(" "),s("blockquote",[s("p",[t._v("多 Redis 实例启动失败，"),s("code",[t._v("netstat -tulnp")]),t._v(" 显示端口已被占用，"),s("code",[t._v("ps aux | grep redis")]),t._v(" 查出是老进程未关闭，"),s("code",[t._v("kill")]),t._v(" 后再重启成功。")])]),t._v(" "),s("h3",{attrs:{id:"磁盘-io-性能瓶颈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#磁盘-io-性能瓶颈"}},[t._v("#")]),t._v(" 磁盘 IO 性能瓶颈")]),t._v(" "),s("blockquote",[s("p",[t._v("某服务响应慢但 CPU 占用低，用 "),s("code",[t._v("iostat -x 1")]),t._v(" 查看发现磁盘 "),s("code",[t._v("util")]),t._v(" 长时间接近 100%，排查是频繁写入日志导致 IO 拥塞，优化后日志按级别写入，响应恢复。")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("命令")]),t._v(" "),s("th",[t._v("面试中简洁描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("top")])]),t._v(" "),s("td",[t._v("实时监控进程 CPU、内存使用情况")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ps aux")])]),t._v(" "),s("td",[t._v("查看所有进程的静态快照")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("netstat")]),t._v("/"),s("code",[t._v("ss")])]),t._v(" "),s("td",[t._v("查看端口监听与网络连接")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("df -h")])]),t._v(" "),s("td",[t._v("查看磁盘分区使用情况")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("du -sh *")])]),t._v(" "),s("td",[t._v("查看目录大小，排查大文件")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("iostat")])]),t._v(" "),s("td",[t._v("查看磁盘 IO 使用与瓶颈")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("tail -f")])]),t._v(" "),s("td",[t._v("实时查看日志输出")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ping")]),t._v(", "),s("code",[t._v("curl")])]),t._v(" "),s("td",[t._v("检查网络连通性与服务是否在线")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("kill -9")])]),t._v(" "),s("td",[t._v("强制结束进程")])])])]),t._v(" "),s("h2",{attrs:{id:"一键安装工具建议-运维必备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一键安装工具建议-运维必备"}},[t._v("#")]),t._v(" 一键安装工具建议（运维必备）")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# IO 和网络工具合集（Debian/Ubuntu）\nsudo apt install sysstat iotop iftop net-tools lsof\n\n# CentOS/RHEL\nsudo yum install sysstat iotop iftop net-tools lsof\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("排查场景")]),t._v(" "),s("th",[t._v("使用命令")]),t._v(" "),s("th",[t._v("目的")]),t._v(" "),s("th",[t._v("实际作用 / 结果")]),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Java 进程 CPU 飙升")]),t._v(" "),s("td",[s("code",[t._v("top")]),t._v(" "),s("br"),t._v(" "),s("code",[t._v("ps aux --sort=-%cpu")]),t._v(" "),s("br"),t._v(" "),s("code",[t._v("jstack PID")])]),t._v(" "),s("td",[t._v("找出高 CPU 占用进程，并用 jstack 抓线程堆栈")]),t._v(" "),s("td",[t._v("确认是某线程死循环导致 CPU 占满，分析定位业务逻辑问题")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("磁盘写入异常")]),t._v(" "),s("td",[s("code",[t._v("df -h")])]),t._v(" "),s("td",[t._v("查看分区是否已满")]),t._v(" "),s("td",[s("code",[t._v("/var")]),t._v(" 分区 100%，服务日志无法写入，导致接口报错")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("大文件定位")]),t._v(" "),s("td",[s("code",[t._v("du -sh *")]),t._v(" "),s("br"),t._v(" `du -sh ./*")]),t._v(" "),s("td",[t._v("sort -rh")]),t._v(" "),s("td",[t._v("head`")]),t._v(" "),s("td",[t._v("快速定位大目录 / 大日志文件")]),t._v(" "),s("td",[t._v("找到某日志文件超过 5G，配合 logrotate 设定切割策略")])]),t._v(" "),s("tr",[s("td",[t._v("磁盘 IO 性能瓶颈")]),t._v(" "),s("td",[s("code",[t._v("iostat -x 1")])]),t._v(" "),s("td",[t._v("查看 IO 利用率、等待时间")]),t._v(" "),s("td",[s("code",[t._v("util")]),t._v(" 长期 90%+，"),s("code",[t._v("await")]),t._v(" 时间高，确认写入瓶颈在磁盘")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("端口冲突 / Redis 未监听")]),t._v(" "),s("td",[s("code",[t._v("netstat -tulnp")]),t._v(" "),s("br"),t._v(" "),s("code",[t._v("ss -lntp")])]),t._v(" "),s("td",[t._v("查看端口占用情况")]),t._v(" "),s("td",[t._v("发现 Redis 配置监听端口未启动或端口被其他进程占用")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("进程是否存在 / 多开")]),t._v(" "),s("td",[t._v("`ps aux")]),t._v(" "),s("td",[t._v("grep redis"),s("code",[t._v("<br>")]),t._v("pgrep -f redis`")]),t._v(" "),s("td",[t._v("确认进程是否已运行、是否重复启动")]),t._v(" "),s("td",[t._v("避免重复启动 Redis 或 MySQL 实例，或确认是否未启动成功")]),t._v(" "),s("td")])])]),t._v(" "),s("p",[t._v("有次线上系统响应变慢，我用 top 查到 Java 进程 CPU 99%，结合 jstack 抓取线程栈，确认某死循环逻辑导致占用；也遇到磁盘异常，df 发现 /var 分区满了，用 du 快速找到是日志爆量；另外还用 iostat 定位 IO 等待高，结合日志改写策略缓解了瓶颈。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(619),alt:"img_14.png"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(620),alt:"img_15.png"}})]),t._v(" "),s("p",[t._v("mongo，")]),t._v(" "),s("p",[t._v("在 MongoDB 中，我们不会说“库”和“表”，而是使用以下术语：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("通用数据库术语")]),t._v(" "),s("th",[t._v("MongoDB 中的术语")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("数据库（Database）")]),t._v(" "),s("td",[t._v("数据库（Database） ✅")])]),t._v(" "),s("tr",[s("td",[t._v("表（Table）")]),t._v(" "),s("td",[t._v("集合（Collection） ✅")])]),t._v(" "),s("tr",[s("td",[t._v("行（Row）")]),t._v(" "),s("td",[t._v("文档（Document） ✅")])]),t._v(" "),s("tr",[s("td",[t._v("列（Column）")]),t._v(" "),s("td",[t._v("字段（Field） ✅")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-mongodb-的基本结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-mongodb-的基本结构"}},[t._v("#")]),t._v(" ✅ MongoDB 的基本结构：")]),t._v(" "),s("div",{staticClass:"language-plaintext extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plaintext"}},[s("code",[t._v("MongoDB Server\n └── Database（数据库）\n      └── Collection（集合，相当于表）\n           └── Document（文档，相当于行）\n                └── Field（字段，相当于列）\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-举例说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-举例说明"}},[t._v("#")]),t._v(" ✅ 举例说明")]),t._v(" "),s("h3",{attrs:{id:"创建数据库和集合-相当于-建库建表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建数据库和集合-相当于-建库建表"}},[t._v("#")]),t._v(" 创建数据库和集合（相当于“建库建表”）：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("use mydb              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 选择或创建数据库")]),t._v("\n\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCollection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建集合，相当于创建表")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"插入文档-相当于插入一行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插入文档-相当于插入一行"}},[t._v("#")]),t._v(" 插入文档（相当于插入一行）：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zhangsan@example.com"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"查询文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询文档"}},[t._v("#")]),t._v(" 查询文档：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$gt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-mongodb-特点-vs-关系型数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-mongodb-特点-vs-关系型数据库"}},[t._v("#")]),t._v(" ✅ MongoDB 特点 vs 关系型数据库")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("MongoDB（文档型）")]),t._v(" "),s("th",[t._v("MySQL / PostgreSQL（关系型）")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("无固定表结构")]),t._v(" "),s("td",[t._v("表结构需提前定义字段类型")])]),t._v(" "),s("tr",[s("td",[t._v("支持嵌套文档、数组字段")]),t._v(" "),s("td",[t._v("不支持嵌套对象")])]),t._v(" "),s("tr",[s("td",[t._v("灵活写入，字段可不同")]),t._v(" "),s("td",[t._v("每行字段一致，强类型约束")])]),t._v(" "),s("tr",[s("td",[t._v("使用 JSON/BSON 存储文档")]),t._v(" "),s("td",[t._v("使用行列式存储")])])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("如果你想查看 Mongo 当前所有库/表（集合）：")]),t._v(" "),s("h3",{attrs:{id:"查看所有数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看所有数据库"}},[t._v("#")]),t._v(" 查看所有数据库：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("show dbs\n")])])]),s("h3",{attrs:{id:"查看当前数据库所有集合-表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看当前数据库所有集合-表"}},[t._v("#")]),t._v(" 查看当前数据库所有集合（表）：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("show collections\n")])])]),s("hr"),t._v(" "),s("p",[t._v("下面是一个完整的 MongoDB 示例项目结构，模拟常见的 "),s("strong",[t._v("用户（users）+ 订单（orders）")]),t._v(" 模型，适合实际开发用作项目初始化：")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-项目结构说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-项目结构说明"}},[t._v("#")]),t._v(" ✅ 项目结构说明")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("数据库："),s("code",[t._v("demo_app")])])]),t._v(" "),s("li",[s("p",[t._v("集合：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("users")]),t._v("：用户信息")]),t._v(" "),s("li",[s("code",[t._v("orders")]),t._v("：用户订单（包含用户 ID 作为外键）")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-初始化脚本-mongo-shell-语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-初始化脚本-mongo-shell-语法"}},[t._v("#")]),t._v(" ✅ 初始化脚本（Mongo Shell 语法）")]),t._v(" "),s("p",[t._v("你可以复制粘贴到 Mongo Shell / "),s("code",[t._v("mongosh")]),t._v(" 中运行：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. 切换或创建数据库")]),t._v("\nuse demo_app\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. 创建 users 集合并插入示例文档")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCollection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertMany")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice@example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("phone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1234567890"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bob"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bob@example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("phone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9876543210"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. 创建 orders 集合并插入示例文档")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCollection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertMany")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("item")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iPhone 15"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("price")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7999")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PAID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bob"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("item")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MacBook Air"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("price")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9999")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SHIPPED"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. 建立索引（如用户邮箱唯一）")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createIndex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("unique")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createIndex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-查询示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-查询示例"}},[t._v("#")]),t._v(" ✅ 查询示例")]),t._v(" "),s("h3",{attrs:{id:"查找某用户的订单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查找某用户的订单"}},[t._v("#")]),t._v(" 查找某用户的订单：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_id "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"查询所有订单并带上用户信息-关联查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询所有订单并带上用户信息-关联查询"}},[t._v("#")]),t._v(" 查询所有订单并带上用户信息（关联查询）：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$lookup")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("localField")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("foreignField")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userInfo"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$unwind")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$userInfo"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$project")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("item")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("price")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"userInfo.username"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"userInfo.email"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[t._v("如果 MongoDB 中的订单集合（orders）超过 1000 万条数据，想要维持查询性能和系统可扩展性，必须从多个维度进行优化：")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-一、索引优化-最关键"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-一、索引优化-最关键"}},[t._v("#")]),t._v(" ✅ 一、索引优化（最关键）")]),t._v(" "),s("h3",{attrs:{id:"_1️⃣-建立高命中率的组合索引"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1️⃣-建立高命中率的组合索引"}},[t._v("#")]),t._v(" 1️⃣ 建立"),s("strong",[t._v("高命中率的组合索引")])]),t._v(" "),s("p",[t._v("例如常见查询条件：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PAID"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("应建立：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createIndex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2️⃣-常用字段如-createdat-用于分页-范围查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2️⃣-常用字段如-createdat-用于分页-范围查询"}},[t._v("#")]),t._v(" 2️⃣ 常用字段如 "),s("code",[t._v("createdAt")]),t._v(" 用于分页/范围查询：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$gte")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ISODate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2024-01-01'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("应建立：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createIndex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3️⃣-查询慢时-用-explain-分析索引命中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3️⃣-查询慢时-用-explain-分析索引命中"}},[t._v("#")]),t._v(" 3️⃣ 查询慢时，用 "),s("code",[t._v("explain()")]),t._v(" 分析索引命中：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" xxx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("explain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"executionStats"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-二、分页优化-避免深度-skip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-二、分页优化-避免深度-skip"}},[t._v("#")]),t._v(" ✅ 二、分页优化（避免深度 skip）")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("不要使用 "),s("code",[t._v("skip")]),t._v(" 深分页")]),t._v("，性能会指数下降。")])]),t._v(" "),s("h3",{attrs:{id:"❌-不推荐"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#❌-不推荐"}},[t._v("#")]),t._v(" ❌ 不推荐：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("skip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"✅-推荐"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-推荐"}},[t._v("#")]),t._v(" ✅ 推荐：")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("createdAt")]),t._v(" 或 "),s("code",[t._v("_id")]),t._v(" 做游标分页（基于“上次最后一条”）：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$lt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 上一页最后时间 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-三、冷热分离-分表策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-三、冷热分离-分表策略"}},[t._v("#")]),t._v(" ✅ 三、冷热分离 / 分表策略")]),t._v(" "),s("h3",{attrs:{id:"🔹-1-冷热数据拆分"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔹-1-冷热数据拆分"}},[t._v("#")]),t._v(" 🔹 1）"),s("strong",[t._v("冷热数据拆分")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("最近 6 个月")]),t._v("的数据保留在主 "),s("code",[t._v("orders")]),t._v(" 表中")]),t._v(" "),s("li",[s("strong",[t._v("历史订单归档")]),t._v("到 "),s("code",[t._v("orders_history")]),t._v(" 表（或另一个库）")])]),t._v(" "),s("p",[t._v("使用脚本定期归档：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$match")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("createdAt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$lt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ISODate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2024-01-01'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$merge")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("into")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders_history"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("然后在 "),s("code",[t._v("orders")]),t._v(" 中删除老数据。")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"🔹-2-按时间-用户-id-分表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔹-2-按时间-用户-id-分表"}},[t._v("#")]),t._v(" 🔹 2）"),s("strong",[t._v("按时间/用户 ID 分表")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("orders_2024")]),t._v(", "),s("code",[t._v("orders_2023")])]),t._v(" "),s("li",[s("code",[t._v("orders_user_0")]),t._v(", "),s("code",[t._v("orders_user_1")]),t._v("（按 userId hash）")])]),t._v(" "),s("p",[t._v("缺点：应用层需要动态路由查询逻辑。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-四、压缩与数据精简"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-四、压缩与数据精简"}},[t._v("#")]),t._v(" ✅ 四、压缩与数据精简")]),t._v(" "),s("h3",{attrs:{id:"🔸-1-字段压缩-精简文档结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔸-1-字段压缩-精简文档结构"}},[t._v("#")]),t._v(" 🔸 1）字段压缩（精简文档结构）")]),t._v(" "),s("ul",[s("li",[t._v("避免冗余嵌套字段")]),t._v(" "),s("li",[t._v("字段名用短名（如 "),s("code",[t._v("uid")]),t._v(" 替代 "),s("code",[t._v("userId")]),t._v("）")])]),t._v(" "),s("h3",{attrs:{id:"🔸-2-关闭不必要字段索引"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔸-2-关闭不必要字段索引"}},[t._v("#")]),t._v(" 🔸 2）关闭不必要字段索引")]),t._v(" "),s("ul",[s("li",[t._v("不查询的字段不要建索引（浪费写入性能 + 空间）")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-五、写入优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-五、写入优化"}},[t._v("#")]),t._v(" ✅ 五、写入优化")]),t._v(" "),s("h3",{attrs:{id:"批量写入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#批量写入"}},[t._v("#")]),t._v(" 批量写入：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertMany")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"合理设置-id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#合理设置-id"}},[t._v("#")]),t._v(" 合理设置 "),s("code",[t._v("_id")])]),t._v(" "),s("p",[t._v("使用自定义顺序生成 "),s("code",[t._v("_id")]),t._v("，可避免默认 ObjectId 带来的分布写入放大问题（但通常影响不大）。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-六、监控与性能分析工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-六、监控与性能分析工具"}},[t._v("#")]),t._v(" ✅ 六、监控与性能分析工具")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("db.orders.stats()")]),t._v(" 查看集合大小")]),t._v(" "),s("li",[s("code",[t._v("db.orders.totalIndexSize()")]),t._v(" 查看索引空间")]),t._v(" "),s("li",[s("code",[t._v("mongotop")]),t._v(", "),s("code",[t._v("mongostat")]),t._v(", "),s("code",[t._v("Atlas Profiler")]),t._v(" 实时监控")]),t._v(" "),s("li",[s("code",[t._v("explain()")]),t._v(" 定位慢查询")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-七、架构层扩展-极端高并发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-七、架构层扩展-极端高并发"}},[t._v("#")]),t._v(" ✅ 七、架构层扩展（极端高并发）")]),t._v(" "),s("p",[t._v("如果数据量和并发再提升，可考虑：")]),t._v(" "),s("ul",[s("li",[t._v("MongoDB 分片集群（Sharding）")]),t._v(" "),s("li",[t._v("热数据使用 Redis 缓存")]),t._v(" "),s("li",[t._v("历史数据归档到 ElasticSearch 用于检索")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-最终建议小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-最终建议小结"}},[t._v("#")]),t._v(" ✅ 最终建议小结")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("优化方向")]),t._v(" "),s("th",[t._v("建议")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("索引")]),t._v(" "),s("td",[t._v("组合索引 + 创建时间索引")])]),t._v(" "),s("tr",[s("td",[t._v("分页")]),t._v(" "),s("td",[t._v("游标分页代替 skip")])]),t._v(" "),s("tr",[s("td",[t._v("分表")]),t._v(" "),s("td",[t._v("热/冷数据分离或按时间分表")])]),t._v(" "),s("tr",[s("td",[t._v("结构优化")]),t._v(" "),s("td",[t._v("字段精简、去冗余、文档大小控制")])]),t._v(" "),s("tr",[s("td",[t._v("查询优化")]),t._v(" "),s("td",[t._v("使用 explain 分析索引使用情况")])]),t._v(" "),s("tr",[s("td",[t._v("扩展方案")]),t._v(" "),s("td",[t._v("数据分片 + Redis 缓存 + ES 检索")])])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("你提到的三种架构优化策略是构建"),s("strong",[t._v("高并发 + 大数据量系统")]),t._v("的核心方式，适用于订单类系统、日志系统、交易系统等场景。下面是对：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("MongoDB 分片集群（Sharding）")])]),t._v(" "),s("li",[s("strong",[t._v("Redis 缓存热数据")])]),t._v(" "),s("li",[s("strong",[t._v("ElasticSearch 归档历史数据")])])]),t._v(" "),s("p",[t._v("三者的 "),s("strong",[t._v("作用、原理、实现方式")]),t._v(" 的详解：")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-一、mongodb-分片集群-sharding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-一、mongodb-分片集群-sharding"}},[t._v("#")]),t._v(" ✅ 一、MongoDB 分片集群（Sharding）")]),t._v(" "),s("h3",{attrs:{id:"📌-作用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📌-作用"}},[t._v("#")]),t._v(" 📌 作用：")]),t._v(" "),s("p",[t._v("将 "),s("strong",[t._v("海量数据水平拆分")]),t._v(" 到多个分片节点（shard）上，实现 "),s("strong",[t._v("读写负载均衡 + 无限扩展容量")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"🧠-原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🧠-原理"}},[t._v("#")]),t._v(" 🧠 原理：")]),t._v(" "),s("ul",[s("li",[t._v("按照 "),s("code",[t._v("shard key")]),t._v(" 将数据分发到不同分片")]),t._v(" "),s("li",[t._v("查询由 Mongos（路由器）根据 key 定向到正确 shard")])]),t._v(" "),s("h3",{attrs:{id:"📦-架构组成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📦-架构组成"}},[t._v("#")]),t._v(" 📦 架构组成：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("客户端\n   │\n ┌─▼─┐\n │mongos 路由器│← 多个，可横向扩展\n └─▲─┘\n   │\n ┌─┴────────────┐\n │     Config Servers     │ ← 配置元数据，3 个或以上\n └───────────────┘\n   │\n ┌──────────────┬──────────────┐\n │    Shard1    │     Shard2   │  ... 可扩展\n └──────────────┴──────────────┘\n")])])]),s("h3",{attrs:{id:"🔧-示例配置步骤-简略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔧-示例配置步骤-简略"}},[t._v("#")]),t._v(" 🔧 示例配置步骤（简略）：")]),t._v(" "),s("ol",[s("li",[t._v("配置分片集群："),s("code",[t._v("mongod --shardsvr")])]),t._v(" "),s("li",[t._v("配置 router："),s("code",[t._v("mongos --configdb")])]),t._v(" "),s("li",[t._v("添加分片：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("sh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addShard")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shard1/host1:27017"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addShard")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shard2/host2:27017"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("启用分片：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("sh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enableSharding")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo_app"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("shardCollection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo_app.orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或 createdAt")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-二、redis-缓存热数据-读多写少"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-二、redis-缓存热数据-读多写少"}},[t._v("#")]),t._v(" ✅ 二、Redis 缓存热数据（读多写少）")]),t._v(" "),s("h3",{attrs:{id:"📌-作用-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📌-作用-2"}},[t._v("#")]),t._v(" 📌 作用：")]),t._v(" "),s("p",[t._v("将"),s("strong",[t._v("高频读的数据")]),t._v("（如用户最新订单、订单状态）缓存到 Redis，避免 MongoDB 频繁查询。")]),t._v(" "),s("h3",{attrs:{id:"🧠-适合数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🧠-适合数据"}},[t._v("#")]),t._v(" 🧠 适合数据：")]),t._v(" "),s("ul",[s("li",[t._v("最近 24 小时的订单状态")]),t._v(" "),s("li",[t._v("用户常访问的订单详情")]),t._v(" "),s("li",[t._v("查询结果缓存（防止重复分页）")])]),t._v(" "),s("h3",{attrs:{id:"🛠️-缓存策略建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🛠️-缓存策略建议"}},[t._v("#")]),t._v(" 🛠️ 缓存策略建议：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("项目")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Key 设计")]),t._v(" "),s("td",[s("code",[t._v("order:{orderId}")]),t._v(" 或 "),s("code",[t._v("user:{id}:orders")])])]),t._v(" "),s("tr",[s("td",[t._v("失效策略")]),t._v(" "),s("td",[t._v("热点数据设定 1h～12h TTL 或 LRU")])]),t._v(" "),s("tr",[s("td",[t._v("一致性策略")]),t._v(" "),s("td",[t._v("写入 Mongo 后立即写入 Redis，或延迟一致性同步")])]),t._v(" "),s("tr",[s("td",[t._v("使用方式")]),t._v(" "),s("td",[t._v("先查 Redis，无数据再查 Mongo")])])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 伪代码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("order:")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("orderId"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" orderId "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("order:")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("orderId"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-三、elasticsearch-归档历史数据-全文检索-聚合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-三、elasticsearch-归档历史数据-全文检索-聚合"}},[t._v("#")]),t._v(" ✅ 三、ElasticSearch 归档历史数据（全文检索 + 聚合）")]),t._v(" "),s("h3",{attrs:{id:"📌-作用-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📌-作用-3"}},[t._v("#")]),t._v(" 📌 作用：")]),t._v(" "),s("p",[t._v("将 "),s("strong",[t._v("老订单数据（如 6 个月前）")]),t._v(" 导入到 ES，支持快速搜索、分页、复杂统计分析，而不影响 Mongo 的读写压力。")]),t._v(" "),s("h3",{attrs:{id:"🧠-为什么用-es"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🧠-为什么用-es"}},[t._v("#")]),t._v(" 🧠 为什么用 ES：")]),t._v(" "),s("ul",[s("li",[t._v("快速全文搜索（支持模糊匹配）")]),t._v(" "),s("li",[t._v("支持复杂聚合查询（如订单金额统计）")]),t._v(" "),s("li",[t._v("自带倒排索引，适合海量数据")])]),t._v(" "),s("h3",{attrs:{id:"🔧-实现方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔧-实现方式"}},[t._v("#")]),t._v(" 🔧 实现方式：")]),t._v(" "),s("ol",[s("li",[t._v("使用同步工具导入数据，如：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("mongo-connector")]),t._v("（已过时）")]),t._v(" "),s("li",[t._v("自建同步程序")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.elastic.co/guide/en/logstash/current/plugins-inputs-mongodb.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Logstash + MongoDB input plugin"),s("OutboundLink")],1)])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("示例数据结构：")])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"orderId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc123"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"u001"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"item"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MacBook Air"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PAID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"createdAt"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2023-05-01T12:00:00"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("查询示例（DSL）：")])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"query"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"bool"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"must"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"match"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PAID"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"range"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"createdAt"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lt"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2024-01-01"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-架构协同使用建议-生产实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-架构协同使用建议-生产实践"}},[t._v("#")]),t._v(" ✅ 架构协同使用建议（生产实践）")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("场景")]),t._v(" "),s("th",[t._v("使用方案")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("实时写入、读写分布式扩展")]),t._v(" "),s("td",[t._v("MongoDB 分片集群")])]),t._v(" "),s("tr",[s("td",[t._v("高频访问订单状态或最近列表")]),t._v(" "),s("td",[t._v("Redis 缓存")])]),t._v(" "),s("tr",[s("td",[t._v("历史订单模糊搜索、统计分析")]),t._v(" "),s("td",[t._v("ElasticSearch 存档+查询")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-一张图总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-一张图总结"}},[t._v("#")]),t._v(" ✅ 一张图总结：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("                +------------------------+\n                |      前端 / 接口       |\n                +------------------------+\n                           |\n              +------------+------------+\n              |                         |\n     +--------▼--------+      +--------▼--------+\n     |    Redis 缓存    |      |     MongoDB      |\n     | 热点订单/状态    |      |   分片订单主库   |\n     +--------+--------+      +--------+--------+\n              |                         |\n     +--------▼--------+      +--------▼--------+\n     |    ElasticSearch |      |   Mongo Archive |\n     | 历史订单检索/统计 |      | 历史数据冷存储  |\n     +------------------+      +------------------+\n")])])]),s("hr"),t._v(" "),s("p",[t._v("你想要的 Java 实现方案，其目标是：")]),t._v(" "),s("blockquote",[s("p",[t._v("构建一个系统：使用 MongoDB 分片集群保存订单数据，Redis 缓存热数据，Elasticsearch 存储历史数据，并通过 Java 服务读写协调。")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-目录结构概览"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-目录结构概览"}},[t._v("#")]),t._v(" ✅ 目录结构概览")]),t._v(" "),s("p",[t._v("我们将从以下 3 个核心点实现：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("目标模块")]),t._v(" "),s("th",[t._v("技术方案")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("🔹 MongoDB 分片读写")]),t._v(" "),s("td",[t._v("使用 "),s("code",[t._v("MongoTemplate")]),t._v(" 或 "),s("code",[t._v("Spring Data Mongo")])])]),t._v(" "),s("tr",[s("td",[t._v("🔹 Redis 缓存加速")]),t._v(" "),s("td",[t._v("使用 "),s("code",[t._v("Spring Cache")]),t._v(" 或 "),s("code",[t._v("Redisson")])])]),t._v(" "),s("tr",[s("td",[t._v("🔹 ElasticSearch 查询")]),t._v(" "),s("td",[t._v("使用 "),s("code",[t._v("Spring Data Elasticsearch")]),t._v(" 或 "),s("code",[t._v("RestHighLevelClient")])])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-一、mongodb-分片集群连接与操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-一、mongodb-分片集群连接与操作"}},[t._v("#")]),t._v(" ✅ 一、MongoDB 分片集群连接与操作")]),t._v(" "),s("h3",{attrs:{id:"📦-maven-依赖-mongodb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📦-maven-依赖-mongodb"}},[t._v("#")]),t._v(" 📦 Maven 依赖（MongoDB）：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-data-mongodb"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"⚙️-application-yml-配置连接-可带副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-application-yml-配置连接-可带副本集"}},[t._v("#")]),t._v(" ⚙️ application.yml 配置连接（可带副本集）")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mongodb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mongodb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//shard1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27017")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("shard2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27017")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("shard3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("27017/demo_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v("replicaSet=rs0\n")])])]),s("h3",{attrs:{id:"✅-使用-mongotemplate-操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-使用-mongotemplate-操作"}},[t._v("#")]),t._v(" ✅ 使用 "),s("code",[t._v("MongoTemplate")]),t._v(" 操作：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OrderService")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MongoTemplate")]),t._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),t._v(" order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findOrdersByUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),t._v(" query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Criteria")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("where")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("is")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-二、redis-缓存热点订单数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-二、redis-缓存热点订单数据"}},[t._v("#")]),t._v(" ✅ 二、Redis 缓存热点订单数据")]),t._v(" "),s("h3",{attrs:{id:"📦-maven-依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📦-maven-依赖"}},[t._v("#")]),t._v(" 📦 Maven 依赖：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-data-redis"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"⚙️-application-yml-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-application-yml-配置"}},[t._v("#")]),t._v(" ⚙️ application.yml 配置：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" localhost\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n")])])]),s("h3",{attrs:{id:"✅-使用-redistemplate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-使用-redistemplate"}},[t._v("#")]),t._v(" ✅ 使用 RedisTemplate：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringRedisTemplate")]),t._v(" redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrderWithCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" cacheKey "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" cached "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cached "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cached"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查询 MongoDB")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),t._v(" order "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toJSONString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofHours")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-三、elasticsearch-查询历史订单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-三、elasticsearch-查询历史订单"}},[t._v("#")]),t._v(" ✅ 三、Elasticsearch 查询历史订单")]),t._v(" "),s("h3",{attrs:{id:"📦-maven-依赖-spring-boot-3-推荐用新客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📦-maven-依赖-spring-boot-3-推荐用新客户端"}},[t._v("#")]),t._v(" 📦 Maven 依赖（Spring Boot 3 推荐用新客户端）：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("co.elastic.clients"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("elasticsearch-java"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("8.11.3"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"✅-初始化-es-客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-初始化-es-客户端"}},[t._v("#")]),t._v(" ✅ 初始化 ES 客户端：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EsConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticsearchClient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("elasticsearchClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestClient")]),t._v(" restClient "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticsearchTransport")]),t._v(" transport "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestClientTransport")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            restClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JacksonJsonpMapper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticsearchClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"✅-查询历史订单-createdat-某时间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-查询历史订单-createdat-某时间"}},[t._v("#")]),t._v(" ✅ 查询历史订单（createdAt < 某时间）：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("searchOldOrders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalDateTime")]),t._v(" sixMonthsAgo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalDateTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("minusMonths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticsearchClient")]),t._v(" client "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" elasticsearchClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" s\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" q\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" b\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("must")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("term")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("field")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("must")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("field")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsonData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("of")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sixMonthsAgo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hits")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hits")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Hit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-四、调度归档-mongo-→-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-四、调度归档-mongo-→-elasticsearch"}},[t._v("#")]),t._v(" ✅ 四、调度归档：Mongo → ElasticSearch")]),t._v(" "),s("p",[t._v("你可以在定时任务中，定期将 Mongo 中的老订单迁移到 ES：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Scheduled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cron "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0 0 2 * * ?"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("archiveOldOrdersToES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),t._v(" query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Criteria")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("where")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalDateTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("minusMonths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" oldOrders "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    oldOrders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            elasticsearchClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" i\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orders"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("document")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"归档失败：{}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"✅-五、整体架构回顾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-五、整体架构回顾"}},[t._v("#")]),t._v(" ✅ 五、整体架构回顾")]),t._v(" "),s("div",{staticClass:"language-plaintext extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plaintext"}},[s("code",[t._v("               +---------------------+\n               |   Java SpringBoot   |\n               +---------------------+\n                   |     |       |\n     Redis (缓存)  |     |       |  MongoDB (分片主库)\n         热点订单  |     |       |  实时读写\n                   ▼     ▼       ▼\n               Elasticsearch       （归档）\n             6月前老订单搜索、统计分析\n")])])]),s("hr"),t._v(" "),s("p",[t._v("使用 MongoDB 分片集群保存订单数据，Redis 缓存热数据，Elasticsearch 存储历史数据，并通过 Java 服务读写协调。")])])}),[],!1,null,null,null);s.default=r.exports},619:function(t,s,a){t.exports=a.p+"assets/img/img_14.512c0408.png"},620:function(t,s,a){t.exports=a.p+"assets/img/img_15.bbbf02cc.png"}}]);