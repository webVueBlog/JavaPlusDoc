(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{1407:function(t,a,s){"use strict";s.r(a);var e=s(1),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("点击勘误"),a("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues"),a("OutboundLink")],1),t._v("，哪吒感谢大家的阅读")])]),t._v(" "),a("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),t._v(" "),a("h2",{attrs:{id:"prometheus单机部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus单机部署"}},[t._v("#")]),t._v(" Prometheus单机部署")]),t._v(" "),a("p",[t._v("本文将介绍如何在单机环境中部署Prometheus监控系统，实现对服务器和应用的全面监控。")]),t._v(" "),a("h3",{attrs:{id:"_1-prometheus简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-prometheus简介"}},[t._v("#")]),t._v(" 1. Prometheus简介")]),t._v(" "),a("h4",{attrs:{id:"_1-1-什么是prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-什么是prometheus"}},[t._v("#")]),t._v(" 1.1 什么是Prometheus")]),t._v(" "),a("p",[t._v("Prometheus是一个开源的系统监控和告警工具包，最初由SoundCloud开发，现在已经成为Cloud Native Computing Foundation（CNCF）的第二个项目（Kubernetes之后）。Prometheus具有以下特点：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("多维数据模型")]),t._v("：由指标名称和键值对标签组成的时间序列数据")]),t._v(" "),a("li",[a("strong",[t._v("强大的查询语言PromQL")]),t._v("：可以对收集的时间序列数据进行切片和切块")]),t._v(" "),a("li",[a("strong",[t._v("不依赖分布式存储")]),t._v("：单个服务器节点是自治的")]),t._v(" "),a("li",[a("strong",[t._v("基于HTTP的pull模式")]),t._v("：通过HTTP协议从目标处拉取指标数据")]),t._v(" "),a("li",[a("strong",[t._v("支持推送模式")]),t._v("：通过中间网关支持推送模式")]),t._v(" "),a("li",[a("strong",[t._v("通过服务发现或静态配置发现目标")])]),t._v(" "),a("li",[a("strong",[t._v("多种图形和仪表盘支持")]),t._v("：可与Grafana等工具集成")])]),t._v(" "),a("h4",{attrs:{id:"_1-2-prometheus架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-prometheus架构"}},[t._v("#")]),t._v(" 1.2 Prometheus架构")]),t._v(" "),a("p",[a("img",{attrs:{src:s(878),alt:"Prometheus架构"}})]),t._v(" "),a("p",[t._v("Prometheus的核心组件包括：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Prometheus Server")]),t._v("：负责抓取和存储时间序列数据")]),t._v(" "),a("li",[a("strong",[t._v("Client Libraries")]),t._v("：用于检测应用程序代码")]),t._v(" "),a("li",[a("strong",[t._v("Pushgateway")]),t._v("：支持短期作业的指标推送")]),t._v(" "),a("li",[a("strong",[t._v("Exporters")]),t._v("：为第三方系统提供指标数据")]),t._v(" "),a("li",[a("strong",[t._v("Alertmanager")]),t._v("：处理告警")]),t._v(" "),a("li",[a("strong",[t._v("可视化工具")]),t._v("：如Grafana等")])]),t._v(" "),a("h3",{attrs:{id:"_2-环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-环境准备"}},[t._v("#")]),t._v(" 2. 环境准备")]),t._v(" "),a("h4",{attrs:{id:"_2-1-系统要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-系统要求"}},[t._v("#")]),t._v(" 2.1 系统要求")]),t._v(" "),a("ul",[a("li",[t._v("操作系统：Linux（推荐CentOS 7+/Ubuntu 18.04+）或Windows Server")]),t._v(" "),a("li",[t._v("内存：至少2GB RAM（建议4GB以上）")]),t._v(" "),a("li",[t._v("CPU：至少2核")]),t._v(" "),a("li",[t._v("磁盘：根据数据保留策略，建议至少50GB可用空间")]),t._v(" "),a("li",[t._v("Docker：18.09.0或更高版本")]),t._v(" "),a("li",[t._v("Docker Compose：1.24.0或更高版本")])]),t._v(" "),a("h4",{attrs:{id:"_2-2-安装docker和docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-安装docker和docker-compose"}},[t._v("#")]),t._v(" 2.2 安装Docker和Docker Compose")]),t._v(" "),a("p",[t._v("如果您尚未安装Docker和Docker Compose，请参考"),a("RouterLink",{attrs:{to:"/worker/grafana.html"}},[t._v("安装监控grafana")]),t._v("文档中的相关章节进行安装。")],1),t._v(" "),a("h3",{attrs:{id:"_3-使用docker-compose部署prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用docker-compose部署prometheus"}},[t._v("#")]),t._v(" 3. 使用Docker Compose部署Prometheus")]),t._v(" "),a("h4",{attrs:{id:"_3-1-创建项目目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-创建项目目录"}},[t._v("#")]),t._v(" 3.1 创建项目目录")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /home/docker/prometheus\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /home/docker/prometheus/prometheus_data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /home/docker/prometheus/alertmanager_data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" /home/docker/prometheus/prometheus_data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" /home/docker/prometheus/alertmanager_data\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/docker/prometheus\n")])])]),a("h4",{attrs:{id:"_3-2-创建prometheus配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-创建prometheus配置文件"}},[t._v("#")]),t._v(" 3.2 创建Prometheus配置文件")]),t._v(" "),a("p",[t._v("创建"),a("code",[t._v("prometheus.yml")]),t._v("文件：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /home/docker/prometheus/prometheus.yml "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'EOF'\nglobal:\n  scrape_interval: 15s  # 默认抓取间隔，15秒向目标抓取一次数据\n  evaluation_interval: 15s  # 执行规则的频率，15秒执行一次规则\n  scrape_timeout: 10s  # 抓取超时时间\n\n  # 附加到所有时间序列或警报的外部标签\n  external_labels:\n    monitor: 'prometheus-standalone'\n\n# Alertmanager配置\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets: ['alertmanager:9093']\n\n# 告警规则文件列表\nrule_files:\n  - \"rules/*.yml\"\n\n# 抓取配置\nscrape_configs:\n  # 监控Prometheus本身\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['localhost:9090']\n\n  # 监控主机节点\n  - job_name: 'node-exporter'\n    static_configs:\n      - targets: ['node-exporter:9100']\n\n  # 监控Docker容器\n  - job_name: 'cadvisor'\n    static_configs:\n      - targets: ['cadvisor:8080']\n\n  # 监控Alertmanager\n  - job_name: 'alertmanager'\n    static_configs:\n      - targets: ['alertmanager:9093']\n\n  # 示例：监控Spring Boot应用\n  # - job_name: 'spring-boot-app'\n  #   metrics_path: '/actuator/prometheus'\n  #   scrape_interval: 5s\n  #   static_configs:\n  #     - targets: ['host.docker.internal:8080']\n\n  # 示例：监控MySQL\n  # - job_name: 'mysql'\n  #   static_configs:\n  #     - targets: ['mysql-exporter:9104']\n\n  # 示例：监控Redis\n  # - job_name: 'redis'\n  #   static_configs:\n  #     - targets: ['redis-exporter:9121']\nEOF")]),t._v("\n")])])]),a("h4",{attrs:{id:"_3-3-创建告警规则目录和示例规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-创建告警规则目录和示例规则"}},[t._v("#")]),t._v(" 3.3 创建告警规则目录和示例规则")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /home/docker/prometheus/rules\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /home/docker/prometheus/rules/node_alerts.yml "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'EOF\'\ngroups:\n- name: node_alerts\n  rules:\n  - alert: HighCPULoad\n    expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: "High CPU load (instance {{ $labels.instance }})"\n      description: "CPU load is > 80%\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}"\n\n  - alert: HighMemoryLoad\n    expr: (node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes) / node_memory_MemTotal_bytes * 100 > 80\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: "High memory load (instance {{ $labels.instance }})"\n      description: "Memory load is > 80%\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}"\n\n  - alert: HighDiskUsage\n    expr: (node_filesystem_size_bytes{fstype!="tmpfs"} - node_filesystem_free_bytes{fstype!="tmpfs"}) / node_filesystem_size_bytes{fstype!="tmpfs"} * 100 > 80\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: "High disk usage (instance {{ $labels.instance }})"\n      description: "Disk usage is > 80%\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}"\nEOF')]),t._v("\n")])])]),a("h4",{attrs:{id:"_3-4-创建alertmanager配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-创建alertmanager配置文件"}},[t._v("#")]),t._v(" 3.4 创建Alertmanager配置文件")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /home/docker/prometheus/alertmanager.yml "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'EOF'\nglobal:\n  resolve_timeout: 5m\n\nroute:\n  group_by: ['alertname']\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 1h\n  receiver: 'web.hook'\n  routes:\n  - match:\n      severity: critical\n    receiver: 'web.hook'\n    continue: true\n\nreceivers:\n- name: 'web.hook'\n  webhook_configs:\n  - url: 'http://127.0.0.1:5001/'\n    send_resolved: true\n\n# 示例：邮件告警配置\n# - name: 'email'\n#   email_configs:\n#   - to: 'your-email@example.com'\n#     from: 'alertmanager@example.com'\n#     smarthost: 'smtp.example.com:587'\n#     auth_username: 'alertmanager@example.com'\n#     auth_password: 'password'\n#     auth_identity: 'alertmanager@example.com'\n#     auth_secret: 'password'\n\n# 示例：企业微信告警配置\n# - name: 'wechat'\n#   wechat_configs:\n#   - corp_id: 'your-corp-id'\n#     api_url: 'https://qyapi.weixin.qq.com/cgi-bin/'\n#     api_secret: 'your-api-secret'\n#     to_party: 'your-party-id'\n#     agent_id: 'your-agent-id'\n#     message: '{{ template \"wechat.default.message\" . }}'\n\ninhibit_rules:\n  - source_match:\n      severity: 'critical'\n    target_match:\n      severity: 'warning'\n    equal: ['alertname', 'dev', 'instance']\nEOF")]),t._v("\n")])])]),a("h4",{attrs:{id:"_3-5-创建docker-compose配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-创建docker-compose配置文件"}},[t._v("#")]),t._v(" 3.5 创建Docker Compose配置文件")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /home/docker/prometheus/docker-compose.yml "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'EOF'\nversion: '3.8'\n\nservices:\n  prometheus:\n    image: prom/prometheus:latest\n    container_name: prometheus\n    volumes:\n      - ./prometheus.yml:/etc/prometheus/prometheus.yml\n      - ./rules:/etc/prometheus/rules\n      - ./prometheus_data:/prometheus\n    command:\n      - '--config.file=/etc/prometheus/prometheus.yml'\n      - '--storage.tsdb.path=/prometheus'\n      - '--storage.tsdb.retention.time=15d'\n      - '--web.console.libraries=/etc/prometheus/console_libraries'\n      - '--web.console.templates=/etc/prometheus/consoles'\n      - '--web.enable-lifecycle'\n    ports:\n      - \"9090:9090\"\n    restart: always\n    networks:\n      - monitoring\n\n  alertmanager:\n    image: prom/alertmanager:latest\n    container_name: alertmanager\n    volumes:\n      - ./alertmanager.yml:/etc/alertmanager/alertmanager.yml\n      - ./alertmanager_data:/alertmanager\n    command:\n      - '--config.file=/etc/alertmanager/alertmanager.yml'\n      - '--storage.path=/alertmanager'\n    ports:\n      - \"9093:9093\"\n    restart: always\n    networks:\n      - monitoring\n\n  node-exporter:\n    image: prom/node-exporter:latest\n    container_name: node-exporter\n    volumes:\n      - /proc:/host/proc:ro\n      - /sys:/host/sys:ro\n      - /:/rootfs:ro\n    command:\n      - '--path.procfs=/host/proc'\n      - '--path.sysfs=/host/sys'\n      - '--collector.filesystem.ignored-mount-points=^/(sys|proc|dev|host|etc)($$|/)'\n    ports:\n      - \"9100:9100\"\n    restart: always\n    networks:\n      - monitoring\n\n  cadvisor:\n    image: gcr.io/cadvisor/cadvisor:latest\n    container_name: cadvisor\n    volumes:\n      - /:/rootfs:ro\n      - /var/run:/var/run:rw\n      - /sys:/sys:ro\n      - /var/lib/docker/:/var/lib/docker:ro\n    ports:\n      - \"8080:8080\"\n    restart: always\n    networks:\n      - monitoring\n\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    volumes:\n      - ./grafana_data:/var/lib/grafana\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=admin\n      - GF_USERS_ALLOW_SIGN_UP=false\n    ports:\n      - \"3000:3000\"\n    restart: always\n    networks:\n      - monitoring\n\nnetworks:\n  monitoring:\n    driver: bridge\n\nvolumes:\n  prometheus_data:\n  alertmanager_data:\n  grafana_data:\nEOF")]),t._v("\n")])])]),a("h4",{attrs:{id:"_3-6-启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-启动服务"}},[t._v("#")]),t._v(" 3.6 启动服务")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/docker/prometheus\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-访问prometheus和grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-访问prometheus和grafana"}},[t._v("#")]),t._v(" 4. 访问Prometheus和Grafana")]),t._v(" "),a("h4",{attrs:{id:"_4-1-访问prometheus-web界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-访问prometheus-web界面"}},[t._v("#")]),t._v(" 4.1 访问Prometheus Web界面")]),t._v(" "),a("p",[t._v("在浏览器中访问："),a("code",[t._v("http://your-server-ip:9090")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/worker/prometheus-dashboard.svg",alt:"Prometheus Web界面"}})]),t._v(" "),a("h4",{attrs:{id:"_4-2-访问grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-访问grafana"}},[t._v("#")]),t._v(" 4.2 访问Grafana")]),t._v(" "),a("p",[t._v("在浏览器中访问："),a("code",[t._v("http://your-server-ip:3000")])]),t._v(" "),a("p",[t._v("默认用户名："),a("code",[t._v("admin")]),t._v("\n默认密码："),a("code",[t._v("admin")])]),t._v(" "),a("p",[t._v("首次登录会要求修改密码。")]),t._v(" "),a("h3",{attrs:{id:"_5-配置grafana数据源和仪表板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置grafana数据源和仪表板"}},[t._v("#")]),t._v(" 5. 配置Grafana数据源和仪表板")]),t._v(" "),a("h4",{attrs:{id:"_5-1-添加prometheus数据源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-添加prometheus数据源"}},[t._v("#")]),t._v(" 5.1 添加Prometheus数据源")]),t._v(" "),a("ol",[a("li",[t._v("登录Grafana")]),t._v(" "),a("li",[t._v("点击左侧菜单的「Configuration」（齿轮图标）")]),t._v(" "),a("li",[t._v("选择「Data Sources」")]),t._v(" "),a("li",[t._v("点击「Add data source」")]),t._v(" "),a("li",[t._v("选择「Prometheus」")]),t._v(" "),a("li",[t._v("在URL字段中输入："),a("code",[t._v("http://prometheus:9090")])]),t._v(" "),a("li",[t._v("点击「Save & Test」确保连接成功")])]),t._v(" "),a("h4",{attrs:{id:"_5-2-导入仪表板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-导入仪表板"}},[t._v("#")]),t._v(" 5.2 导入仪表板")]),t._v(" "),a("p",[t._v("Grafana提供了许多预配置的仪表板，您可以导入这些仪表板来监控不同的系统和应用。")]),t._v(" "),a("ol",[a("li",[t._v("点击左侧菜单的「+」图标")]),t._v(" "),a("li",[t._v("选择「Import」")]),t._v(" "),a("li",[t._v("输入以下仪表板ID之一：\n"),a("ul",[a("li",[t._v("1860：Node Exporter Full（主机监控）")]),t._v(" "),a("li",[t._v("893：Docker and system monitoring（Docker监控）")]),t._v(" "),a("li",[t._v("12900：Cadvisor Exporter（容器监控）")]),t._v(" "),a("li",[t._v("9578：Prometheus 2.0 Overview（Prometheus自身监控）")])])]),t._v(" "),a("li",[t._v("点击「Load」")]),t._v(" "),a("li",[t._v("在「Prometheus」数据源下拉菜单中选择您刚才添加的Prometheus数据源")]),t._v(" "),a("li",[t._v("点击「Import」")])]),t._v(" "),a("h3",{attrs:{id:"_6-监控自定义应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-监控自定义应用"}},[t._v("#")]),t._v(" 6. 监控自定义应用")]),t._v(" "),a("h4",{attrs:{id:"_6-1-监控spring-boot应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-监控spring-boot应用"}},[t._v("#")]),t._v(" 6.1 监控Spring Boot应用")]),t._v(" "),a("ol",[a("li",[t._v("在Spring Boot应用中添加依赖：")])]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-actuator"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.micrometer"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("micrometer-registry-prometheus"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("在"),a("code",[t._v("application.properties")]),t._v("中添加配置：")])]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.endpoints.web.exposure.include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("prometheus,health,info")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.endpoint.prometheus.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.metrics.export.prometheus.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("修改Prometheus配置文件，添加Spring Boot应用的监控配置：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'spring-boot-app'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/actuator/prometheus'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5s\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'host.docker.internal:8080'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("重新加载Prometheus配置：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" POST http://localhost:9090/-/reload\n")])])]),a("h4",{attrs:{id:"_6-2-监控mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-监控mysql"}},[t._v("#")]),t._v(" 6.2 监控MySQL")]),t._v(" "),a("ol",[a("li",[t._v("添加MySQL Exporter到docker-compose.yml：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql-exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" prom/mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("exporter\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DATA_SOURCE_NAME=user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("password@(mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3306)/\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9104:9104"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" monitoring\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("修改Prometheus配置文件，添加MySQL监控配置：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql-exporter:9104'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("重新加载配置")])]),t._v(" "),a("h4",{attrs:{id:"_6-3-监控redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-监控redis"}},[t._v("#")]),t._v(" 6.3 监控Redis")]),t._v(" "),a("ol",[a("li",[t._v("添加Redis Exporter到docker-compose.yml：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis-exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" oliver006/redis_exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("exporter\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" REDIS_ADDR=redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9121:9121"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" monitoring\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("修改Prometheus配置文件，添加Redis监控配置：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redis'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redis-exporter:9121'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("重新加载配置")])]),t._v(" "),a("h3",{attrs:{id:"_7-配置告警通知"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-配置告警通知"}},[t._v("#")]),t._v(" 7. 配置告警通知")]),t._v(" "),a("h4",{attrs:{id:"_7-1-配置邮件告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-配置邮件告警"}},[t._v("#")]),t._v(" 7.1 配置邮件告警")]),t._v(" "),a("p",[t._v("修改alertmanager.yml文件，添加邮件告警配置：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receivers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'email'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("email_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("to")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'your-email@example.com'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'alertmanager@example.com'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("smarthost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp.example.com:587'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("auth_username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'alertmanager@example.com'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("auth_password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'password'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("auth_identity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'alertmanager@example.com'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("auth_secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'password'")]),t._v("\n")])])]),a("h4",{attrs:{id:"_7-2-配置企业微信告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-配置企业微信告警"}},[t._v("#")]),t._v(" 7.2 配置企业微信告警")]),t._v(" "),a("p",[t._v("修改alertmanager.yml文件，添加企业微信告警配置：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receivers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wechat'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wechat_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("corp_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'your-corp-id'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("api_url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://qyapi.weixin.qq.com/cgi-bin/'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("api_secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'your-api-secret'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("to_party")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'your-party-id'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("agent_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'your-agent-id'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{ template \"wechat.default.message\" . }}'")]),t._v("\n")])])]),a("h4",{attrs:{id:"_7-3-配置钉钉告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-配置钉钉告警"}},[t._v("#")]),t._v(" 7.3 配置钉钉告警")]),t._v(" "),a("ol",[a("li",[t._v("安装钉钉告警适配器：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dingtalk-webhook")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" timonwong/prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("webhook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dingtalk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dingtalk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("webhook\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8060:8060"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./dingtalk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config.yml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("webhook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dingtalk/config.yml\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" monitoring\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("创建钉钉配置文件：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dingtalk-config.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("webhook1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//oapi.dingtalk.com/robot/send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v("access_token=xxxxxxxxxxxx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SEC000000000000000000000\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("修改alertmanager.yml，添加钉钉告警配置：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receivers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dingtalk'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("webhook_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://dingtalk-webhook:8060/dingtalk/webhook1/send'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send_resolved")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("h3",{attrs:{id:"_8-性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-性能优化"}},[t._v("#")]),t._v(" 8. 性能优化")]),t._v(" "),a("h4",{attrs:{id:"_8-1-prometheus存储优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-prometheus存储优化"}},[t._v("#")]),t._v(" 8.1 Prometheus存储优化")]),t._v(" "),a("p",[t._v("修改Prometheus启动参数，优化存储性能：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--config.file=/etc/prometheus/prometheus.yml'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--storage.tsdb.path=/prometheus'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--storage.tsdb.retention.time=15d'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据保留时间")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--storage.tsdb.retention.size=10GB'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据保留大小")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--storage.tsdb.wal-compression'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用WAL压缩")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--web.enable-lifecycle'")]),t._v("\n")])])]),a("h4",{attrs:{id:"_8-2-抓取频率优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-抓取频率优化"}},[t._v("#")]),t._v(" 8.2 抓取频率优化")]),t._v(" "),a("p",[t._v("根据实际需求调整抓取频率，减少资源消耗：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 30s  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认抓取间隔调整为30秒")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'critical-service'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关键服务使用更频繁的抓取")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'critical-service:8080'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h3",{attrs:{id:"_9-安全加固"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-安全加固"}},[t._v("#")]),t._v(" 9. 安全加固")]),t._v(" "),a("h4",{attrs:{id:"_9-1-启用基本认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-启用基本认证"}},[t._v("#")]),t._v(" 9.1 启用基本认证")]),t._v(" "),a("ol",[a("li",[t._v("创建密码文件：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("htpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" /home/docker/prometheus/web.htpasswd admin\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("修改Prometheus配置：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" prom/prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" prometheus\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./prometheus.yml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/prometheus/prometheus.yml\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./web.htpasswd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/prometheus/web.htpasswd\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--config.file=/etc/prometheus/prometheus.yml'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--web.config.file=/etc/prometheus/web.yml'")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("创建web.yml文件：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("basic_auth_users")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$2y$10$..."')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 密码哈希值")]),t._v("\n")])])]),a("h4",{attrs:{id:"_9-2-使用反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-使用反向代理"}},[t._v("#")]),t._v(" 9.2 使用反向代理")]),t._v(" "),a("p",[t._v("使用Nginx作为反向代理，提供额外的安全层：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" prometheus.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://localhost:9090")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auth_basic")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Prometheus"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auth_basic_user_file")]),t._v(" /etc/nginx/htpasswd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_10-故障排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-故障排查"}},[t._v("#")]),t._v(" 10. 故障排查")]),t._v(" "),a("h4",{attrs:{id:"_10-1-检查prometheus状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-检查prometheus状态"}},[t._v("#")]),t._v(" 10.1 检查Prometheus状态")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看Prometheus容器日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs prometheus\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查Prometheus目标状态")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://localhost:9090/api/v1/targets "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jq "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),a("h4",{attrs:{id:"_10-2-检查alertmanager状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-检查alertmanager状态"}},[t._v("#")]),t._v(" 10.2 检查Alertmanager状态")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看Alertmanager容器日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs alertmanager\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查Alertmanager状态")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://localhost:9093/api/v1/status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jq "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),a("h4",{attrs:{id:"_10-3-常见问题解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-常见问题解决"}},[t._v("#")]),t._v(" 10.3 常见问题解决")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("无法抓取目标")]),t._v("：检查网络连接、防火墙设置和目标服务是否正常运行")]),t._v(" "),a("li",[a("strong",[t._v("数据存储问题")]),t._v("：检查磁盘空间和权限")]),t._v(" "),a("li",[a("strong",[t._v("告警未触发")]),t._v("：检查告警规则和Alertmanager配置")]),t._v(" "),a("li",[a("strong",[t._v("Grafana无法连接Prometheus")]),t._v("：检查网络和数据源配置")])]),t._v(" "),a("h3",{attrs:{id:"_11-备份和恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-备份和恢复"}},[t._v("#")]),t._v(" 11. 备份和恢复")]),t._v(" "),a("h4",{attrs:{id:"_11-1-备份prometheus数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-备份prometheus数据"}},[t._v("#")]),t._v(" 11.1 备份Prometheus数据")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止Prometheus服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" stop prometheus\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 备份数据目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-czvf")]),t._v(" prometheus_backup_"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" +%Y%m%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(".tar.gz /home/docker/prometheus/prometheus_data\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启Prometheus服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" start prometheus\n")])])]),a("h4",{attrs:{id:"_11-2-恢复prometheus数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-恢复prometheus数据"}},[t._v("#")]),t._v(" 11.2 恢复Prometheus数据")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止Prometheus服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" stop prometheus\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 恢复数据目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rf")]),t._v(" /home/docker/prometheus/prometheus_data/*\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-xzvf")]),t._v(" prometheus_backup_20230815.tar.gz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" /\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启Prometheus服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" start prometheus\n")])])]),a("h3",{attrs:{id:"_12-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-总结"}},[t._v("#")]),t._v(" 12. 总结")]),t._v(" "),a("p",[t._v("通过本文的指导，您已经成功部署了一个完整的Prometheus监控系统，包括：")]),t._v(" "),a("ul",[a("li",[t._v("Prometheus服务器用于收集和存储指标")]),t._v(" "),a("li",[t._v("Node Exporter用于监控主机")]),t._v(" "),a("li",[t._v("cAdvisor用于监控容器")]),t._v(" "),a("li",[t._v("Alertmanager用于处理告警")]),t._v(" "),a("li",[t._v("Grafana用于可视化监控数据")])]),t._v(" "),a("p",[t._v("您还学习了如何监控自定义应用、配置告警通知、优化性能和加强安全性。这个监控系统可以帮助您及时发现和解决潜在问题，保障系统的稳定运行。")]),t._v(" "),a("p",[t._v("随着业务的发展，您可以根据需要扩展监控系统，添加更多的Exporter来监控不同的服务和应用，或者升级到Prometheus的集群部署方案，以支持更大规模的监控需求。")])])}),[],!1,null,null,null);a.default=n.exports},878:function(t,a,s){t.exports=s.p+"assets/img/prometheus-architecture.8531e2b2.svg"}}]);