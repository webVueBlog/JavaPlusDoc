(window.webpackJsonp=window.webpackJsonp||[]).push([[405],{1237:function(t,a,s){"use strict";s.r(a);var v=s(1),_=Object(v.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("点击勘误"),a("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues"),a("OutboundLink")],1),t._v("，哪吒感谢大家的阅读")])]),t._v(" "),a("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),t._v(" "),a("h2",{attrs:{id:"笔记1运维服务器6年经验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#笔记1运维服务器6年经验"}},[t._v("#")]),t._v(" 笔记1运维服务器6年经验")]),t._v(" "),a("h2",{attrs:{id:"✅-一、查看端口是否被占用的常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-一、查看端口是否被占用的常用命令"}},[t._v("#")]),t._v(" ✅ 一、查看端口是否被占用的常用命令")]),t._v(" "),a("h3",{attrs:{id:"_1️⃣-lsof-命令-最推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1️⃣-lsof-命令-最推荐"}},[t._v("#")]),t._v(" 1️⃣ "),a("code",[t._v("lsof")]),t._v(" 命令（最推荐）")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lsof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" :端口号\n")])])]),a("h4",{attrs:{id:"示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lsof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" :8080\n")])])]),a("p",[t._v("输出：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("COMMAND   PID  USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME\njava     1278  root   45u  IPv6  123456      0t0  TCP *:http-alt (LISTEN)\n")])])]),a("p",[t._v("表示：Java 进程正在监听 8080 端口。")]),t._v(" "),a("hr"),t._v(" "),a("h3",{attrs:{id:"_2️⃣-netstat-命令-传统方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2️⃣-netstat-命令-传统方式"}},[t._v("#")]),t._v(" 2️⃣ "),a("code",[t._v("netstat")]),t._v(" 命令（传统方式）")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-tunlp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" :端口号\n")])])]),a("h4",{attrs:{id:"示例-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-2"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-tunlp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" :8080\n")])])]),a("p",[t._v("输出：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("tcp6  0  0 :::8080  :::*  LISTEN  1278/java\n")])])]),a("hr"),t._v(" "),a("h3",{attrs:{id:"_3️⃣-ss-命令-更快更现代"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3️⃣-ss-命令-更快更现代"}},[t._v("#")]),t._v(" 3️⃣ "),a("code",[t._v("ss")]),t._v(" 命令（更快更现代）")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ltnp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" :端口号\n")])])]),a("h4",{attrs:{id:"示例-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-3"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ltnp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" :8080\n")])])]),a("p",[t._v("输出：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('LISTEN 0 128 :::8080 :::* users:(("java",pid=1278,fd=45))\n')])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-二、查看哪个程序占用了端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-二、查看哪个程序占用了端口"}},[t._v("#")]),t._v(" ✅ 二、查看哪个程序占用了端口")]),t._v(" "),a("h3",{attrs:{id:"命令组合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令组合"}},[t._v("#")]),t._v(" 命令组合：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lsof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" :端口号\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-tunlp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" :端口号\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或")]),t._v("\nss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ltnp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" :端口号\n")])])]),a("p",[t._v("你会看到：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("PID")]),t._v("：进程 ID")]),t._v(" "),a("li",[a("code",[t._v("COMMAND")]),t._v("：进程名")]),t._v(" "),a("li",[a("code",[t._v("fd")]),t._v("：文件描述符")]),t._v(" "),a("li",[a("code",[t._v("LISTEN")]),t._v(" 状态：表示该端口是服务端监听中")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-三、查看端口是否能访问-远程端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-三、查看端口是否能访问-远程端口"}},[t._v("#")]),t._v(" ✅ 三、查看端口是否能访问（远程端口）")]),t._v(" "),a("h3",{attrs:{id:"本地-telnet-测试远程是否通"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地-telnet-测试远程是否通"}},[t._v("#")]),t._v(" 本地 telnet（测试远程是否通）：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("telnet "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" port\n")])])]),a("h4",{attrs:{id:"示例-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-4"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("telnet "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("如果显示 "),a("code",[t._v("Connected to 127.0.0.1.")]),t._v("，说明端口是开放的。")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-四、没有-lsof-netstat-时怎么办"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-四、没有-lsof-netstat-时怎么办"}},[t._v("#")]),t._v(" ✅ 四、没有 "),a("code",[t._v("lsof")]),t._v(" / "),a("code",[t._v("netstat")]),t._v(" 时怎么办？")]),t._v(" "),a("p",[t._v("安装命令：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Debian/Ubuntu")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lsof")]),t._v(" net-tools\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CentOS/RHEL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lsof")]),t._v(" net-tools\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-五、进阶工具-可选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-五、进阶工具-可选"}},[t._v("#")]),t._v(" ✅ 五、进阶工具（可选）")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("工具")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("nmap")])]),t._v(" "),a("td",[t._v("扫描本机或远程端口是否开放")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("fuser")])]),t._v(" "),a("td",[t._v("快速找出哪个 PID 占用端口")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("nc -zv")])]),t._v(" "),a("td",[t._v("测试端口连通性")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("`ss -anp")]),t._v(" "),a("td",[t._v("grep LISTEN`")]),t._v(" "),a("td",[t._v("通用的监听端口扫描")])])])]),t._v(" "),a("hr"),t._v(" "),a("blockquote",[a("p",[t._v("查看端口是否被占用，我通常使用 "),a("code",[t._v("lsof -i :端口")]),t._v(" 或 "),a("code",[t._v("ss -ltnp")]),t._v("，能直接定位是哪一个进程监听该端口。实际中如果是端口冲突导致服务启动失败，可以结合 "),a("code",[t._v("kill PID")]),t._v(" 或 "),a("code",[t._v("fuser -k")]),t._v(" 来释放端口。")])]),t._v(" "),a("hr"),t._v(" "),a("ul",[a("li",[a("strong",[t._v("先宏观、后细节")]),t._v("：先看全局指标再聚焦具体进程 / 线程 / 调用栈")]),t._v(" "),a("li",[a("strong",[t._v("先“活数据”，后“冷分析”")]),t._v("：先用实时工具捕捉异常，再用离线日志或 Dump 深挖")]),t._v(" "),a("li",[a("strong",[t._v("留证据、可复现")]),t._v("：执行高频采样时先确认磁盘空间、权限和对业务的影响")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_0-事前准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-事前准备"}},[t._v("#")]),t._v(" 0  事前准备")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("动作")]),t._v(" "),a("th",[t._v("目的")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("记录时间线")]),t._v("（报警触发点、峰值出现点）")]),t._v(" "),a("td",[t._v("方便对比前后基线")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("确认变更")]),t._v("（发布、配置、流量）")]),t._v(" "),a("td",[t._v("排除代码 / 业务层面因素")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("确保 root / sudo + perf/ebpf 权限")])]),t._v(" "),a("td",[t._v("避免临时被卡权限")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_1-快速横向体检-1-2-分钟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-快速横向体检-1-2-分钟"}},[t._v("#")]),t._v(" 1  快速横向体检（1–2 分钟）")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uptime")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# load & run-queue")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-b")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CPU/Load/Swap 一眼看")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 内存概览")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("df")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-hT")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容量/只读分区")]),t._v("\niostat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-xz")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 磁盘 util% / await")]),t._v("\nsar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" DEV "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 网卡收发速率/丢包")]),t._v("\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("判断优先级")]),t._v("：")]),t._v(" "),a("ol",[a("li",[t._v("load≈CPU 核数且 %sy/%wa 高 → 先查 CPU 或磁盘")]),t._v(" "),a("li",[t._v("free 可用内存低 + swpd 增长 → 查内存泄漏 / OOM")]),t._v(" "),a("li",[t._v("iostat %util 常年 >80% 或 await > 50 ms → 查磁盘")]),t._v(" "),a("li",[t._v("网络丢包 / re-trans 增长 → 查网络")])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_2-cpu-排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-cpu-排查"}},[t._v("#")]),t._v(" 2  CPU 排查")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("① 进程定位")]),t._v(" "),a("td",[a("code",[t._v("top -H")]),t._v(" / "),a("code",[t._v("htop")])]),t._v(" "),a("td",[t._v("找到高 CPU PID 或线程 (TID)")])]),t._v(" "),a("tr",[a("td",[t._v("② 线程源码归位")]),t._v(" "),a("td",[a("code",[t._v("ps -Lp <PID>")])]),t._v(" "),a("td",[t._v("将 TID ↔ 线程名")])]),t._v(" "),a("tr",[a("td",[t._v("③ 调用栈抓取")]),t._v(" "),a("td",[a("code",[t._v("perf top -p <PID>")]),t._v(" 或 "),a("code",[t._v("perf record -F 99 -p <PID> -- sleep 30")]),t._v("，随后 "),a("code",[t._v("perf report")])]),t._v(" "),a("td",[t._v("取热点函数")])]),t._v(" "),a("tr",[a("td",[t._v("④ Java 专用")]),t._v(" "),a("td",[a("code",[t._v("jstack -l <PID>")]),t._v(" / async-profiler")]),t._v(" "),a("td",[t._v("对应线程状态、死循环、GC 卡顿")])]),t._v(" "),a("tr",[a("td",[t._v("⑤ 内核抢占")]),t._v(" "),a("td",[a("code",[t._v("mpstat -P ALL 1")]),t._v("、"),a("code",[t._v("pidstat -w")])]),t._v(" "),a("td",[t._v("context-switch、cpu steal 判断虚机噪音")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_3-内存排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-内存排查"}},[t._v("#")]),t._v(" 3  内存排查")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("① 누수初判")]),t._v(" "),a("td",[a("code",[t._v("free -m")]),t._v("、"),a("code",[t._v("vmstat 1")])]),t._v(" "),a("td",[t._v("缓存/缓存回收、swap in/out")])]),t._v(" "),a("tr",[a("td",[t._v("② 进程级")]),t._v(" "),a("td",[a("code",[t._v("top -o %MEM")]),t._v("、"),a("code",[t._v("smem -r")])]),t._v(" "),a("td",[t._v("找占用最大的进程")])]),t._v(" "),a("tr",[a("td",[t._v("③ 映射明细")]),t._v(" "),a("td",[a("code",[t._v("pmap -x <PID>")]),t._v(" / "),a("code",[t._v("cat /proc/<PID>/smaps_rollup")])]),t._v(" "),a("td",[t._v("堆 / 共享库 / 匿名页")])]),t._v(" "),a("tr",[a("td",[t._v("④ Java 堆")]),t._v(" "),a("td",[a("code",[t._v("jmap -heap <PID>")]),t._v("、"),a("code",[t._v("jmap -histo:live")]),t._v("、"),a("code",[t._v("jcmd GC.heap_info")])]),t._v(" "),a("td",[t._v("老年代溢出、类加载飙升")])]),t._v(" "),a("tr",[a("td",[t._v("⑤ 堆 Dump")]),t._v(" "),a("td",[a("code",[t._v("jmap -dump:live,format=b,file=heap.hprof <PID>")]),t._v("，MAT / VisualVM 分析")]),t._v(" "),a("td",[t._v("根因定位（集合持有 / 缓存未清）")])]),t._v(" "),a("tr",[a("td",[t._v("⑥ 内核缓存")]),t._v(" "),a("td",[a("code",[t._v("slabtop")]),t._v("、"),a("code",[t._v("kmemleak")])]),t._v(" "),a("td",[t._v("罕见但要排除 driver 泄漏")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_4-磁盘-io-排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-磁盘-io-排查"}},[t._v("#")]),t._v(" 4  磁盘 & IO 排查")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("① 负载概览")]),t._v(" "),a("td",[a("code",[t._v("iostat -xz 1")])]),t._v(" "),a("td",[a("code",[t._v("%util")]),t._v("、"),a("code",[t._v("await")]),t._v("、"),a("code",[t._v("avgrq-sz")])])]),t._v(" "),a("tr",[a("td",[t._v("② 进程级")]),t._v(" "),a("td",[a("code",[t._v("pidstat -d 1")]),t._v("、"),a("code",[t._v("iotop -b -n 3")])]),t._v(" "),a("td",[t._v("哪个进程读写大")])]),t._v(" "),a("tr",[a("td",[t._v("③ 磁盘延迟")]),t._v(" "),a("td",[a("code",[t._v("blktrace /dev/sdX")]),t._v(" + "),a("code",[t._v("blkparse")])]),t._v(" "),a("td",[t._v("队列/设备层延迟")])]),t._v(" "),a("tr",[a("td",[t._v("④ 文件定位")]),t._v(" "),a("td",[a("code",[t._v("lsof +D /path")]),t._v(" 或 "),a("code",[t._v("fileslower-bpfcc")])]),t._v(" "),a("td",[t._v("频繁访问文件路径")])]),t._v(" "),a("tr",[a("td",[t._v("⑤ FS 级别")]),t._v(" "),a("td",[a("code",[t._v("df -ih")]),t._v("、"),a("code",[t._v("dumpe2fs -h")])]),t._v(" "),a("td",[t._v("inode 耗尽、磁盘坏块")])]),t._v(" "),a("tr",[a("td",[t._v("⑥ 调优")]),t._v(" "),a("td",[a("code",[t._v("deadline→mq-deadline")]),t._v("、"),a("code",[t._v("noop")]),t._v("、"),a("code",[t._v("fio")]),t._v(" 基准")]),t._v(" "),a("td",[t._v("IO 调度、RAID/SSD 队列深度")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_5-网络排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-网络排查"}},[t._v("#")]),t._v(" 5  网络排查")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("① 速率 / 丢包")]),t._v(" "),a("td",[a("code",[t._v("sar -n DEV 1")]),t._v("、"),a("code",[t._v("ethtool -S eth0")])]),t._v(" "),a("td",[t._v("TX/RX errors, drops")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("② 连接数")]),t._v(" "),a("td",[a("code",[t._v("ss -s")]),t._v("、"),a("code",[t._v("ss -ant state established")])]),t._v(" "),a("td",[t._v("SYN flood? FD 耗尽?")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("③ 会话详情")]),t._v(" "),a("td",[a("code",[t._v("ss -ntp sport = :8080")])]),t._v(" "),a("td",[t._v("哪些远端连接最多")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("④ RTT / 路由")]),t._v(" "),a("td",[a("code",[t._v("mtr <ip>")]),t._v("、"),a("code",[t._v("tracepath")])]),t._v(" "),a("td",[t._v("跨机房抖动排除")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("⑤ 微包/重传")]),t._v(" "),a("td",[a("code",[t._v("tcpdump -i eth0 -w cap.pcap")]),t._v(" + Wireshark")]),t._v(" "),a("td",[t._v("Window size、Dup ACK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("⑥ Socket 队列")]),t._v(" "),a("td",[t._v("`netstat -anp")]),t._v(" "),a("td",[t._v("grep "),a("PID",[a("code",[t._v("、")]),t._v("ss -ltn`")])],1),t._v(" "),a("td",[t._v("Recv-Q / Send-Q 堵塞")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_6-跨资源综合分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-跨资源综合分析"}},[t._v("#")]),t._v(" 6  跨资源综合分析")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("时间轴对齐")]),t._v("：Grafana/Prometheus 将 CPU、iowait、GC、p99 延迟放在同一 Dashboard。")]),t._v(" "),a("li",[a("strong",[t._v("内核 ebpf")]),t._v("：用 bcc / bpftrace 即时追踪 (e.g. "),a("code",[t._v("profile")]),t._v(", "),a("code",[t._v("tcpconnlat")]),t._v(", "),a("code",[t._v("biolatency")]),t._v(").")]),t._v(" "),a("li",[a("strong",[t._v("压测复现")]),t._v("：ab / wrk / vegeta 重放流量，配合 "),a("code",[t._v("perf/kernexec")]),t._v(" 抓热点。")]),t._v(" "),a("li",[a("strong",[t._v("容器视角")]),t._v("："),a("code",[t._v("docker stats")]),t._v("、cgroup "),a("code",[t._v("/sys/fs/cgroup/*/usage_usec")]),t._v("、K8s Metrics-Server。")]),t._v(" "),a("li",[a("strong",[t._v("自动化")]),t._v("：把常用采样脚本写成 "),a("code",[t._v("diag.sh")]),t._v("，配合 Ansible/Fabric 一键收集，避免线上手动误操作。")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_7-建议的-黄金三板斧-脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-建议的-黄金三板斧-脚本"}},[t._v("#")]),t._v(" 7  建议的“黄金三板斧”脚本")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gstack + top")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-b")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^ *[0-9]+/ && $9>500 {print $1;exit}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\ngstack "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$pid")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /tmp/stack."),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" +%s"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 30s CPU 火焰图")]),t._v("\nperf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-F")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-g")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$pid")]),t._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\nperf script "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" flamegraph.pl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /tmp/cpu.svg\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ebpf: 连接延迟")]),t._v("\n/tcpconnectlat-bpfcc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /tmp/tcplat.log\n")])])]),a("hr"),t._v(" "),a("h3",{attrs:{id:"结语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[t._v("#")]),t._v(" 结语")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("先定位资源瓶颈 → 再定位进程 → 再看线程 / 调用栈 / 系统调用 / 数据结构")]),t._v("。")]),t._v(" "),a("li",[a("strong",[t._v("复现-> 采样-> 验证")]),t._v("，任何优化都要有客观指标前后对比。")]),t._v(" "),a("li",[a("strong",[t._v("脚本化、自动化")]),t._v("：把上述高频操作固化到仓库，避免“凭感觉”排障。")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-一、cpu-性能问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-一、cpu-性能问题排查"}},[t._v("#")]),t._v(" ✅ 一、CPU 性能问题排查")]),t._v(" "),a("h3",{attrs:{id:"🔍-排查目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔍-排查目标"}},[t._v("#")]),t._v(" 🔍 排查目标：")]),t._v(" "),a("ul",[a("li",[t._v("哪个进程/线程占用 CPU 高？")]),t._v(" "),a("li",[t._v("是系统调用高？还是业务代码死循环？")]),t._v(" "),a("li",[t._v("多核是否均衡？")])]),t._v(" "),a("h3",{attrs:{id:"🛠️-常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🛠️-常用命令"}},[t._v("#")]),t._v(" 🛠️ 常用命令：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("用途")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("top")])]),t._v(" "),a("td",[t._v("查看实时 CPU 使用率、负载、占用进程")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("htop")])]),t._v(" "),a("td",[t._v("图形化显示各核使用，支持排序和筛选")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ps aux --sort=-%cpu")])]),t._v(" "),a("td",[t._v("静态查看占用 CPU 的进程")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("pidstat -u -p <pid> 1")])]),t._v(" "),a("td",[t._v("查看某个进程的 CPU 使用详情")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("perf top")]),t._v(" / "),a("code",[t._v("perf record")])]),t._v(" "),a("td",[t._v("查看热点函数，分析死循环")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("jstack <pid>")])]),t._v(" "),a("td",[t._v("Java 进程线程栈分析，定位死循环线程")])])])]),t._v(" "),a("h3",{attrs:{id:"🚨-实战指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🚨-实战指标"}},[t._v("#")]),t._v(" 🚨 实战指标：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("load average")]),t._v(" 高，但 CPU 利用率低 → IO 等待")]),t._v(" "),a("li",[a("code",[t._v("top")]),t._v(" 中 "),a("code",[t._v("%us")]),t._v("（用户态）高 → 业务逻辑问题")]),t._v(" "),a("li",[a("code",[t._v("%sy")]),t._v(" 高 → 系统调用多，可能频繁网络/disk 操作")]),t._v(" "),a("li",[a("code",[t._v("%id")]),t._v("（空闲）低 → CPU 打满")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-二、内存问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-二、内存问题排查"}},[t._v("#")]),t._v(" ✅ 二、内存问题排查")]),t._v(" "),a("h3",{attrs:{id:"🔍-排查目标-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔍-排查目标-2"}},[t._v("#")]),t._v(" 🔍 排查目标：")]),t._v(" "),a("ul",[a("li",[t._v("是否 OOM（内存打爆）？")]),t._v(" "),a("li",[t._v("是哪个进程吃内存？")]),t._v(" "),a("li",[t._v("有没有内存泄漏？")])]),t._v(" "),a("h3",{attrs:{id:"🛠️-常用命令-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🛠️-常用命令-2"}},[t._v("#")]),t._v(" 🛠️ 常用命令：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("free -h")])]),t._v(" "),a("td",[t._v("查看整体内存和 swap 使用情况")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("top")]),t._v(" / "),a("code",[t._v("htop")])]),t._v(" "),a("td",[t._v("查看哪个进程吃内存")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ps aux --sort=-%mem")])]),t._v(" "),a("td",[t._v("内存占用排序")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("vmstat 1")])]),t._v(" "),a("td",[a("code",[t._v("si/so")]),t._v(" 代表 swap in/out（频繁表示内存不足）")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("smem")]),t._v(" / "),a("code",[t._v("pmap <pid>")])]),t._v(" "),a("td",[t._v("查看进程内存映射")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("jmap -heap <pid>")]),t._v(" / "),a("code",[t._v("jstat -gc <pid>")])]),t._v(" "),a("td",[t._v("Java 堆信息")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("`dmesg")]),t._v(" "),a("td",[t._v("grep -i oom`")]),t._v(" "),a("td",[t._v("查看是否有 OOM 杀死记录")])])])]),t._v(" "),a("h3",{attrs:{id:"🚨-实战指标-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🚨-实战指标-2"}},[t._v("#")]),t._v(" 🚨 实战指标：")]),t._v(" "),a("ul",[a("li",[t._v("swap 使用过高 → 内存不足")]),t._v(" "),a("li",[a("code",[t._v("OOM Killer")]),t._v(" 出现 → 杀掉了高占用进程")]),t._v(" "),a("li",[t._v("Java 内存泄漏 → 用 "),a("code",[t._v("MAT")]),t._v(" 工具分析 dump")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-三、磁盘空间问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-三、磁盘空间问题排查"}},[t._v("#")]),t._v(" ✅ 三、磁盘空间问题排查")]),t._v(" "),a("h3",{attrs:{id:"🔍-排查目标-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔍-排查目标-3"}},[t._v("#")]),t._v(" 🔍 排查目标：")]),t._v(" "),a("ul",[a("li",[t._v("是否磁盘已满？")]),t._v(" "),a("li",[t._v("是哪个目录/文件太大？")]),t._v(" "),a("li",[t._v("哪些临时文件没有清理？")])]),t._v(" "),a("h3",{attrs:{id:"🛠️-常用命令-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🛠️-常用命令-3"}},[t._v("#")]),t._v(" 🛠️ 常用命令：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("df -h")])]),t._v(" "),a("td",[t._v("查看磁盘各分区使用情况")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("du -sh *")])]),t._v(" "),a("td",[t._v("查看当前目录大小")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ncdu")])]),t._v(" "),a("td",[t._v("交互式目录体积分析")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("find / -type f -size +500M")])]),t._v(" "),a("td",[t._v("找出超过 500M 的文件")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("`lsof")]),t._v(" "),a("td",[t._v("grep deleted`")]),t._v(" "),a("td",[t._v("查看已删除但仍占用磁盘的文件（常见于日志）")])])])]),t._v(" "),a("h3",{attrs:{id:"🚨-实战指标-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🚨-实战指标-3"}},[t._v("#")]),t._v(" 🚨 实战指标：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("/var")]),t._v(" 或 "),a("code",[t._v("/tmp")]),t._v(" 被日志打满 → 服务异常")]),t._v(" "),a("li",[t._v("日志文件被删但没释放 → 需重启进程")]),t._v(" "),a("li",[a("code",[t._v("docker")]),t._v("/"),a("code",[t._v("log")]),t._v("/"),a("code",[t._v("core dump")]),t._v(" 等导致空间异常消耗")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-四、磁盘-io-问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-四、磁盘-io-问题排查"}},[t._v("#")]),t._v(" ✅ 四、磁盘 IO 问题排查")]),t._v(" "),a("h3",{attrs:{id:"🔍-排查目标-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔍-排查目标-4"}},[t._v("#")]),t._v(" 🔍 排查目标：")]),t._v(" "),a("ul",[a("li",[t._v("是否磁盘读写速率限制系统？")]),t._v(" "),a("li",[t._v("哪个进程 IO 频繁？")]),t._v(" "),a("li",[t._v("IO 等待高？")])]),t._v(" "),a("h3",{attrs:{id:"🛠️-常用命令-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🛠️-常用命令-4"}},[t._v("#")]),t._v(" 🛠️ 常用命令：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("用途")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("iostat -x 1")])]),t._v(" "),a("td",[t._v("查看每块磁盘的利用率 "),a("code",[t._v("util")]),t._v(" 和等待 "),a("code",[t._v("await")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("iotop")])]),t._v(" "),a("td",[t._v("实时查看进程的读写 IO 负载")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("vmstat 1")])]),t._v(" "),a("td",[a("code",[t._v("wa")]),t._v(" 字段高说明 IO 等待高")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("dstat -d")])]),t._v(" "),a("td",[t._v("磁盘写入速率")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("sar -d 1 5")])]),t._v(" "),a("td",[t._v("历史 IO 数据")])])])]),t._v(" "),a("h3",{attrs:{id:"🚨-实战指标-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🚨-实战指标-4"}},[t._v("#")]),t._v(" 🚨 实战指标：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("iostat")]),t._v(" 中某磁盘 "),a("code",[t._v("util")]),t._v(" > 80% → 说明该磁盘是瓶颈")]),t._v(" "),a("li",[a("code",[t._v("await")]),t._v(" > 50ms → 表示磁盘响应慢")]),t._v(" "),a("li",[t._v("Java 日志写入频繁也会导致 IO 拥堵")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-五、网络性能问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-五、网络性能问题排查"}},[t._v("#")]),t._v(" ✅ 五、网络性能问题排查")]),t._v(" "),a("h3",{attrs:{id:"🔍-排查目标-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔍-排查目标-5"}},[t._v("#")]),t._v(" 🔍 排查目标：")]),t._v(" "),a("ul",[a("li",[t._v("网络延迟？丢包？带宽不够？")]),t._v(" "),a("li",[t._v("服务端口未监听？")]),t._v(" "),a("li",[t._v("某服务连接满了？")])]),t._v(" "),a("h3",{attrs:{id:"🛠️-常用命令-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🛠️-常用命令-5"}},[t._v("#")]),t._v(" 🛠️ 常用命令：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("ping")]),t._v(", "),a("code",[t._v("traceroute")])]),t._v(" "),a("td",[t._v("检查网络连通性、路径问题")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("curl")]),t._v(", "),a("code",[t._v("telnet ip port")])]),t._v(" "),a("td",[t._v("检查端口是否通")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("netstat -anp")]),t._v(" / "),a("code",[t._v("ss -lntp")])]),t._v(" "),a("td",[t._v("查看端口监听状态")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("iftop")]),t._v(", "),a("code",[t._v("nethogs")])]),t._v(" "),a("td",[t._v("查看实时带宽占用")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("tcpdump")])]),t._v(" "),a("td",[t._v("抓包分析异常")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("sar -n DEV 1")])]),t._v(" "),a("td",[t._v("查看网络设备流量")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("`conntrack -L")]),t._v(" "),a("td",[t._v("wc -l`")]),t._v(" "),a("td",[t._v("查看连接数（适用于 NAT 场景）")])])])]),t._v(" "),a("h3",{attrs:{id:"🚨-实战指标-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🚨-实战指标-5"}},[t._v("#")]),t._v(" 🚨 实战指标：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ping")]),t._v(" 延迟高丢包多 → 网络链路问题")]),t._v(" "),a("li",[a("code",[t._v("ss")]),t._v(" 发现端口未监听 → 应用未启动或崩溃")]),t._v(" "),a("li",[a("code",[t._v("established")]),t._v(" 链接数过多 → 服务未释放连接或未加连接池")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"✅-六、问题排查流程总结图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-六、问题排查流程总结图"}},[t._v("#")]),t._v(" ✅ 六、问题排查流程总结图")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("   系统性能异常\n         │\n  ┌──────┴──────┐\n  ↓             ↓\nCPU高       内存爆/GC频\n  ↓             ↓\ntop/ps       free/vmstat\njstack       jmap/jstat\n  ↓             ↓\n磁盘满/慢    IO 卡顿？\n  ↓             ↓\ndf/du      iostat/iotop\n  ↓             ↓\n网络问题？\n  ↓\nping/tcpdump/ss/curl\n")])])]),a("hr"),t._v(" "),a("blockquote",[a("p",[t._v("遇到系统响应慢问题，我会先看 CPU/内存是否异常（用 "),a("code",[t._v("top")]),t._v(" / "),a("code",[t._v("vmstat")]),t._v("），然后用 "),a("code",[t._v("iostat")]),t._v(" 确认是否是磁盘瓶颈，如果都正常再排查网络（"),a("code",[t._v("ping")]),t._v("、"),a("code",[t._v("ss")]),t._v("、"),a("code",[t._v("tcpdump")]),t._v("），实际中配合 "),a("code",[t._v("dmesg")]),t._v("/"),a("code",[t._v("journalctl")]),t._v(" 查异常日志也很重要。")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("排查 Linux 系统中的 "),a("strong",[t._v("CPU、内存、磁盘、IO、网络性能问题")]),t._v(" 通常遵循「定位瓶颈 → 查找进程 → 分析原因 → 优化方案」这条主线。以下是各个方向的排查思路和常用命令：")]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"🧠-一、cpu-性能问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🧠-一、cpu-性能问题排查"}},[t._v("#")]),t._v(" 🧠 一、CPU 性能问题排查")]),t._v(" "),a("h3",{attrs:{id:"_1-1-初步排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-初步排查"}},[t._v("#")]),t._v(" 1.1 初步排查")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("htop")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更直观（需安装）")]),t._v("\n")])])]),a("ul",[a("li",[t._v("关注 "),a("code",[t._v("%CPU")]),t._v("，"),a("code",[t._v("load average")]),t._v("（是否超过核心数）")]),t._v(" "),a("li",[t._v("找出 CPU 占用高的进程（PID）")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-深入分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-深入分析"}},[t._v("#")]),t._v(" 1.2 深入分析")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-eo")]),t._v(" pid,ppid,cmd,%mem,%cpu "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--sort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-%cpu "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("PID"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看某进程 CPU 占用变化")]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-3-java-应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-java-应用场景"}},[t._v("#")]),t._v(" 1.3 Java 应用场景")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("jstack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("PID"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看线程栈，排查死循环")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Hp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("PID"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 找出占用 CPU 高的线程 TID（十进制）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("printf")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%x'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("TID"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 转为十六进制匹配 jstack 中的 nid")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"🧠-二、内存问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🧠-二、内存问题排查"}},[t._v("#")]),t._v(" 🧠 二、内存问题排查")]),t._v(" "),a("h3",{attrs:{id:"_2-1-查看整体使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-查看整体使用"}},[t._v("#")]),t._v(" 2.1 查看整体使用")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-h")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("htop")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vmstat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),a("ul",[a("li",[t._v("重点关注 "),a("code",[t._v("free")]),t._v(", "),a("code",[t._v("available")]),t._v(", "),a("code",[t._v("swap")]),t._v(" 是否频繁使用")])]),t._v(" "),a("h3",{attrs:{id:"_2-2-查找占用高的进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-查找占用高的进程"}},[t._v("#")]),t._v(" 2.2 查找占用高的进程")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-eo")]),t._v(" pid,ppid,cmd,%mem,%cpu "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--sort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-%mem "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("smem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更准确统计（需安装）")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-3-检查-oom-历史"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-检查-oom-历史"}},[t._v("#")]),t._v(" 2.3 检查 OOM 历史")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dmesg")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"💽-三、磁盘使用排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#💽-三、磁盘使用排查"}},[t._v("#")]),t._v(" 💽 三、磁盘使用排查")]),t._v(" "),a("h3",{attrs:{id:"_3-1-空间使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-空间使用"}},[t._v("#")]),t._v(" 3.1 空间使用")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("df")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-h")]),t._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看挂载点使用率")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("du")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sh")]),t._v(" /var/log/*            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看目录占用")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-2-清理建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-清理建议"}},[t._v("#")]),t._v(" 3.2 清理建议")]),t._v(" "),a("ul",[a("li",[t._v("定期清理大日志文件")]),t._v(" "),a("li",[t._v("使用 logrotate 自动归档压缩日志")])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"🖴-四、磁盘-io-性能排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🖴-四、磁盘-io-性能排查"}},[t._v("#")]),t._v(" 🖴 四、磁盘 IO 性能排查")]),t._v(" "),a("h3",{attrs:{id:"_4-1-实时-io-状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-实时-io-状态"}},[t._v("#")]),t._v(" 4.1 实时 IO 状态")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iostat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-x")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 观察 %util（高表示 IO 饱和）")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-2-观察读写情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-观察读写情况"}},[t._v("#")]),t._v(" 4.2 观察读写情况")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iotop                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看读写最多的进程（需 root）")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"🌐-五、网络问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🌐-五、网络问题排查"}},[t._v("#")]),t._v(" 🌐 五、网络问题排查")]),t._v(" "),a("h3",{attrs:{id:"_5-1-基本命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-基本命令"}},[t._v("#")]),t._v(" 5.1 基本命令")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-tnlp")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看端口监听情况")]),t._v("\nss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v("                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TCP 状态统计")]),t._v("\nss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ant")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" estab     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前活跃连接")]),t._v("\n")])])]),a("h3",{attrs:{id:"_5-2-查看流量和连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-查看流量和连接"}},[t._v("#")]),t._v(" 5.2 查看流量和连接")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iftop                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实时流量（需安装）")]),t._v("\nnethogs                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进程级别的网络流量（需安装）")]),t._v("\n")])])]),a("h3",{attrs:{id:"_5-3-ping-traceroute"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-ping-traceroute"}},[t._v("#")]),t._v(" 5.3 ping & traceroute")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("目标地址"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看网络是否通畅、延迟")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("traceroute")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("目标地址"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由跳数分析")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"📌-实战经验总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#📌-实战经验总结"}},[t._v("#")]),t._v(" 📌 实战经验总结")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("问题现象")]),t._v(" "),a("th",[t._v("排查思路")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("CPU 飙高")]),t._v(" "),a("td",[t._v("top → jstack → 定位死循环")])]),t._v(" "),a("tr",[a("td",[t._v("内存不足")]),t._v(" "),a("td",[t._v("free → ps → OOM 日志")])]),t._v(" "),a("tr",[a("td",[t._v("磁盘满了")]),t._v(" "),a("td",[t._v("df/du 分析目录占用")])]),t._v(" "),a("tr",[a("td",[t._v("IO 慢卡顿")]),t._v(" "),a("td",[t._v("iostat → iotop 分析进程")])]),t._v(" "),a("tr",[a("td",[t._v("网络断连/慢")]),t._v(" "),a("td",[t._v("ping/traceroute/iftop")])])])]),t._v(" "),a("hr")])}),[],!1,null,null,null);a.default=_.exports}}]);