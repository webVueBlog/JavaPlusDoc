(window.webpackJsonp=window.webpackJsonp||[]).push([[534],{1404:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("点击勘误"),t("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[s._v("issues"),t("OutboundLink")],1),s._v("，哪吒感谢大家的阅读")])]),s._v(" "),t("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),s._v(" "),t("h2",{attrs:{id:"搭建jenkins部署spring-boot项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建jenkins部署spring-boot项目"}},[s._v("#")]),s._v(" 搭建jenkins部署spring-boot项目")]),s._v(" "),t("h3",{attrs:{id:"docker配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker配置"}},[s._v("#")]),s._v(" docker配置")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\nservices:\n  jenkins:\n    privileged: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    container_name: myjenkins\n    image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jenkins/jenkins:lts-jdk17"')]),s._v("\n    restart: always\n    user: root\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/localtime:/etc/localtime:ro"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/docker/jenkins/data:/var/jenkins_home"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/run/docker.sock:/var/run/docker.sock"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/docker:/usr/bin/docker"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker:/var/lib/docker"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root:/home"')]),s._v("\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10002:8080"')]),s._v("\n\n\n")])])]),t("h3",{attrs:{id:"命令行脚本配置时区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令行脚本配置时区"}},[s._v("#")]),s._v(" 命令行脚本配置时区")]),s._v(" "),t("h3",{attrs:{id:"临时修改系统时区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#临时修改系统时区"}},[s._v("#")]),s._v(" 临时修改系统时区")]),s._v(" "),t("p",[s._v("根据Manage Jenkins -> Script Console找到指令框，在指令框中投入下面的指令，可以将时区变为北京时间： "),t("code",[s._v("System.setProperty(‘org.apache.commons.jelly.tags.fmt.timeZone’, ‘Asia/Shanghai’)")])]),s._v(" "),t("h3",{attrs:{id:"永久修改时区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#永久修改时区"}},[s._v("#")]),s._v(" 永久修改时区")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". 进入daocker容器里面 ： "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" myjenkins "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/timezone\n\n")])])]),t("h2",{attrs:{id:"pipeline脚本文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pipeline脚本文件"}},[s._v("#")]),s._v(" pipeline脚本文件")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("pipeline "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n   agent any\n\n   // 环境变量\n    environment "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        JAR_FILE_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"项目部署文件名 ,例如：app.jar"')]),s._v("\n        work_dir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/jenkins_home/workspace/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.JAR_FILE_NAME}")]),s._v('-prod"')]),s._v("\n        REMOTE_HOST "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1'")]),s._v("\n        REMOTE_USER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("\n        REMOTE_DIR "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/www/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.JAR_FILE_NAME}")]),s._v('"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    // 入参定义\n    parameters "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'branch_name'")]),s._v(", defaultValue: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'master'")]),s._v(", description: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git分支'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n   stages "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      stage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'检出代码'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          steps "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n               // 检出代码\n            \tcheckout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${params.branch_name}")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n            \tdoGenerateSubmoduleConfigurations: false,\n            \textensions: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n            \tsubmoduleCfg: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n                userRemoteConfigs: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                    credentialsId: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git'")]),s._v(",\n                \turl: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:443/xxx.git"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        stage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"编译打包"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        \tagent "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                \timage "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'maven:3-alpine'")]),s._v("\n                    args "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-v /root/.m2:/root/.m2"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n            steps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                dir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.work_dir}")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    // 编译打包\n                   \t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mvn -B -DskipTests clean package"')]),s._v("\n                   \t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pwd"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n        stage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Deploy'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    def remote "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                    remote.name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'名字随便起，方便记就行 你看到知道是哪台机器'")]),s._v("\n                    remote.host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.REMOTE_HOST}")]),s._v('"')]),s._v("\n                    remote.user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.REMOTE_USER}")]),s._v('"')]),s._v("\n                    remote.allowAnyHosts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n                   \n                    withCredentials"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("usernamePassword"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("credentialsId: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins上配置的用户名密码凭证ID'")]),s._v(", passwordVariable: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(", usernameVariable: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'userName'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        remote.user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${userName}")]),s._v('"')]),s._v("\n                        remote.password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${password}")]),s._v('"')]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n                    // 将jar拷贝到远程机器 \n                    sshPut remote: remote, from: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.work_dir}")]),s._v("/target/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.JAR_FILE_NAME}")]),s._v('.jar"')]),s._v(", into: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.REMOTE_DIR}")]),s._v('"')]),s._v("\n\n                    //在远程机器执行启动命令\n                    sshCommand remote: remote, command: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n                        '),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile \n                        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.REMOTE_DIR}")]),s._v("/startup.sh restart\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n                '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);