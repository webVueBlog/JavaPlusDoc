(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{1401:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("点击勘误"),t("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[s._v("issues"),t("OutboundLink")],1),s._v("，哪吒感谢大家的阅读")])]),s._v(" "),t("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),s._v(" "),t("h2",{attrs:{id:"安装监控grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装监控grafana"}},[s._v("#")]),s._v(" 安装监控grafana")]),s._v(" "),t("h3",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step 1: 安装必要的一些系统工具")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" yum-utils device-mapper-persistent-data lvm2\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step 2: 添加软件源信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step 3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s+download.docker.com+mirrors.aliyun.com/docker-ce+'")]),s._v(" /etc/yum.repos.d/docker-ce.repo\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step 4: 更新并安装Docker-CE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum makecache fast\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step 4: 开启Docker服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" start\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，您可以通过以下方式开启。同理可以开启各种测试版本等。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/yum.repos.d/docker-ce.repo")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   将[docker-ce-test]下方的enabled=0修改为enabled=1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装指定版本的Docker-CE:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step 1: 查找Docker-CE的版本:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum list docker-ce.x86_64 --showduplicates | sort -r")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   Loading mirror speeds from cached hostfile")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   Loaded plugins: branch, fastestmirror, langpacks")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   Available Packages")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step2: 安装指定版本的Docker-CE: (VERSION例如上面的17.03.0.ce.1-1.el7.centos)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo yum -y install docker-ce-[VERSION]")]),s._v("\n\n\n")])])]),t("h3",{attrs:{id:"配置国内镜像源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置国内镜像源"}},[s._v("#")]),s._v(" 配置国内镜像源")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'EOF\'\n{\n    "registry-mirrors": [\n        "https://docker.m.daocloud.io",\n        "https://huecker.io",\n        "https://dockerhub.timeweb.cloud",\n        "https://noohub.ru"\n    ]\n}\nEOF')]),s._v("\n\n")])])]),t("h3",{attrs:{id:"创建目录和授权"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建目录和授权"}},[s._v("#")]),s._v(" 创建目录和授权")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 都安装在这个目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /home/docker/prometheus\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/docker/prometheus/grafana_data\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/docker/prometheus/prometheus_data\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v("  /home/docker/prometheus/grafana_data\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v("  /home/docker/prometheus/prometheus_data\n\n")])])]),t("h3",{attrs:{id:"配置文件-prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件-prometheus"}},[s._v("#")]),s._v(" 配置文件 prometheus")]),s._v(" "),t("p",[s._v("/home/docker/prometheus/prometheus.yml")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("global:\n  scrape_interval:     15s "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认抓取周期")]),s._v("\n  external_labels:\n    monitor: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'codelab-monitor'")]),s._v("\nscrape_configs:\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node-exporter'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务的名称")]),s._v("\n    scrape_interval: 5s\n    metrics_path: /metrics  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取指标的url")]),s._v("\n    static_configs:\n      - targets: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.221:9100'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个为监听指定服务服务的ip和port，需要修改为自己的ip，貌似云服务必须用公网ip")]),s._v("\n\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'electricity'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务的名称")]),s._v("\n    scrape_interval: 5s\n    metrics_path: /actuator/prometheus  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取指标的url")]),s._v("\n    static_configs:\n      - targets: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.130:28097'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个为监听指定服务服务的ip和port，需要修改为自己的ip，貌似云服务必须用公网ip")]),s._v("\n\n")])])]),t("h3",{attrs:{id:"配置docker-compose文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置docker-compose文件"}},[s._v("#")]),s._v(" 配置docker compose文件")]),s._v(" "),t("p",[s._v("/home/docker/prometheus/docker-compose.yml")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.7"')]),s._v("\nservices:\n node-exporter:\n   image: prom/node-exporter:latest\n   container_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-exporter0"')]),s._v("\n   ports:\n     - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9100:9100"')]),s._v("\n   restart: always\n prometheus:\n   image: prom/prometheus:latest\n   container_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus0"')]),s._v("\n   restart: always\n   ports:\n     - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9090:9090"')]),s._v("\n   volumes:\n     - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./prometheus.yml:/etc/prometheus/prometheus.yml"')]),s._v("\n     - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./prometheus_data:/prometheus"')]),s._v("\n grafana:\n   image: grafana/grafana\n   container_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grafana0"')]),s._v("\n   ports:\n     - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3000:3000"')]),s._v("\n   restart: always\n   volumes:\n     - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./grafana_data:/var/lib/grafana"')]),s._v("                                       \n\n")])])]),t("h3",{attrs:{id:"启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/docker/prometheus/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose up "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" \n\n")])])]),t("p",[s._v("主机基础监控(cpu，内存，磁盘，网络)")]),s._v(" "),t("p",[t("img",{attrs:{src:a(874),alt:"img_8.png"}})]),s._v(" "),t("p",[s._v("https://grafana.com/grafana/dashboards/12856-jvm-micrometer/")]),s._v(" "),t("p",[s._v("https://grafana.com/grafana/dashboards/10280-microservices-spring-boot-2-1/")]),s._v(" "),t("p",[s._v("https://grafana.com/grafana/dashboards/4701-jvm-micrometer/")]),s._v(" "),t("p",[s._v("https://grafana.com/grafana/dashboards/9276-1-cpu/")])])}),[],!1,null,null,null);t.default=n.exports},874:function(s,t,a){s.exports=a.p+"assets/img/img_8.2ca387ce.png"}}]);