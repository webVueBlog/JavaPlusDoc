(window.webpackJsonp=window.webpackJsonp||[]).push([[535],{1405:function(t,a,s){"use strict";s.r(a);var e=s(1),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("点击勘误"),a("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues"),a("OutboundLink")],1),t._v("，哪吒感谢大家的阅读")])]),t._v(" "),a("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),t._v(" "),a("h2",{attrs:{id:"kubernetes全栈监控实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes全栈监控实践"}},[t._v("#")]),t._v(" Kubernetes全栈监控实践")]),t._v(" "),a("p",[t._v("本文将介绍如何在Kubernetes环境中搭建全栈监控系统，实现对集群、节点、Pod、容器和应用的全方位监控。")]),t._v(" "),a("h3",{attrs:{id:"_1-kubernetes监控概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-kubernetes监控概述"}},[t._v("#")]),t._v(" 1. Kubernetes监控概述")]),t._v(" "),a("h4",{attrs:{id:"_1-1-监控层次"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-监控层次"}},[t._v("#")]),t._v(" 1.1 监控层次")]),t._v(" "),a("p",[t._v("Kubernetes环境的监控通常分为以下几个层次：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("基础设施层")]),t._v("：物理/虚拟机、网络设备")]),t._v(" "),a("li",[a("strong",[t._v("Kubernetes集群层")]),t._v("：控制平面组件（API Server、Scheduler、Controller Manager、etcd）")]),t._v(" "),a("li",[a("strong",[t._v("节点层")]),t._v("：Node状态、资源使用率（CPU、内存、磁盘、网络）")]),t._v(" "),a("li",[a("strong",[t._v("Pod/容器层")]),t._v("：容器资源使用、健康状态")]),t._v(" "),a("li",[a("strong",[t._v("应用层")]),t._v("：业务指标、请求延迟、错误率")])]),t._v(" "),a("h4",{attrs:{id:"_1-2-监控架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-监控架构"}},[t._v("#")]),t._v(" 1.2 监控架构")]),t._v(" "),a("p",[t._v("我们将采用以下组件构建Kubernetes监控系统：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Prometheus")]),t._v("：时序数据库，用于存储和查询监控指标")]),t._v(" "),a("li",[a("strong",[t._v("Grafana")]),t._v("：可视化平台，用于展示监控数据")]),t._v(" "),a("li",[a("strong",[t._v("Alertmanager")]),t._v("：告警管理器，处理告警路由和通知")]),t._v(" "),a("li",[a("strong",[t._v("Node Exporter")]),t._v("：收集节点级别的指标")]),t._v(" "),a("li",[a("strong",[t._v("kube-state-metrics")]),t._v("：提供Kubernetes对象的状态指标")]),t._v(" "),a("li",[a("strong",[t._v("Prometheus Operator")]),t._v("：简化Prometheus在Kubernetes上的部署和管理")])]),t._v(" "),a("h3",{attrs:{id:"_2-使用prometheus-operator部署监控系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用prometheus-operator部署监控系统"}},[t._v("#")]),t._v(" 2. 使用Prometheus Operator部署监控系统")]),t._v(" "),a("h4",{attrs:{id:"_2-1-安装helm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装helm"}},[t._v("#")]),t._v(" 2.1 安装Helm")]),t._v(" "),a("p",[t._v("Helm是Kubernetes的包管理工具，我们将使用它来部署Prometheus Operator。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载Helm安装脚本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-fsSL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加执行权限")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("700")]),t._v(" get_helm.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行安装脚本")]),t._v("\n./get_helm.sh\n")])])]),a("h4",{attrs:{id:"_2-2-添加prometheus社区helm仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-添加prometheus社区helm仓库"}},[t._v("#")]),t._v(" 2.2 添加Prometheus社区Helm仓库")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\n")])])]),a("h4",{attrs:{id:"_2-3-创建监控命名空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-创建监控命名空间"}},[t._v("#")]),t._v(" 2.3 创建监控命名空间")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("kubectl create namespace monitoring\n")])])]),a("h4",{attrs:{id:"_2-4-部署prometheus-operator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-部署prometheus-operator"}},[t._v("#")]),t._v(" 2.4 部署Prometheus Operator")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("helm "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" prometheus prometheus-community/kube-prometheus-stack "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--namespace")]),t._v(" monitoring "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("grafana.adminPassword")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("admin "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("prometheus.prometheusSpec.retention")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("15d\n")])])]),a("p",[t._v("这个Helm Chart会部署以下组件：")]),t._v(" "),a("ul",[a("li",[t._v("Prometheus Operator")]),t._v(" "),a("li",[t._v("Prometheus实例")]),t._v(" "),a("li",[t._v("Alertmanager")]),t._v(" "),a("li",[t._v("Grafana")]),t._v(" "),a("li",[t._v("Node Exporter")]),t._v(" "),a("li",[t._v("kube-state-metrics")]),t._v(" "),a("li",[t._v("各种ServiceMonitor和PodMonitor资源")])]),t._v(" "),a("h4",{attrs:{id:"_2-5-验证部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-验证部署"}},[t._v("#")]),t._v(" 2.5 验证部署")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查Pod状态")]),t._v("\nkubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" monitoring\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查Service状态")]),t._v("\nkubectl get svc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" monitoring\n")])])]),a("h4",{attrs:{id:"_2-6-访问grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-访问grafana"}},[t._v("#")]),t._v(" 2.6 访问Grafana")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口转发Grafana服务")]),t._v("\nkubectl port-forward svc/prometheus-grafana "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" monitoring\n")])])]),a("p",[t._v("现在可以通过浏览器访问 http://localhost:3000 来访问Grafana。默认用户名是 "),a("code",[t._v("admin")]),t._v("，密码是上面设置的 "),a("code",[t._v("admin")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_3-监控kubernetes集群组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-监控kubernetes集群组件"}},[t._v("#")]),t._v(" 3. 监控Kubernetes集群组件")]),t._v(" "),a("h4",{attrs:{id:"_3-1-控制平面监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-控制平面监控"}},[t._v("#")]),t._v(" 3.1 控制平面监控")]),t._v(" "),a("p",[t._v("Prometheus Operator已经配置了对Kubernetes控制平面组件的监控，包括：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("API Server")]),t._v("：请求延迟、请求率、错误率")]),t._v(" "),a("li",[a("strong",[t._v("Scheduler")]),t._v("：调度延迟、调度错误")]),t._v(" "),a("li",[a("strong",[t._v("Controller Manager")]),t._v("：控制循环延迟")]),t._v(" "),a("li",[a("strong",[t._v("etcd")]),t._v("：提案提交率、提案失败率、数据库大小")])]),t._v(" "),a("p",[t._v('在Grafana中，可以找到名为 "Kubernetes / Control Plane" 的预配置仪表板。')]),t._v(" "),a("h4",{attrs:{id:"_3-2-节点监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-节点监控"}},[t._v("#")]),t._v(" 3.2 节点监控")]),t._v(" "),a("p",[t._v("Node Exporter收集的节点级别指标包括：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("CPU使用率")]),t._v("：用户态、系统态、IO等待")]),t._v(" "),a("li",[a("strong",[t._v("内存使用率")]),t._v("：已用、可用、缓存")]),t._v(" "),a("li",[a("strong",[t._v("磁盘使用率")]),t._v("：读写操作、空间使用")]),t._v(" "),a("li",[a("strong",[t._v("网络流量")]),t._v("：接收和发送的字节数、包数")]),t._v(" "),a("li",[a("strong",[t._v("系统负载")]),t._v("：1分钟、5分钟、15分钟平均负载")])]),t._v(" "),a("p",[t._v('在Grafana中，可以找到名为 "Kubernetes / Compute Resources / Node" 的预配置仪表板。')]),t._v(" "),a("h4",{attrs:{id:"_3-3-pod和容器监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-pod和容器监控"}},[t._v("#")]),t._v(" 3.3 Pod和容器监控")]),t._v(" "),a("p",[t._v("kubelet的cAdvisor组件收集容器级别的指标，包括：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("容器CPU使用率")])]),t._v(" "),a("li",[a("strong",[t._v("容器内存使用率")])]),t._v(" "),a("li",[a("strong",[t._v("容器网络流量")])]),t._v(" "),a("li",[a("strong",[t._v("容器文件系统使用率")])])]),t._v(" "),a("p",[t._v('在Grafana中，可以找到名为 "Kubernetes / Compute Resources / Pod" 和 "Kubernetes / Compute Resources / Container" 的预配置仪表板。')]),t._v(" "),a("h3",{attrs:{id:"_4-监控应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-监控应用"}},[t._v("#")]),t._v(" 4. 监控应用")]),t._v(" "),a("h4",{attrs:{id:"_4-1-为应用添加prometheus指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-为应用添加prometheus指标"}},[t._v("#")]),t._v(" 4.1 为应用添加Prometheus指标")]),t._v(" "),a("p",[t._v("以Spring Boot应用为例，添加Prometheus指标支持：")]),t._v(" "),a("ol",[a("li",[t._v("添加依赖：")])]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-actuator"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.micrometer"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("micrometer-registry-prometheus"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("配置application.properties：")])]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.endpoints.web.exposure.include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("prometheus,health,info")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.endpoint.prometheus.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.metrics.export.prometheus.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n")])])]),a("h4",{attrs:{id:"_4-2-创建servicemonitor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-创建servicemonitor"}},[t._v("#")]),t._v(" 4.2 创建ServiceMonitor")]),t._v(" "),a("p",[t._v("创建一个ServiceMonitor资源，让Prometheus自动发现并抓取应用指标：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitoring.coreos.com/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceMonitor\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" spring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitoring\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" spring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用Service的标签")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Service中暴露指标的端口名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /actuator/prometheus  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指标路径")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 15s  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 抓取间隔")]),t._v("\n")])])]),a("h4",{attrs:{id:"_4-3-导入应用仪表板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-导入应用仪表板"}},[t._v("#")]),t._v(" 4.3 导入应用仪表板")]),t._v(" "),a("p",[t._v("在Grafana中，可以导入ID为4701的「JVM Micrometer」仪表板，用于监控Spring Boot应用。")]),t._v(" "),a("h3",{attrs:{id:"_5-配置告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置告警"}},[t._v("#")]),t._v(" 5. 配置告警")]),t._v(" "),a("h4",{attrs:{id:"_5-1-创建prometheusrule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-创建prometheusrule"}},[t._v("#")]),t._v(" 5.1 创建PrometheusRule")]),t._v(" "),a("p",[t._v("创建一个PrometheusRule资源，定义告警规则：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitoring.coreos.com/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PrometheusRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("apps\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitoring\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("groups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("apps\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PodHighCpuUsage\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sum(rate(container_cpu_usage_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("container"),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v('""'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pod"),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v('""'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(")) by (pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" namespace) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" 0.8\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5m\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("severity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" warning\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("summary")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Pod CPU使用率过高"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Pod {{ $labels.pod }} 在命名空间 {{ $labels.namespace }} 的CPU使用率超过80%已持续5分钟。"')]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PodHighMemoryUsage\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sum(container_memory_working_set_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("container"),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v('""'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pod"),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v('""'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(") by (pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" namespace) / sum(container_spec_memory_limit_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("container"),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v('""'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pod"),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v('""'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(") by (pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" namespace) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" 0.8\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5m\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("severity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" warning\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("summary")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Pod内存使用率过高"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Pod {{ $labels.pod }} 在命名空间 {{ $labels.namespace }} 的内存使用率超过80%已持续5分钟。"')]),t._v("\n")])])]),a("h4",{attrs:{id:"_5-2-配置alertmanager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-配置alertmanager"}},[t._v("#")]),t._v(" 5.2 配置Alertmanager")]),t._v(" "),a("p",[t._v("创建一个Secret来配置Alertmanager：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" alertmanager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alertmanager\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitoring\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stringData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alertmanager.yaml")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    global:\n      resolve_timeout: 5m\n      smtp_smarthost: 'smtp.example.com:587'\n      smtp_from: 'alertmanager@example.com'\n      smtp_auth_username: 'alertmanager'\n      smtp_auth_password: 'password'\n    route:\n      group_by: ['job', 'alertname', 'namespace']\n      group_wait: 30s\n      group_interval: 5m\n      repeat_interval: 12h\n      receiver: 'email'\n      routes:\n      - match:\n          severity: critical\n        receiver: 'pager'\n    receivers:\n    - name: 'email'\n      email_configs:\n      - to: 'alerts@example.com'\n    - name: 'pager'\n      email_configs:\n      - to: 'oncall@example.com'\n      webhook_configs:\n      - url: 'https://api.example.com/webhook'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n")])])]),a("h3",{attrs:{id:"_6-高级配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-高级配置"}},[t._v("#")]),t._v(" 6. 高级配置")]),t._v(" "),a("h4",{attrs:{id:"_6-1-自定义prometheus存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-自定义prometheus存储"}},[t._v("#")]),t._v(" 6.1 自定义Prometheus存储")]),t._v(" "),a("p",[t._v("对于生产环境，建议配置持久化存储：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheusSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("retention")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 30d\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storageSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeClaimTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storageClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" standard\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ReadWriteOnce"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100Gi\n")])])]),a("h4",{attrs:{id:"_6-2-配置远程存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-配置远程存储"}},[t._v("#")]),t._v(" 6.2 配置远程存储")]),t._v(" "),a("p",[t._v("对于长期存储，可以配置Prometheus将数据发送到远程存储：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheusSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remoteWrite")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://thanos-receive.monitoring.svc:19291/api/v1/receive"')]),t._v("\n")])])]),a("h4",{attrs:{id:"_6-3-使用thanos扩展prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-使用thanos扩展prometheus"}},[t._v("#")]),t._v(" 6.3 使用Thanos扩展Prometheus")]),t._v(" "),a("p",[t._v("Thanos可以提供全局查询视图、长期存储和高可用性：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" bitnami https://charts.bitnami.com/bitnami\nhelm "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" thanos bitnami/thanos "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--namespace")]),t._v(" monitoring "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("objstoreConfig")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type: S3'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("accessKey: YOUR_ACCESS_KEY"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("secretKey: YOUR_SECRET_KEY"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("bucket: thanos"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v('endpoint: s3.amazonaws.com"')]),t._v("\n")])])]),a("h2",{attrs:{id:"监控面板示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控面板示例"}},[t._v("#")]),t._v(" 监控面板示例")]),t._v(" "),a("h3",{attrs:{id:"集群概览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群概览"}},[t._v("#")]),t._v(" 集群概览")]),t._v(" "),a("p",[a("img",{attrs:{src:"/worker/k8s-cluster-overview.svg",alt:"Kubernetes集群概览"}})]),t._v(" "),a("p",[a("em",[t._v("Kubernetes集群概览面板展示了集群的整体健康状态和资源使用情况")])]),t._v(" "),a("h3",{attrs:{id:"节点资源监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节点资源监控"}},[t._v("#")]),t._v(" 节点资源监控")]),t._v(" "),a("p",[a("img",{attrs:{src:"/worker/k8s-node-resources.svg",alt:"Kubernetes节点资源使用率"}})]),t._v(" "),a("p",[a("em",[t._v("Kubernetes节点资源监控面板展示了各节点的CPU、内存和磁盘使用率以及Pod数量")])]),t._v(" "),a("h3",{attrs:{id:"pod监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pod监控"}},[t._v("#")]),t._v(" Pod监控")]),t._v(" "),a("p",[a("img",{attrs:{src:"/worker/k8s-pod-monitoring.svg",alt:"Kubernetes Pod监控"}})]),t._v(" "),a("p",[a("em",[t._v("Kubernetes Pod监控面板展示了Pod的状态分布、资源使用情况和关键Pod的详细信息")])]),t._v(" "),a("h3",{attrs:{id:"应用监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用监控"}},[t._v("#")]),t._v(" 应用监控")]),t._v(" "),a("p",[a("img",{attrs:{src:"/worker/k8s-app-monitoring.svg",alt:"Spring Boot应用监控"}})]),t._v(" "),a("p",[a("em",[t._v("Spring Boot应用监控面板展示了应用的JVM内存使用、HTTP请求统计和端点性能数据")])]),t._v(" "),a("h3",{attrs:{id:"_8-最佳实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-最佳实践"}},[t._v("#")]),t._v(" 8. 最佳实践")]),t._v(" "),a("h4",{attrs:{id:"_8-1-资源规划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-资源规划"}},[t._v("#")]),t._v(" 8.1 资源规划")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Prometheus")]),t._v("：根据指标数量和保留时间调整资源。一般建议每天1GB的数据量，加上30%的余量。")]),t._v(" "),a("li",[a("strong",[t._v("Grafana")]),t._v("：对于中小型集群，1CPU和1GB内存通常足够。")]),t._v(" "),a("li",[a("strong",[t._v("Alertmanager")]),t._v("：资源需求较小，0.5CPU和256MB内存通常足够。")])]),t._v(" "),a("h4",{attrs:{id:"_8-2-性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-性能优化"}},[t._v("#")]),t._v(" 8.2 性能优化")]),t._v(" "),a("ul",[a("li",[t._v("调整抓取间隔：默认为15s，可以根据需要调整。")]),t._v(" "),a("li",[t._v("使用标签选择器限制抓取范围。")]),t._v(" "),a("li",[t._v("配置适当的保留期限，避免存储过多历史数据。")]),t._v(" "),a("li",[t._v("对于大型集群，考虑使用Prometheus联邦或Thanos。")])]),t._v(" "),a("h4",{attrs:{id:"_8-3-安全性考虑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-安全性考虑"}},[t._v("#")]),t._v(" 8.3 安全性考虑")]),t._v(" "),a("ul",[a("li",[t._v("使用NetworkPolicy限制Prometheus的访问范围。")]),t._v(" "),a("li",[t._v("为Grafana配置适当的认证和授权。")]),t._v(" "),a("li",[t._v("敏感信息（如告警接收者的凭据）应使用Secret存储。")])]),t._v(" "),a("h3",{attrs:{id:"_9-故障排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-故障排查"}},[t._v("#")]),t._v(" 9. 故障排查")]),t._v(" "),a("h4",{attrs:{id:"_9-1-prometheus无法抓取指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-prometheus无法抓取指标"}},[t._v("#")]),t._v(" 9.1 Prometheus无法抓取指标")]),t._v(" "),a("ul",[a("li",[t._v("检查ServiceMonitor/PodMonitor的标签选择器是否正确。")]),t._v(" "),a("li",[t._v("验证目标端点是否可访问（使用kubectl port-forward测试）。")]),t._v(" "),a("li",[t._v("检查Prometheus日志中的错误信息。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("kubectl logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" prometheus-prometheus-kube-prometheus-prometheus-0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" monitoring "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" prometheus\n")])])]),a("h4",{attrs:{id:"_9-2-grafana无法显示数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-grafana无法显示数据"}},[t._v("#")]),t._v(" 9.2 Grafana无法显示数据")]),t._v(" "),a("ul",[a("li",[t._v("验证Prometheus数据源配置是否正确。")]),t._v(" "),a("li",[t._v("使用Prometheus UI测试查询表达式。")]),t._v(" "),a("li",[t._v("检查Grafana日志中的错误信息。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("kubectl logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" prometheus-grafana-xxxxxxxxxx-xxxxx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" monitoring "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" grafana\n")])])]),a("h4",{attrs:{id:"_9-3-告警未触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-告警未触发"}},[t._v("#")]),t._v(" 9.3 告警未触发")]),t._v(" "),a("ul",[a("li",[t._v("在Prometheus UI中检查告警规则状态。")]),t._v(" "),a("li",[t._v("验证告警表达式是否正确。")]),t._v(" "),a("li",[t._v("检查Alertmanager的配置和日志。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("kubectl logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" alertmanager-prometheus-kube-prometheus-alertmanager-0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" monitoring "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" alertmanager\n")])])]),a("h3",{attrs:{id:"_10-结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-结论"}},[t._v("#")]),t._v(" 10. 结论")]),t._v(" "),a("p",[t._v("通过本文介绍的方法，您可以在Kubernetes环境中搭建全栈监控系统，实现对集群、节点、Pod、容器和应用的全方位监控。这将帮助您及时发现和解决潜在问题，保障系统的稳定运行。")]),t._v(" "),a("p",[t._v("随着Kubernetes生态的不断发展，监控工具和最佳实践也在不断演进。建议定期关注社区动态，及时更新监控系统，以获得更好的监控效果。")])])}),[],!1,null,null,null);a.default=r.exports}}]);