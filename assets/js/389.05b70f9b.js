(window.webpackJsonp=window.webpackJsonp||[]).push([[389],{1215:function(a,t,s){"use strict";s.r(t);var n=s(1),r=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("blockquote",[t("p",[a._v("点击勘误"),t("a",{attrs:{href:"https://github.com/webVueBlog/JavaPlusDoc/issues",target:"_blank",rel:"noopener noreferrer"}},[a._v("issues"),t("OutboundLink")],1),a._v("，哪吒感谢大家的阅读")])]),a._v(" "),t("img",{attrs:{align:"right",width:"100",src:"https://cdn.jsdelivr.net/gh/YunYouJun/yun/images/yun-alpha-compressed.png"}}),a._v(" "),t("h2",{attrs:{id:"mongodb备份与恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb备份与恢复"}},[a._v("#")]),a._v(" MongoDB备份与恢复")]),a._v(" "),t("p",[a._v("在生产环境中，数据备份是一项至关重要的工作。无论是系统故障、人为操作失误还是其他不可预见的情况，都可能导致数据丢失。因此，掌握MongoDB的备份与恢复技术对于保障数据安全至关重要。本文将详细介绍MongoDB的备份与恢复方法。")]),a._v(" "),t("h2",{attrs:{id:"mongodb备份方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb备份方法"}},[a._v("#")]),a._v(" MongoDB备份方法")]),a._v(" "),t("p",[a._v("MongoDB提供了多种备份方法，主要包括以下几种：")]),a._v(" "),t("h3",{attrs:{id:"_1-mongodump备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-mongodump备份"}},[a._v("#")]),a._v(" 1. mongodump备份")]),a._v(" "),t("p",[a._v("mongodump是MongoDB官方提供的备份工具，它可以导出MongoDB数据库中的数据为BSON格式文件。这是最常用的备份方法之一。")]),a._v(" "),t("p",[t("strong",[a._v("基本语法：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("mongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--username")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("password"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--authenticationDatabase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("database"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--collection")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("collection"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--out")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("output_directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),t("p",[t("strong",[a._v("参数说明：")])]),a._v(" "),t("ul",[t("li",[t("code",[a._v("--host")]),a._v("：MongoDB服务器地址，默认为localhost")]),a._v(" "),t("li",[t("code",[a._v("--port")]),a._v("：MongoDB服务器端口，默认为27017")]),a._v(" "),t("li",[t("code",[a._v("--username")]),a._v("：用户名")]),a._v(" "),t("li",[t("code",[a._v("--password")]),a._v("：密码")]),a._v(" "),t("li",[t("code",[a._v("--authenticationDatabase")]),a._v("：认证数据库，通常为admin")]),a._v(" "),t("li",[t("code",[a._v("--db")]),a._v("：要备份的数据库名称，如果不指定则备份所有数据库")]),a._v(" "),t("li",[t("code",[a._v("--collection")]),a._v("：要备份的集合名称，如果不指定则备份指定数据库中的所有集合")]),a._v(" "),t("li",[t("code",[a._v("--out")]),a._v("：备份文件输出目录")])]),a._v(" "),t("p",[t("strong",[a._v("示例：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 备份整个MongoDB实例")]),a._v("\nmongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--out")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/backup/mongodb/full\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 备份特定数据库")]),a._v("\nmongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mydb "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--out")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/backup/mongodb/mydb\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 备份特定集合")]),a._v("\nmongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mydb "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--collection")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("users "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--out")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/backup/mongodb/mydb_users\n")])])]),t("h3",{attrs:{id:"_2-文件系统快照备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-文件系统快照备份"}},[a._v("#")]),a._v(" 2. 文件系统快照备份")]),a._v(" "),t("p",[a._v("对于使用WiredTiger存储引擎的MongoDB（MongoDB 3.2及以上版本的默认引擎），可以使用文件系统快照进行备份。这种方法需要先锁定数据库以确保数据一致性，然后对数据文件目录进行快照。")]),a._v(" "),t("p",[t("strong",[a._v("步骤：")])]),a._v(" "),t("ol",[t("li",[a._v("连接到MongoDB并锁定数据库：")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("fsyncLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[a._v("使用文件系统工具创建数据目录的快照")])]),a._v(" "),t("li",[t("p",[a._v("解锁数据库：")])])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("fsyncUnlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h3",{attrs:{id:"_3-mongodb-atlas备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-mongodb-atlas备份"}},[a._v("#")]),a._v(" 3. MongoDB Atlas备份")]),a._v(" "),t("p",[a._v("如果你使用MongoDB Atlas云服务，它提供了自动备份功能，可以设置备份策略和保留期限。")]),a._v(" "),t("h2",{attrs:{id:"mongodb恢复方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb恢复方法"}},[a._v("#")]),a._v(" MongoDB恢复方法")]),a._v(" "),t("h3",{attrs:{id:"_1-mongorestore恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-mongorestore恢复"}},[a._v("#")]),a._v(" 1. mongorestore恢复")]),a._v(" "),t("p",[a._v("mongorestore是与mongodump配套的恢复工具，用于将mongodump创建的备份数据恢复到MongoDB数据库中。")]),a._v(" "),t("p",[t("strong",[a._v("基本语法：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("mongorestore "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--username")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("password"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--authenticationDatabase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("database"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--collection")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("collection"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("backup_directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),t("p",[t("strong",[a._v("参数说明：")])]),a._v(" "),t("ul",[t("li",[t("code",[a._v("--host")]),a._v("：MongoDB服务器地址")]),a._v(" "),t("li",[t("code",[a._v("--port")]),a._v("：MongoDB服务器端口")]),a._v(" "),t("li",[t("code",[a._v("--username")]),a._v("：用户名")]),a._v(" "),t("li",[t("code",[a._v("--password")]),a._v("：密码")]),a._v(" "),t("li",[t("code",[a._v("--authenticationDatabase")]),a._v("：认证数据库")]),a._v(" "),t("li",[t("code",[a._v("--db")]),a._v("：要恢复的数据库名称")]),a._v(" "),t("li",[t("code",[a._v("--collection")]),a._v("：要恢复的集合名称")]),a._v(" "),t("li",[t("code",[a._v("<backup_directory>")]),a._v("：备份文件目录")])]),a._v(" "),t("p",[t("strong",[a._v("示例：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 恢复整个备份")]),a._v("\nmongorestore "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" /backup/mongodb/full\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 恢复特定数据库")]),a._v("\nmongorestore "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mydb /backup/mongodb/mydb\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 恢复特定集合")]),a._v("\nmongorestore "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mydb "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--collection")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("users /backup/mongodb/mydb/users.bson\n")])])]),t("h3",{attrs:{id:"_2-从文件系统快照恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-从文件系统快照恢复"}},[a._v("#")]),a._v(" 2. 从文件系统快照恢复")]),a._v(" "),t("p",[a._v("如果使用文件系统快照进行备份，恢复过程如下：")]),a._v(" "),t("ol",[t("li",[a._v("停止MongoDB服务")]),a._v(" "),t("li",[a._v("删除或重命名现有数据目录")]),a._v(" "),t("li",[a._v("从快照中恢复数据目录")]),a._v(" "),t("li",[a._v("启动MongoDB服务")])]),a._v(" "),t("h2",{attrs:{id:"备份策略最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备份策略最佳实践"}},[a._v("#")]),a._v(" 备份策略最佳实践")]),a._v(" "),t("h3",{attrs:{id:"_1-定期备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-定期备份"}},[a._v("#")]),a._v(" 1. 定期备份")]),a._v(" "),t("p",[a._v("根据数据重要性和变化频率，制定合适的备份计划。对于关键业务数据，建议每天至少备份一次。")]),a._v(" "),t("h3",{attrs:{id:"_2-备份验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-备份验证"}},[a._v("#")]),a._v(" 2. 备份验证")]),a._v(" "),t("p",[a._v("定期验证备份数据的完整性和可用性，确保在需要时能够成功恢复。")]),a._v(" "),t("h3",{attrs:{id:"_3-异地备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-异地备份"}},[a._v("#")]),a._v(" 3. 异地备份")]),a._v(" "),t("p",[a._v("将备份数据存储在与生产环境不同的物理位置，以防止因自然灾害等导致的数据丢失。")]),a._v(" "),t("h3",{attrs:{id:"_4-自动化备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-自动化备份"}},[a._v("#")]),a._v(" 4. 自动化备份")]),a._v(" "),t("p",[a._v("使用脚本或任务调度工具（如cron）自动执行备份任务，减少人为干预和错误。")]),a._v(" "),t("p",[t("strong",[a._v("示例备份脚本：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置变量")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BACKUP_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/backup/mongodb/'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%Y%m%d"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MONGO_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"127.0.0.1"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MONGO_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"27017"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MONGO_DB")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mydb"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建备份目录")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 执行备份")]),a._v("\nmongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MONGO_HOST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MONGO_PORT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MONGO_DB")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--out")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 压缩备份文件")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zcvf")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v(".tar.gz "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除原始备份目录")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 保留最近30天的备份，删除更早的备份")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" /backup/mongodb/ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"*.tar.gz"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-type")]),a._v(" f "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mtime")]),a._v(" +30 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-delete")]),a._v("\n")])])]),t("h2",{attrs:{id:"在java应用中实现备份与恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在java应用中实现备份与恢复"}},[a._v("#")]),a._v(" 在Java应用中实现备份与恢复")]),a._v(" "),t("p",[a._v("除了使用命令行工具，我们还可以在Java应用中集成MongoDB的备份与恢复功能。")]),a._v(" "),t("h3",{attrs:{id:"使用java执行mongodump和mongorestore"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用java执行mongodump和mongorestore"}},[a._v("#")]),a._v(" 使用Java执行mongodump和mongorestore")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IOException")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MongoDBBackupRestore")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("performBackup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" dbName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" outputDir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessBuilder")]),a._v(" pb "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mongodump"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--host"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--port"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("valueOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--db"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" dbName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--out"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" outputDir\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Process")]),a._v(" process "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" pb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" exitCode "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("waitFor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("exitCode "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"备份成功："')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" outputDir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"备份失败，退出码："')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" exitCode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IOException")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("InterruptedException")]),a._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("performRestore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" dbName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" backupDir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessBuilder")]),a._v(" pb "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mongorestore"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--host"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--port"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("valueOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--db"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" dbName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                backupDir\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Process")]),a._v(" process "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" pb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" exitCode "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("waitFor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("exitCode "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"恢复成功："')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" backupDir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"恢复失败，退出码："')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" exitCode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IOException")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("InterruptedException")]),a._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 执行备份")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("performBackup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mydb"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/backup/mongodb/"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("currentTimeMillis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 执行恢复")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// performRestore("localhost", 27017, "mydb", "/backup/mongodb/1623765432123");')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),t("p",[a._v("MongoDB的备份与恢复是数据库管理中不可或缺的一部分。通过合理的备份策略和恢复方法，可以有效降低数据丢失的风险，确保业务的连续性和数据的安全性。在实际应用中，应根据具体需求选择适合的备份方式，并定期验证备份的有效性。")]),a._v(" "),t("p",[a._v("对于大型生产环境，建议结合多种备份方法，如定期的完整备份、增量备份以及实时的操作日志备份，构建全面的数据保护体系。同时，将备份流程自动化，并建立监控机制，及时发现和解决备份过程中的问题。")])])}),[],!1,null,null,null);t.default=r.exports}}]);