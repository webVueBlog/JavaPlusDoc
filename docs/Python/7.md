---
title: ç¬¬7å¤©-å‡½æ•°å¼ç¼–ç¨‹
author: å“ªå’
date: '2023-06-15'
---

# ç¬¬7å¤©-Pythonå‡½æ•°å¼ç¼–ç¨‹

æ¬¢è¿æ¥åˆ°Pythonå‡½æ•°å¼ç¼–ç¨‹çš„ä¸–ç•Œï¼ä»Šå¤©æˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ ä¸€ç§ä¼˜é›…çš„ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒèƒ½è®©ä½ çš„ä»£ç æ›´åŠ ç®€æ´ã€å¯è¯»å’Œå¯ç»´æŠ¤ã€‚

## ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿ

å‡½æ•°å¼ç¼–ç¨‹ï¼ˆFunctional Programmingï¼ŒFPï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå°†è®¡ç®—è§†ä¸ºæ•°å­¦å‡½æ•°çš„æ±‚å€¼ï¼Œé¿å…æ”¹å˜çŠ¶æ€å’Œå¯å˜æ•°æ®ã€‚

> **ç”Ÿæ´»ç±»æ¯”**ï¼š
> - **å‘½ä»¤å¼ç¼–ç¨‹**ï¼šåƒåšèœçš„è¯¦ç»†æ­¥éª¤ï¼Œ"å…ˆåˆ‡èœï¼Œå†ç‚’èœï¼Œç„¶åè£…ç›˜"
> - **å‡½æ•°å¼ç¼–ç¨‹**ï¼šåƒæ•°å­¦å…¬å¼ï¼Œ"f(åŸæ–™) = æˆå“èœ"ï¼Œå…³æ³¨è¾“å…¥å’Œè¾“å‡ºçš„å…³ç³»

### å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒç‰¹ç‚¹

1. **å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘**ï¼šå‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€ä½œä¸ºè¿”å›å€¼ã€èµ‹å€¼ç»™å˜é‡
2. **ä¸å¯å˜æ€§**ï¼šæ•°æ®ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹
3. **çº¯å‡½æ•°**ï¼šç›¸åŒè¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒè¾“å‡ºï¼Œæ²¡æœ‰å‰¯ä½œç”¨
4. **é«˜é˜¶å‡½æ•°**ï¼šæ¥å—å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è¿”å›å‡½æ•°çš„å‡½æ•°

---

## ä¸€ã€çº¯å‡½æ•°ï¼ˆPure Functionsï¼‰

### 1.1 ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ï¼Ÿ

çº¯å‡½æ•°å…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š
1. **ç¡®å®šæ€§**ï¼šç›¸åŒçš„è¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„è¾“å‡º
2. **æ— å‰¯ä½œç”¨**ï¼šä¸ä¿®æ”¹å¤–éƒ¨çŠ¶æ€ï¼Œä¸äº§ç”Ÿå¯è§‚å¯Ÿçš„å‰¯ä½œç”¨

```python
# çº¯å‡½æ•°ç¤ºä¾‹
def add(x, y):
    """çº¯å‡½æ•°ï¼šåªä¾èµ–è¾“å…¥å‚æ•°ï¼Œæ€»æ˜¯è¿”å›ç›¸åŒç»“æœ"""
    return x + y

def multiply(x, y):
    """çº¯å‡½æ•°ï¼šç®€å•çš„æ•°å­¦è¿ç®—"""
    return x * y

def get_full_name(first_name, last_name):
    """çº¯å‡½æ•°ï¼šå­—ç¬¦ä¸²å¤„ç†"""
    return f"{first_name} {last_name}"

# æµ‹è¯•çº¯å‡½æ•°
print(add(2, 3))  # æ€»æ˜¯è¿”å› 5
print(multiply(4, 5))  # æ€»æ˜¯è¿”å› 20
print(get_full_name("å¼ ", "ä¸‰"))  # æ€»æ˜¯è¿”å› "å¼  ä¸‰"
```

### 1.2 éçº¯å‡½æ•°ç¤ºä¾‹

```python
import random
import datetime

# éçº¯å‡½æ•°ç¤ºä¾‹ï¼ˆä¸æ¨èåœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ä½¿ç”¨ï¼‰
counter = 0

def impure_increment():
    """éçº¯å‡½æ•°ï¼šä¿®æ”¹å…¨å±€å˜é‡"""
    global counter
    counter += 1
    return counter

def get_random_number():
    """éçº¯å‡½æ•°ï¼šæ¯æ¬¡è°ƒç”¨ç»“æœä¸åŒ"""
    return random.randint(1, 100)

def get_current_time():
    """éçº¯å‡½æ•°ï¼šä¾èµ–å¤–éƒ¨çŠ¶æ€ï¼ˆå½“å‰æ—¶é—´ï¼‰"""
    return datetime.datetime.now()

# è¿™äº›å‡½æ•°çš„è¾“å‡ºä¸å¯é¢„æµ‹
print(impure_increment())  # 1
print(impure_increment())  # 2
print(get_random_number())  # éšæœºæ•°
print(get_current_time())  # å½“å‰æ—¶é—´
```

### 1.3 å°†éçº¯å‡½æ•°è½¬æ¢ä¸ºçº¯å‡½æ•°

```python
# æ”¹è¿›ï¼šå°†éçº¯å‡½æ•°è½¬æ¢ä¸ºçº¯å‡½æ•°
def pure_increment(current_value):
    """çº¯å‡½æ•°ç‰ˆæœ¬ï¼šä¸ä¿®æ”¹å¤–éƒ¨çŠ¶æ€"""
    return current_value + 1

def generate_sequence(start, length):
    """çº¯å‡½æ•°ï¼šç”Ÿæˆç¡®å®šçš„åºåˆ—"""
    return [start + i for i in range(length)]

def format_timestamp(timestamp):
    """çº¯å‡½æ•°ï¼šæ ¼å¼åŒ–ç»™å®šçš„æ—¶é—´æˆ³"""
    return datetime.datetime.fromtimestamp(timestamp).strftime('%Y-%m-%d %H:%M:%S')

# ä½¿ç”¨çº¯å‡½æ•°
current = 0
for i in range(3):
    current = pure_increment(current)
    print(f"è®¡æ•°å™¨ï¼š{current}")

sequence = generate_sequence(10, 5)
print(f"åºåˆ—ï¼š{sequence}")  # [10, 11, 12, 13, 14]

timestamp = 1640995200  # å›ºå®šæ—¶é—´æˆ³
formatted_time = format_timestamp(timestamp)
print(f"æ ¼å¼åŒ–æ—¶é—´ï¼š{formatted_time}")
```

---

## äºŒã€é«˜é˜¶å‡½æ•°ï¼ˆHigher-Order Functionsï¼‰

### 2.1 å‡½æ•°ä½œä¸ºå‚æ•°

```python
def apply_operation(numbers, operation):
    """é«˜é˜¶å‡½æ•°ï¼šæ¥å—å‡½æ•°ä½œä¸ºå‚æ•°"""
    return [operation(num) for num in numbers]

def square(x):
    return x ** 2

def cube(x):
    return x ** 3

def double(x):
    return x * 2

# ä½¿ç”¨ä¸åŒçš„æ“ä½œå‡½æ•°
numbers = [1, 2, 3, 4, 5]

squared = apply_operation(numbers, square)
print(f"å¹³æ–¹ï¼š{squared}")  # [1, 4, 9, 16, 25]

cubed = apply_operation(numbers, cube)
print(f"ç«‹æ–¹ï¼š{cubed}")  # [1, 8, 27, 64, 125]

doubled = apply_operation(numbers, double)
print(f"ç¿»å€ï¼š{doubled}")  # [2, 4, 6, 8, 10]

# ä½¿ç”¨lambdaå‡½æ•°
halved = apply_operation(numbers, lambda x: x / 2)
print(f"å‡åŠï¼š{halved}")  # [0.5, 1.0, 1.5, 2.0, 2.5]
```

### 2.2 å‡½æ•°ä½œä¸ºè¿”å›å€¼

```python
def create_multiplier(factor):
    """è¿”å›ä¸€ä¸ªä¹˜æ³•å‡½æ•°"""
    def multiplier(x):
        return x * factor
    return multiplier

def create_validator(min_value, max_value):
    """è¿”å›ä¸€ä¸ªéªŒè¯å‡½æ•°"""
    def validator(value):
        return min_value <= value <= max_value
    return validator

def create_formatter(prefix, suffix):
    """è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–å‡½æ•°"""
    def formatter(text):
        return f"{prefix}{text}{suffix}"
    return formatter

# ä½¿ç”¨å‡½æ•°å·¥å‚
double_func = create_multiplier(2)
triple_func = create_multiplier(3)

print(double_func(5))  # 10
print(triple_func(5))  # 15

# åˆ›å»ºéªŒè¯å™¨
age_validator = create_validator(0, 120)
score_validator = create_validator(0, 100)

print(age_validator(25))   # True
print(age_validator(150))  # False
print(score_validator(85)) # True
print(score_validator(105)) # False

# åˆ›å»ºæ ¼å¼åŒ–å™¨
html_formatter = create_formatter("<p>", "</p>")
markdown_formatter = create_formatter("**", "**")

print(html_formatter("Hello"))     # <p>Hello</p>
print(markdown_formatter("Bold"))  # **Bold**
```

### 2.3 å‡½æ•°ç»„åˆ

```python
def compose(f, g):
    """å‡½æ•°ç»„åˆï¼šè¿”å› f(g(x))"""
    return lambda x: f(g(x))

def pipe(*functions):
    """ç®¡é“æ“ä½œï¼šä»å·¦åˆ°å³ä¾æ¬¡åº”ç”¨å‡½æ•°"""
    def piped_function(value):
        for func in functions:
            value = func(value)
        return value
    return piped_function

# åŸºç¡€å‡½æ•°
def add_one(x):
    return x + 1

def multiply_by_two(x):
    return x * 2

def square(x):
    return x ** 2

# å‡½æ•°ç»„åˆ
add_then_multiply = compose(multiply_by_two, add_one)
result1 = add_then_multiply(3)  # multiply_by_two(add_one(3)) = multiply_by_two(4) = 8
print(f"ç»„åˆç»“æœï¼š{result1}")

# ç®¡é“æ“ä½œ
process_number = pipe(add_one, multiply_by_two, square)
result2 = process_number(3)  # ((3+1)*2)^2 = (4*2)^2 = 8^2 = 64
print(f"ç®¡é“ç»“æœï¼š{result2}")

# å¤„ç†å­—ç¬¦ä¸²çš„ç®¡é“
def to_upper(s):
    return s.upper()

def add_exclamation(s):
    return s + "!"

def add_prefix(s):
    return ">>> " + s

process_text = pipe(to_upper, add_exclamation, add_prefix)
result3 = process_text("hello world")
print(f"æ–‡æœ¬å¤„ç†ï¼š{result3}")  # >>> HELLO WORLD!
```

---

## ä¸‰ã€å†…ç½®é«˜é˜¶å‡½æ•°æ·±å…¥

### 3.1 map()å‡½æ•°è¿›é˜¶

```python
# å¤„ç†å¤šä¸ªåºåˆ—
def add_three_numbers(x, y, z):
    return x + y + z

list1 = [1, 2, 3]
list2 = [10, 20, 30]
list3 = [100, 200, 300]

result = list(map(add_three_numbers, list1, list2, list3))
print(f"ä¸‰ä¸ªåˆ—è¡¨ç›¸åŠ ï¼š{result}")  # [111, 222, 333]

# å¤„ç†å­—å…¸
students = [
    {'name': 'Alice', 'score': 85},
    {'name': 'Bob', 'score': 92},
    {'name': 'Charlie', 'score': 78}
]

# æå–å§“å
names = list(map(lambda student: student['name'], students))
print(f"å­¦ç”Ÿå§“åï¼š{names}")  # ['Alice', 'Bob', 'Charlie']

# è®¡ç®—ç­‰çº§
def get_grade(score):
    if score >= 90:
        return 'A'
    elif score >= 80:
        return 'B'
    elif score >= 70:
        return 'C'
    else:
        return 'D'

grades = list(map(lambda s: get_grade(s['score']), students))
print(f"å­¦ç”Ÿç­‰çº§ï¼š{grades}")  # ['B', 'A', 'C']
```

### 3.2 filter()å‡½æ•°è¿›é˜¶

```python
# å¤æ‚è¿‡æ»¤æ¡ä»¶
numbers = range(1, 21)

# è¿‡æ»¤è´¨æ•°
def is_prime(n):
    if n < 2:
        return False
    for i in range(2, int(n ** 0.5) + 1):
        if n % i == 0:
            return False
    return True

primes = list(filter(is_prime, numbers))
print(f"è´¨æ•°ï¼š{primes}")  # [2, 3, 5, 7, 11, 13, 17, 19]

# è¿‡æ»¤å­—ç¬¦ä¸²
words = ['apple', 'banana', 'cherry', 'date', 'elderberry', 'fig']

# é•¿åº¦å¤§äº5ä¸”åŒ…å«'e'çš„å•è¯
filtered_words = list(filter(
    lambda word: len(word) > 5 and 'e' in word, 
    words
))
print(f"è¿‡æ»¤åçš„å•è¯ï¼š{filtered_words}")  # ['cherry', 'elderberry']

# è¿‡æ»¤å­¦ç”Ÿæ•°æ®
students = [
    {'name': 'Alice', 'age': 20, 'score': 85},
    {'name': 'Bob', 'age': 22, 'score': 92},
    {'name': 'Charlie', 'age': 19, 'score': 78},
    {'name': 'Diana', 'age': 21, 'score': 96}
]

# å¹´é¾„å¤§äº20ä¸”åˆ†æ•°å¤§äº80çš„å­¦ç”Ÿ
excellent_students = list(filter(
    lambda s: s['age'] > 20 and s['score'] > 80,
    students
))
print("ä¼˜ç§€å­¦ç”Ÿï¼š")
for student in excellent_students:
    print(f"  {student['name']}: {student['age']}å², {student['score']}åˆ†")
```

### 3.3 reduce()å‡½æ•°è¿›é˜¶

```python
from functools import reduce

# å¤æ‚çš„ç´¯ç§¯æ“ä½œ
numbers = [1, 2, 3, 4, 5]

# è®¡ç®—é˜¶ä¹˜
factorial = reduce(lambda x, y: x * y, numbers)
print(f"é˜¶ä¹˜ï¼š{factorial}")  # 120

# æ‰¾åˆ°æœ€å¤§å€¼å’Œæœ€å°å€¼
max_value = reduce(lambda x, y: x if x > y else y, numbers)
min_value = reduce(lambda x, y: x if x < y else y, numbers)
print(f"æœ€å¤§å€¼ï¼š{max_value}, æœ€å°å€¼ï¼š{min_value}")  # 5, 1

# å­—ç¬¦ä¸²æ“ä½œ
words = ['Python', 'is', 'awesome', 'for', 'programming']

# è¿æ¥å­—ç¬¦ä¸²
sentence = reduce(lambda x, y: x + ' ' + y, words)
print(f"å¥å­ï¼š{sentence}")  # Python is awesome for programming

# æ‰¾æœ€é•¿çš„å•è¯
longest_word = reduce(
    lambda x, y: x if len(x) > len(y) else y, 
    words
)
print(f"æœ€é•¿å•è¯ï¼š{longest_word}")  # programming

# å¤æ‚æ•°æ®ç»“æ„çš„å¤„ç†
orders = [
    {'id': 1, 'amount': 100},
    {'id': 2, 'amount': 250},
    {'id': 3, 'amount': 75},
    {'id': 4, 'amount': 300}
]

# è®¡ç®—æ€»é‡‘é¢
total_amount = reduce(
    lambda total, order: total + order['amount'],
    orders,
    0  # åˆå§‹å€¼
)
print(f"æ€»é‡‘é¢ï¼š{total_amount}")  # 725

# åˆå¹¶å­—å…¸
data_sources = [
    {'users': 100, 'posts': 500},
    {'users': 50, 'comments': 200},
    {'users': 75, 'likes': 1000}
]

merged_data = reduce(
    lambda acc, data: {**acc, **data},
    data_sources,
    {}
)
print(f"åˆå¹¶æ•°æ®ï¼š{merged_data}")
# {'users': 75, 'posts': 500, 'comments': 200, 'likes': 1000}
```

---

## å››ã€å‡½æ•°å¼ç¼–ç¨‹å·¥å…·

### 4.1 itertoolsæ¨¡å—

```python
import itertools

# itertools.chain - è¿æ¥å¤šä¸ªå¯è¿­ä»£å¯¹è±¡
list1 = [1, 2, 3]
list2 = [4, 5, 6]
list3 = [7, 8, 9]

chained = list(itertools.chain(list1, list2, list3))
print(f"è¿æ¥åˆ—è¡¨ï¼š{chained}")  # [1, 2, 3, 4, 5, 6, 7, 8, 9]

# itertools.cycle - æ— é™å¾ªç¯
cycler = itertools.cycle(['A', 'B', 'C'])
first_10 = [next(cycler) for _ in range(10)]
print(f"å¾ªç¯å‰10ä¸ªï¼š{first_10}")  # ['A', 'B', 'C', 'A', 'B', 'C', 'A', 'B', 'C', 'A']

# itertools.repeat - é‡å¤å…ƒç´ 
repeated = list(itertools.repeat('Hello', 5))
print(f"é‡å¤å…ƒç´ ï¼š{repeated}")  # ['Hello', 'Hello', 'Hello', 'Hello', 'Hello']

# itertools.takewhile - æ¡ä»¶ä¸ºçœŸæ—¶å–å…ƒç´ 
numbers = [1, 3, 5, 8, 9, 11, 13]
less_than_10 = list(itertools.takewhile(lambda x: x < 10, numbers))
print(f"å°äº10çš„è¿ç»­å…ƒç´ ï¼š{less_than_10}")  # [1, 3, 5, 8, 9]

# itertools.dropwhile - æ¡ä»¶ä¸ºçœŸæ—¶è·³è¿‡å…ƒç´ 
after_10 = list(itertools.dropwhile(lambda x: x < 10, numbers))
print(f"å¤§äºç­‰äº10çš„å…ƒç´ ï¼š{after_10}")  # [11, 13]

# itertools.groupby - åˆ†ç»„
data = [('A', 1), ('A', 2), ('B', 3), ('B', 4), ('C', 5)]
grouped = {k: list(g) for k, g in itertools.groupby(data, key=lambda x: x[0])}
print(f"åˆ†ç»„æ•°æ®ï¼š{grouped}")
# {'A': [('A', 1), ('A', 2)], 'B': [('B', 3), ('B', 4)], 'C': [('C', 5)]}
```

### 4.2 operatoræ¨¡å—

```python
import operator
from functools import reduce

# ä½¿ç”¨operatoræ¨¡å—æ›¿ä»£lambda
numbers = [1, 2, 3, 4, 5]

# æ±‚å’Œ
total = reduce(operator.add, numbers)
print(f"æ€»å’Œï¼š{total}")  # 15

# æ±‚ç§¯
product = reduce(operator.mul, numbers)
print(f"ä¹˜ç§¯ï¼š{product}")  # 120

# å­—ç¬¦ä¸²è¿æ¥
words = ['Hello', 'World', 'Python']
sentence = reduce(operator.add, words)
print(f"è¿æ¥å­—ç¬¦ä¸²ï¼š{sentence}")  # HelloWorldPython

# è·å–å±æ€§å’Œç´¢å¼•
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age
    
    def __repr__(self):
        return f"Person('{self.name}', {self.age})"

people = [
    Person('Alice', 25),
    Person('Bob', 30),
    Person('Charlie', 20)
]

# æŒ‰å¹´é¾„æ’åº
sorted_by_age = sorted(people, key=operator.attrgetter('age'))
print(f"æŒ‰å¹´é¾„æ’åºï¼š{sorted_by_age}")

# æŒ‰å§“åæ’åº
sorted_by_name = sorted(people, key=operator.attrgetter('name'))
print(f"æŒ‰å§“åæ’åºï¼š{sorted_by_name}")

# å¤„ç†å…ƒç»„åˆ—è¡¨
student_scores = [('Alice', 85), ('Bob', 92), ('Charlie', 78)]
sorted_by_score = sorted(student_scores, key=operator.itemgetter(1))
print(f"æŒ‰åˆ†æ•°æ’åºï¼š{sorted_by_score}")
```

### 4.3 functoolsæ¨¡å—è¿›é˜¶

```python
from functools import partial, wraps, lru_cache, singledispatch

# partial - åå‡½æ•°åº”ç”¨
def multiply(x, y, z):
    return x * y * z

# åˆ›å»ºåå‡½æ•°
double = partial(multiply, 2)  # å›ºå®šç¬¬ä¸€ä¸ªå‚æ•°ä¸º2
triple = partial(multiply, 3)  # å›ºå®šç¬¬ä¸€ä¸ªå‚æ•°ä¸º3

print(double(5, 6))  # 2 * 5 * 6 = 60
print(triple(4, 5))  # 3 * 4 * 5 = 60

# æ›´å¤æ‚çš„åå‡½æ•°
def log_message(level, message, timestamp=None):
    import datetime
    if timestamp is None:
        timestamp = datetime.datetime.now()
    return f"[{timestamp}] {level}: {message}"

# åˆ›å»ºç‰¹å®šçº§åˆ«çš„æ—¥å¿—å‡½æ•°
info_log = partial(log_message, "INFO")
error_log = partial(log_message, "ERROR")
warning_log = partial(log_message, "WARNING")

print(info_log("åº”ç”¨å¯åŠ¨"))
print(error_log("æ•°æ®åº“è¿æ¥å¤±è´¥"))
print(warning_log("å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"))

# lru_cache - ç¼“å­˜è£…é¥°å™¨
@lru_cache(maxsize=128)
def fibonacci(n):
    """å¸¦ç¼“å­˜çš„æ–æ³¢é‚£å¥‘å‡½æ•°"""
    if n < 2:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# æµ‹è¯•ç¼“å­˜æ•ˆæœ
import time

start = time.time()
result = fibonacci(35)
end = time.time()
print(f"fibonacci(35) = {result}, è€—æ—¶: {end - start:.4f}ç§’")

# ç¬¬äºŒæ¬¡è°ƒç”¨ä¼šå¾ˆå¿«ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
start = time.time()
result = fibonacci(35)
end = time.time()
print(f"fibonacci(35) = {result}, è€—æ—¶: {end - start:.6f}ç§’")

# singledispatch - å•åˆ†æ´¾æ³›å‹å‡½æ•°
@singledispatch
def process_data(data):
    """é»˜è®¤å¤„ç†å‡½æ•°"""
    return f"å¤„ç†æœªçŸ¥ç±»å‹: {type(data).__name__}"

@process_data.register
def _(data: int):
    return f"å¤„ç†æ•´æ•°: {data * 2}"

@process_data.register
def _(data: str):
    return f"å¤„ç†å­—ç¬¦ä¸²: {data.upper()}"

@process_data.register
def _(data: list):
    return f"å¤„ç†åˆ—è¡¨: {len(data)} ä¸ªå…ƒç´ "

# æµ‹è¯•å•åˆ†æ´¾
print(process_data(42))        # å¤„ç†æ•´æ•°: 84
print(process_data("hello"))   # å¤„ç†å­—ç¬¦ä¸²: HELLO
print(process_data([1,2,3]))   # å¤„ç†åˆ—è¡¨: 3 ä¸ªå…ƒç´ 
print(process_data(3.14))      # å¤„ç†æœªçŸ¥ç±»å‹: float
```

---

## äº”ã€ä¸å¯å˜æ•°æ®ç»“æ„

### 5.1 ä½¿ç”¨å…ƒç»„å’Œå‘½åå…ƒç»„

```python
from collections import namedtuple

# æ™®é€šå…ƒç»„
point = (3, 4)
print(f"ç‚¹åæ ‡ï¼š{point}")
print(f"xåæ ‡ï¼š{point[0]}, yåæ ‡ï¼š{point[1]}")

# å‘½åå…ƒç»„ - æ›´å…·å¯è¯»æ€§
Point = namedtuple('Point', ['x', 'y'])
point = Point(3, 4)
print(f"ç‚¹åæ ‡ï¼š{point}")
print(f"xåæ ‡ï¼š{point.x}, yåæ ‡ï¼š{point.y}")

# å‘½åå…ƒç»„çš„æ–¹æ³•
print(f"è½¬ä¸ºå­—å…¸ï¼š{point._asdict()}")
print(f"æ›¿æ¢å€¼ï¼š{point._replace(x=5)}")

# å¤æ‚çš„å‘½åå…ƒç»„
Student = namedtuple('Student', ['name', 'age', 'grade', 'scores'])
student = Student(
    name='Alice',
    age=20,
    grade='A',
    scores=(85, 92, 78, 96)
)

print(f"å­¦ç”Ÿä¿¡æ¯ï¼š{student}")
print(f"å¹³å‡åˆ†ï¼š{sum(student.scores) / len(student.scores):.2f}")

# å‡½æ•°å¼å¤„ç†å‘½åå…ƒç»„
def calculate_gpa(student):
    """è®¡ç®—GPAï¼ˆçº¯å‡½æ•°ï¼‰"""
    average = sum(student.scores) / len(student.scores)
    if average >= 90:
        return 4.0
    elif average >= 80:
        return 3.0
    elif average >= 70:
        return 2.0
    else:
        return 1.0

def update_grade(student, new_grade):
    """æ›´æ–°ç­‰çº§ï¼ˆè¿”å›æ–°å¯¹è±¡ï¼‰"""
    return student._replace(grade=new_grade)

gpa = calculate_gpa(student)
print(f"GPAï¼š{gpa}")

updated_student = update_grade(student, 'A+')
print(f"æ›´æ–°åçš„å­¦ç”Ÿï¼š{updated_student}")
print(f"åŸå­¦ç”Ÿä¸å˜ï¼š{student}")
```

### 5.2 frozensetçš„ä½¿ç”¨

```python
# frozenset - ä¸å¯å˜é›†åˆ
mutable_set = {1, 2, 3, 4, 5}
immutable_set = frozenset([1, 2, 3, 4, 5])

print(f"å¯å˜é›†åˆï¼š{mutable_set}")
print(f"ä¸å¯å˜é›†åˆï¼š{immutable_set}")

# frozensetå¯ä»¥ä½œä¸ºå­—å…¸çš„é”®
set_dict = {
    frozenset([1, 2]): "å°é›†åˆ",
    frozenset([1, 2, 3, 4, 5]): "å¤§é›†åˆ"
}

print(f"é›†åˆå­—å…¸ï¼š{set_dict}")

# å‡½æ•°å¼æ“ä½œfrozenset
def union_sets(*sets):
    """åˆå¹¶å¤šä¸ªé›†åˆ"""
    result = frozenset()
    for s in sets:
        result = result.union(s)
    return result

def filter_set(s, predicate):
    """è¿‡æ»¤é›†åˆå…ƒç´ """
    return frozenset(filter(predicate, s))

set1 = frozenset([1, 2, 3])
set2 = frozenset([3, 4, 5])
set3 = frozenset([5, 6, 7])

unioned = union_sets(set1, set2, set3)
print(f"åˆå¹¶é›†åˆï¼š{uniond}")

even_numbers = filter_set(uniond, lambda x: x % 2 == 0)
print(f"å¶æ•°ï¼š{even_numbers}")
```

---

## å…­ã€å‡½æ•°å¼ç¼–ç¨‹å®æˆ˜

### 6.1 æ•°æ®å¤„ç†ç®¡é“

```python
from functools import reduce
from typing import List, Dict, Any

# å­¦ç”Ÿæ•°æ®
students_data = [
    {'name': 'Alice', 'age': 20, 'scores': [85, 92, 78, 96], 'major': 'CS'},
    {'name': 'Bob', 'age': 22, 'scores': [76, 88, 82, 79], 'major': 'Math'},
    {'name': 'Charlie', 'age': 19, 'scores': [95, 87, 91, 93], 'major': 'CS'},
    {'name': 'Diana', 'age': 21, 'scores': [68, 74, 82, 79], 'major': 'Physics'},
    {'name': 'Eve', 'age': 20, 'scores': [89, 94, 87, 92], 'major': 'CS'}
]

# çº¯å‡½æ•°å®šä¹‰
def calculate_average(scores: List[int]) -> float:
    """è®¡ç®—å¹³å‡åˆ†"""
    return sum(scores) / len(scores)

def add_average_score(student: Dict[str, Any]) -> Dict[str, Any]:
    """æ·»åŠ å¹³å‡åˆ†å­—æ®µ"""
    return {
        **student,
        'average': calculate_average(student['scores'])
    }

def is_excellent_student(student: Dict[str, Any]) -> bool:
    """åˆ¤æ–­æ˜¯å¦ä¸ºä¼˜ç§€å­¦ç”Ÿï¼ˆå¹³å‡åˆ†>85ï¼‰"""
    return student['average'] > 85

def is_cs_major(student: Dict[str, Any]) -> bool:
    """åˆ¤æ–­æ˜¯å¦ä¸ºCSä¸“ä¸š"""
    return student['major'] == 'CS'

def get_student_summary(student: Dict[str, Any]) -> Dict[str, Any]:
    """è·å–å­¦ç”Ÿæ‘˜è¦ä¿¡æ¯"""
    return {
        'name': student['name'],
        'average': round(student['average'], 2),
        'major': student['major']
    }

# å‡½æ•°å¼æ•°æ®å¤„ç†ç®¡é“
def process_students(students: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
    """å¤„ç†å­¦ç”Ÿæ•°æ®çš„å®Œæ•´ç®¡é“"""
    return list(
        map(
            get_student_summary,
            filter(
                lambda s: is_excellent_student(s) and is_cs_major(s),
                map(add_average_score, students)
            )
        )
    )

# æ‰§è¡Œå¤„ç†
excellent_cs_students = process_students(students_data)
print("ä¼˜ç§€çš„CSä¸“ä¸šå­¦ç”Ÿï¼š")
for student in excellent_cs_students:
    print(f"  {student['name']}: {student['average']} ({student['major']})")

# ä½¿ç”¨reduceè®¡ç®—ç»Ÿè®¡ä¿¡æ¯
def calculate_stats(students: List[Dict[str, Any]]) -> Dict[str, float]:
    """è®¡ç®—ç»Ÿè®¡ä¿¡æ¯"""
    students_with_avg = list(map(add_average_score, students))
    
    total_avg = reduce(
        lambda acc, student: acc + student['average'],
        students_with_avg,
        0
    ) / len(students_with_avg)
    
    max_avg = reduce(
        lambda acc, student: max(acc, student['average']),
        students_with_avg,
        0
    )
    
    min_avg = reduce(
        lambda acc, student: min(acc, student['average']),
        students_with_avg,
        float('inf')
    )
    
    return {
        'total_average': round(total_avg, 2),
        'max_average': round(max_avg, 2),
        'min_average': round(min_avg, 2)
    }

stats = calculate_stats(students_data)
print(f"\nç»Ÿè®¡ä¿¡æ¯ï¼š{stats}")
```

### 6.2 å‡½æ•°å¼é…ç½®ç®¡ç†

```python
from functools import partial
from typing import Callable, Any

# é…ç½®éªŒè¯å‡½æ•°
def validate_range(min_val: float, max_val: float, value: float) -> bool:
    """éªŒè¯å€¼æ˜¯å¦åœ¨èŒƒå›´å†…"""
    return min_val <= value <= max_val

def validate_type(expected_type: type, value: Any) -> bool:
    """éªŒè¯ç±»å‹"""
    return isinstance(value, expected_type)

def validate_length(min_len: int, max_len: int, value: str) -> bool:
    """éªŒè¯å­—ç¬¦ä¸²é•¿åº¦"""
    return min_len <= len(value) <= max_len

# åˆ›å»ºç‰¹å®šçš„éªŒè¯å™¨
validate_port = partial(validate_range, 1, 65535)
validate_percentage = partial(validate_range, 0, 100)
validate_string = partial(validate_type, str)
validate_int = partial(validate_type, int)
validate_username = partial(validate_length, 3, 20)

# é…ç½®è§„åˆ™
config_rules = {
    'server_port': [validate_int, validate_port],
    'cpu_threshold': [validate_int, validate_percentage],
    'username': [validate_string, validate_username],
    'timeout': [validate_int, partial(validate_range, 1, 300)]
}

def validate_config(rules: Dict[str, List[Callable]], config: Dict[str, Any]) -> Dict[str, bool]:
    """éªŒè¯é…ç½®"""
    results = {}
    
    for key, validators in rules.items():
        if key in config:
            # æ‰€æœ‰éªŒè¯å™¨éƒ½å¿…é¡»é€šè¿‡
            results[key] = all(
                validator(config[key]) for validator in validators
            )
        else:
            results[key] = False
    
    return results

# æµ‹è¯•é…ç½®
test_config = {
    'server_port': 8080,
    'cpu_threshold': 85,
    'username': 'alice',
    'timeout': 30
}

validation_results = validate_config(config_rules, test_config)
print("é…ç½®éªŒè¯ç»“æœï¼š")
for key, is_valid in validation_results.items():
    status = "âœ“" if is_valid else "âœ—"
    print(f"  {key}: {status}")

# æ— æ•ˆé…ç½®æµ‹è¯•
invalid_config = {
    'server_port': 70000,  # è¶…å‡ºèŒƒå›´
    'cpu_threshold': 150,  # è¶…å‡ºç™¾åˆ†æ¯”èŒƒå›´
    'username': 'ab',      # å¤ªçŸ­
    'timeout': 500         # è¶…æ—¶æ—¶é—´å¤ªé•¿
}

invalid_results = validate_config(config_rules, invalid_config)
print("\næ— æ•ˆé…ç½®éªŒè¯ç»“æœï¼š")
for key, is_valid in invalid_results.items():
    status = "âœ“" if is_valid else "âœ—"
    print(f"  {key}: {status}")
```

### 6.3 å‡½æ•°å¼é”™è¯¯å¤„ç†

```python
from typing import Union, Callable, Any
from dataclasses import dataclass

# å®šä¹‰Resultç±»å‹ï¼ˆæ¨¡æ‹ŸRustçš„Resultï¼‰
@dataclass
class Success:
    value: Any
    
    def is_success(self) -> bool:
        return True
    
    def is_error(self) -> bool:
        return False
    
    def map(self, func: Callable) -> 'Union[Success, Error]':
        try:
            return Success(func(self.value))
        except Exception as e:
            return Error(str(e))
    
    def flat_map(self, func: Callable) -> 'Union[Success, Error]':
        try:
            return func(self.value)
        except Exception as e:
            return Error(str(e))

@dataclass
class Error:
    message: str
    
    def is_success(self) -> bool:
        return False
    
    def is_error(self) -> bool:
        return True
    
    def map(self, func: Callable) -> 'Error':
        return self
    
    def flat_map(self, func: Callable) -> 'Error':
        return self

Result = Union[Success, Error]

# å®‰å…¨çš„æ•°å­¦æ“ä½œ
def safe_divide(x: float, y: float) -> Result:
    """å®‰å…¨é™¤æ³•"""
    if y == 0:
        return Error("é™¤é›¶é”™è¯¯")
    return Success(x / y)

def safe_sqrt(x: float) -> Result:
    """å®‰å…¨å¼€æ–¹"""
    if x < 0:
        return Error("è´Ÿæ•°ä¸èƒ½å¼€æ–¹")
    return Success(x ** 0.5)

def safe_log(x: float) -> Result:
    """å®‰å…¨å¯¹æ•°"""
    if x <= 0:
        return Error("å¯¹æ•°çš„å‚æ•°å¿…é¡»å¤§äº0")
    import math
    return Success(math.log(x))

# å‡½æ•°å¼é”™è¯¯å¤„ç†é“¾
def calculate_complex_formula(a: float, b: float, c: float) -> Result:
    """è®¡ç®—å¤æ‚å…¬å¼ï¼šlog(sqrt(a/b) + c)"""
    return (safe_divide(a, b)
            .flat_map(lambda x: safe_sqrt(x))
            .map(lambda x: x + c)
            .flat_map(lambda x: safe_log(x)))

# æµ‹è¯•é”™è¯¯å¤„ç†
test_cases = [
    (16, 4, 1),   # æ­£å¸¸æƒ…å†µ
    (16, 0, 1),   # é™¤é›¶é”™è¯¯
    (-16, 4, 1),  # è´Ÿæ•°å¼€æ–¹é”™è¯¯
    (16, 4, -3),  # å¯¹æ•°å‚æ•°é”™è¯¯
]

print("å¤æ‚å…¬å¼è®¡ç®—ç»“æœï¼š")
for a, b, c in test_cases:
    result = calculate_complex_formula(a, b, c)
    if result.is_success():
        print(f"  f({a}, {b}, {c}) = {result.value:.4f}")
    else:
        print(f"  f({a}, {b}, {c}) = é”™è¯¯: {result.message}")

# æ‰¹é‡å¤„ç†
def process_batch(data: List[tuple], processor: Callable) -> Dict[str, List]:
    """æ‰¹é‡å¤„ç†æ•°æ®"""
    successes = []
    errors = []
    
    for item in data:
        result = processor(*item)
        if result.is_success():
            successes.append((item, result.value))
        else:
            errors.append((item, result.message))
    
    return {'successes': successes, 'errors': errors}

batch_results = process_batch(test_cases, calculate_complex_formula)
print(f"\næ‰¹é‡å¤„ç†ç»“æœï¼š")
print(f"æˆåŠŸ: {len(batch_results['successes'])} ä¸ª")
print(f"å¤±è´¥: {len(batch_results['errors'])} ä¸ª")
```

---

## ä¸ƒã€æ€»ç»“

### 7.1 å‡½æ•°å¼ç¼–ç¨‹çš„ä¼˜åŠ¿

1. **å¯é¢„æµ‹æ€§**ï¼šçº¯å‡½æ•°ä½¿ä»£ç è¡Œä¸ºå¯é¢„æµ‹
2. **å¯æµ‹è¯•æ€§**ï¼šçº¯å‡½æ•°æ˜“äºå•å…ƒæµ‹è¯•
3. **å¯ç»„åˆæ€§**ï¼šå‡½æ•°å¯ä»¥è½»æ¾ç»„åˆæˆå¤æ‚æ“ä½œ
4. **å¹¶å‘å®‰å…¨**ï¼šä¸å¯å˜æ•°æ®é¿å…äº†å¹¶å‘é—®é¢˜
5. **ä»£ç ç®€æ´**ï¼šé«˜é˜¶å‡½æ•°å‡å°‘é‡å¤ä»£ç 

### 7.2 ä½•æ—¶ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹

**é€‚åˆçš„åœºæ™¯ï¼š**
- æ•°æ®è½¬æ¢å’Œå¤„ç†
- é…ç½®éªŒè¯
- æ•°å­¦è®¡ç®—
- å¹¶å‘ç¼–ç¨‹
- éœ€è¦é«˜å¯é æ€§çš„ç³»ç»Ÿ

**ä¸å¤ªé€‚åˆçš„åœºæ™¯ï¼š**
- éœ€è¦é¢‘ç¹ä¿®æ”¹çŠ¶æ€çš„åº”ç”¨
- æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
- ç®€å•çš„è„šæœ¬ä»»åŠ¡

### 7.3 æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨çº¯å‡½æ•°**ï¼šé¿å…å‰¯ä½œç”¨
2. **ä¿æŒå‡½æ•°ç®€å•**ï¼šä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹
3. **ä½¿ç”¨ç±»å‹æ³¨è§£**ï¼šæé«˜ä»£ç å¯è¯»æ€§
4. **åˆç†ä½¿ç”¨é«˜é˜¶å‡½æ•°**ï¼šä¸è¦è¿‡åº¦æŠ½è±¡
5. **ç»“åˆå…¶ä»–èŒƒå¼**ï¼šPythonæ”¯æŒå¤šç§ç¼–ç¨‹èŒƒå¼

### 7.4 ä¸‹ä¸€æ­¥å­¦ä¹ 

- **æ·±å…¥å­¦ä¹ itertoolså’Œfunctools**
- **äº†è§£æ›´å¤šå‡½æ•°å¼ç¼–ç¨‹åº“**ï¼ˆå¦‚toolzï¼‰
- **å­¦ä¹ å…¶ä»–å‡½æ•°å¼è¯­è¨€**ï¼ˆå¦‚Haskellã€Clojureï¼‰
- **å®è·µå‡½æ•°å¼è®¾è®¡æ¨¡å¼**

æ­å–œä½ ï¼æŒæ¡äº†å‡½æ•°å¼ç¼–ç¨‹ï¼Œä½ çš„PythonæŠ€èƒ½åˆä¸Šäº†ä¸€ä¸ªæ–°å°é˜¶ï¼ğŸ‰

---

**ç»ƒä¹ å»ºè®®ï¼š**
1. é‡æ„ç°æœ‰ä»£ç ï¼Œä½¿ç”¨çº¯å‡½æ•°
2. ç»ƒä¹ ä½¿ç”¨mapã€filterã€reduceå¤„ç†æ•°æ®
3. å°è¯•å‡½æ•°ç»„åˆå’Œç®¡é“æ“ä½œ
4. å®ç°è‡ªå·±çš„é«˜é˜¶å‡½æ•°
5. ç”¨å‡½æ•°å¼æ–¹æ³•è§£å†³å®é™…é—®é¢˜






























