<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第19天-电子邮件 | Jeskson-微服务分布式</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Jeskson文档-架构师">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/JavaPlusDoc/assets/css/0.styles.69a89f58.css" as="style"><link rel="preload" href="/JavaPlusDoc/assets/js/app.ff4b1912.js" as="script"><link rel="preload" href="/JavaPlusDoc/assets/js/7.dfc0397a.js" as="script"><link rel="preload" href="/JavaPlusDoc/assets/js/2.cfbace72.js" as="script"><link rel="preload" href="/JavaPlusDoc/assets/js/1.d59a348b.js" as="script"><link rel="preload" href="/JavaPlusDoc/assets/js/136.51486790.js" as="script"><link rel="prefetch" href="/JavaPlusDoc/assets/js/10.8af913bb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/100.2c53fcbd.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/101.8ccd9f40.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/102.6abe231e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/103.0e437ead.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/104.d915d7e5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/105.5d55ab62.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/106.07d5a34b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/107.513f25ac.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/108.7cda8012.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/109.b70451e6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/11.7e3aeb50.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/110.b8dbdfb8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/111.71acaa8b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/112.ca35903a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/113.2db92a40.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/114.6e775813.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/115.d4fcd4df.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/116.5fbd9309.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/117.67d2a408.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/118.458ec435.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/119.044db67a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/120.433d403c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/121.4a247941.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/122.edf76321.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/123.24f157cc.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/124.8d2eafc2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/125.9fcad17b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/126.ea0c1e50.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/127.eb6e5a6c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/128.c37745dd.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/129.d42e1da1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/130.1f940759.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/131.f048f51b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/132.f2e05b7b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/133.1025c747.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/134.e986b5c6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/135.ee67ecb2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/137.7afd61da.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/138.a9b7f1d5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/139.b0abdadb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/140.928f8b9d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/141.75ac97ba.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/142.e4a40851.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/143.abb68380.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/144.4a31149b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/145.4a204821.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/146.df6efac7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/147.35f39f6d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/148.8f687af8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/149.75598127.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/15.ab64ce54.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/150.7c950dfa.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/151.1a568fbd.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/152.39d4b618.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/153.f7912ca4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/154.a7e8c404.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/155.11719bb5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/156.b0f61c27.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/157.78f0d5ec.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/158.96bd7aa7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/159.c826f336.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/16.5859debf.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/160.79fcd999.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/161.6e041a18.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/162.c1dd8613.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/163.ab44d65f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/164.55f30c4b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/165.1945cc91.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/166.7ce08c0a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/167.39902e9e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/168.0a015885.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/169.68d1a118.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/17.f3af3709.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/170.284bccfc.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/171.8abc7f27.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/172.1fda5d51.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/173.bb2d4d2b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/174.b34f63a3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/175.28b93c68.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/176.7c670e26.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/177.5163bae9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/178.51467a77.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/179.9738c734.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/18.7387f7e6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/180.ec8da569.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/181.321020b2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/182.eaa16e7a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/183.fd9bacb6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/184.987ef50e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/185.65f18305.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/186.ece5c753.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/187.b0e4a1ac.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/188.5ac430dd.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/189.e5a35218.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/19.f4fea483.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/190.0d633d69.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/191.cb84e758.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/192.5696bda6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/193.c152ca1b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/194.58104929.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/195.f5268146.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/196.09b66f73.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/197.ac23f446.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/198.261200a2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/199.724aa135.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/20.070d4a3f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/200.2fc8b0b5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/201.8d7b1f57.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/202.b803e840.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/203.2eff0b6c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/204.d5a4c7c6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/205.88bbae92.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/206.cd68581c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/207.85c260ec.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/208.fd085d80.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/209.d2453e08.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/21.78933f38.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/210.116334ba.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/211.345d1772.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/212.1a27f8c9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/213.59877e34.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/214.6480dee2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/215.70ae1d89.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/216.09ca4312.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/217.af7bdf8c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/218.02a40cca.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/219.f484832f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/22.4753ae4d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/220.6ba39f2b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/221.d585a6e3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/222.557543ae.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/223.5140b6e5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/224.eaa0e691.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/225.356a94a3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/226.fc10b75b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/227.9af00c34.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/228.4dc3c41b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/229.d11b02a5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/23.5ad2a326.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/230.519fdeb6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/231.680b752e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/232.1adf38e1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/233.fcc3e8cc.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/234.7295f17c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/235.860622cd.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/236.07a1c33e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/237.8b3b18c5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/238.02b07b10.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/239.4b1eaae1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/24.d8ef76cb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/240.7a378249.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/241.50826979.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/242.a827cb6e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/243.02ee6149.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/244.95a1f931.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/245.839cc4a8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/246.a8298108.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/247.17c29ff6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/248.076346b6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/249.a5694c3b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/25.56c87efe.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/250.db53d9fa.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/251.e5678920.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/252.4a97a73b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/253.fab94cc6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/254.f6fe60a9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/255.5c90176f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/256.51b253fa.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/257.7545eceb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/258.d30ea980.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/259.19f6dd5e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/26.e137a506.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/260.b45fa309.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/261.b82f3b68.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/262.66dbb3e0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/263.1bd0b88a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/264.e2d16987.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/265.a999dac8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/266.0e3ffc82.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/267.31bcc9c4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/268.21cadd7e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/269.6d41a49b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/27.8fd1e34f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/270.cdc34c03.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/271.14d67f07.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/272.6b7ef511.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/273.29143d7e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/274.98c8d414.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/275.fcbb9b74.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/276.57d87a0b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/277.f32479eb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/278.6c8f70ff.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/279.ee430fb0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/28.ec80e187.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/280.6482b349.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/281.a146cd78.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/282.859de97e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/283.c15404e4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/284.01dad2ca.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/285.619be44a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/286.d242787c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/287.c87ab04d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/288.e030d44a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/289.59a5a660.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/29.a2b39230.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/290.eab48a51.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/291.1f4b1e47.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/292.a13c9a99.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/293.b4eb7ce5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/294.d4abf953.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/295.8daf6058.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/296.368c24d4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/297.3f74b182.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/298.6988474c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/299.dfad3465.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/3.40e3acc6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/30.9a11650a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/300.17321217.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/301.d9a1826e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/302.09a7987d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/303.5025013f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/304.d4b8a3d1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/305.159772d2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/306.24c63e31.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/307.e6a6d270.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/308.4e507498.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/309.aee111c8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/31.874f8153.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/310.5f1b5ca1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/311.34ae5cb3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/312.c43ea236.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/313.b847ec00.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/314.d64f5684.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/315.7d106bd1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/316.867e71e0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/317.494bb25c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/318.b855401a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/319.6ac2e09f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/32.ee0b114a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/320.5c40f84e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/321.f2cf33ad.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/322.3fa8fc56.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/323.8a4d04ec.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/324.8105e17f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/325.2550dcad.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/326.c3ff61c8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/327.3a7ecc7c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/328.fed3b915.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/329.827908ae.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/33.cd82de30.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/330.937816d2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/331.c852bfdf.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/332.c505b6c7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/333.bef6e033.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/334.08a55ffe.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/335.6b268219.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/336.82d3fb2a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/337.39956547.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/338.6136640d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/339.81f5ad5b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/34.9c90a2a7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/340.48782f66.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/341.d47516d3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/342.4436bb4a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/343.908c9bd3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/344.697ee8bd.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/345.ab9f1f75.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/346.076fd1c5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/347.3be42a59.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/348.97ba33db.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/349.3c07d100.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/35.d8543719.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/350.ec1bc3db.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/351.9d3153e4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/352.e71317f4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/353.261cb101.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/354.f3e47221.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/355.b307a3ed.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/356.b38d86c2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/357.d1d9dc9d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/358.a03fc094.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/359.6b15776d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/36.ca9f16ca.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/360.bb0c54dd.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/361.35cefb19.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/362.56d3b2f7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/363.86a26ed2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/364.94d338d5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/365.07637682.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/366.575090a7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/367.a24af406.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/368.84aaad95.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/369.878f8b2f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/37.21403d6a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/370.dd867f9d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/371.dd80e718.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/372.c7b54b81.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/373.e2554640.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/374.b9b710d2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/375.c9ad50e0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/376.9b86837b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/377.05760818.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/378.12ec82d0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/379.173b0296.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/38.bc6b1c3c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/380.d0bdf0e1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/381.79d7a925.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/382.2c726e6e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/383.c3692568.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/384.7d008b7d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/385.08ce6856.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/386.12bb7596.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/387.4ee785b3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/388.ebe74e39.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/389.05b70f9b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/39.8a7f24eb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/390.bdcfda98.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/391.5f2295e0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/392.8e12903a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/393.c553ee9b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/394.142fba6a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/395.2330c45a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/396.a7c9d0aa.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/397.e8412077.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/398.464f44c4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/399.aaa72c53.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/4.8b5d3c01.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/40.98ac2f84.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/400.154963b8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/401.894a8c6f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/402.8f683588.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/403.b8dbd9cb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/404.fc97c865.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/405.398fff13.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/406.ada3f6c6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/407.46666ee3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/408.39295bc5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/409.00710db4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/41.b36c815d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/410.0cb22004.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/411.e5923416.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/412.f58d3da9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/413.0f6f7f8b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/414.015eb6b2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/415.b155b195.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/416.3244bedb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/417.26b9b844.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/418.37dd3bda.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/419.4a64bc57.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/42.8c4dfaf7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/420.15ff5f8b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/421.988f32c6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/422.75528a99.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/423.366db802.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/424.508f7b6c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/425.6f763bb5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/426.659742ea.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/427.8b3d75d8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/428.2f29aadb.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/429.2f28db07.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/43.815d0502.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/430.abf10612.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/431.9e64562c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/432.99f2f904.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/433.6296d93e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/434.f7904247.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/435.98715d2d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/436.9fefac84.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/437.fea151e9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/438.7191b005.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/439.f3ccd045.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/44.ba19f402.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/440.2de0c08c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/441.8e3cb7b2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/442.b93b4817.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/443.39c48a3a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/444.1655e664.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/445.97e47e06.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/446.d2adebf8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/447.4be86ce4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/448.0b587761.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/449.ddf18f4c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/45.4182ef1e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/450.28fa53ca.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/451.ef5b2bd0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/452.e121c917.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/453.c8132e49.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/454.2432fab6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/455.34584ef6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/456.9903968f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/457.63aa6849.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/458.0b9d9b23.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/459.9f021166.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/46.2a154851.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/460.a629ff70.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/461.d75e8448.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/462.552a8aef.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/463.ec331fd1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/464.1890b541.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/465.2a0bd1b9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/466.610de9f1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/467.2d46b708.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/468.04a56bcc.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/469.7d6a224c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/47.9b096bd4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/470.da81c67e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/471.e592f995.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/472.bc085169.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/473.0cb79355.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/474.7f396d93.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/475.e2adea36.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/476.8b82e0ff.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/477.8bd4fa06.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/478.3fa4b579.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/479.6029394b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/48.fff8acb7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/480.1eb05b6f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/481.18496764.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/482.11a56dce.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/483.285ea6df.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/484.b15c921d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/485.53d859c3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/486.4680c312.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/487.2376b70e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/488.bd4ff8a8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/489.7c19b407.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/49.510ceb1b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/490.5c95e6f9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/491.c22e75d5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/492.e7342ffc.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/493.7e251855.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/494.b4a9a5ea.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/495.36fc9e68.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/496.7616b0ef.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/497.a627b99d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/498.e6ec30be.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/499.9f8c621b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/5.dd2e9586.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/50.1c015ec1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/500.e4f04fa7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/501.23e805ce.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/502.c7707c65.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/503.3f577d77.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/504.5fd17fd2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/505.0e03be2a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/506.e87bada7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/507.2b245401.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/508.87b73a39.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/509.cc69075a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/51.fa0d4ce8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/510.6490c5fe.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/511.be7a1d82.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/512.c680c2c9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/513.36b29e3e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/514.d3ae3a27.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/515.cdb5681f.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/516.469418ff.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/517.24928bff.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/518.6a26365b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/519.59e59dea.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/52.03c9ff54.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/520.23673bd1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/521.a5806db8.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/522.73be9af3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/523.0e7e4925.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/524.327700e3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/525.c768492d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/526.febcc9d9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/527.dd5fd0b5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/528.7e1d4ec5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/529.8bdce1a4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/53.7e80043a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/530.44e010d9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/531.f67a86b7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/532.09b7ead5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/533.7adabdfa.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/534.f868f74a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/535.c98d4c0e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/536.370ce042.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/537.753a8af1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/538.d017f77d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/539.a133376e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/54.f7955daf.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/540.f4dbc9d0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/55.686f3985.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/56.cb0430ac.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/57.eb834e65.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/58.bf089253.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/59.14efcce4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/6.bab6d49b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/60.eaf6e3a4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/61.3bbdc790.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/62.38f6d5ec.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/63.02f1b305.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/64.1722673d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/65.6547e007.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/66.4e8931dc.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/67.cfca24ed.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/68.8add83f1.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/69.1693fd1e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/70.179cc187.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/71.313fbab6.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/72.0e0d03ef.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/73.9b65b544.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/74.b4c4befd.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/75.f2ffd04c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/76.d8a485ae.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/77.df0cc69e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/78.63985859.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/79.1b530da0.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/8.482e3594.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/80.48deda5a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/81.26d7dd05.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/82.526c2b16.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/83.a00c4a7e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/84.f55a4b6a.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/85.62ab46e7.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/86.82d619c9.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/87.e726803b.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/88.a864fe77.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/89.dee71f5d.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/9.cb5e384c.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/90.f1aadb95.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/91.94144a2e.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/92.72d39ce5.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/93.b68bfc16.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/94.8957be11.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/95.eb9d19f3.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/96.093d0db2.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/97.5ba97253.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/98.6bf338d4.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/99.ba035d72.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/vendors~docsearch.0b3f4b62.js"><link rel="prefetch" href="/JavaPlusDoc/assets/js/vendors~flowchart.2a4bfc54.js">
    <link rel="stylesheet" href="/JavaPlusDoc/assets/css/0.styles.69a89f58.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Jeskson-微服务分布式</h3> <p class="description" data-v-59e6cb88>Jeskson文档-架构师</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2025
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/JavaPlusDoc/" class="home-link router-link-active"><!----> <span class="site-name">Jeskson-微服务分布式</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/JavaPlusDoc/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      学习路线
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/" class="nav-link"><i class="undefined"></i>
  入门指南
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/basic-grammar/basic-data-type.html" class="nav-link"><i class="undefined"></i>
  基础到进阶
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/high-concurrency/why-cache.html" class="nav-link"><i class="undefined"></i>
  架构师成长
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      刷题练习
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/" class="nav-link"><i class="undefined"></i>
  🎯 题库首页
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/topics/" class="nav-link"><i class="undefined"></i>
  📚 专题练习
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/written-exam/" class="nav-link"><i class="undefined"></i>
  📝 笔试真题
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/interview/" class="nav-link"><i class="undefined"></i>
  💼 面试真题
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/contest/" class="nav-link"><i class="undefined"></i>
  🏆 竞赛题库
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/statistics/" class="nav-link"><i class="undefined"></i>
  📊 刷题统计
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      技术分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/basic-grammar/basic-data-type.html" class="nav-link"><i class="undefined"></i>
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/java-up/nginx.html" class="nav-link"><i class="undefined"></i>
  Java进阶
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/go/" class="nav-link"><i class="undefined"></i>
  GO语言技术
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/iot/" class="nav-link"><i class="undefined"></i>
  物联网架构
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/high-concurrency/why-cache.html" class="nav-link"><i class="undefined"></i>
  分布式架构
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/worker/1.html" class="nav-link"><i class="undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/mysql/mysql.html" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/sql/" class="nav-link"><i class="undefined"></i>
  SQL专属手册
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/linux/linux.html" class="nav-link"><i class="undefined"></i>
  运维与部署
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/docker/docker-tutorial.html" class="nav-link"><i class="undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/uniapp/充电宝小程序实现.html" class="nav-link"><i class="undefined"></i>
  UniApp小程序
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/products/" class="nav-link"><i class="undefined"></i>
  产品系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      实战案例
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/worker/1.html" class="nav-link"><i class="undefined"></i>
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/high-concurrency/why-cache.html" class="nav-link"><i class="undefined"></i>
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/java-up/nginx.html" class="nav-link"><i class="undefined"></i>
  项目实践
</a></li><li class="dropdown-item"><!----> <a href="https://1024bibi.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  📝 简历制作工具
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      资源
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://webvueblog.github.io/JavaPlusDoc/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/webVueBlog/JavaPlusDoc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub仓库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/webVueBlog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  作者主页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/wechat-contact-demo.html" class="nav-link"><i class="undefined"></i>
  微信联系
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>496</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>22</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/JavaPlusDoc/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      学习路线
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/" class="nav-link"><i class="undefined"></i>
  入门指南
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/basic-grammar/basic-data-type.html" class="nav-link"><i class="undefined"></i>
  基础到进阶
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/high-concurrency/why-cache.html" class="nav-link"><i class="undefined"></i>
  架构师成长
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      刷题练习
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/" class="nav-link"><i class="undefined"></i>
  🎯 题库首页
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/topics/" class="nav-link"><i class="undefined"></i>
  📚 专题练习
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/written-exam/" class="nav-link"><i class="undefined"></i>
  📝 笔试真题
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/interview/" class="nav-link"><i class="undefined"></i>
  💼 面试真题
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/contest/" class="nav-link"><i class="undefined"></i>
  🏆 竞赛题库
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/coding-practice/statistics/" class="nav-link"><i class="undefined"></i>
  📊 刷题统计
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      技术分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/basic-grammar/basic-data-type.html" class="nav-link"><i class="undefined"></i>
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/java-up/nginx.html" class="nav-link"><i class="undefined"></i>
  Java进阶
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/go/" class="nav-link"><i class="undefined"></i>
  GO语言技术
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/iot/" class="nav-link"><i class="undefined"></i>
  物联网架构
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/high-concurrency/why-cache.html" class="nav-link"><i class="undefined"></i>
  分布式架构
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/worker/1.html" class="nav-link"><i class="undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/mysql/mysql.html" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/sql/" class="nav-link"><i class="undefined"></i>
  SQL专属手册
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/linux/linux.html" class="nav-link"><i class="undefined"></i>
  运维与部署
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/docker/docker-tutorial.html" class="nav-link"><i class="undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/uniapp/充电宝小程序实现.html" class="nav-link"><i class="undefined"></i>
  UniApp小程序
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/products/" class="nav-link"><i class="undefined"></i>
  产品系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      实战案例
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/worker/1.html" class="nav-link"><i class="undefined"></i>
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/high-concurrency/why-cache.html" class="nav-link"><i class="undefined"></i>
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/java-up/nginx.html" class="nav-link"><i class="undefined"></i>
  项目实践
</a></li><li class="dropdown-item"><!----> <a href="https://1024bibi.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  📝 简历制作工具
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      资源
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://webvueblog.github.io/JavaPlusDoc/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/webVueBlog/JavaPlusDoc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub仓库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/webVueBlog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  作者主页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/JavaPlusDoc/wechat-contact-demo.html" class="nav-link"><i class="undefined"></i>
  微信联系
</a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/JavaPlusDoc/" class="sidebar-heading clickable router-link-active open"><span>文档指南</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/" aria-current="page" class="sidebar-link">学前必读</a></li><li><a href="/JavaPlusDoc/encrypted-article.html" class="sidebar-link">加密文章示例</a></li><li><a href="/JavaPlusDoc/plugin-demo.html" class="sidebar-link">插件功能演示</a></li><li><a href="/JavaPlusDoc/share-demo.html" class="sidebar-link">社交分享功能演示</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>后端专属笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>达达JAVA基础问答</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/basic/1.html" class="sidebar-link">第1天-第一个程序</a></li><li><a href="/JavaPlusDoc/basic/2.html" class="sidebar-link">第2天-基础语法</a></li><li><a href="/JavaPlusDoc/basic/3.html" class="sidebar-link">第3天-基本概念</a></li><li><a href="/JavaPlusDoc/basic/4.html" class="sidebar-link">第4天-基本数据类型</a></li><li><a href="/JavaPlusDoc/basic/5.html" class="sidebar-link">第5天-变量的声明实例</a></li><li><a href="/JavaPlusDoc/basic/6.html" class="sidebar-link">第6天-变量命名规则</a></li><li><a href="/JavaPlusDoc/basic/7.html" class="sidebar-link">第7天-修饰符</a></li><li><a href="/JavaPlusDoc/basic/8.html" class="sidebar-link">第8天-运算符</a></li><li><a href="/JavaPlusDoc/basic/9.html" class="sidebar-link">第9天-循环结构</a></li><li><a href="/JavaPlusDoc/basic/10.html" class="sidebar-link">第10天-条件语句</a></li><li><a href="/JavaPlusDoc/basic/11.html" class="sidebar-link">第11天-switch-case</a></li><li><a href="/JavaPlusDoc/basic/12.html" class="sidebar-link">第12天-Number-Math类</a></li><li><a href="/JavaPlusDoc/basic/13.html" class="sidebar-link">第13天-Character</a></li><li><a href="/JavaPlusDoc/basic/14.html" class="sidebar-link">第14天-String</a></li><li><a href="/JavaPlusDoc/basic/15.html" class="sidebar-link">第15天-StringBuffer</a></li><li><a href="/JavaPlusDoc/basic/16.html" class="sidebar-link">第16天-数组</a></li><li><a href="/JavaPlusDoc/basic/17.html" class="sidebar-link">第17天-日期时间</a></li><li><a href="/JavaPlusDoc/basic/18.html" class="sidebar-link">第18天-正则表达式</a></li><li><a href="/JavaPlusDoc/basic/19.html" class="sidebar-link">第19天-方法</a></li><li><a href="/JavaPlusDoc/basic/20.html" class="sidebar-link">第20天-构造方法</a></li><li><a href="/JavaPlusDoc/basic/21.html" class="sidebar-link">第21天-流</a></li><li><a href="/JavaPlusDoc/basic/22.html" class="sidebar-link">第22天-异常处理</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>达达JAVA写法思路</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/basic/23.html" class="sidebar-link">第23天-继承的概念</a></li><li><a href="/JavaPlusDoc/basic/24.html" class="sidebar-link">第24天-重写与重载</a></li><li><a href="/JavaPlusDoc/basic/25.html" class="sidebar-link">第25天-多态</a></li><li><a href="/JavaPlusDoc/basic/26.html" class="sidebar-link">第26天-抽象类</a></li><li><a href="/JavaPlusDoc/basic/27.html" class="sidebar-link">第27天-封装</a></li><li><a href="/JavaPlusDoc/basic/28.html" class="sidebar-link">第28天-接口</a></li><li><a href="/JavaPlusDoc/basic/29.html" class="sidebar-link">第29天-枚举</a></li><li><a href="/JavaPlusDoc/basic/30.html" class="sidebar-link">第30天-反射</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>达达JAVA进阶教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/basicUp/31.html" class="sidebar-link">第31天-数据结构</a></li><li><a href="/JavaPlusDoc/basicUp/32.html" class="sidebar-link">第32天-集合框架</a></li><li><a href="/JavaPlusDoc/basicUp/33.html" class="sidebar-link">第33天-ArrayList</a></li><li><a href="/JavaPlusDoc/basicUp/34.html" class="sidebar-link">第34天-LinkedList</a></li><li><a href="/JavaPlusDoc/basicUp/35.html" class="sidebar-link">第35天-HashSet</a></li><li><a href="/JavaPlusDoc/basicUp/36.html" class="sidebar-link">第36天-HashMap</a></li><li><a href="/JavaPlusDoc/basicUp/37.html" class="sidebar-link">第37天-Iterator</a></li><li><a href="/JavaPlusDoc/basicUp/38.html" class="sidebar-link">第38天-Object</a></li><li><a href="/JavaPlusDoc/basicUp/39.html" class="sidebar-link">第39天-NIO</a></li><li><a href="/JavaPlusDoc/basicUp/40.html" class="sidebar-link">第40天-泛型</a></li><li><a href="/JavaPlusDoc/basicUp/41.html" class="sidebar-link">第41天-序列化</a></li><li><a href="/JavaPlusDoc/basicUp/42.html" class="sidebar-link">第42天-网络编程</a></li><li><a href="/JavaPlusDoc/basicUp/43.html" class="sidebar-link">第43天-发送邮件</a></li><li><a href="/JavaPlusDoc/basicUp/44.html" class="sidebar-link">第44天-多线程编程</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>刷题练习平台</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/coding-practice/" class="sidebar-link">题库导航</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/JavaPlusDoc/coding-practice/topics/" class="sidebar-heading clickable"><span>📝 专题练习</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/JavaPlusDoc/coding-practice/written-exam/" class="sidebar-heading clickable"><span>📝 笔试真题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/JavaPlusDoc/coding-practice/interview/" class="sidebar-heading clickable"><span>💼 面试真题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/JavaPlusDoc/coding-practice/contest/" class="sidebar-heading clickable"><span>🏆 竞赛题库</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/JavaPlusDoc/coding-practice/statistics/" class="sidebar-heading clickable"><span>📊 学习统计</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>SQL专属笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/sql/" class="sidebar-link">手册简介</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>基础语法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/sql/basic/syntax.html" class="sidebar-link">SQL基础语法</a></li><li><a href="/JavaPlusDoc/sql/basic/data-types.html" class="sidebar-link">数据类型</a></li><li><a href="/JavaPlusDoc/sql/basic/constraints.html" class="sidebar-link">约束条件</a></li><li><a href="/JavaPlusDoc/sql/basic/ddl.html" class="sidebar-link">DDL数据定义语言</a></li><li><a href="/JavaPlusDoc/sql/basic/dml.html" class="sidebar-link">DML数据操作语言</a></li><li><a href="/JavaPlusDoc/sql/basic/dql.html" class="sidebar-link">DQL数据查询语言</a></li><li><a href="/JavaPlusDoc/sql/basic/dcl.html" class="sidebar-link">DCL数据控制语言</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>查询操作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/sql/query/select-basic.html" class="sidebar-link">SELECT查询基础</a></li><li><a href="/JavaPlusDoc/sql/query/where.html" class="sidebar-link">WHERE条件查询</a></li><li><a href="/JavaPlusDoc/sql/query/join.html" class="sidebar-link">JOIN表连接</a></li><li><a href="/JavaPlusDoc/sql/query/subquery.html" class="sidebar-link">子查询</a></li><li><a href="/JavaPlusDoc/sql/query/group-by.html" class="sidebar-link">GROUP BY分组</a></li><li><a href="/JavaPlusDoc/sql/query/order-by.html" class="sidebar-link">ORDER BY排序</a></li><li><a href="/JavaPlusDoc/sql/query/pagination.html" class="sidebar-link">分页查询</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/sql/perfor/indexr.html" class="sidebar-link">性能优化概述</a></li><li><a href="/JavaPlusDoc/sql/perfor/indexes.html" class="sidebar-link">索引原理与应用</a></li><li><a href="/JavaPlusDoc/sql/perfor/query-optimization.html" class="sidebar-link">查询优化</a></li><li><a href="/JavaPlusDoc/sql/perfor/execution-plans.html" class="sidebar-link">执行计划分析</a></li><li><a href="/JavaPlusDoc/sql/perfor/tuning.html" class="sidebar-link">性能调优</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>高级特性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/sql/advanced/indexr.html" class="sidebar-link">高级特性概述</a></li><li><a href="/JavaPlusDoc/sql/advanced/transactions.html" class="sidebar-link">事务处理</a></li><li><a href="/JavaPlusDoc/sql/advanced/stored-procedures.html" class="sidebar-link">存储过程与函数</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>函数大全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/sql/functions/aggregate.html" class="sidebar-link">聚合函数</a></li><li><a href="/JavaPlusDoc/sql/functions/string.html" class="sidebar-link">字符串函数</a></li><li><a href="/JavaPlusDoc/sql/functions/numeric.html" class="sidebar-link">数值函数</a></li><li><a href="/JavaPlusDoc/sql/functions/datetime.html" class="sidebar-link">日期时间函数</a></li><li><a href="/JavaPlusDoc/sql/functions/conditional.html" class="sidebar-link">条件函数</a></li><li><a href="/JavaPlusDoc/sql/functions/window.html" class="sidebar-link">窗口函数</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实战案例</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/sql/examples/ecommerce.html" class="sidebar-link">电商系统实战</a></li><li><a href="/JavaPlusDoc/sql/examples/analytics.html" class="sidebar-link">数据分析实战</a></li><li><a href="/JavaPlusDoc/sql/examples/reports.html" class="sidebar-link">报表查询实战</a></li><li><a href="/JavaPlusDoc/sql/examples/migration.html" class="sidebar-link">数据迁移实战</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>数据库特定</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/sql/databases/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/JavaPlusDoc/sql/databases/postgresql.html" class="sidebar-link">PostgreSQL</a></li><li><a href="/JavaPlusDoc/sql/databases/sqlserver.html" class="sidebar-link">SQL Server</a></li><li><a href="/JavaPlusDoc/sql/databases/oracle.html" class="sidebar-link">Oracle</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>UniApp小程序开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/uniapp/充电宝小程序实现.html" class="sidebar-link">充电宝小程序实现</a></li><li><a href="/JavaPlusDoc/uniapp/充电桩小程序实现.html" class="sidebar-link">充电桩小程序实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python专属笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Python基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/Python/1.html" class="sidebar-link">第1天-Python历史</a></li><li><a href="/JavaPlusDoc/Python/2.html" class="sidebar-link">第2天-安装Python</a></li><li><a href="/JavaPlusDoc/Python/3.html" class="sidebar-link">第3天-第一个程序</a></li><li><a href="/JavaPlusDoc/Python/4.html" class="sidebar-link">第4天-Python基础</a></li><li><a href="/JavaPlusDoc/Python/5.html" class="sidebar-link">第5天-函数</a></li><li><a href="/JavaPlusDoc/Python/6.html" class="sidebar-link">第6天-高级特性</a></li><li><a href="/JavaPlusDoc/Python/7.html" class="sidebar-link">第7天-函数式编程</a></li><li><a href="/JavaPlusDoc/Python/8.html" class="sidebar-link">第8天-模块</a></li><li><a href="/JavaPlusDoc/Python/9.html" class="sidebar-link">第9天-面向对象编程</a></li><li><a href="/JavaPlusDoc/Python/10.html" class="sidebar-link">第10天-高级编程</a></li><li><a href="/JavaPlusDoc/Python/11.html" class="sidebar-link">第11天-错误和调试</a></li><li><a href="/JavaPlusDoc/Python/12.html" class="sidebar-link">第12天-IO编程</a></li><li><a href="/JavaPlusDoc/Python/13.html" class="sidebar-link">第13天-进程和线程</a></li><li><a href="/JavaPlusDoc/Python/14.html" class="sidebar-link">第14天-正则表达式</a></li><li><a href="/JavaPlusDoc/Python/15.html" class="sidebar-link">第15天-常用内建模块</a></li><li><a href="/JavaPlusDoc/Python/16.html" class="sidebar-link">第16天-常用第三方模块</a></li><li><a href="/JavaPlusDoc/Python/17.html" class="sidebar-link">第17天-图形界面</a></li><li><a href="/JavaPlusDoc/Python/18.html" class="sidebar-link">第18天-网络编程</a></li><li><a href="/JavaPlusDoc/Python/19.html" aria-current="page" class="active sidebar-link">第19天-电子邮件</a></li><li><a href="/JavaPlusDoc/Python/20.html" class="sidebar-link">第20天-访问数据库</a></li><li><a href="/JavaPlusDoc/Python/21.html" class="sidebar-link">第21天-Web开发</a></li><li><a href="/JavaPlusDoc/Python/22.html" class="sidebar-link">第22天-异步IO</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java核心技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/e/JVM深入解析.html" class="sidebar-link">JVM深入解析</a></li><li><a href="/JavaPlusDoc/e/JDK开发工具详解.html" class="sidebar-link">JDK开发工具详解</a></li><li><a href="/JavaPlusDoc/e/Java实战演示.html" class="sidebar-link">Java实战演示</a></li><li><a href="/JavaPlusDoc/basic-grammar/java-jdk-jre-jvm.html" class="sidebar-link">Java、JDK、JRE、JVM详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/basic-data-type.html" class="sidebar-link">Java基本数据类型</a></li><li><a href="/JavaPlusDoc/basic-grammar/type-cast.html" class="sidebar-link">数据类型转换</a></li><li><a href="/JavaPlusDoc/basic-grammar/int-cache.html" class="sidebar-link">数据类型缓存池</a></li><li><a href="/JavaPlusDoc/basic-grammar/operator.html" class="sidebar-link">运算符</a></li><li><a href="/JavaPlusDoc/basic-grammar/flow-control.html" class="sidebar-link">流程控制</a></li><li><a href="/JavaPlusDoc/basic-grammar/string-source.html" class="sidebar-link">String类详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/constant-pool.html" class="sidebar-link">字符串常量池</a></li><li><a href="/JavaPlusDoc/basic-grammar/builder-buffer.html" class="sidebar-link">StringBuilder和Buffer</a></li><li><a href="/JavaPlusDoc/basic-grammar/equals.html" class="sidebar-link">字符串比较</a></li><li><a href="/JavaPlusDoc/basic-grammar/object-class.html" class="sidebar-link">面向对象基础</a></li><li><a href="/JavaPlusDoc/basic-grammar/package.html" class="sidebar-link">Java包机制</a></li><li><a href="/JavaPlusDoc/basic-grammar/var.html" class="sidebar-link">变量与方法</a></li><li><a href="/JavaPlusDoc/basic-grammar/construct.html" class="sidebar-link">构造方法</a></li><li><a href="/JavaPlusDoc/basic-grammar/abstract.html" class="sidebar-link">抽象类</a></li><li><a href="/JavaPlusDoc/basic-grammar/interface.html" class="sidebar-link">接口和内部类</a></li><li><a href="/JavaPlusDoc/basic-grammar/encapsulation-inheritance-polymorphism.html" class="sidebar-link">封装继承多态</a></li><li><a href="/JavaPlusDoc/basic-grammar/this-super.html" class="sidebar-link">this与super关键字</a></li><li><a href="/JavaPlusDoc/basic-grammar/immutable.html" class="sidebar-link">不可变对象</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>集合框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/basic-grammar/gailan.html" class="sidebar-link">集合框架概览</a></li><li><a href="/JavaPlusDoc/basic-grammar/arraylist.html" class="sidebar-link">ArrayList详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/linkedlist.html" class="sidebar-link">LinkedList详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/stack.html" class="sidebar-link">栈Stack详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/hashmap.html" class="sidebar-link">HashMap详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/linkedhashmap.html" class="sidebar-link">LinkedHashMap详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/treemap.html" class="sidebar-link">TreeMap详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/ArrayDeque.html" class="sidebar-link">ArrayDeque详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/PriorityQueue.html" class="sidebar-link">PriorityQueue详解</a></li><li><a href="/JavaPlusDoc/basic-grammar/array-linked-list.html" class="sidebar-link">ArrayList vs LinkedList</a></li><li><a href="/JavaPlusDoc/basic-grammar/generic.html" class="sidebar-link">Java泛型</a></li><li><a href="/JavaPlusDoc/basic-grammar/iterator-iterable.html" class="sidebar-link">Iterator和Iterable</a></li><li><a href="/JavaPlusDoc/basic-grammar/fail-fast.html" class="sidebar-link">foreach循环陷阱</a></li><li><a href="/JavaPlusDoc/basic-grammar/comparable-omparator.html" class="sidebar-link">Comparable和Comparator</a></li><li><a href="/JavaPlusDoc/basic-grammar/WeakHashMap.html" class="sidebar-link">WeakHashMap详解</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>JVM与性能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/aJava/jvm.html" class="sidebar-link">JVM基础</a></li><li><a href="/JavaPlusDoc/aJava/JVM内存区域.html" class="sidebar-link">JVM内存区域</a></li><li><a href="/JavaPlusDoc/aJava/程序计数器.html" class="sidebar-link">程序计数器</a></li><li><a href="/JavaPlusDoc/aJava/线程.html" class="sidebar-link">线程</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>并发编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/thread/thread.html" class="sidebar-link">多线程入门</a></li><li><a href="/JavaPlusDoc/thread/callable-future-futuretask.html" class="sidebar-link">线程执行结果获取</a></li><li><a href="/JavaPlusDoc/thread/thread-state-and-method.html" class="sidebar-link">线程的6种状态</a></li><li><a href="/JavaPlusDoc/thread/threadpool-executor.html" class="sidebar-link">深入浅出Java线程池ThreadPoolExecutor</a></li><li><a href="/JavaPlusDoc/jobPro/synchronized.html" class="sidebar-link">synchronized和lock</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>IO与网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/java-up/shangtou.html" class="sidebar-link">JavaIO知识体系</a></li><li><a href="/JavaPlusDoc/java-up/file-path.html" class="sidebar-link">文件流</a></li><li><a href="/JavaPlusDoc/java-up/reader-writer.html" class="sidebar-link">字节流与字符流</a></li><li><a href="/JavaPlusDoc/java-up/char-byte.html" class="sidebar-link">转换流</a></li><li><a href="/JavaPlusDoc/java-up/serialize.html" class="sidebar-link">序列化和反序列化</a></li><li><a href="/JavaPlusDoc/nio/nio.html" class="sidebar-link">NIO基础</a></li><li><a href="/JavaPlusDoc/nio/BIONIOAIO.html" class="sidebar-link">NIO vs BIO vs AIO</a></li><li><a href="/JavaPlusDoc/nio/buffer-channel.html" class="sidebar-link">Buffer和Channel</a></li><li><a href="/JavaPlusDoc/nio/network-connect.html" class="sidebar-link">网络编程实践</a></li><li><a href="/JavaPlusDoc/nio/moxing.html" class="sidebar-link">IO模型</a></li><li><a href="/JavaPlusDoc/jobPro/IO.html" class="sidebar-link">IO多路复用</a></li><li><a href="/JavaPlusDoc/java-up/netty.html" class="sidebar-link">Netty入门</a></li><li><a href="/JavaPlusDoc/nio/socket-communication-basics.html" class="sidebar-link">Socket通信基础</a></li><li><a href="/JavaPlusDoc/nio/tcp-udp-programming.html" class="sidebar-link">TCP与UDP编程</a></li><li><a href="/JavaPlusDoc/nio/network-protocols-deep-dive.html" class="sidebar-link">网络协议深入解析</a></li><li><a href="/JavaPlusDoc/nio/nio-netty-framework.html" class="sidebar-link">NIO与Netty框架</a></li><li><a href="/JavaPlusDoc/nio/socket-programming-practice.html" class="sidebar-link">Socket编程实战案例</a></li><li><a href="/JavaPlusDoc/nio/socket-performance-optimization.html" class="sidebar-link">Socket性能优化与调试</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/JavaPlusDoc/gaobingfaxitong/1" class="sidebar-heading clickable"><span>高并发系统</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/gaobingfaxitong/1.html" class="sidebar-link">它的通用设计方法是什么</a></li><li><a href="/JavaPlusDoc/gaobingfaxitong/2.html" class="sidebar-link">架构分层</a></li><li><a href="/JavaPlusDoc/gaobingfaxitong/3.html" class="sidebar-link">如何提升系统性能</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>物联网架构系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/iot/" class="sidebar-link">IoT架构概览</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>架构分层设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/iot/device-layer.html" class="sidebar-link">设备层架构</a></li><li><a href="/JavaPlusDoc/iot/network-layer.html" class="sidebar-link">网络层架构</a></li><li><a href="/JavaPlusDoc/iot/application-layer.html" class="sidebar-link">应用层架构</a></li><li><a href="/JavaPlusDoc/iot/frontend-layer.html" class="sidebar-link">前端展示层</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>设备接入与管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/iot/device-access.html" class="sidebar-link">设备接入层</a></li><li><a href="/JavaPlusDoc/iot/device-management-layer.html" class="sidebar-link">设备管理层</a></li><li><a href="/JavaPlusDoc/iot/device-authentication.html" class="sidebar-link">设备认证</a></li><li><a href="/JavaPlusDoc/iot/device-control.html" class="sidebar-link">设备控制</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>协议适配层</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/iot/protocol-adapter-layer.html" class="sidebar-link">协议适配器</a></li><li><a href="/JavaPlusDoc/iot/mqtt-access-layer.html" class="sidebar-link">MQTT接入</a></li><li><a href="/JavaPlusDoc/iot/http-access-layer.html" class="sidebar-link">HTTP接入</a></li><li><a href="/JavaPlusDoc/iot/coap-access-layer.html" class="sidebar-link">CoAP接入</a></li><li><a href="/JavaPlusDoc/iot/tcp-udp-access-layer.html" class="sidebar-link">TCP/UDP接入</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>数据处理与存储</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/iot/data-processing.html" class="sidebar-link">数据处理层</a></li><li><a href="/JavaPlusDoc/iot/data-reception.html" class="sidebar-link">数据接收</a></li><li><a href="/JavaPlusDoc/iot/redis.html" class="sidebar-link">Redis缓存</a></li><li><a href="/JavaPlusDoc/iot/kafka.html" class="sidebar-link">Kafka消息队列</a></li><li><a href="/JavaPlusDoc/iot/cassandra.html" class="sidebar-link">Cassandra存储</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实战项目</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/iot/practice-projects.html" class="sidebar-link">实践项目案例</a></li><li><a href="/JavaPlusDoc/iot/geofence.html" class="sidebar-link">电子围栏功能设计</a></li><li><a href="/JavaPlusDoc/iot/charging-station-gateway.html" class="sidebar-link">充电桩设备网关</a></li><li><a href="/JavaPlusDoc/iot/netty-gateway-design.html" class="sidebar-link">百万台设备Netty网关架构</a></li><li><a href="/JavaPlusDoc/iot/netty-gateway-design-mi.html" class="sidebar-link">小米实战过亿设备Netty网关架构</a></li><li><a href="/JavaPlusDoc/iot/netty-gateway-bat.html" class="sidebar-link">哈喽电池设备Netty网关架构</a></li><li><a href="/JavaPlusDoc/iot/user-organization-permissions.html" class="sidebar-link">用户组织权限</a></li><li><a href="/JavaPlusDoc/iot/database-storage.html" class="sidebar-link">架构懂了就来了解数据库存储扩展千亿读写</a></li><li><a href="/JavaPlusDoc/iot/mermaid-test.html" class="sidebar-link">Mermaid图表测试</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GO语言技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/go/" class="sidebar-link">GO技术手册导航</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>基础语法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/go/basic-grammar/basic-syntax.html" class="sidebar-link">GO语言基础语法</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>高级特性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/go/advanced/concurrency.html" class="sidebar-link">并发编程</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>标准库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/go/stdlib/http.html" class="sidebar-link">HTTP编程</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>最佳实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/go/best-practices/testing.html" class="sidebar-link">测试最佳实践</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实战项目</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/go/projects/web-service.html" class="sidebar-link">Web服务开发实战</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>分布式架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>缓存系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/high-concurrency/why-cache.html" class="sidebar-link">缓存使用场景</a></li><li><a href="/JavaPlusDoc/high-concurrency/redis-single-thread-model.html" class="sidebar-link">Redis vs Memcached</a></li><li><a href="/JavaPlusDoc/high-concurrency/redis-data-types.html" class="sidebar-link">Redis数据类型</a></li><li><a href="/JavaPlusDoc/high-concurrency/redis-expiration-policies-and-lru.html" class="sidebar-link">Redis过期策略</a></li><li><a href="/JavaPlusDoc/high-concurrency/how-to-ensure-high-concurrency-and-high-availability-of-redis.html" class="sidebar-link">Redis高并发与高可用</a></li><li><a href="/JavaPlusDoc/high-concurrency/redis-master-slave.html" class="sidebar-link">Redis主从架构</a></li><li><a href="/JavaPlusDoc/high-concurrency/redis-persistence.html" class="sidebar-link">Redis持久化</a></li><li><a href="/JavaPlusDoc/high-concurrency/redis-sentinel.html" class="sidebar-link">Redis哨兵集群</a></li><li><a href="/JavaPlusDoc/jobPro/redis.html" class="sidebar-link">Redis应用场景</a></li><li><a href="/JavaPlusDoc/redis/redis-key-expiration.html" class="sidebar-link">Redis key过期问题解决方案</a></li><li><a href="/JavaPlusDoc/java-up/redis-springboot.html" class="sidebar-link">SpringBoot整合Redis</a></li><li><a href="/JavaPlusDoc/redis/xuebeng-chuantou-jichuan.html" class="sidebar-link">缓存雪崩、穿透、击穿</a></li><li><a href="/JavaPlusDoc/redis/redis-lua.html" class="sidebar-link">深入分析Redis Lua脚本运行原理</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>消息队列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/messagequeue/why-mq.html" class="sidebar-link">为什么使用消息队列</a></li><li><a href="/JavaPlusDoc/messagequeue/how-to-ensure-high-availability-of-message-queues.html" class="sidebar-link">消息队列高可用</a></li><li><a href="/JavaPlusDoc/messagequeue/how-to-ensure-that-messages-are-not-repeatedly-consumed.html" class="sidebar-link">消息不重复消费</a></li><li><a href="/JavaPlusDoc/messagequeue/how-to-ensure-the-reliable-transmission-of-messages.html" class="sidebar-link">消息可靠传输</a></li><li><a href="/JavaPlusDoc/messagequeue/how-to-ensure-the-order-of-messages.html" class="sidebar-link">消息顺序性</a></li><li><a href="/JavaPlusDoc/messagequeue/mq-time-delay-and-expired-failure.html" class="sidebar-link">消息队列延时问题</a></li><li><a href="/JavaPlusDoc/messagequeue/mq-design.html" class="sidebar-link">消息队列设计</a></li><li><a href="/JavaPlusDoc/java-up/rabbitmq.html" class="sidebar-link">RabbitMQ入门</a></li><li><a href="/JavaPlusDoc/power/kafka.html" class="sidebar-link">Kafka基础</a></li><li><a href="/JavaPlusDoc/power/kafkas.html" class="sidebar-link">Kafka集群</a></li><li><a href="/JavaPlusDoc/power/comsumer.html" class="sidebar-link">Kafka消费者</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>搜索引擎</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/searchEngine/es-architecture.html" class="sidebar-link">ES分布式架构原理</a></li><li><a href="/JavaPlusDoc/searchEngine/es-write-query-search.html" class="sidebar-link">ES写入数据原理</a></li><li><a href="/JavaPlusDoc/searchEngine/es-optimizing-query-performance.html" class="sidebar-link">ES查询效率优化</a></li><li><a href="/JavaPlusDoc/searchEngine/es-production-cluster.html" class="sidebar-link">ES生产集群部署</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>微服务架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/worker/3.html" class="sidebar-link">微服务优雅上下线</a></li><li><a href="/JavaPlusDoc/worker/1.html" class="sidebar-link">滚动部署</a></li><li><a href="/JavaPlusDoc/worker/2.html" class="sidebar-link">Nacos优雅停机</a></li><li><a href="/JavaPlusDoc/dubbo/dubbo.html" class="sidebar-link">Dubbo基础</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>数据库技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/mysql/mysql.html" class="sidebar-link">SQL执行过程</a></li><li><a href="/JavaPlusDoc/mysql/shiwu-shixia.html" class="sidebar-link">MySQL事务实现</a></li><li><a href="/JavaPlusDoc/mysql/lijie-shiwu.html" class="sidebar-link">深入理解MySQL事务</a></li><li><a href="/JavaPlusDoc/mysql/mysql-locks.html" class="sidebar-link">MySQL锁机制详解</a></li><li><a href="/JavaPlusDoc/mysql/redis-shuju-yizhixing.html" class="sidebar-link">MySQL和Redis数据一致性</a></li><li><a href="/JavaPlusDoc/jobPro/InnoDB.html" class="sidebar-link">MyISAM vs InnoDB</a></li><li><a href="/JavaPlusDoc/java-up/mongodb.html" class="sidebar-link">MongoDB基础</a></li><li><a href="/JavaPlusDoc/java-up/mongodb-backup-restore.html" class="sidebar-link">MongoDB备份与恢复</a></li><li><a href="/JavaPlusDoc/MyBatis-Plus/getting-started.html" class="sidebar-link">MyBatis-Plus入门</a></li><li><a href="/JavaPlusDoc/MyBatis-Plus/service-interface.html" class="sidebar-link">MyBatis-Plus接口</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>运维与部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Docker容器技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/docker/docker-tutorial.html" class="sidebar-link">Docker教程</a></li><li><a href="/JavaPlusDoc/docker/docker架构.html" class="sidebar-link">docker架构</a></li><li><a href="/JavaPlusDoc/docker/docker-install.html" class="sidebar-link">Docker安装指南</a></li><li><a href="/JavaPlusDoc/docker/docker-mirror.html" class="sidebar-link">Docker配置国内源</a></li><li><a href="/JavaPlusDoc/docker/docker-images.html" class="sidebar-link">Docker镜像管理</a></li><li><a href="/JavaPlusDoc/docker/docker-containers.html" class="sidebar-link">Docker容器管理</a></li><li><a href="/JavaPlusDoc/docker/docker-network.html" class="sidebar-link">Docker网络配置</a></li><li><a href="/JavaPlusDoc/docker/docker-volumes.html" class="sidebar-link">Docker数据卷管理</a></li><li><a href="/JavaPlusDoc/docker/docker-dockerfile.html" class="sidebar-link">Dockerfile最佳实践</a></li><li><a href="/JavaPlusDoc/docker/docker-compose.html" class="sidebar-link">Docker Compose详解</a></li><li><a href="/JavaPlusDoc/docker/docker-swarm.html" class="sidebar-link">Docker Swarm集群</a></li><li><a href="/JavaPlusDoc/docker/docker-security.html" class="sidebar-link">Docker安全最佳实践</a></li><li><a href="/JavaPlusDoc/docker/docker-production.html" class="sidebar-link">Docker生产环境部署</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>基础设施</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/aJava/设备网关后端设计.html" class="sidebar-link">设备网关后端设计</a></li><li><a href="/JavaPlusDoc/aJava/Redis底层数据结构原理.html" class="sidebar-link">Redis底层数据结构原理</a></li><li><a href="/JavaPlusDoc/aJava/HashMap底层原理.html" class="sidebar-link">HashMap底层原理</a></li><li><a href="/JavaPlusDoc/aJava/MySQL的InnoDB原理.html" class="sidebar-link">MySQL的InnoDB原理</a></li><li><a href="/JavaPlusDoc/aJava/充电桩业务实现.html" class="sidebar-link">充电桩业务实现</a></li><li><a href="/JavaPlusDoc/aJava/充电宝业务实现.html" class="sidebar-link">充电宝业务实现</a></li><li><a href="/JavaPlusDoc/aJava/数据库分片技术实现.html" class="sidebar-link">数据库分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/Redis分片技术实现.html" class="sidebar-link">Redis分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/MongoDB分片技术实现.html" class="sidebar-link">MongoDB分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/Elasticsearch分片技术实现.html" class="sidebar-link">Elasticsearch分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/HBase分片技术实现.html" class="sidebar-link">HBase分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/ClickHouse分片技术实现.html" class="sidebar-link">ClickHouse分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/PostgreSQL分片技术实现.html" class="sidebar-link">PostgreSQL分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/Oracle分片技术实现.html" class="sidebar-link">Oracle分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/SQLServer分片技术实现.html" class="sidebar-link">SQLServer分片技术实现</a></li><li><a href="/JavaPlusDoc/aJava/云计算是什么.html" class="sidebar-link">云计算基础</a></li><li><a href="/JavaPlusDoc/aJava/mysql是什么.html" class="sidebar-link">mysql是什么</a></li><li><a href="/JavaPlusDoc/aJava/mogodb是什么.html" class="sidebar-link">mogodb是什么</a></li><li><a href="/JavaPlusDoc/aJava/安全组是什么.html" class="sidebar-link">安全组是什么</a></li><li><a href="/JavaPlusDoc/aJava/子网掩码是什么.html" class="sidebar-link">子网掩码是什么</a></li><li><a href="/JavaPlusDoc/aJava/路由器是什么.html" class="sidebar-link">路由器是什么</a></li><li><a href="/JavaPlusDoc/aJava/交换机是什么.html" class="sidebar-link">交换机是什么</a></li><li><a href="/JavaPlusDoc/aJava/CDN是什么.html" class="sidebar-link">CDN是什么</a></li><li><a href="/JavaPlusDoc/aJava/nginx是什么.html" class="sidebar-link">nginx是什么</a></li><li><a href="/JavaPlusDoc/aJava/tomcat是什么.html" class="sidebar-link">tomcat是什么</a></li><li><a href="/JavaPlusDoc/aJava/Eureka是什么.html" class="sidebar-link">Eureka是什么</a></li><li><a href="/JavaPlusDoc/aJava/nacos是什么.html" class="sidebar-link">nacos是什么</a></li><li><a href="/JavaPlusDoc/aJava/Zookeeper是什么.html" class="sidebar-link">Zookeeper是什么</a></li><li><a href="/JavaPlusDoc/aJava/ElasticSearch是什么.html" class="sidebar-link">ElasticSearch是什么</a></li><li><a href="/JavaPlusDoc/aJava/微服务是什么.html" class="sidebar-link">微服务基础</a></li><li><a href="/JavaPlusDoc/aJava/HDFS是什么.html" class="sidebar-link">HDFS基础</a></li><li><a href="/JavaPlusDoc/aJava/块存储是什么.html" class="sidebar-link">块存储</a></li><li><a href="/JavaPlusDoc/aJava/对象存储是什么.html" class="sidebar-link">对象存储</a></li><li><a href="/JavaPlusDoc/aJava/存储快照是什么.html" class="sidebar-link">存储快照</a></li><li><a href="/JavaPlusDoc/aJava/负载均衡是什么.html" class="sidebar-link">负载均衡</a></li><li><a href="/JavaPlusDoc/aJava/什么是灰度发布.html" class="sidebar-link">灰度发布</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>DevOps工具链</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/aJava/Jenkins是什么.html" class="sidebar-link">Jenkins基础</a></li><li><a href="/JavaPlusDoc/aJava/Ansible是什么.html" class="sidebar-link">Ansible基础</a></li><li><a href="/JavaPlusDoc/aJava/DevOps是什么.html" class="sidebar-link">DevOps概念</a></li><li><a href="/JavaPlusDoc/aJava/WAF和DDOS的区别是什么.html" class="sidebar-link">WAF和DDOS防护</a></li><li><a href="/JavaPlusDoc/linux/linux.html" class="sidebar-link">Linux常用命令</a></li><li><a href="/JavaPlusDoc/linux/nginx-env.html" class="sidebar-link">Nginx环境配置</a></li><li><a href="/JavaPlusDoc/linux/kibana-install.html" class="sidebar-link">Kibana安装与使用</a></li><li><a href="/JavaPlusDoc/java-up/nginx.html" class="sidebar-link">Nginx入门</a></li><li><a href="/JavaPlusDoc/java-up/ssl.html" class="sidebar-link">Nginx SSL配置</a></li><li><a href="/JavaPlusDoc/worker/nginx-optimization.html" class="sidebar-link">Nginx优化与防盗链</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>部署与监控</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/worker/elk.html" class="sidebar-link">ELK日志系统</a></li><li><a href="/JavaPlusDoc/worker/elfk-cluster.html" class="sidebar-link">ELFK生产集群搭建</a></li><li><a href="/JavaPlusDoc/worker/jenkins.html" class="sidebar-link">Jenkins部署SpringBoot</a></li><li><a href="/JavaPlusDoc/worker/rocketmq.html" class="sidebar-link">RocketMQ安装</a></li><li><a href="/JavaPlusDoc/worker/grafana.html" class="sidebar-link">Grafana监控</a></li><li><a href="/JavaPlusDoc/worker/prometheus.html" class="sidebar-link">Prometheus单机部署</a></li><li><a href="/JavaPlusDoc/worker/grafana-database-monitoring.html" class="sidebar-link">Grafana监控MySQL、Redis和MongoDB</a></li><li><a href="/JavaPlusDoc/worker/k8s-monitoring.html" class="sidebar-link">K8s监控</a></li><li><a href="/JavaPlusDoc/worker/cpu-troubleshooting.html" class="sidebar-link">CPU使用率100%异常排查</a></li><li><a href="/JavaPlusDoc/worker/springboot.html" class="sidebar-link">SpringBoot启动脚本</a></li><li><a href="/JavaPlusDoc/worker/skywalking.html" class="sidebar-link">SkyWalking监控</a></li><li><a href="/JavaPlusDoc/worker/7.html" class="sidebar-link">前端自动化部署</a></li><li><a href="/JavaPlusDoc/sre/sre.html" class="sidebar-link">SRE实践</a></li><li><a href="/JavaPlusDoc/sre/monitor.html" class="sidebar-link">分布式监控</a></li><li><a href="/JavaPlusDoc/sre/serviceQuality.html" class="sidebar-link">服务质量目标</a></li><li><a href="/JavaPlusDoc/sre/errorBudget.html" class="sidebar-link">错误预算</a></li><li><a href="/JavaPlusDoc/sre/system.html" class="sidebar-link">系统性能指标</a></li><li><a href="/JavaPlusDoc/sre/server-mining-virus-removal.html" class="sidebar-link">服务器挖矿病毒清除</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ElasticSearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/es/es-architecture.html" class="sidebar-link">ElasticSearch架构</a></li><li><a href="/JavaPlusDoc/es/es-optimizing-query-performance.html" class="sidebar-link">查询性能优化</a></li><li><a href="/JavaPlusDoc/es/es-cluster-setup.html" class="sidebar-link">Linux搭建ES集群与Kibana</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>产品系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/products/" class="sidebar-link">产品概述</a></li><li><a href="/JavaPlusDoc/products/product-gallery.html" class="sidebar-link">【溜溜梅】官方商城小程序</a></li><li><a href="/JavaPlusDoc/products/productChange.html" class="sidebar-link">小区充电桩小程序</a></li><li><a href="/JavaPlusDoc/products/photoImage.html" class="sidebar-link">话圈小程序</a></li><li><a href="/JavaPlusDoc/products/changeChange.html" class="sidebar-link">速绿充电小程序体验设计</a></li><li><a href="/JavaPlusDoc/products/changeChange2.html" class="sidebar-link">恒想充充电桩小程序改版设计</a></li><li><a href="/JavaPlusDoc/products/productShare.html" class="sidebar-link">分销小程序</a></li><li><a href="/JavaPlusDoc/products/product-car.html" class="sidebar-link">电动车充电桩小程序</a></li><li><a href="/JavaPlusDoc/products/无人岛商业计划书.html" class="sidebar-link">无人岛商业计划书</a></li><li><a href="/JavaPlusDoc/products/蜗牛睡眠高嵩.html" class="sidebar-link">蜗牛睡眠高嵩</a></li><li><a href="/JavaPlusDoc/products/优质行业报告网站.html" class="sidebar-link">优质行业报告网站</a></li><li><a href="/JavaPlusDoc/products/篮球场如何赚钱.html" class="sidebar-link">篮球场如何赚钱</a></li><li><a href="/JavaPlusDoc/products/enterprise-platform.html" class="sidebar-link">企业级应用平台</a></li><li><a href="/JavaPlusDoc/products/microservice-framework.html" class="sidebar-link">微服务框架</a></li><li><a href="/JavaPlusDoc/products/data-analytics-suite.html" class="sidebar-link">数据分析套件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>实战案例</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Web应用开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/jobPro/login.html" class="sidebar-link">用户注册登录系统</a></li><li><a href="/JavaPlusDoc/jobPro/lan.html" class="sidebar-link">多语言国际化</a></li><li><a href="/JavaPlusDoc/jobPro/jobPro.html" class="sidebar-link">PC网站微信扫码登录</a></li><li><a href="/JavaPlusDoc/jobPro/wechat-miniprogram-guide.html" class="sidebar-link">微信小程序开发完全指南</a></li><li><a href="/JavaPlusDoc/jobPro/wechat-customer-service.html" class="sidebar-link">微信小程序API客服消息</a></li><li><a href="/JavaPlusDoc/jobPro/wechat-open-api.html" class="sidebar-link">微信小程序开放接口</a></li><li><a href="/JavaPlusDoc/jobPro/wechat-operation-center.html" class="sidebar-link">微信小程序运维中心</a></li><li><a href="/JavaPlusDoc/jobPro/appMsg.html" class="sidebar-link">微信小程序消息推送</a></li><li><a href="/JavaPlusDoc/jobPro/miniprogram.html" class="sidebar-link">微信小程序自动化部署</a></li><li><a href="/JavaPlusDoc/jobPro/appPay.html" class="sidebar-link">微信小程序支付功能</a></li><li><a href="/JavaPlusDoc/jobPro/uniapp.html" class="sidebar-link">iOS/Android打包发布</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>GO语言应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/go/projects/web-service.html" class="sidebar-link">GO Web服务开发实战</a></li><li><a href="/JavaPlusDoc/go/advanced/concurrency.html" class="sidebar-link">GO并发编程实践</a></li><li><a href="/JavaPlusDoc/go/stdlib/http.html" class="sidebar-link">GO HTTP编程指南</a></li><li><a href="/JavaPlusDoc/go/best-practices/testing.html" class="sidebar-link">GO测试最佳实践</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>技术架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/tech/high-availability-group-buying.html" class="sidebar-link">500万日订单下的高可用拼购系统</a></li><li><a href="/JavaPlusDoc/tech/twenty-million-orders-architecture.html" class="sidebar-link">2000万日订单背后的技术架构</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>企业级应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/java-up/aop-log.html" class="sidebar-link">SpringAOP实践</a></li><li><a href="/JavaPlusDoc/java-up/ioc.html" class="sidebar-link">SpringIoC实践</a></li><li><a href="/JavaPlusDoc/java-up/transaction.html" class="sidebar-link">事务支持</a></li><li><a href="/JavaPlusDoc/java-up/Filter-Interceptor-Listener.html" class="sidebar-link">过滤器与拦截器</a></li><li><a href="/JavaPlusDoc/java-up/quartz.html" class="sidebar-link">SpringBoot整合Quartz</a></li><li><a href="/JavaPlusDoc/java-up/mybatis.html" class="sidebar-link">SpringBoot整合MyBatis</a></li><li><a href="/JavaPlusDoc/java-up/validator.html" class="sidebar-link">数据校验</a></li><li><a href="/JavaPlusDoc/worker/6.html" class="sidebar-link">API数据加密</a></li><li><a href="/JavaPlusDoc/data/data.html" class="sidebar-link">大数据开发实践</a></li><li><a href="/JavaPlusDoc/order/order-BizOrderService.html" class="sidebar-link">订单流程设计</a></li><li><a href="/JavaPlusDoc/linuxPrometheus/linux.html" class="sidebar-link">数据导入导出优化</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>物联网应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/iot/iot.html" class="sidebar-link">物联网基础</a></li><li><a href="/JavaPlusDoc/iot/kafka.html" class="sidebar-link">物联网Kafka应用</a></li><li><a href="/JavaPlusDoc/iot/redis.html" class="sidebar-link">物联网Redis应用</a></li><li><a href="/JavaPlusDoc/iot/cassandra.html" class="sidebar-link">物联网Cassandra应用</a></li><li><a href="/JavaPlusDoc/iot/server.html" class="sidebar-link">物联网设备管理</a></li><li><a href="/JavaPlusDoc/iot/byteArray.html" class="sidebar-link">字节数组处理</a></li><li><a href="/JavaPlusDoc/iot/iotJob.html" class="sidebar-link">物联网业务流程</a></li><li><a href="/JavaPlusDoc/iot/protocol-adapter-layer.html" class="sidebar-link">协议适配层</a></li><li><a href="/JavaPlusDoc/iot/device-management-layer.html" class="sidebar-link">设备管理层</a></li><li><a href="/JavaPlusDoc/iot/application-service-layer.html" class="sidebar-link">应用服务层</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java线程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/thread/java-multithreading-basics.html" class="sidebar-link">Java多线程基础</a></li><li><a href="/JavaPlusDoc/thread/java-thread-synchronization.html" class="sidebar-link">Java线程同步机制</a></li><li><a href="/JavaPlusDoc/thread/java-concurrent-utilities.html" class="sidebar-link">Java并发工具类</a></li><li><a href="/JavaPlusDoc/thread/java-threadpool-advanced.html" class="sidebar-link">Java线程池深入解析</a></li><li><a href="/JavaPlusDoc/thread/java-memory-model.html" class="sidebar-link">Java内存模型与并发编程</a></li><li><a href="/JavaPlusDoc/thread/java-concurrency-best-practices.html" class="sidebar-link">Java并发编程最佳实践</a></li><li><a href="/JavaPlusDoc/thread/thread-state-and-method.html" class="sidebar-link">线程状态与方法</a></li><li><a href="/JavaPlusDoc/thread/callable-future-futuretask.html" class="sidebar-link">Callable、Future、FutureTask</a></li><li><a href="/JavaPlusDoc/thread/threadpool-executor.html" class="sidebar-link">ThreadPoolExecutor详解</a></li><li><a href="/JavaPlusDoc/aThread/linux.html" class="sidebar-link">linux线程基础</a></li><li><a href="/JavaPlusDoc/aThread/jvm.html" class="sidebar-link">jvm基础知识</a></li><li><a href="/JavaPlusDoc/aThread/jvmThread.html" class="sidebar-link">jvm线程</a></li><li><a href="/JavaPlusDoc/aThread/jvmThreadEvent.html" class="sidebar-link">jvm线程通信原理</a></li><li><a href="/JavaPlusDoc/aThread/jvmThreadSync.html" class="sidebar-link">jvm线程同步机制</a></li><li><a href="/JavaPlusDoc/aThread/jvmLock.html" class="sidebar-link">java锁实现原理</a></li><li><a href="/JavaPlusDoc/aThread/jvmAtomic.html" class="sidebar-link">java原子操作类实现原理</a></li><li><a href="/JavaPlusDoc/aThread/jvmConcurrent.html" class="sidebar-link">java并发容器实现原理</a></li><li><a href="/JavaPlusDoc/aThread/javaThreadPool.html" class="sidebar-link">java线程池实现原理</a></li><li><a href="/JavaPlusDoc/aThread/javaThreadPoolUse.html" class="sidebar-link">java线程池使用</a></li><li><a href="/JavaPlusDoc/aThread/javaThreadSkill.html" class="sidebar-link">java多线程编程技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>电商业务交易系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/ecommerce/product-management.html" class="sidebar-link">商品管理系统</a></li><li><a href="/JavaPlusDoc/ecommerce/order-management.html" class="sidebar-link">订单管理系统</a></li><li><a href="/JavaPlusDoc/ecommerce/payment-system.html" class="sidebar-link">支付系统设计</a></li><li><a href="/JavaPlusDoc/ecommerce/shopping-cart.html" class="sidebar-link">购物车系统</a></li><li><a href="/JavaPlusDoc/ecommerce/inventory-management.html" class="sidebar-link">库存管理系统</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>跨境电商系统架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/ecommerce/cross-border/" class="sidebar-link">系统架构概述</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/product-catalog-service.html" class="sidebar-link">商品管理系统</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/pricing-engine.html" class="sidebar-link">价格计算引擎</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/order-processing-system.html" class="sidebar-link">订单处理系统</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/payment-gateway-system.html" class="sidebar-link">支付网关系统</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/logistics-delivery-system.html" class="sidebar-link">物流配送系统</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/after-sales-service.html" class="sidebar-link">售后服务系统</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/user-management-system.html" class="sidebar-link">用户管理与权限系统</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/search-recommendation-engine.html" class="sidebar-link">搜索推荐引擎</a></li><li><a href="/JavaPlusDoc/ecommerce/cross-border/shopping-cart-system.html" class="sidebar-link">购物车系统</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>营销系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/marketing/coupon-system.html" class="sidebar-link">优惠券系统</a></li><li><a href="/JavaPlusDoc/marketing/flash-sale-system.html" class="sidebar-link">秒杀系统</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>物联网设备接入系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/iot/device-access.html" class="sidebar-link">设备接入系统</a></li><li><a href="/JavaPlusDoc/iot/device-management.html" class="sidebar-link">设备管理服务</a></li><li><a href="/JavaPlusDoc/iot/device-authentication.html" class="sidebar-link">设备认证服务</a></li><li><a href="/JavaPlusDoc/iot/data-reception.html" class="sidebar-link">数据接收服务</a></li><li><a href="/JavaPlusDoc/iot/device-control.html" class="sidebar-link">设备控制服务</a></li><li><a href="/JavaPlusDoc/iot/protocol-adapter.html" class="sidebar-link">协议适配器</a></li><li><a href="/JavaPlusDoc/iot/mqtt-access-layer.html" class="sidebar-link">MQTT设备接入层</a></li><li><a href="/JavaPlusDoc/iot/coap-access-layer.html" class="sidebar-link">CoAP设备接入层</a></li><li><a href="/JavaPlusDoc/iot/http-access-layer.html" class="sidebar-link">HTTP设备接入层</a></li><li><a href="/JavaPlusDoc/iot/tcp-udp-access-layer.html" class="sidebar-link">TCP/UDP设备接入层</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>计算机基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaPlusDoc/cs/os.html" class="sidebar-link">操作系统</a></li><li><a href="/JavaPlusDoc/cs/wangluo.html" class="sidebar-link">计算机网络</a></li><li><a href="/JavaPlusDoc/cs/tcp-ip.html" class="sidebar-link">TCP/IP协议详解</a></li><li><a href="/JavaPlusDoc/aJava/cookie-session-token.html" class="sidebar-link">Cookie/Session/Token</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>第19天-电子邮件</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2025
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">第19天-电子邮件</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>哪吒</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/6/15</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="第19天-电子邮件"><a href="#第19天-电子邮件" class="header-anchor">#</a> 第19天-电子邮件</h1> <h2 id="_1-电子邮件基础"><a href="#_1-电子邮件基础" class="header-anchor">#</a> 1. 电子邮件基础</h2> <h3 id="_1-1-电子邮件协议概述"><a href="#_1-1-电子邮件协议概述" class="header-anchor">#</a> 1.1 电子邮件协议概述</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">email_protocols_overview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;电子邮件协议概述&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 电子邮件协议概述 ===&quot;</span><span class="token punctuation">)</span>
    
    protocols <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;SMTP (Simple Mail Transfer Protocol)&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;用途&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;发送邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;端口&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;25 (非加密), 587 (STARTTLS), 465 (SSL/TLS)&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;特点&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;用于邮件传输，从客户端到服务器或服务器间&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Python模块&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;smtplib&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;POP3 (Post Office Protocol 3)&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;用途&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;接收邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;端口&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;110 (非加密), 995 (SSL/TLS)&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;特点&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;下载邮件到本地，服务器上的邮件通常被删除&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Python模块&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;poplib&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;IMAP (Internet Message Access Protocol)&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;用途&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;接收邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;端口&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;143 (非加密), 993 (SSL/TLS)&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;特点&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;邮件保存在服务器上，支持多设备同步&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Python模块&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;imaplib&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">for</span> protocol<span class="token punctuation">,</span> details <span class="token keyword">in</span> protocols<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n</span><span class="token interpolation"><span class="token punctuation">{</span>protocol<span class="token punctuation">}</span></span><span class="token string">:&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> details<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  </span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n邮件处理流程:&quot;</span><span class="token punctuation">)</span>
    flow_steps <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;1. 编写邮件内容（文本、HTML、附件）&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;2. 使用SMTP协议发送邮件&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;3. 邮件服务器接收并转发邮件&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;4. 收件人使用POP3或IMAP接收邮件&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;5. 邮件客户端显示邮件内容&quot;</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> step <span class="token keyword">in</span> flow_steps<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  </span><span class="token interpolation"><span class="token punctuation">{</span>step<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行协议概述</span>
email_protocols_overview<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-2-python邮件模块介绍"><a href="#_1-2-python邮件模块介绍" class="header-anchor">#</a> 1.2 Python邮件模块介绍</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> smtplib
<span class="token keyword">import</span> poplib
<span class="token keyword">import</span> imaplib
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> MIMEText
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>multipart <span class="token keyword">import</span> MIMEMultipart
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>base <span class="token keyword">import</span> MIMEBase
<span class="token keyword">from</span> email <span class="token keyword">import</span> encoders
<span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> decode_header
<span class="token keyword">from</span> email<span class="token punctuation">.</span>utils <span class="token keyword">import</span> parseaddr<span class="token punctuation">,</span> formataddr
<span class="token keyword">import</span> os
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">def</span> <span class="token function">python_email_modules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Python邮件模块介绍&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== Python邮件模块介绍 ===&quot;</span><span class="token punctuation">)</span>
    
    modules <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;smtplib&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;功能&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;SMTP客户端，用于发送邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;主要类&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;SMTP, SMTP_SSL&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;常用方法&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;connect(), login(), sendmail(), quit()&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;poplib&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;功能&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;POP3客户端，用于接收邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;主要类&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;POP3, POP3_SSL&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;常用方法&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user(), pass_(), list(), retr(), dele()&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;imaplib&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;功能&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;IMAP客户端，用于接收邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;主要类&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;IMAP4, IMAP4_SSL&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;常用方法&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;login(), select(), search(), fetch()&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;email.mime&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;功能&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;构造邮件内容&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;主要类&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;MIMEText, MIMEMultipart, MIMEBase&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;常用方法&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;attach(), set_payload(), as_string()&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;email.header&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;功能&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;处理邮件头部编码&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;主要函数&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;decode_header(), make_header()&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;用途&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;处理中文等非ASCII字符&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">for</span> module<span class="token punctuation">,</span> details <span class="token keyword">in</span> modules<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n</span><span class="token interpolation"><span class="token punctuation">{</span>module<span class="token punctuation">}</span></span><span class="token string">:&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> details<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  </span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n邮件格式标准:&quot;</span><span class="token punctuation">)</span>
    standards <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;RFC 5322: Internet Message Format (邮件格式)&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;RFC 2045-2049: MIME (多媒体邮件扩展)&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;RFC 3501: IMAP4rev1 (IMAP协议)&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;RFC 1939: POP3 (POP3协议)&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;RFC 5321: SMTP (SMTP协议)&quot;</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> standard <span class="token keyword">in</span> standards<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  • </span><span class="token interpolation"><span class="token punctuation">{</span>standard<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行模块介绍</span>
python_email_modules<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-发送邮件"><a href="#_2-发送邮件" class="header-anchor">#</a> 2. 发送邮件</h2> <h3 id="_2-1-smtp基础发送"><a href="#_2-1-smtp基础发送" class="header-anchor">#</a> 2.1 SMTP基础发送</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> smtplib
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> MIMEText
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>multipart <span class="token keyword">import</span> MIMEMultipart
<span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> Header
<span class="token keyword">from</span> email<span class="token punctuation">.</span>utils <span class="token keyword">import</span> formataddr

<span class="token keyword">def</span> <span class="token function">smtp_basic_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;SMTP基础发送演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== SMTP基础发送演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 发送纯文本邮件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 发送纯文本邮件:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">send_text_email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;发送纯文本邮件&quot;&quot;&quot;</span>
        <span class="token comment"># 邮件配置</span>
        smtp_server <span class="token operator">=</span> <span class="token string">&quot;smtp.gmail.com&quot;</span>  <span class="token comment"># Gmail SMTP服务器</span>
        smtp_port <span class="token operator">=</span> <span class="token number">587</span>  <span class="token comment"># STARTTLS端口</span>
        sender_email <span class="token operator">=</span> <span class="token string">&quot;your_email@gmail.com&quot;</span>
        sender_password <span class="token operator">=</span> <span class="token string">&quot;your_app_password&quot;</span>  <span class="token comment"># 应用专用密码</span>
        
        <span class="token comment"># 收件人信息</span>
        receiver_email <span class="token operator">=</span> <span class="token string">&quot;recipient@example.com&quot;</span>
        
        <span class="token comment"># 创建邮件内容</span>
        subject <span class="token operator">=</span> <span class="token string">&quot;Python发送的测试邮件&quot;</span>
        body <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
        这是一封使用Python发送的测试邮件。
        
        邮件内容：
        - 发送时间：{}
        - 发送方式：SMTP
        - 编程语言：Python
        
        祝好！
        &quot;&quot;&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建MIMEText对象</span>
        message <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">'plain'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> formataddr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Python发送者&quot;</span><span class="token punctuation">,</span> sender_email<span class="token punctuation">)</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> receiver_email
        message<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 连接SMTP服务器</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   正在连接SMTP服务器...&quot;</span><span class="token punctuation">)</span>
            server <span class="token operator">=</span> smtplib<span class="token punctuation">.</span>SMTP<span class="token punctuation">(</span>smtp_server<span class="token punctuation">,</span> smtp_port<span class="token punctuation">)</span>
            server<span class="token punctuation">.</span>starttls<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 启用TLS加密</span>
            
            <span class="token comment"># 登录</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   正在登录...&quot;</span><span class="token punctuation">)</span>
            server<span class="token punctuation">.</span>login<span class="token punctuation">(</span>sender_email<span class="token punctuation">,</span> sender_password<span class="token punctuation">)</span>
            
            <span class="token comment"># 发送邮件</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   正在发送邮件...&quot;</span><span class="token punctuation">)</span>
            text <span class="token operator">=</span> message<span class="token punctuation">.</span>as_string<span class="token punctuation">(</span><span class="token punctuation">)</span>
            server<span class="token punctuation">.</span>sendmail<span class="token punctuation">(</span>sender_email<span class="token punctuation">,</span> receiver_email<span class="token punctuation">,</span> text<span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   ✓ 邮件发送成功！&quot;</span><span class="token punctuation">)</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 邮件发送失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            server<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 2. 发送HTML邮件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 发送HTML邮件:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">send_html_email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;发送HTML邮件&quot;&quot;&quot;</span>
        <span class="token comment"># 邮件配置（示例配置）</span>
        smtp_config <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'server'</span><span class="token punctuation">:</span> <span class="token string">'smtp.example.com'</span><span class="token punctuation">,</span>
            <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token number">587</span><span class="token punctuation">,</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'your_email@example.com'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'your_password'</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment"># HTML邮件内容</span>
        html_content <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
        &lt;head&gt;
            &lt;meta charset=&quot;utf-8&quot;&gt;
            &lt;title&gt;Python HTML邮件&lt;/title&gt;
            &lt;style&gt;
                body { font-family: Arial, sans-serif; margin: 20px; }
                .header { background-color: #4CAF50; color: white; padding: 10px; text-align: center; }
                .content { padding: 20px; border: 1px solid #ddd; }
                .footer { background-color: #f1f1f1; padding: 10px; text-align: center; font-size: 12px; }
                .highlight { background-color: #ffeb3b; padding: 5px; }
            &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;div class=&quot;header&quot;&gt;
                &lt;h1&gt;Python邮件发送测试&lt;/h1&gt;
            &lt;/div&gt;
            &lt;div class=&quot;content&quot;&gt;
                &lt;h2&gt;邮件内容&lt;/h2&gt;
                &lt;p&gt;这是一封使用Python发送的&lt;span class=&quot;highlight&quot;&gt;HTML格式&lt;/span&gt;邮件。&lt;/p&gt;
                
                &lt;h3&gt;功能特点：&lt;/h3&gt;
                &lt;ul&gt;
                    &lt;li&gt;支持HTML格式&lt;/li&gt;
                    &lt;li&gt;支持CSS样式&lt;/li&gt;
                    &lt;li&gt;支持图片和链接&lt;/li&gt;
                    &lt;li&gt;支持表格和列表&lt;/li&gt;
                &lt;/ul&gt;
                
                &lt;h3&gt;技术信息：&lt;/h3&gt;
                &lt;table border=&quot;1&quot; style=&quot;border-collapse: collapse; width: 100%;&quot;&gt;
                    &lt;tr&gt;
                        &lt;th style=&quot;padding: 8px; background-color: #f2f2f2;&quot;&gt;项目&lt;/th&gt;
                        &lt;th style=&quot;padding: 8px; background-color: #f2f2f2;&quot;&gt;值&lt;/th&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td style=&quot;padding: 8px;&quot;&gt;发送时间&lt;/td&gt;
                        &lt;td style=&quot;padding: 8px;&quot;&gt;{}&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td style=&quot;padding: 8px;&quot;&gt;编程语言&lt;/td&gt;
                        &lt;td style=&quot;padding: 8px;&quot;&gt;Python&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td style=&quot;padding: 8px;&quot;&gt;协议&lt;/td&gt;
                        &lt;td style=&quot;padding: 8px;&quot;&gt;SMTP&lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
                
                &lt;p&gt;访问我们的网站：&lt;a href=&quot;https://www.python.org&quot;&gt;Python官网&lt;/a&gt;&lt;/p&gt;
            &lt;/div&gt;
            &lt;div class=&quot;footer&quot;&gt;
                &lt;p&gt;此邮件由Python自动发送 | © 2023 Python邮件系统&lt;/p&gt;
            &lt;/div&gt;
        &lt;/body&gt;
        &lt;/html&gt;
        &quot;&quot;&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建HTML邮件</span>
        message <span class="token operator">=</span> MIMEMultipart<span class="token punctuation">(</span><span class="token string">'alternative'</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> formataddr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Python HTML发送者&quot;</span><span class="token punctuation">,</span> smtp_config<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;recipient@example.com&quot;</span>
        message<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token string">&quot;Python HTML邮件测试&quot;</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 添加HTML内容</span>
        html_part <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span>html_content<span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        message<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>html_part<span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   HTML邮件内容已准备完成&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   邮件大小:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>as_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;字节&quot;</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 注意：这里只是演示，实际发送需要真实的SMTP配置</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   注意：需要配置真实的SMTP服务器信息才能发送&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 3. 批量发送邮件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 批量发送邮件:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">send_bulk_emails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;批量发送邮件&quot;&quot;&quot;</span>
        <span class="token comment"># 收件人列表</span>
        recipients <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user1@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;用户一&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user2@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;用户二&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user3@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;用户三&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
        
        <span class="token comment"># 邮件模板</span>
        <span class="token keyword">def</span> <span class="token function">create_personalized_email</span><span class="token punctuation">(</span>recipient<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;创建个性化邮件&quot;&quot;&quot;</span>
            subject <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;欢迎 </span><span class="token interpolation"><span class="token punctuation">{</span>recipient<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 加入我们！&quot;</span></span>
            
            body <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;&quot;&quot;
            亲爱的 </span><span class="token interpolation"><span class="token punctuation">{</span>recipient<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">，
            
            欢迎您加入我们的Python学习社区！
            
            您的邮箱：</span><span class="token interpolation"><span class="token punctuation">{</span>recipient<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">
            注册时间：</span><span class="token interpolation"><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">
            
            我们为您准备了丰富的学习资源：
            • Python基础教程
            • 实战项目案例
            • 在线编程练习
            • 技术交流社区
            
            期待与您一起学习进步！
            
            Python学习团队
            &quot;&quot;&quot;</span></span>
            
            message <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">'plain'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            message<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> formataddr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Python学习团队&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;team@pythonlearn.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            message<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recipient<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span>
            message<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> message
        
        <span class="token comment"># 模拟批量发送</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   开始批量发送邮件...&quot;</span><span class="token punctuation">)</span>
        
        success_count <span class="token operator">=</span> <span class="token number">0</span>
        failed_count <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> recipient <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>recipients<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                message <span class="token operator">=</span> create_personalized_email<span class="token punctuation">(</span>recipient<span class="token punctuation">)</span>
                
                <span class="token comment"># 这里模拟发送过程</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   [</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>recipients<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">] 正在发送给 </span><span class="token interpolation"><span class="token punctuation">{</span>recipient<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>recipient<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># 实际发送代码会在这里</span>
                <span class="token comment"># server.sendmail(sender, recipient['email'], message.as_string())</span>
                
                success_count <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 发送成功&quot;</span></span><span class="token punctuation">)</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                failed_count <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 发送失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n   批量发送完成:&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   成功: </span><span class="token interpolation"><span class="token punctuation">{</span>success_count<span class="token punctuation">}</span></span><span class="token string"> 封&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   失败: </span><span class="token interpolation"><span class="token punctuation">{</span>failed_count<span class="token punctuation">}</span></span><span class="token string"> 封&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   总计: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>recipients<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 封&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 运行示例（注意：需要真实SMTP配置才能实际发送）</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n注意：以下示例需要配置真实的SMTP服务器信息&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;建议使用Gmail、QQ邮箱等提供的SMTP服务&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># send_text_email()  # 取消注释并配置SMTP信息后可运行</span>
    send_html_email<span class="token punctuation">(</span><span class="token punctuation">)</span>
    send_bulk_emails<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 运行SMTP基础演示</span>
smtp_basic_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-2-邮件附件处理"><a href="#_2-2-邮件附件处理" class="header-anchor">#</a> 2.2 邮件附件处理</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> os
<span class="token keyword">import</span> mimetypes
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>base <span class="token keyword">import</span> MIMEBase
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>image <span class="token keyword">import</span> MIMEImage
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>audio <span class="token keyword">import</span> MIMEAudio
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>application <span class="token keyword">import</span> MIMEApplication
<span class="token keyword">from</span> email <span class="token keyword">import</span> encoders
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

<span class="token keyword">def</span> <span class="token function">email_attachments_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件附件处理演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 邮件附件处理演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 添加文件附件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 添加文件附件:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">add_file_attachment</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;添加文件附件&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   文件不存在: </span><span class="token interpolation"><span class="token punctuation">{</span>file_path<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token comment"># 获取文件信息</span>
        filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
        file_size <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   添加附件: </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>file_size<span class="token punctuation">}</span></span><span class="token string"> 字节)&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 猜测文件类型</span>
        ctype<span class="token punctuation">,</span> encoding <span class="token operator">=</span> mimetypes<span class="token punctuation">.</span>guess_type<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ctype <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> encoding <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            ctype <span class="token operator">=</span> <span class="token string">'application/octet-stream'</span>
        
        maintype<span class="token punctuation">,</span> subtype <span class="token operator">=</span> ctype<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
                <span class="token keyword">if</span> maintype <span class="token operator">==</span> <span class="token string">'text'</span><span class="token punctuation">:</span>
                    <span class="token comment"># 文本文件</span>
                    attachment <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span>fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _subtype<span class="token operator">=</span>subtype<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> maintype <span class="token operator">==</span> <span class="token string">'image'</span><span class="token punctuation">:</span>
                    <span class="token comment"># 图片文件</span>
                    attachment <span class="token operator">=</span> MIMEImage<span class="token punctuation">(</span>fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _subtype<span class="token operator">=</span>subtype<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> maintype <span class="token operator">==</span> <span class="token string">'audio'</span><span class="token punctuation">:</span>
                    <span class="token comment"># 音频文件</span>
                    attachment <span class="token operator">=</span> MIMEAudio<span class="token punctuation">(</span>fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _subtype<span class="token operator">=</span>subtype<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 其他文件类型</span>
                    attachment <span class="token operator">=</span> MIMEBase<span class="token punctuation">(</span>maintype<span class="token punctuation">,</span> subtype<span class="token punctuation">)</span>
                    attachment<span class="token punctuation">.</span>set_payload<span class="token punctuation">(</span>fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    encoders<span class="token punctuation">.</span>encode_base64<span class="token punctuation">(</span>attachment<span class="token punctuation">)</span>
            
            <span class="token comment"># 设置附件头部</span>
            attachment<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span>
                <span class="token string">'Content-Disposition'</span><span class="token punctuation">,</span>
                <span class="token string">'attachment'</span><span class="token punctuation">,</span>
                filename<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            
            <span class="token comment"># 添加到邮件</span>
            message<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>attachment<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 附件添加成功: </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 附件添加失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># 2. 创建带附件的邮件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 创建带附件的邮件:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_email_with_attachments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;创建带附件的邮件&quot;&quot;&quot;</span>
        <span class="token comment"># 创建多部分邮件</span>
        message <span class="token operator">=</span> MIMEMultipart<span class="token punctuation">(</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> formataddr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Python发送者&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sender@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;recipient@example.com&quot;</span>
        message<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token string">&quot;带附件的邮件测试&quot;</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 邮件正文</span>
        body <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
        这是一封带有附件的测试邮件。
        
        附件说明：
        • 文档文件：包含项目说明
        • 图片文件：项目截图
        • 数据文件：分析结果
        
        请查收附件内容。
        
        谢谢！
        &quot;&quot;&quot;</span>
        
        message<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>MIMEText<span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">'plain'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 模拟添加不同类型的附件</span>
        attachments_info <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;document.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;文本文档&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2.5 KB&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;screenshot.png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;PNG图片&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;156 KB&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;data.csv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;CSV数据&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;45 KB&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;report.pdf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;PDF文档&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.2 MB&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   准备添加的附件:&quot;</span><span class="token punctuation">)</span>
        total_size <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> att <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>attachments_info<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>att<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>att<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>att<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span>
            <span class="token comment"># 这里模拟文件大小计算</span>
            size_num <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>att<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">'KB'</span> <span class="token keyword">in</span> att<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                total_size <span class="token operator">+=</span> size_num <span class="token operator">*</span> <span class="token number">1024</span>
            <span class="token keyword">elif</span> <span class="token string">'MB'</span> <span class="token keyword">in</span> att<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                total_size <span class="token operator">+=</span> size_num <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   总附件大小: </span><span class="token interpolation"><span class="token punctuation">{</span>total_size<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> MB&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 检查邮件大小限制</span>
        <span class="token keyword">if</span> total_size <span class="token operator">&gt;</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">:</span>  <span class="token comment"># 25MB限制</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   ⚠️  警告：附件总大小超过25MB，可能被邮件服务器拒绝&quot;</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> message
    
    <span class="token comment"># 3. 内嵌图片处理</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 内嵌图片处理:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_email_with_embedded_images</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;创建带内嵌图片的邮件&quot;&quot;&quot;</span>
        <span class="token comment"># 创建相关多部分邮件</span>
        message <span class="token operator">=</span> MIMEMultipart<span class="token punctuation">(</span><span class="token string">'related'</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> formataddr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Python发送者&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sender@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;recipient@example.com&quot;</span>
        message<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token string">&quot;带内嵌图片的HTML邮件&quot;</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># HTML内容，引用内嵌图片</span>
        html_content <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
        &lt;head&gt;
            &lt;meta charset=&quot;utf-8&quot;&gt;
            &lt;title&gt;内嵌图片邮件&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;h1&gt;Python邮件系统&lt;/h1&gt;
            &lt;p&gt;这是一封包含内嵌图片的HTML邮件。&lt;/p&gt;
            
            &lt;h2&gt;项目截图：&lt;/h2&gt;
            &lt;img src=&quot;cid:screenshot&quot; alt=&quot;项目截图&quot; style=&quot;max-width: 600px;&quot;&gt;
            
            &lt;h2&gt;Logo：&lt;/h2&gt;
            &lt;img src=&quot;cid:logo&quot; alt=&quot;公司Logo&quot; style=&quot;width: 200px;&quot;&gt;
            
            &lt;p&gt;图片已内嵌在邮件中，无需额外下载。&lt;/p&gt;
        &lt;/body&gt;
        &lt;/html&gt;
        &quot;&quot;&quot;</span>
        
        <span class="token comment"># 添加HTML内容</span>
        html_part <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span>html_content<span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        message<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>html_part<span class="token punctuation">)</span>
        
        <span class="token comment"># 模拟添加内嵌图片</span>
        embedded_images <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">&quot;cid&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;screenshot&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;screenshot.png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;项目截图&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;cid&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;logo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;logo.png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;公司Logo&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   内嵌图片信息:&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> img <span class="token keyword">in</span> embedded_images<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     CID: </span><span class="token interpolation"><span class="token punctuation">{</span>img<span class="token punctuation">[</span><span class="token string">'cid'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>img<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>img<span class="token punctuation">[</span><span class="token string">'desc'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 实际使用时的代码示例</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     # 添加内嵌图片的代码:&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     # with open('</span><span class="token interpolation"><span class="token punctuation">{</span>img<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">', 'rb') as f:&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     #     img_data = f.read()&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     #     image = MIMEImage(img_data)&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     #     image.add_header('Content-ID', '&lt;</span><span class="token interpolation"><span class="token punctuation">{</span>img<span class="token punctuation">[</span><span class="token string">'cid'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&gt;')&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     #     message.attach(image)&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> message
    
    <span class="token comment"># 4. 附件安全检查</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n4. 附件安全检查:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">check_attachment_security</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;检查附件安全性&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">&quot;文件不存在&quot;</span>
        
        filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
        file_ext <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        file_size <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
        
        <span class="token comment"># 危险文件扩展名</span>
        dangerous_extensions <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'.exe'</span><span class="token punctuation">,</span> <span class="token string">'.bat'</span><span class="token punctuation">,</span> <span class="token string">'.cmd'</span><span class="token punctuation">,</span> <span class="token string">'.com'</span><span class="token punctuation">,</span> <span class="token string">'.pif'</span><span class="token punctuation">,</span> <span class="token string">'.scr'</span><span class="token punctuation">,</span> <span class="token string">'.vbs'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">,</span>
            <span class="token string">'.jar'</span><span class="token punctuation">,</span> <span class="token string">'.msi'</span><span class="token punctuation">,</span> <span class="token string">'.dll'</span><span class="token punctuation">,</span> <span class="token string">'.sys'</span><span class="token punctuation">,</span> <span class="token string">'.drv'</span><span class="token punctuation">,</span> <span class="token string">'.ocx'</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment"># 检查文件扩展名</span>
        <span class="token keyword">if</span> file_ext <span class="token keyword">in</span> dangerous_extensions<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f&quot;危险的文件类型: </span><span class="token interpolation"><span class="token punctuation">{</span>file_ext<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
        
        <span class="token comment"># 检查文件大小（25MB限制）</span>
        max_size <span class="token operator">=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>
        <span class="token keyword">if</span> file_size <span class="token operator">&gt;</span> max_size<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f&quot;文件过大: </span><span class="token interpolation"><span class="token punctuation">{</span>file_size<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">MB &gt; 25MB&quot;</span></span>
        
        <span class="token comment"># 检查文件名</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">255</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">&quot;文件名过长&quot;</span>
        
        <span class="token comment"># 检查特殊字符</span>
        invalid_chars <span class="token operator">=</span> <span class="token string">'&lt;&gt;:&quot;/\\|?*'</span>
        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>char <span class="token keyword">in</span> filename <span class="token keyword">for</span> char <span class="token keyword">in</span> invalid_chars<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">&quot;文件名包含非法字符&quot;</span>
        
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">&quot;文件安全&quot;</span>
    
    <span class="token comment"># 测试安全检查</span>
    test_files <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;document.txt&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;image.png&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;script.exe&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># 危险文件</span>
        <span class="token string">&quot;very_long_filename_&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;x&quot;</span> <span class="token operator">*</span> <span class="token number">250</span> <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># 文件名过长</span>
        <span class="token string">&quot;file&lt;with&gt;invalid:chars.txt&quot;</span>  <span class="token comment"># 非法字符</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   附件安全检查结果:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> file_path <span class="token keyword">in</span> test_files<span class="token punctuation">:</span>
        is_safe<span class="token punctuation">,</span> message <span class="token operator">=</span> check_attachment_security<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
        status <span class="token operator">=</span> <span class="token string">&quot;✓ 安全&quot;</span> <span class="token keyword">if</span> is_safe <span class="token keyword">else</span> <span class="token string">&quot;✗ 危险&quot;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>file_path<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>status<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 运行示例</span>
    create_email_with_attachments<span class="token punctuation">(</span><span class="token punctuation">)</span>
    create_email_with_embedded_images<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 运行附件处理演示</span>
email_attachments_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-3-高级发送功能"><a href="#_2-3-高级发送功能" class="header-anchor">#</a> 2.3 高级发送功能</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">import</span> threading
<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta
<span class="token keyword">import</span> json
<span class="token keyword">import</span> logging

<span class="token keyword">def</span> <span class="token function">advanced_email_features</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;高级邮件发送功能演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 高级邮件发送功能演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 邮件模板系统</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 邮件模板系统:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">EmailTemplate</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件模板类&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> subject_template<span class="token punctuation">,</span> body_template<span class="token punctuation">,</span> template_type<span class="token operator">=</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
            self<span class="token punctuation">.</span>subject_template <span class="token operator">=</span> subject_template
            self<span class="token punctuation">.</span>body_template <span class="token operator">=</span> body_template
            self<span class="token punctuation">.</span>template_type <span class="token operator">=</span> template_type
            self<span class="token punctuation">.</span>created_at <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;渲染模板&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                subject <span class="token operator">=</span> self<span class="token punctuation">.</span>subject_template<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
                body <span class="token operator">=</span> self<span class="token punctuation">.</span>body_template<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
                <span class="token keyword">return</span> subject<span class="token punctuation">,</span> body
            <span class="token keyword">except</span> KeyError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;模板变量缺失: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">validate_variables</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;验证模板变量&quot;&quot;&quot;</span>
            <span class="token keyword">import</span> re
            
            <span class="token comment"># 提取模板中的变量</span>
            subject_vars <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\{(\w+)\}'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>subject_template<span class="token punctuation">)</span><span class="token punctuation">)</span>
            body_vars <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\{(\w+)\}'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>body_template<span class="token punctuation">)</span><span class="token punctuation">)</span>
            required_vars <span class="token operator">=</span> subject_vars <span class="token operator">|</span> body_vars
            
            provided_vars <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            missing_vars <span class="token operator">=</span> required_vars <span class="token operator">-</span> provided_vars
            
            <span class="token keyword">if</span> missing_vars<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f&quot;缺少变量: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>missing_vars<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">&quot;变量完整&quot;</span>
    
    <span class="token comment"># 创建邮件模板</span>
    templates <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'welcome'</span><span class="token punctuation">:</span> EmailTemplate<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">'欢迎邮件'</span><span class="token punctuation">,</span>
            subject_template<span class="token operator">=</span><span class="token string">'欢迎 {username} 加入 {platform}！'</span><span class="token punctuation">,</span>
            body_template<span class="token operator">=</span><span class="token triple-quoted-string string">&quot;&quot;&quot;
            亲爱的 {username}，
            
            欢迎您加入 {platform}！
            
            您的账户信息：
            • 用户名：{username}
            • 邮箱：{email}
            • 注册时间：{register_time}
            • 会员等级：{membership_level}
            
            接下来您可以：
            1. 完善个人资料
            2. 浏览学习资源
            3. 参与社区讨论
            4. 开始您的学习之旅
            
            如有任何问题，请随时联系我们。
            
            祝您学习愉快！
            
            {platform} 团队
            &quot;&quot;&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'notification'</span><span class="token punctuation">:</span> EmailTemplate<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">'通知邮件'</span><span class="token punctuation">,</span>
            subject_template<span class="token operator">=</span><span class="token string">'{notification_type}：{title}'</span><span class="token punctuation">,</span>
            body_template<span class="token operator">=</span><span class="token triple-quoted-string string">&quot;&quot;&quot;
            {username}，您好！
            
            您有一条新的{notification_type}：
            
            标题：{title}
            内容：{content}
            时间：{timestamp}
            优先级：{priority}
            
            {action_required}
            
            详情请登录系统查看。
            
            系统自动发送，请勿回复。
            &quot;&quot;&quot;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># 测试模板渲染</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   测试邮件模板:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 欢迎邮件测试</span>
    welcome_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
        <span class="token string">'platform'</span><span class="token punctuation">:</span> <span class="token string">'Python学习平台'</span><span class="token punctuation">,</span>
        <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'zhangsan@example.com'</span><span class="token punctuation">,</span>
        <span class="token string">'register_time'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'membership_level'</span><span class="token punctuation">:</span> <span class="token string">'普通会员'</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        subject<span class="token punctuation">,</span> body <span class="token operator">=</span> templates<span class="token punctuation">[</span><span class="token string">'welcome'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token operator">**</span>welcome_data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     欢迎邮件主题: </span><span class="token interpolation"><span class="token punctuation">{</span>subject<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     邮件长度: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 字符&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     模板渲染失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 通知邮件测试</span>
    notification_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'李四'</span><span class="token punctuation">,</span>
        <span class="token string">'notification_type'</span><span class="token punctuation">:</span> <span class="token string">'系统通知'</span><span class="token punctuation">,</span>
        <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'课程更新提醒'</span><span class="token punctuation">,</span>
        <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'Python高级编程课程已更新第10章内容'</span><span class="token punctuation">,</span>
        <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'priority'</span><span class="token punctuation">:</span> <span class="token string">'中等'</span><span class="token punctuation">,</span>
        <span class="token string">'action_required'</span><span class="token punctuation">:</span> <span class="token string">'请及时查看新增内容。'</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        subject<span class="token punctuation">,</span> body <span class="token operator">=</span> templates<span class="token punctuation">[</span><span class="token string">'notification'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token operator">**</span>notification_data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     通知邮件主题: </span><span class="token interpolation"><span class="token punctuation">{</span>subject<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     邮件长度: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 字符&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     模板渲染失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 2. 邮件队列系统</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 邮件队列系统:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">EmailQueue</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件队列管理器&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_workers<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> retry_times<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>max_workers <span class="token operator">=</span> max_workers
            self<span class="token punctuation">.</span>retry_times <span class="token operator">=</span> retry_times
            self<span class="token punctuation">.</span>workers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>is_running <span class="token operator">=</span> <span class="token boolean">False</span>
            self<span class="token punctuation">.</span>sent_count <span class="token operator">=</span> <span class="token number">0</span>
            self<span class="token punctuation">.</span>failed_count <span class="token operator">=</span> <span class="token number">0</span>
            
            <span class="token comment"># 配置日志</span>
            self<span class="token punctuation">.</span>logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'EmailQueue'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>handlers<span class="token punctuation">:</span>
                handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
                formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span>
                    <span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>
                <span class="token punctuation">)</span>
                handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">add_email</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_data<span class="token punctuation">,</span> priority<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;添加邮件到队列&quot;&quot;&quot;</span>
            email_item <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'data'</span><span class="token punctuation">:</span> email_data<span class="token punctuation">,</span>
                <span class="token string">'priority'</span><span class="token punctuation">:</span> priority<span class="token punctuation">,</span>
                <span class="token string">'retry_count'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'created_at'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;email_</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            <span class="token punctuation">}</span>
            
            self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>email_item<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;邮件已加入队列: </span><span class="token interpolation"><span class="token punctuation">{</span>email_item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">worker</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> worker_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;工作线程&quot;&quot;&quot;</span>
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;工作线程 </span><span class="token interpolation"><span class="token punctuation">{</span>worker_id<span class="token punctuation">}</span></span><span class="token string"> 启动&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>is_running<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token comment"># 获取邮件任务</span>
                    email_item <span class="token operator">=</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
                    
                    self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span>
                        <span class="token string-interpolation"><span class="token string">f&quot;[Worker-</span><span class="token interpolation"><span class="token punctuation">{</span>worker_id<span class="token punctuation">}</span></span><span class="token string">] 处理邮件: </span><span class="token interpolation"><span class="token punctuation">{</span>email_item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                    <span class="token punctuation">)</span>
                    
                    <span class="token comment"># 模拟发送邮件</span>
                    success <span class="token operator">=</span> self<span class="token punctuation">.</span>_send_email<span class="token punctuation">(</span>email_item<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    
                    <span class="token keyword">if</span> success<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>sent_count <span class="token operator">+=</span> <span class="token number">1</span>
                        self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span>
                            <span class="token string-interpolation"><span class="token string">f&quot;[Worker-</span><span class="token interpolation"><span class="token punctuation">{</span>worker_id<span class="token punctuation">}</span></span><span class="token string">] 邮件发送成功: </span><span class="token interpolation"><span class="token punctuation">{</span>email_item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                        <span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token comment"># 重试机制</span>
                        email_item<span class="token punctuation">[</span><span class="token string">'retry_count'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                        
                        <span class="token keyword">if</span> email_item<span class="token punctuation">[</span><span class="token string">'retry_count'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>retry_times<span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>
                                <span class="token string-interpolation"><span class="token string">f&quot;[Worker-</span><span class="token interpolation"><span class="token punctuation">{</span>worker_id<span class="token punctuation">}</span></span><span class="token string">] 邮件发送失败，重试 </span><span class="token interpolation"><span class="token punctuation">{</span>email_item<span class="token punctuation">[</span><span class="token string">'retry_count'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>retry_times<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>email_item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                            <span class="token punctuation">)</span>
                            <span class="token comment"># 重新加入队列</span>
                            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">**</span> email_item<span class="token punctuation">[</span><span class="token string">'retry_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 指数退避</span>
                            self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>email_item<span class="token punctuation">)</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span>failed_count <span class="token operator">+=</span> <span class="token number">1</span>
                            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span>
                                <span class="token string-interpolation"><span class="token string">f&quot;[Worker-</span><span class="token interpolation"><span class="token punctuation">{</span>worker_id<span class="token punctuation">}</span></span><span class="token string">] 邮件发送最终失败: </span><span class="token interpolation"><span class="token punctuation">{</span>email_item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                            <span class="token punctuation">)</span>
                    
                    self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token string">&quot;timed out&quot;</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[Worker-</span><span class="token interpolation"><span class="token punctuation">{</span>worker_id<span class="token punctuation">}</span></span><span class="token string">] 处理错误: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;工作线程 </span><span class="token interpolation"><span class="token punctuation">{</span>worker_id<span class="token punctuation">}</span></span><span class="token string"> 停止&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_send_email</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;模拟发送邮件&quot;&quot;&quot;</span>
            <span class="token comment"># 模拟网络延迟</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 模拟90%成功率</span>
            <span class="token keyword">import</span> random
            <span class="token keyword">return</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.1</span>
        
        <span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;启动队列处理&quot;&quot;&quot;</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_running<span class="token punctuation">:</span>
                <span class="token keyword">return</span>
            
            self<span class="token punctuation">.</span>is_running <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>sent_count <span class="token operator">=</span> <span class="token number">0</span>
            self<span class="token punctuation">.</span>failed_count <span class="token operator">=</span> <span class="token number">0</span>
            
            <span class="token comment"># 启动工作线程</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>max_workers<span class="token punctuation">)</span><span class="token punctuation">:</span>
                worker <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>
                    target<span class="token operator">=</span>self<span class="token punctuation">.</span>worker<span class="token punctuation">,</span>
                    args<span class="token operator">=</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    daemon<span class="token operator">=</span><span class="token boolean">True</span>
                <span class="token punctuation">)</span>
                worker<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>workers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>worker<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;邮件队列启动，工作线程数: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>max_workers<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;停止队列处理&quot;&quot;&quot;</span>
            self<span class="token punctuation">.</span>is_running <span class="token operator">=</span> <span class="token boolean">False</span>
            
            <span class="token comment"># 等待队列清空</span>
            self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;邮件队列已停止&quot;</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;发送统计 - 成功: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>sent_count<span class="token punctuation">}</span></span><span class="token string">, 失败: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>failed_count<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">get_status</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取队列状态&quot;&quot;&quot;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'queue_size'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'is_running'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>is_running<span class="token punctuation">,</span>
                <span class="token string">'workers'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>workers<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sent_count'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>sent_count<span class="token punctuation">,</span>
                <span class="token string">'failed_count'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>failed_count
            <span class="token punctuation">}</span>
    
    <span class="token comment"># 测试邮件队列</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   测试邮件队列系统:&quot;</span><span class="token punctuation">)</span>
    
    email_queue <span class="token operator">=</span> EmailQueue<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    email_queue<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 添加测试邮件</span>
    test_emails <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">'to'</span><span class="token punctuation">:</span> <span class="token string">'user1@example.com'</span><span class="token punctuation">,</span> <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'测试邮件1'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'内容1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">'to'</span><span class="token punctuation">:</span> <span class="token string">'user2@example.com'</span><span class="token punctuation">,</span> <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'测试邮件2'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'内容2'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">'to'</span><span class="token punctuation">:</span> <span class="token string">'user3@example.com'</span><span class="token punctuation">,</span> <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'测试邮件3'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'内容3'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">'to'</span><span class="token punctuation">:</span> <span class="token string">'user4@example.com'</span><span class="token punctuation">,</span> <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'测试邮件4'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'内容4'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">'to'</span><span class="token punctuation">:</span> <span class="token string">'user5@example.com'</span><span class="token punctuation">,</span> <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'测试邮件5'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'内容5'</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> email_data <span class="token keyword">in</span> test_emails<span class="token punctuation">:</span>
        email_queue<span class="token punctuation">.</span>add_email<span class="token punctuation">(</span>email_data<span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   已添加 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_emails<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 封邮件到队列&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 等待处理完成</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    
    status <span class="token operator">=</span> email_queue<span class="token punctuation">.</span>get_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   队列状态: </span><span class="token interpolation"><span class="token punctuation">{</span>status<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    email_queue<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 3. 邮件发送统计</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 邮件发送统计:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">EmailStatistics</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件发送统计&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>stats <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'total_sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'total_failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'daily_stats'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">'hourly_stats'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">'recipient_stats'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">'template_stats'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        
        <span class="token keyword">def</span> <span class="token function">record_sent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> recipient<span class="token punctuation">,</span> template_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;记录发送成功&quot;&quot;&quot;</span>
            now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
            date_key <span class="token operator">=</span> now<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span>
            hour_key <span class="token operator">=</span> now<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:00'</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'total_sent'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 按日统计</span>
            <span class="token keyword">if</span> date_key <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'daily_stats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'daily_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>date_key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'daily_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>date_key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sent'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 按小时统计</span>
            <span class="token keyword">if</span> hour_key <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'hourly_stats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'hourly_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>hour_key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'hourly_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>hour_key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sent'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 按收件人统计</span>
            <span class="token keyword">if</span> recipient <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'recipient_stats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'recipient_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>recipient<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'recipient_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>recipient<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sent'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 按模板统计</span>
            <span class="token keyword">if</span> template_name<span class="token punctuation">:</span>
                <span class="token keyword">if</span> template_name <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'template_stats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'template_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>template_name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
                self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'template_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>template_name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sent'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token keyword">def</span> <span class="token function">record_failed</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> recipient<span class="token punctuation">,</span> template_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;记录发送失败&quot;&quot;&quot;</span>
            now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
            date_key <span class="token operator">=</span> now<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span>
            hour_key <span class="token operator">=</span> now<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:00'</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'total_failed'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 按日统计</span>
            <span class="token keyword">if</span> date_key <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'daily_stats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'daily_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>date_key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'daily_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>date_key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'failed'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 按小时统计</span>
            <span class="token keyword">if</span> hour_key <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'hourly_stats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'hourly_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>hour_key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'hourly_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>hour_key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'failed'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 按收件人统计</span>
            <span class="token keyword">if</span> recipient <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'recipient_stats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'recipient_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>recipient<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'recipient_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>recipient<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'failed'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 按模板统计</span>
            <span class="token keyword">if</span> template_name<span class="token punctuation">:</span>
                <span class="token keyword">if</span> template_name <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'template_stats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'template_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>template_name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'sent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'failed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
                self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'template_stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>template_name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'failed'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token keyword">def</span> <span class="token function">get_summary</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取统计摘要&quot;&quot;&quot;</span>
            total <span class="token operator">=</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'total_sent'</span><span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'total_failed'</span><span class="token punctuation">]</span>
            success_rate <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'total_sent'</span><span class="token punctuation">]</span> <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">if</span> total <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
            
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'total_emails'</span><span class="token punctuation">:</span> total<span class="token punctuation">,</span>
                <span class="token string">'successful'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'total_sent'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'failed'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'total_failed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'success_rate'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>success_rate<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%&quot;</span></span><span class="token punctuation">,</span>
                <span class="token string">'unique_recipients'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'recipient_stats'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'templates_used'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'template_stats'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        
        <span class="token keyword">def</span> <span class="token function">export_stats</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;导出统计数据&quot;&quot;&quot;</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> filename<span class="token punctuation">:</span>
                filename <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;email_stats_</span><span class="token interpolation"><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d_%H%M%S'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">.json&quot;</span></span>
            
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>stats<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> filename
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;导出统计数据失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">None</span>
    
    <span class="token comment"># 测试统计功能</span>
    stats <span class="token operator">=</span> EmailStatistics<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟一些发送记录</span>
    test_records <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">'user1@example.com'</span><span class="token punctuation">,</span> <span class="token string">'welcome'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'user2@example.com'</span><span class="token punctuation">,</span> <span class="token string">'welcome'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'user3@example.com'</span><span class="token punctuation">,</span> <span class="token string">'notification'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'user1@example.com'</span><span class="token punctuation">,</span> <span class="token string">'notification'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'user4@example.com'</span><span class="token punctuation">,</span> <span class="token string">'welcome'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> recipient<span class="token punctuation">,</span> template<span class="token punctuation">,</span> success <span class="token keyword">in</span> test_records<span class="token punctuation">:</span>
        <span class="token keyword">if</span> success<span class="token punctuation">:</span>
            stats<span class="token punctuation">.</span>record_sent<span class="token punctuation">(</span>recipient<span class="token punctuation">,</span> template<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            stats<span class="token punctuation">.</span>record_failed<span class="token punctuation">(</span>recipient<span class="token punctuation">,</span> template<span class="token punctuation">)</span>
    
    summary <span class="token operator">=</span> stats<span class="token punctuation">.</span>get_summary<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   发送统计摘要:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> summary<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 导出统计数据</span>
    <span class="token comment"># export_file = stats.export_stats()</span>
    <span class="token comment"># if export_file:</span>
    <span class="token comment">#     print(f&quot;   统计数据已导出到: {export_file}&quot;)</span>

<span class="token comment"># 运行高级功能演示</span>
advanced_email_features<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-接收邮件"><a href="#_3-接收邮件" class="header-anchor">#</a> 3. 接收邮件</h2> <h3 id="_3-1-pop3接收邮件"><a href="#_3-1-pop3接收邮件" class="header-anchor">#</a> 3.1 POP3接收邮件</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> poplib
<span class="token keyword">from</span> email<span class="token punctuation">.</span>parser <span class="token keyword">import</span> Parser
<span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> decode_header
<span class="token keyword">from</span> email<span class="token punctuation">.</span>utils <span class="token keyword">import</span> parseaddr
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> quopri

<span class="token keyword">def</span> <span class="token function">pop3_receive_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;POP3接收邮件演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== POP3接收邮件演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 连接POP3服务器</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 连接POP3服务器:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">connect_pop3_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;连接POP3服务器&quot;&quot;&quot;</span>
        <span class="token comment"># POP3服务器配置</span>
        pop3_config <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'server'</span><span class="token punctuation">:</span> <span class="token string">'pop.gmail.com'</span><span class="token punctuation">,</span>
            <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token number">995</span><span class="token punctuation">,</span>  <span class="token comment"># SSL端口</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'your_email@gmail.com'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'your_app_password'</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   正在连接POP3服务器...&quot;</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 连接SSL POP3服务器</span>
            server <span class="token operator">=</span> poplib<span class="token punctuation">.</span>POP3_SSL<span class="token punctuation">(</span>pop3_config<span class="token punctuation">[</span><span class="token string">'server'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pop3_config<span class="token punctuation">[</span><span class="token string">'port'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 登录</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   正在登录...&quot;</span><span class="token punctuation">)</span>
            server<span class="token punctuation">.</span>user<span class="token punctuation">(</span>pop3_config<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            server<span class="token punctuation">.</span>pass_<span class="token punctuation">(</span>pop3_config<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 获取邮箱统计信息</span>
            num_messages<span class="token punctuation">,</span> total_size <span class="token operator">=</span> server<span class="token punctuation">.</span>stat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 连接成功！&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   邮件数量: </span><span class="token interpolation"><span class="token punctuation">{</span>num_messages<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   总大小: </span><span class="token interpolation"><span class="token punctuation">{</span>total_size<span class="token punctuation">}</span></span><span class="token string"> 字节&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> server
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 连接失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
    
    <span class="token comment"># 2. 获取邮件列表</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 获取邮件列表:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_email_list</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;获取邮件列表&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> server<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   服务器连接无效&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 获取邮件列表</span>
            messages <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   邮件列表响应: </span><span class="token interpolation"><span class="token punctuation">{</span>messages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            email_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> msg_info <span class="token keyword">in</span> messages<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 解析邮件信息：序号 大小</span>
                parts <span class="token operator">=</span> msg_info<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
                msg_num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                msg_size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                
                email_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token string">'number'</span><span class="token punctuation">:</span> msg_num<span class="token punctuation">,</span>
                    <span class="token string">'size'</span><span class="token punctuation">:</span> msg_size
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   获取到 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>email_list<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 封邮件:&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> email_info <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>email_list<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 只显示前5封</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. 邮件</span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 字节&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>email_list<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     ... 还有 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>email_list<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">}</span></span><span class="token string"> 封邮件&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> email_list
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   获取邮件列表失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 3. 下载和解析邮件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 下载和解析邮件:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">download_and_parse_email</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> msg_num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;下载和解析邮件&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> server<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   服务器连接无效&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   正在下载邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>msg_num<span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 获取邮件内容</span>
            response<span class="token punctuation">,</span> lines<span class="token punctuation">,</span> octets <span class="token operator">=</span> server<span class="token punctuation">.</span>retr<span class="token punctuation">(</span>msg_num<span class="token punctuation">)</span>
            
            <span class="token comment"># 合并邮件内容</span>
            raw_email <span class="token operator">=</span> <span class="token string">b'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>lines<span class="token punctuation">)</span>
            
            <span class="token comment"># 解析邮件</span>
            parser <span class="token operator">=</span> Parser<span class="token punctuation">(</span><span class="token punctuation">)</span>
            email_message <span class="token operator">=</span> parser<span class="token punctuation">.</span>parsestr<span class="token punctuation">(</span>raw_email<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 提取邮件信息</span>
            email_info <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'number'</span><span class="token punctuation">:</span> msg_num<span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'From'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'to'</span><span class="token punctuation">:</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'To'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'date'</span><span class="token punctuation">:</span> email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> octets
            <span class="token punctuation">}</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 邮件下载成功&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     主题: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     发件人: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'from'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     收件人: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'to'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     日期: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     大小: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 字节&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 提取邮件正文</span>
            body <span class="token operator">=</span> extract_email_body<span class="token punctuation">(</span>email_message<span class="token punctuation">)</span>
            <span class="token keyword">if</span> body<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     正文预览: </span><span class="token interpolation"><span class="token punctuation">{</span>body<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> email_info<span class="token punctuation">,</span> email_message
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   下载邮件失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">decode_email_header</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;解码邮件头部&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> header<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">''</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            decoded_parts <span class="token operator">=</span> decode_header<span class="token punctuation">(</span>header<span class="token punctuation">)</span>
            decoded_str <span class="token operator">=</span> <span class="token string">''</span>
            
            <span class="token keyword">for</span> part<span class="token punctuation">,</span> encoding <span class="token keyword">in</span> decoded_parts<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>part<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> encoding<span class="token punctuation">:</span>
                        decoded_str <span class="token operator">+=</span> part<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        decoded_str <span class="token operator">+=</span> part<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    decoded_str <span class="token operator">+=</span> part
            
            <span class="token keyword">return</span> decoded_str
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">return</span> header
    
    <span class="token keyword">def</span> <span class="token function">extract_email_body</span><span class="token punctuation">(</span>email_message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;提取邮件正文&quot;&quot;&quot;</span>
        body <span class="token operator">=</span> <span class="token string">''</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> email_message<span class="token punctuation">.</span>is_multipart<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 多部分邮件</span>
                <span class="token keyword">for</span> part <span class="token keyword">in</span> email_message<span class="token punctuation">.</span>walk<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    content_type <span class="token operator">=</span> part<span class="token punctuation">.</span>get_content_type<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    content_disposition <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>part<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># 跳过附件</span>
                    <span class="token keyword">if</span> <span class="token string">'attachment'</span> <span class="token keyword">in</span> content_disposition<span class="token punctuation">:</span>
                        <span class="token keyword">continue</span>
                    
                    <span class="token keyword">if</span> content_type <span class="token operator">==</span> <span class="token string">'text/plain'</span><span class="token punctuation">:</span>
                        charset <span class="token operator">=</span> part<span class="token punctuation">.</span>get_content_charset<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'utf-8'</span>
                        body <span class="token operator">=</span> part<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span>decode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
                    <span class="token keyword">elif</span> content_type <span class="token operator">==</span> <span class="token string">'text/html'</span> <span class="token keyword">and</span> <span class="token keyword">not</span> body<span class="token punctuation">:</span>
                        charset <span class="token operator">=</span> part<span class="token punctuation">.</span>get_content_charset<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'utf-8'</span>
                        body <span class="token operator">=</span> part<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span>decode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 单部分邮件</span>
                charset <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get_content_charset<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'utf-8'</span>
                body <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span>decode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> body
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   提取邮件正文失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">''</span>
    
    <span class="token comment"># 4. 删除邮件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n4. 删除邮件:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">delete_email</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> msg_num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;删除邮件&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> server<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   服务器连接无效&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   正在删除邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>msg_num<span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
            server<span class="token punctuation">.</span>dele<span class="token punctuation">(</span>msg_num<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>msg_num<span class="token punctuation">}</span></span><span class="token string"> 已标记为删除&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   注意：邮件将在quit()后真正删除&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   删除邮件失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># 模拟POP3操作</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   模拟POP3邮件接收流程:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   注意：需要配置真实的POP3服务器信息&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟邮件信息</span>
    mock_emails <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">'number'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'Python学习资料'</span><span class="token punctuation">,</span>
            <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'teacher@pythonlearn.com'</span><span class="token punctuation">,</span>
            <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'2023-06-15 10:30:00'</span><span class="token punctuation">,</span>
            <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">2048</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">'number'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'系统通知'</span><span class="token punctuation">,</span>
            <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'system@example.com'</span><span class="token punctuation">,</span>
            <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'2023-06-15 14:20:00'</span><span class="token punctuation">,</span>
            <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">1024</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   模拟邮件列表 (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>mock_emails<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 封):&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> email <span class="token keyword">in</span> mock_emails<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     邮件</span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">[</span><span class="token string">'from'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># server = connect_pop3_server()  # 需要真实配置</span>
    <span class="token comment"># if server:</span>
    <span class="token comment">#     email_list = get_email_list(server)</span>
    <span class="token comment">#     if email_list:</span>
    <span class="token comment">#         # 下载第一封邮件</span>
    <span class="token comment">#         download_and_parse_email(server, 1)</span>
    <span class="token comment">#     server.quit()</span>

<span class="token comment"># 运行POP3演示</span>
pop3_receive_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-2-imap接收邮件"><a href="#_3-2-imap接收邮件" class="header-anchor">#</a> 3.2 IMAP接收邮件</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> imaplib
<span class="token keyword">import</span> email
<span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> decode_header
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">imap_receive_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;IMAP接收邮件演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== IMAP接收邮件演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 连接IMAP服务器</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 连接IMAP服务器:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">connect_imap_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;连接IMAP服务器&quot;&quot;&quot;</span>
        <span class="token comment"># IMAP服务器配置</span>
        imap_config <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'server'</span><span class="token punctuation">:</span> <span class="token string">'imap.gmail.com'</span><span class="token punctuation">,</span>
            <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token number">993</span><span class="token punctuation">,</span>  <span class="token comment"># SSL端口</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'your_email@gmail.com'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'your_app_password'</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   正在连接IMAP服务器...&quot;</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 连接SSL IMAP服务器</span>
            server <span class="token operator">=</span> imaplib<span class="token punctuation">.</span>IMAP4_SSL<span class="token punctuation">(</span>imap_config<span class="token punctuation">[</span><span class="token string">'server'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> imap_config<span class="token punctuation">[</span><span class="token string">'port'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 登录</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   正在登录...&quot;</span><span class="token punctuation">)</span>
            server<span class="token punctuation">.</span>login<span class="token punctuation">(</span>imap_config<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> imap_config<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 连接成功！&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> server
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 连接失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
    
    <span class="token comment"># 2. 选择邮箱文件夹</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 选择邮箱文件夹:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">list_mailboxes</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;列出邮箱文件夹&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> server<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   服务器连接无效&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 获取文件夹列表</span>
            status<span class="token punctuation">,</span> folders <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> status <span class="token operator">==</span> <span class="token string">'OK'</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   可用文件夹:&quot;</span><span class="token punctuation">)</span>
                folder_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
                <span class="token keyword">for</span> folder <span class="token keyword">in</span> folders<span class="token punctuation">:</span>
                    <span class="token comment"># 解析文件夹信息</span>
                    folder_str <span class="token operator">=</span> folder<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
                    <span class="token comment"># 提取文件夹名称</span>
                    <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'&quot;([^&quot;]+)&quot;$'</span><span class="token punctuation">,</span> folder_str<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
                        folder_name <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token comment"># 如果没有引号，取最后一个空格后的内容</span>
                        folder_name <span class="token operator">=</span> folder_str<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                    
                    folder_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>folder_name<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     • </span><span class="token interpolation"><span class="token punctuation">{</span>folder_name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                
                <span class="token keyword">return</span> folder_list
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   获取文件夹列表失败&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   获取文件夹列表失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">select_mailbox</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> mailbox<span class="token operator">=</span><span class="token string">'INBOX'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;选择邮箱文件夹&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> server<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   服务器连接无效&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   正在选择文件夹: </span><span class="token interpolation"><span class="token punctuation">{</span>mailbox<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            status<span class="token punctuation">,</span> messages <span class="token operator">=</span> server<span class="token punctuation">.</span>select<span class="token punctuation">(</span>mailbox<span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> status <span class="token operator">==</span> <span class="token string">'OK'</span><span class="token punctuation">:</span>
                num_messages <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>messages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 文件夹选择成功&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   邮件数量: </span><span class="token interpolation"><span class="token punctuation">{</span>num_messages<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   文件夹选择失败: </span><span class="token interpolation"><span class="token punctuation">{</span>status<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   选择文件夹失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># 3. 搜索邮件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 搜索邮件:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">search_emails</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> criteria<span class="token operator">=</span><span class="token string">'ALL'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;搜索邮件&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> server<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   服务器连接无效&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   搜索条件: </span><span class="token interpolation"><span class="token punctuation">{</span>criteria<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            status<span class="token punctuation">,</span> messages <span class="token operator">=</span> server<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> criteria<span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> status <span class="token operator">==</span> <span class="token string">'OK'</span><span class="token punctuation">:</span>
                <span class="token comment"># 获取邮件ID列表</span>
                email_ids <span class="token operator">=</span> messages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   找到 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>email_ids<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 封邮件&quot;</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># 显示邮件ID</span>
                <span class="token keyword">if</span> email_ids<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   邮件ID列表:&quot;</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> i<span class="token punctuation">,</span> email_id <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>email_ids<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 只显示前10个</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>email_id<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    
                    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>email_ids<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     ... 还有 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>email_ids<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">}</span></span><span class="token string"> 封邮件&quot;</span></span><span class="token punctuation">)</span>
                
                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">id</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token builtin">id</span> <span class="token keyword">in</span> email_ids<span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   搜索失败: </span><span class="token interpolation"><span class="token punctuation">{</span>status<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   搜索邮件失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">advanced_search_examples</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;高级搜索示例&quot;&quot;&quot;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   高级搜索示例:&quot;</span><span class="token punctuation">)</span>
        
        search_examples <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">(</span><span class="token string">'ALL'</span><span class="token punctuation">,</span> <span class="token string">'所有邮件'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'UNSEEN'</span><span class="token punctuation">,</span> <span class="token string">'未读邮件'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'FROM &quot;example@gmail.com&quot;'</span><span class="token punctuation">,</span> <span class="token string">'来自特定发件人'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'SUBJECT &quot;Python&quot;'</span><span class="token punctuation">,</span> <span class="token string">'主题包含Python'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'SINCE &quot;01-Jun-2023&quot;'</span><span class="token punctuation">,</span> <span class="token string">'2023年6月1日之后的邮件'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'BEFORE &quot;01-Jul-2023&quot;'</span><span class="token punctuation">,</span> <span class="token string">'2023年7月1日之前的邮件'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'LARGER 1000000'</span><span class="token punctuation">,</span> <span class="token string">'大于1MB的邮件'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'SMALLER 1000'</span><span class="token punctuation">,</span> <span class="token string">'小于1KB的邮件'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> criteria<span class="token punctuation">,</span> description <span class="token keyword">in</span> search_examples<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>criteria<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>description<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token comment"># 实际搜索时取消注释</span>
            <span class="token comment"># email_ids = search_emails(server, criteria)</span>
    
    <span class="token comment"># 4. 获取邮件内容</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n4. 获取邮件内容:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">fetch_email</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> email_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;获取邮件内容&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> server<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   服务器连接无效&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   正在获取邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>email_id<span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 获取邮件</span>
            status<span class="token punctuation">,</span> msg_data <span class="token operator">=</span> server<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span>email_id<span class="token punctuation">,</span> <span class="token string">'(RFC822)'</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> status <span class="token operator">==</span> <span class="token string">'OK'</span><span class="token punctuation">:</span>
                <span class="token comment"># 解析邮件</span>
                raw_email <span class="token operator">=</span> msg_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                email_message <span class="token operator">=</span> email<span class="token punctuation">.</span>message_from_bytes<span class="token punctuation">(</span>raw_email<span class="token punctuation">)</span>
                
                <span class="token comment"># 提取邮件信息</span>
                email_info <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">'id'</span><span class="token punctuation">:</span> email_id<span class="token punctuation">,</span>
                    <span class="token string">'subject'</span><span class="token punctuation">:</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'from'</span><span class="token punctuation">:</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'From'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'to'</span><span class="token punctuation">:</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'To'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'date'</span><span class="token punctuation">:</span> email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'message_id'</span><span class="token punctuation">:</span> email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Message-ID'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 邮件获取成功&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     主题: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     发件人: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'from'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     日期: </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># 提取邮件正文和附件</span>
                body<span class="token punctuation">,</span> attachments <span class="token operator">=</span> extract_email_content<span class="token punctuation">(</span>email_message<span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> body<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     正文预览: </span><span class="token interpolation"><span class="token punctuation">{</span>body<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> attachments<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     附件数量: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>attachments<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> i<span class="token punctuation">,</span> att <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>attachments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>att<span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>att<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 字节)&quot;</span></span><span class="token punctuation">)</span>
                
                <span class="token keyword">return</span> email_info<span class="token punctuation">,</span> email_message
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   获取邮件失败: </span><span class="token interpolation"><span class="token punctuation">{</span>status<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   获取邮件失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">extract_email_content</span><span class="token punctuation">(</span>email_message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;提取邮件内容和附件&quot;&quot;&quot;</span>
        body <span class="token operator">=</span> <span class="token string">''</span>
        attachments <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> email_message<span class="token punctuation">.</span>is_multipart<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> part <span class="token keyword">in</span> email_message<span class="token punctuation">.</span>walk<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    content_type <span class="token operator">=</span> part<span class="token punctuation">.</span>get_content_type<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    content_disposition <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>part<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    
                    <span class="token keyword">if</span> <span class="token string">'attachment'</span> <span class="token keyword">in</span> content_disposition<span class="token punctuation">:</span>
                        <span class="token comment"># 处理附件</span>
                        filename <span class="token operator">=</span> part<span class="token punctuation">.</span>get_filename<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> filename<span class="token punctuation">:</span>
                            filename <span class="token operator">=</span> decode_email_header<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
                            payload <span class="token operator">=</span> part<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span>decode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                            attachments<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                                <span class="token string">'filename'</span><span class="token punctuation">:</span> filename<span class="token punctuation">,</span>
                                <span class="token string">'content_type'</span><span class="token punctuation">:</span> content_type<span class="token punctuation">,</span>
                                <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token keyword">if</span> payload <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">,</span>
                                <span class="token string">'data'</span><span class="token punctuation">:</span> payload
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token keyword">elif</span> content_type <span class="token operator">==</span> <span class="token string">'text/plain'</span> <span class="token keyword">and</span> <span class="token keyword">not</span> body<span class="token punctuation">:</span>
                        <span class="token comment"># 提取纯文本正文</span>
                        charset <span class="token operator">=</span> part<span class="token punctuation">.</span>get_content_charset<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'utf-8'</span>
                        payload <span class="token operator">=</span> part<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span>decode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
                            body <span class="token operator">=</span> payload<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
                    <span class="token keyword">elif</span> content_type <span class="token operator">==</span> <span class="token string">'text/html'</span> <span class="token keyword">and</span> <span class="token keyword">not</span> body<span class="token punctuation">:</span>
                        <span class="token comment"># 提取HTML正文</span>
                        charset <span class="token operator">=</span> part<span class="token punctuation">.</span>get_content_charset<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'utf-8'</span>
                        payload <span class="token operator">=</span> part<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span>decode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
                            body <span class="token operator">=</span> payload<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 单部分邮件</span>
                charset <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get_content_charset<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'utf-8'</span>
                payload <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span>decode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
                    body <span class="token operator">=</span> payload<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> body<span class="token punctuation">,</span> attachments
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   提取邮件内容失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 5. 邮件标记操作</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n5. 邮件标记操作:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">mark_email_as_read</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> email_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;标记邮件为已读&quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            server<span class="token punctuation">.</span>store<span class="token punctuation">(</span>email_id<span class="token punctuation">,</span> <span class="token string">'+FLAGS'</span><span class="token punctuation">,</span> <span class="token string">'\\Seen'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>email_id<span class="token punctuation">}</span></span><span class="token string"> 已标记为已读&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   标记邮件失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">mark_email_as_unread</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> email_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;标记邮件为未读&quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            server<span class="token punctuation">.</span>store<span class="token punctuation">(</span>email_id<span class="token punctuation">,</span> <span class="token string">'-FLAGS'</span><span class="token punctuation">,</span> <span class="token string">'\\Seen'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>email_id<span class="token punctuation">}</span></span><span class="token string"> 已标记为未读&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   标记邮件失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">delete_email_imap</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> email_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;删除邮件（IMAP）&quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 标记为删除</span>
            server<span class="token punctuation">.</span>store<span class="token punctuation">(</span>email_id<span class="token punctuation">,</span> <span class="token string">'+FLAGS'</span><span class="token punctuation">,</span> <span class="token string">'\\Deleted'</span><span class="token punctuation">)</span>
            <span class="token comment"># 执行删除</span>
            server<span class="token punctuation">.</span>expunge<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>email_id<span class="token punctuation">}</span></span><span class="token string"> 已删除&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   删除邮件失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟IMAP操作</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   模拟IMAP邮件接收流程:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   注意：需要配置真实的IMAP服务器信息&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟操作流程</span>
    operations <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;1. 连接IMAP服务器&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;2. 登录账户&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;3. 列出邮箱文件夹&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;4. 选择INBOX文件夹&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;5. 搜索未读邮件&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;6. 获取邮件内容&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;7. 处理附件&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;8. 标记邮件状态&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;9. 关闭连接&quot;</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   IMAP操作流程:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> op <span class="token keyword">in</span> operations<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>op<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># server = connect_imap_server()  # 需要真实配置</span>
    <span class="token comment"># if server:</span>
    <span class="token comment">#     list_mailboxes(server)</span>
    <span class="token comment">#     if select_mailbox(server, 'INBOX'):</span>
    <span class="token comment">#         email_ids = search_emails(server, 'UNSEEN')</span>
    <span class="token comment">#         if email_ids:</span>
    <span class="token comment">#             fetch_email(server, email_ids[0])</span>
    <span class="token comment">#     server.close()</span>
    <span class="token comment">#     server.logout()</span>
    
    advanced_search_examples<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token comment"># 运行IMAP演示</span>
imap_receive_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-3-邮件内容解析"><a href="#_3-3-邮件内容解析" class="header-anchor">#</a> 3.3 邮件内容解析</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> re
<span class="token keyword">import</span> html2text
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> chardet

<span class="token keyword">def</span> <span class="token function">email_parsing_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件内容解析演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 邮件内容解析演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. HTML邮件解析</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. HTML邮件解析:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">parse_html_email</span><span class="token punctuation">(</span>html_content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;解析HTML邮件&quot;&quot;&quot;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   解析HTML邮件内容...&quot;</span><span class="token punctuation">)</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 使用BeautifulSoup解析HTML</span>
            soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html_content<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 提取文本内容</span>
            text_content <span class="token operator">=</span> soup<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 清理文本</span>
            text_content <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'\n\s*\n'</span><span class="token punctuation">,</span> <span class="token string">'\n\n'</span><span class="token punctuation">,</span> text_content<span class="token punctuation">)</span>
            text_content <span class="token operator">=</span> text_content<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 提取链接</span>
            links <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> link <span class="token keyword">in</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> href<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                links<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token string">'text'</span><span class="token punctuation">:</span> link<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'url'</span><span class="token punctuation">:</span> link<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 提取图片</span>
            images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> img <span class="token keyword">in</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> src<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                images<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token string">'alt'</span><span class="token punctuation">:</span> img<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'alt'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'src'</span><span class="token punctuation">:</span> img<span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ HTML解析完成&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     文本长度: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>text_content<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 字符&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     链接数量: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>links<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     图片数量: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> links<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     链接列表:&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> i<span class="token punctuation">,</span> link <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>links<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>link<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>link<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'text'</span><span class="token punctuation">:</span> text_content<span class="token punctuation">,</span>
                <span class="token string">'links'</span><span class="token punctuation">:</span> links<span class="token punctuation">,</span>
                <span class="token string">'images'</span><span class="token punctuation">:</span> images
            <span class="token punctuation">}</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   HTML解析失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">html_to_text</span><span class="token punctuation">(</span>html_content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;HTML转纯文本&quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 使用html2text转换</span>
            h <span class="token operator">=</span> html2text<span class="token punctuation">.</span>HTML2Text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            h<span class="token punctuation">.</span>ignore_links <span class="token operator">=</span> <span class="token boolean">False</span>
            h<span class="token punctuation">.</span>ignore_images <span class="token operator">=</span> <span class="token boolean">False</span>
            h<span class="token punctuation">.</span>body_width <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 不限制行宽</span>
            
            text <span class="token operator">=</span> h<span class="token punctuation">.</span>handle<span class="token punctuation">(</span>html_content<span class="token punctuation">)</span>
            <span class="token keyword">return</span> text
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   HTML转文本失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> html_content
    
    <span class="token comment"># 2. 邮件编码处理</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 邮件编码处理:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">detect_encoding</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;检测文本编码&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">'utf-8'</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            result <span class="token operator">=</span> chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            encoding <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'encoding'</span><span class="token punctuation">]</span>
            confidence <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'confidence'</span><span class="token punctuation">]</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   检测到编码: </span><span class="token interpolation"><span class="token punctuation">{</span>encoding<span class="token punctuation">}</span></span><span class="token string"> (置信度: </span><span class="token interpolation"><span class="token punctuation">{</span>confidence<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> encoding
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   编码检测失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">'utf-8'</span>
    
    <span class="token keyword">def</span> <span class="token function">decode_content</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;解码内容&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> data
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> encoding<span class="token punctuation">:</span>
            encoding <span class="token operator">=</span> detect_encoding<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   解码失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 3. 邮件地址解析</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 邮件地址解析:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">parse_email_addresses</span><span class="token punctuation">(</span>address_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;解析邮件地址&quot;&quot;&quot;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   解析地址字符串: </span><span class="token interpolation"><span class="token punctuation">{</span>address_string<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        addresses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 分割多个地址</span>
            addr_list <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[,;]'</span><span class="token punctuation">,</span> address_string<span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> addr <span class="token keyword">in</span> addr_list<span class="token punctuation">:</span>
                addr <span class="token operator">=</span> addr<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> addr<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                
                <span class="token comment"># 解析地址格式：&quot;Name&quot; &lt;email@domain.com&gt; 或 email@domain.com</span>
                <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^&quot;?([^&quot;&lt;&gt;]+?)&quot;?\s*&lt;([^&lt;&gt;]+)&gt;$'</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
                    name <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    email <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 简单邮件地址</span>
                    email_match <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> email_match<span class="token punctuation">:</span>
                        email <span class="token operator">=</span> email_match<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                        name <span class="token operator">=</span> addr<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>email<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'&lt;&gt; &quot;'</span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">continue</span>
                
                addresses<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token string">'name'</span><span class="token punctuation">:</span> name <span class="token keyword">if</span> name <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    <span class="token string">'email'</span><span class="token punctuation">:</span> email
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   解析出 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>addresses<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 个地址:&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> addr <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>addresses<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> addr<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>addr<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> &lt;</span><span class="token interpolation"><span class="token punctuation">{</span>addr<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&gt;&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>addr<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> addresses
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   地址解析失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 4. 邮件内容提取</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n4. 邮件内容提取:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">extract_email_metadata</span><span class="token punctuation">(</span>email_message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;提取邮件元数据&quot;&quot;&quot;</span>
        metadata <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 基本信息</span>
            metadata<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'from'</span><span class="token punctuation">]</span> <span class="token operator">=</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'From'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'to'</span><span class="token punctuation">]</span> <span class="token operator">=</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'To'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'cc'</span><span class="token punctuation">]</span> <span class="token operator">=</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Cc'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'bcc'</span><span class="token punctuation">]</span> <span class="token operator">=</span> decode_email_header<span class="token punctuation">(</span>email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Bcc'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'message_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Message-ID'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 技术信息</span>
            metadata<span class="token punctuation">[</span><span class="token string">'content_type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get_content_type<span class="token punctuation">(</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'charset'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get_content_charset<span class="token punctuation">(</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'transfer_encoding'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Content-Transfer-Encoding'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 邮件客户端信息</span>
            metadata<span class="token punctuation">[</span><span class="token string">'user_agent'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'x_mailer'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'X-Mailer'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 路由信息</span>
            received_headers <span class="token operator">=</span> email_message<span class="token punctuation">.</span>get_all<span class="token punctuation">(</span><span class="token string">'Received'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            metadata<span class="token punctuation">[</span><span class="token string">'received_count'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>received_headers<span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   邮件元数据:&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> metadata<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> value<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> metadata
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   元数据提取失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">extract_urls_from_text</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;从文本中提取URL&quot;&quot;&quot;</span>
        url_pattern <span class="token operator">=</span> <span class="token string">r'https?://[^\s&lt;&gt;&quot;]+|www\.[^\s&lt;&gt;&quot;]+'</span>
        urls <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>url_pattern<span class="token punctuation">,</span> text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   从文本中提取到 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 个URL:&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> url <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>urls<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> urls
    
    <span class="token keyword">def</span> <span class="token function">extract_phone_numbers</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;从文本中提取电话号码&quot;&quot;&quot;</span>
        phone_patterns <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">r'\b\d{3}-\d{3}-\d{4}\b'</span><span class="token punctuation">,</span>  <span class="token comment"># 123-456-7890</span>
            <span class="token string">r'\b\d{3}\.\d{3}\.\d{4}\b'</span><span class="token punctuation">,</span>  <span class="token comment"># 123.456.7890</span>
            <span class="token string">r'\b\(\d{3}\)\s*\d{3}-\d{4}\b'</span><span class="token punctuation">,</span>  <span class="token comment"># (123) 456-7890</span>
            <span class="token string">r'\b\d{11}\b'</span><span class="token punctuation">,</span>  <span class="token comment"># 12345678901</span>
            <span class="token string">r'\b\d{3}\s+\d{4}\s+\d{4}\b'</span>  <span class="token comment"># 123 4567 8901</span>
        <span class="token punctuation">]</span>
        
        phones <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> pattern <span class="token keyword">in</span> phone_patterns<span class="token punctuation">:</span>
            phones<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   从文本中提取到 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>phones<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 个电话号码:&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> phone <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>phones<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>phone<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> phones
    
    <span class="token comment"># 测试解析功能</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   测试邮件内容解析:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 测试HTML内容</span>
    sample_html <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
    &lt;html&gt;
    &lt;body&gt;
        &lt;h1&gt;Python学习通知&lt;/h1&gt;
        &lt;p&gt;亲爱的学员，&lt;/p&gt;
        &lt;p&gt;我们的&lt;a href=&quot;https://python.org&quot;&gt;Python课程&lt;/a&gt;已经更新。&lt;/p&gt;
        &lt;p&gt;请访问 &lt;a href=&quot;https://example.com/course&quot;&gt;课程页面&lt;/a&gt; 查看详情。&lt;/p&gt;
        &lt;img src=&quot;https://example.com/logo.png&quot; alt=&quot;Logo&quot;&gt;
        &lt;p&gt;联系电话：123-456-7890&lt;/p&gt;
        &lt;p&gt;网站：www.example.com&lt;/p&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    &quot;&quot;&quot;</span>
    
    parsed_html <span class="token operator">=</span> parse_html_email<span class="token punctuation">(</span>sample_html<span class="token punctuation">)</span>
    <span class="token keyword">if</span> parsed_html<span class="token punctuation">:</span>
        extract_urls_from_text<span class="token punctuation">(</span>parsed_html<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        extract_phone_numbers<span class="token punctuation">(</span>parsed_html<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 测试地址解析</span>
    test_addresses <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'&quot;张三&quot; &lt;zhangsan@example.com&gt;'</span><span class="token punctuation">,</span>
        <span class="token string">'lisi@example.com'</span><span class="token punctuation">,</span>
        <span class="token string">'&quot;王五&quot; &lt;wangwu@test.com&gt;, &quot;赵六&quot; &lt;zhaoliu@demo.com&gt;'</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> addr <span class="token keyword">in</span> test_addresses<span class="token punctuation">:</span>
        parse_email_addresses<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>

<span class="token comment"># 运行邮件解析演示</span>
email_parsing_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_4-邮件处理和管理"><a href="#_4-邮件处理和管理" class="header-anchor">#</a> 4. 邮件处理和管理</h2> <h3 id="_4-1-邮件过滤和分类"><a href="#_4-1-邮件过滤和分类" class="header-anchor">#</a> 4.1 邮件过滤和分类</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> re
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta
<span class="token keyword">import</span> json

<span class="token keyword">def</span> <span class="token function">email_filtering_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件过滤和分类演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 邮件过滤和分类演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 邮件过滤器</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 邮件过滤器:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">EmailFilter</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件过滤器类&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">def</span> <span class="token function">add_rule</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> condition<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;添加过滤规则&quot;&quot;&quot;</span>
            rule <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'name'</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
                <span class="token string">'condition'</span><span class="token punctuation">:</span> condition<span class="token punctuation">,</span>
                <span class="token string">'action'</span><span class="token punctuation">:</span> action<span class="token punctuation">,</span>
                <span class="token string">'created'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rule<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 添加规则: </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">apply_filters</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;应用过滤规则&quot;&quot;&quot;</span>
            applied_rules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token keyword">for</span> rule <span class="token keyword">in</span> self<span class="token punctuation">.</span>rules<span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>_check_condition<span class="token punctuation">(</span>email_info<span class="token punctuation">,</span> rule<span class="token punctuation">[</span><span class="token string">'condition'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    result <span class="token operator">=</span> self<span class="token punctuation">.</span>_execute_action<span class="token punctuation">(</span>email_info<span class="token punctuation">,</span> rule<span class="token punctuation">[</span><span class="token string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    applied_rules<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token string">'rule_name'</span><span class="token punctuation">:</span> rule<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'action_result'</span><span class="token punctuation">:</span> result
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> applied_rules
        
        <span class="token keyword">def</span> <span class="token function">_check_condition</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_info<span class="token punctuation">,</span> condition<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;检查条件&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                condition_type <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>
                
                <span class="token keyword">if</span> condition_type <span class="token operator">==</span> <span class="token string">'sender'</span><span class="token punctuation">:</span>
                    pattern <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'pattern'</span><span class="token punctuation">]</span>
                    <span class="token keyword">return</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span>
                
                <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'subject'</span><span class="token punctuation">:</span>
                    pattern <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'pattern'</span><span class="token punctuation">]</span>
                    <span class="token keyword">return</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span>
                
                <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'body'</span><span class="token punctuation">:</span>
                    pattern <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'pattern'</span><span class="token punctuation">]</span>
                    <span class="token keyword">return</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span>
                
                <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'size'</span><span class="token punctuation">:</span>
                    operator <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'operator'</span><span class="token punctuation">]</span>  <span class="token comment"># '&gt;', '&lt;', '=='</span>
                    threshold <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
                    size <span class="token operator">=</span> email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    
                    <span class="token keyword">if</span> operator <span class="token operator">==</span> <span class="token string">'&gt;'</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> size <span class="token operator">&gt;</span> threshold
                    <span class="token keyword">elif</span> operator <span class="token operator">==</span> <span class="token string">'&lt;'</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> size <span class="token operator">&lt;</span> threshold
                    <span class="token keyword">elif</span> operator <span class="token operator">==</span> <span class="token string">'=='</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> size <span class="token operator">==</span> threshold
                
                <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'date'</span><span class="token punctuation">:</span>
                    operator <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'operator'</span><span class="token punctuation">]</span>
                    days_ago <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'days'</span><span class="token punctuation">]</span>
                    threshold_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>days_ago<span class="token punctuation">)</span>
                    
                    email_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>fromisoformat<span class="token punctuation">(</span>email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    
                    <span class="token keyword">if</span> operator <span class="token operator">==</span> <span class="token string">'older'</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> email_date <span class="token operator">&lt;</span> threshold_date
                    <span class="token keyword">elif</span> operator <span class="token operator">==</span> <span class="token string">'newer'</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> email_date <span class="token operator">&gt;</span> threshold_date
                
                <span class="token keyword">return</span> <span class="token boolean">False</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   条件检查失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">def</span> <span class="token function">_execute_action</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_info<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;执行动作&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                action_type <span class="token operator">=</span> action<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>
                
                <span class="token keyword">if</span> action_type <span class="token operator">==</span> <span class="token string">'move_to_folder'</span><span class="token punctuation">:</span>
                    folder <span class="token operator">=</span> action<span class="token punctuation">[</span><span class="token string">'folder'</span><span class="token punctuation">]</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     → 移动到文件夹: </span><span class="token interpolation"><span class="token punctuation">{</span>folder<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;moved_to_</span><span class="token interpolation"><span class="token punctuation">{</span>folder<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                
                <span class="token keyword">elif</span> action_type <span class="token operator">==</span> <span class="token string">'mark_as_read'</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     → 标记为已读&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token string">&quot;marked_as_read&quot;</span>
                
                <span class="token keyword">elif</span> action_type <span class="token operator">==</span> <span class="token string">'mark_as_important'</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     → 标记为重要&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token string">&quot;marked_as_important&quot;</span>
                
                <span class="token keyword">elif</span> action_type <span class="token operator">==</span> <span class="token string">'delete'</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     → 删除邮件&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token string">&quot;deleted&quot;</span>
                
                <span class="token keyword">elif</span> action_type <span class="token operator">==</span> <span class="token string">'forward'</span><span class="token punctuation">:</span>
                    to_address <span class="token operator">=</span> action<span class="token punctuation">[</span><span class="token string">'to'</span><span class="token punctuation">]</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     → 转发到: </span><span class="token interpolation"><span class="token punctuation">{</span>to_address<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;forwarded_to_</span><span class="token interpolation"><span class="token punctuation">{</span>to_address<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                
                <span class="token keyword">elif</span> action_type <span class="token operator">==</span> <span class="token string">'add_label'</span><span class="token punctuation">:</span>
                    label <span class="token operator">=</span> action<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     → 添加标签: </span><span class="token interpolation"><span class="token punctuation">{</span>label<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;labeled_</span><span class="token interpolation"><span class="token punctuation">{</span>label<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                
                <span class="token keyword">return</span> <span class="token string">&quot;action_executed&quot;</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   动作执行失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token string">&quot;action_failed&quot;</span>
    
    <span class="token comment"># 2. 创建过滤规则</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 创建过滤规则:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_filter_rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;创建过滤规则&quot;&quot;&quot;</span>
        email_filter <span class="token operator">=</span> EmailFilter<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 垃圾邮件过滤</span>
        email_filter<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;垃圾邮件过滤&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'subject'</span><span class="token punctuation">,</span>
                <span class="token string">'pattern'</span><span class="token punctuation">:</span> <span class="token string">r'(广告|促销|优惠|免费|中奖)'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'move_to_folder'</span><span class="token punctuation">,</span>
                <span class="token string">'folder'</span><span class="token punctuation">:</span> <span class="token string">'spam'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 工作邮件分类</span>
        email_filter<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;工作邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'sender'</span><span class="token punctuation">,</span>
                <span class="token string">'pattern'</span><span class="token punctuation">:</span> <span class="token string">r'@company\.com$'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'move_to_folder'</span><span class="token punctuation">,</span>
                <span class="token string">'folder'</span><span class="token punctuation">:</span> <span class="token string">'work'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 重要邮件标记</span>
        email_filter<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;重要邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'subject'</span><span class="token punctuation">,</span>
                <span class="token string">'pattern'</span><span class="token punctuation">:</span> <span class="token string">r'(紧急|重要|urgent|important)'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'mark_as_important'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 大附件邮件</span>
        email_filter<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;大附件邮件&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'size'</span><span class="token punctuation">,</span>
                <span class="token string">'operator'</span><span class="token punctuation">:</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span>
                <span class="token string">'value'</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>  <span class="token comment"># 5MB</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'add_label'</span><span class="token punctuation">,</span>
                <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">'large_attachment'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 旧邮件清理</span>
        email_filter<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;旧邮件清理&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'date'</span><span class="token punctuation">,</span>
                <span class="token string">'operator'</span><span class="token punctuation">:</span> <span class="token string">'older'</span><span class="token punctuation">,</span>
                <span class="token string">'days'</span><span class="token punctuation">:</span> <span class="token number">365</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'move_to_folder'</span><span class="token punctuation">,</span>
                <span class="token string">'folder'</span><span class="token punctuation">:</span> <span class="token string">'archive'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> email_filter
    
    <span class="token comment"># 3. 应用过滤规则</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 应用过滤规则:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">test_email_filtering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;测试邮件过滤&quot;&quot;&quot;</span>
        email_filter <span class="token operator">=</span> create_filter_rules<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 测试邮件数据</span>
        test_emails <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'紧急：系统维护通知'</span><span class="token punctuation">,</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'admin@company.com'</span><span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'系统将于今晚进行维护'</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
                <span class="token string">'date'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'免费获得iPhone！点击领取'</span><span class="token punctuation">,</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'promo@spam.com'</span><span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'恭喜您中奖了！'</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">512</span><span class="token punctuation">,</span>
                <span class="token string">'date'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'会议资料'</span><span class="token punctuation">,</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'colleague@company.com'</span><span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'附件是明天会议的资料'</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>  <span class="token comment"># 8MB</span>
                <span class="token string">'date'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'旧项目文档'</span><span class="token punctuation">,</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'archive@oldcompany.com'</span><span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'这是去年的项目文档'</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">2048</span><span class="token punctuation">,</span>
                <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   测试邮件过滤:&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> email <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>test_emails<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n   邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     发件人: </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">[</span><span class="token string">'from'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            applied_rules <span class="token operator">=</span> email_filter<span class="token punctuation">.</span>apply_filters<span class="token punctuation">(</span>email<span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> applied_rules<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     应用的规则:&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> rule <span class="token keyword">in</span> applied_rules<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       • </span><span class="token interpolation"><span class="token punctuation">{</span>rule<span class="token punctuation">[</span><span class="token string">'rule_name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>rule<span class="token punctuation">[</span><span class="token string">'action_result'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     → 无匹配规则，保持在收件箱&quot;</span></span><span class="token punctuation">)</span>
    
    test_email_filtering<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 运行邮件过滤演示</span>
email_filtering_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-2-邮件自动回复"><a href="#_4-2-邮件自动回复" class="header-anchor">#</a> 4.2 邮件自动回复</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">auto_reply_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件自动回复演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 邮件自动回复演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 自动回复系统</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 自动回复系统:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">AutoReplySystem</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;自动回复系统&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>templates <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">True</span>
        
        <span class="token keyword">def</span> <span class="token function">add_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> body<span class="token punctuation">,</span> variables<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;添加回复模板&quot;&quot;&quot;</span>
            template <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'name'</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> subject<span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> body<span class="token punctuation">,</span>
                <span class="token string">'variables'</span><span class="token punctuation">:</span> variables <span class="token keyword">or</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'created'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>templates<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> template
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 添加模板: </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">add_rule</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> condition<span class="token punctuation">,</span> template_name<span class="token punctuation">,</span> delay_hours<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;添加自动回复规则&quot;&quot;&quot;</span>
            rule <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'name'</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
                <span class="token string">'condition'</span><span class="token punctuation">:</span> condition<span class="token punctuation">,</span>
                <span class="token string">'template'</span><span class="token punctuation">:</span> template_name<span class="token punctuation">,</span>
                <span class="token string">'delay_hours'</span><span class="token punctuation">:</span> delay_hours<span class="token punctuation">,</span>
                <span class="token string">'enabled'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rule<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 添加规则: </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">process_email</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;处理邮件并生成自动回复&quot;&quot;&quot;</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>enabled<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">None</span>
            
            <span class="token keyword">for</span> rule <span class="token keyword">in</span> self<span class="token punctuation">.</span>rules<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> rule<span class="token punctuation">[</span><span class="token string">'enabled'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>_check_condition<span class="token punctuation">(</span>email_info<span class="token punctuation">,</span> rule<span class="token punctuation">[</span><span class="token string">'condition'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    template_name <span class="token operator">=</span> rule<span class="token punctuation">[</span><span class="token string">'template'</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> template_name <span class="token keyword">in</span> self<span class="token punctuation">.</span>templates<span class="token punctuation">:</span>
                        reply <span class="token operator">=</span> self<span class="token punctuation">.</span>_generate_reply<span class="token punctuation">(</span>email_info<span class="token punctuation">,</span> template_name<span class="token punctuation">)</span>
                        reply<span class="token punctuation">[</span><span class="token string">'delay_hours'</span><span class="token punctuation">]</span> <span class="token operator">=</span> rule<span class="token punctuation">[</span><span class="token string">'delay_hours'</span><span class="token punctuation">]</span>
                        reply<span class="token punctuation">[</span><span class="token string">'rule_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> rule<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>
                        <span class="token keyword">return</span> reply
            
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        
        <span class="token keyword">def</span> <span class="token function">_check_condition</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_info<span class="token punctuation">,</span> condition<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;检查触发条件&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                condition_type <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>
                
                <span class="token keyword">if</span> condition_type <span class="token operator">==</span> <span class="token string">'keyword'</span><span class="token punctuation">:</span>
                    keywords <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'keywords'</span><span class="token punctuation">]</span>
                    text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> text<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> keywords<span class="token punctuation">)</span>
                
                <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'sender_domain'</span><span class="token punctuation">:</span>
                    domain <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'domain'</span><span class="token punctuation">]</span>
                    sender <span class="token operator">=</span> email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> domain <span class="token keyword">in</span> sender
                
                <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'time_range'</span><span class="token punctuation">:</span>
                    start_hour <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'start_hour'</span><span class="token punctuation">]</span>
                    end_hour <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'end_hour'</span><span class="token punctuation">]</span>
                    current_hour <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hour
                    
                    <span class="token keyword">if</span> start_hour <span class="token operator">&lt;=</span> end_hour<span class="token punctuation">:</span>
                        <span class="token keyword">return</span> start_hour <span class="token operator">&lt;=</span> current_hour <span class="token operator">&lt;=</span> end_hour
                    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 跨午夜</span>
                        <span class="token keyword">return</span> current_hour <span class="token operator">&gt;=</span> start_hour <span class="token keyword">or</span> current_hour <span class="token operator">&lt;=</span> end_hour
                
                <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'first_contact'</span><span class="token punctuation">:</span>
                    <span class="token comment"># 简化实现：假设检查是否为首次联系</span>
                    <span class="token keyword">return</span> email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_first_contact'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
                
                <span class="token keyword">return</span> <span class="token boolean">False</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   条件检查失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">def</span> <span class="token function">_generate_reply</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_info<span class="token punctuation">,</span> template_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;生成回复邮件&quot;&quot;&quot;</span>
            template <span class="token operator">=</span> self<span class="token punctuation">.</span>templates<span class="token punctuation">[</span>template_name<span class="token punctuation">]</span>
            
            <span class="token comment"># 提取变量</span>
            variables <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'sender_name'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_extract_sender_name<span class="token punctuation">(</span>email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'original_subject'</span><span class="token punctuation">:</span> email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'current_date'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y年%m月%d日'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'current_time'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%H:%M'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment"># 替换模板变量</span>
            subject <span class="token operator">=</span> self<span class="token punctuation">.</span>_replace_variables<span class="token punctuation">(</span>template<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> variables<span class="token punctuation">)</span>
            body <span class="token operator">=</span> self<span class="token punctuation">.</span>_replace_variables<span class="token punctuation">(</span>template<span class="token punctuation">[</span><span class="token string">'body'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> variables<span class="token punctuation">)</span>
            
            reply <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'to'</span><span class="token punctuation">:</span> email_info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> subject<span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> body<span class="token punctuation">,</span>
                <span class="token string">'template_used'</span><span class="token punctuation">:</span> template_name<span class="token punctuation">,</span>
                <span class="token string">'generated_at'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">return</span> reply
        
        <span class="token keyword">def</span> <span class="token function">_extract_sender_name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_address<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;提取发件人姓名&quot;&quot;&quot;</span>
            <span class="token comment"># 简单提取：&quot;Name&quot; &lt;email@domain.com&gt; -&gt; Name</span>
            <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^&quot;?([^&quot;&lt;&gt;]+?)&quot;?\s*&lt;'</span><span class="token punctuation">,</span> from_address<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 从邮箱地址提取用户名</span>
                email_match <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'([^@&lt;&gt;\s]+)@'</span><span class="token punctuation">,</span> from_address<span class="token punctuation">)</span>
                <span class="token keyword">if</span> email_match<span class="token punctuation">:</span>
                    <span class="token keyword">return</span> email_match<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">'朋友'</span>
        
        <span class="token keyword">def</span> <span class="token function">_replace_variables</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;替换模板变量&quot;&quot;&quot;</span>
            <span class="token keyword">for</span> var_name<span class="token punctuation">,</span> var_value <span class="token keyword">in</span> variables<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'{{</span><span class="token interpolation"><span class="token punctuation">{</span>var_name<span class="token punctuation">}</span></span><span class="token string">}}'</span></span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>var_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> text
    
    <span class="token comment"># 2. 创建回复模板</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 创建回复模板:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_reply_templates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;创建回复模板&quot;&quot;&quot;</span>
        auto_reply <span class="token operator">=</span> AutoReplySystem<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 外出自动回复</span>
        auto_reply<span class="token punctuation">.</span>add_template<span class="token punctuation">(</span>
            <span class="token string">&quot;外出回复&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;自动回复：Re: {original_subject}&quot;</span><span class="token punctuation">,</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;
亲爱的 {sender_name}，

感谢您的邮件。我目前外出办公，将于下周一返回。

如有紧急事务，请联系我的同事：
- 张三：zhangsan@company.com
- 李四：lisi@company.com

我会在返回后尽快回复您的邮件。

此邮件为自动回复，请勿直接回复。

谢谢！
{current_date}
            &quot;&quot;&quot;</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 客服自动回复</span>
        auto_reply<span class="token punctuation">.</span>add_template<span class="token punctuation">(</span>
            <span class="token string">&quot;客服回复&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;收到您的咨询：{original_subject}&quot;</span><span class="token punctuation">,</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;
尊敬的 {sender_name}，

感谢您联系我们的客服团队！

我们已收到您于 {current_date} {current_time} 发送的邮件，我们的客服代表将在24小时内回复您。

如需紧急帮助，请拨打客服热线：400-123-4567

常见问题解答：https://example.com/faq

谢谢您的耐心等待！

客服团队
            &quot;&quot;&quot;</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 招聘自动回复</span>
        auto_reply<span class="token punctuation">.</span>add_template<span class="token punctuation">(</span>
            <span class="token string">&quot;招聘回复&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;感谢您的求职申请&quot;</span><span class="token punctuation">,</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;
亲爱的 {sender_name}，

感谢您对我们公司的关注和求职申请！

我们已收到您的简历，人力资源部门将在5个工作日内审核您的申请。

如果您的背景符合我们的要求，我们会尽快与您联系安排面试。

在此期间，您可以访问我们的官网了解更多公司信息：
https://company.com/about

再次感谢您的申请！

人力资源部
{current_date}
            &quot;&quot;&quot;</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 技术支持回复</span>
        auto_reply<span class="token punctuation">.</span>add_template<span class="token punctuation">(</span>
            <span class="token string">&quot;技术支持回复&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;技术支持工单已创建：{original_subject}&quot;</span><span class="token punctuation">,</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;
您好 {sender_name}，

感谢您联系技术支持！

我们已为您创建了支持工单，工单编号：TS-{current_date}-001

我们的技术工程师将在2个工作日内分析您的问题并提供解决方案。

您可以通过以下方式跟踪工单状态：
- 访问：https://support.company.com
- 电话：400-888-9999

常见问题可能的解决方案：
1. 重启应用程序
2. 清除浏览器缓存
3. 检查网络连接

技术支持团队
            &quot;&quot;&quot;</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> auto_reply
    
    <span class="token comment"># 3. 设置自动回复规则</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 设置自动回复规则:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">setup_reply_rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;设置自动回复规则&quot;&quot;&quot;</span>
        auto_reply <span class="token operator">=</span> create_reply_templates<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 外出时间自动回复</span>
        auto_reply<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;外出自动回复&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'time_range'</span><span class="token punctuation">,</span>
                <span class="token string">'start_hour'</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>  <span class="token comment"># 下午6点后</span>
                <span class="token string">'end_hour'</span><span class="token punctuation">:</span> <span class="token number">8</span>      <span class="token comment"># 上午8点前</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">&quot;外出回复&quot;</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 客服邮箱自动回复</span>
        auto_reply<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;客服自动回复&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'sender_domain'</span><span class="token punctuation">,</span>
                <span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token string">'customer'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">&quot;客服回复&quot;</span><span class="token punctuation">,</span>
            delay_hours<span class="token operator">=</span><span class="token number">0</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 招聘相关自动回复</span>
        auto_reply<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;招聘自动回复&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'keyword'</span><span class="token punctuation">,</span>
                <span class="token string">'keywords'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'求职'</span><span class="token punctuation">,</span> <span class="token string">'应聘'</span><span class="token punctuation">,</span> <span class="token string">'简历'</span><span class="token punctuation">,</span> <span class="token string">'招聘'</span><span class="token punctuation">,</span> <span class="token string">'job'</span><span class="token punctuation">,</span> <span class="token string">'resume'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">&quot;招聘回复&quot;</span><span class="token punctuation">,</span>
            delay_hours<span class="token operator">=</span><span class="token number">1</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 技术支持自动回复</span>
        auto_reply<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;技术支持自动回复&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'keyword'</span><span class="token punctuation">,</span>
                <span class="token string">'keywords'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'bug'</span><span class="token punctuation">,</span> <span class="token string">'错误'</span><span class="token punctuation">,</span> <span class="token string">'问题'</span><span class="token punctuation">,</span> <span class="token string">'故障'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'help'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">&quot;技术支持回复&quot;</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> auto_reply
    
    <span class="token comment"># 4. 测试自动回复</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n4. 测试自动回复:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">test_auto_reply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;测试自动回复功能&quot;&quot;&quot;</span>
        auto_reply <span class="token operator">=</span> setup_reply_rules<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 测试邮件</span>
        test_emails <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'&quot;张三&quot; &lt;zhangsan@customer.com&gt;'</span><span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'产品咨询'</span><span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'我想了解你们的产品功能'</span><span class="token punctuation">,</span>
                <span class="token string">'is_first_contact'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'lisi@jobseeker.com'</span><span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'求职申请 - Python开发工程师'</span><span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'附件是我的简历，希望能加入贵公司'</span><span class="token punctuation">,</span>
                <span class="token string">'is_first_contact'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'user@example.com'</span><span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'系统bug报告'</span><span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'登录时出现error 500错误'</span><span class="token punctuation">,</span>
                <span class="token string">'is_first_contact'</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'friend@personal.com'</span><span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'周末聚会'</span><span class="token punctuation">,</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'这周末有空吗？一起吃饭'</span><span class="token punctuation">,</span>
                <span class="token string">'is_first_contact'</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   测试自动回复:&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> email <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>test_emails<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n   邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     发件人: </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">[</span><span class="token string">'from'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            reply <span class="token operator">=</span> auto_reply<span class="token punctuation">.</span>process_email<span class="token punctuation">(</span>email<span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> reply<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     ✓ 生成自动回复:&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       规则: </span><span class="token interpolation"><span class="token punctuation">{</span>reply<span class="token punctuation">[</span><span class="token string">'rule_name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       模板: </span><span class="token interpolation"><span class="token punctuation">{</span>reply<span class="token punctuation">[</span><span class="token string">'template_used'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       延迟: </span><span class="token interpolation"><span class="token punctuation">{</span>reply<span class="token punctuation">[</span><span class="token string">'delay_hours'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 小时&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       主题: </span><span class="token interpolation"><span class="token punctuation">{</span>reply<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       正文预览: </span><span class="token interpolation"><span class="token punctuation">{</span>reply<span class="token punctuation">[</span><span class="token string">'body'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     → 无匹配规则，不发送自动回复&quot;</span></span><span class="token punctuation">)</span>
    
    test_auto_reply<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 运行自动回复演示</span>
auto_reply_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-3-邮件统计和分析"><a href="#_4-3-邮件统计和分析" class="header-anchor">#</a> 4.3 邮件统计和分析</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict<span class="token punctuation">,</span> Counter
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">def</span> <span class="token function">email_analytics_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件统计和分析演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 邮件统计和分析演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 邮件统计类</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 邮件统计分析:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">EmailAnalytics</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件分析类&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>emails <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>stats <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        
        <span class="token keyword">def</span> <span class="token function">add_email</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;添加邮件数据&quot;&quot;&quot;</span>
            self<span class="token punctuation">.</span>emails<span class="token punctuation">.</span>append<span class="token punctuation">(</span>email_info<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">analyze_volume</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;分析邮件量&quot;&quot;&quot;</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   邮件量分析:&quot;</span><span class="token punctuation">)</span>
            
            total_emails <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>emails<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     总邮件数: </span><span class="token interpolation"><span class="token punctuation">{</span>total_emails<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> total_emails <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span>
            
            <span class="token comment"># 按日期统计</span>
            daily_count <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> email <span class="token keyword">in</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">:</span>
                date <span class="token operator">=</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 提取日期部分</span>
                daily_count<span class="token punctuation">[</span>date<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     活跃天数: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>daily_count<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> daily_count<span class="token punctuation">:</span>
                avg_daily <span class="token operator">=</span> total_emails <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>daily_count<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     日均邮件: </span><span class="token interpolation"><span class="token punctuation">{</span>avg_daily<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                
                max_day <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>daily_count<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     最忙的一天: </span><span class="token interpolation"><span class="token punctuation">{</span>max_day<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>max_day<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 封)&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 按小时统计</span>
            hourly_count <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> email <span class="token keyword">in</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    dt <span class="token operator">=</span> datetime<span class="token punctuation">.</span>fromisoformat<span class="token punctuation">(</span>email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    hour <span class="token operator">=</span> dt<span class="token punctuation">.</span>hour
                    hourly_count<span class="token punctuation">[</span>hour<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">except</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
            
            <span class="token keyword">if</span> hourly_count<span class="token punctuation">:</span>
                peak_hour <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>hourly_count<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     邮件高峰时段: </span><span class="token interpolation"><span class="token punctuation">{</span>peak_hour<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:00 (</span><span class="token interpolation"><span class="token punctuation">{</span>peak_hour<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 封)&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">analyze_senders</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;分析发件人&quot;&quot;&quot;</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n   发件人分析:&quot;</span><span class="token punctuation">)</span>
            
            sender_count <span class="token operator">=</span> Counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
            domain_count <span class="token operator">=</span> Counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> email <span class="token keyword">in</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">:</span>
                sender <span class="token operator">=</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                sender_count<span class="token punctuation">[</span>sender<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                
                <span class="token comment"># 提取域名</span>
                <span class="token keyword">if</span> <span class="token string">'@'</span> <span class="token keyword">in</span> sender<span class="token punctuation">:</span>
                    domain <span class="token operator">=</span> sender<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                    domain_count<span class="token punctuation">[</span>domain<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     独立发件人数: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>sender_count<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 最活跃发件人</span>
            <span class="token keyword">if</span> sender_count<span class="token punctuation">:</span>
                top_senders <span class="token operator">=</span> sender_count<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     最活跃发件人:&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>top_senders<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>sender<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string"> 封&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 最常见域名</span>
            <span class="token keyword">if</span> domain_count<span class="token punctuation">:</span>
                top_domains <span class="token operator">=</span> domain_count<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     最常见域名:&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>domain<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>top_domains<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>domain<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string"> 封&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">analyze_subjects</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;分析主题&quot;&quot;&quot;</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n   主题分析:&quot;</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 主题关键词统计</span>
            keyword_count <span class="token operator">=</span> Counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
            subject_lengths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token keyword">for</span> email <span class="token keyword">in</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">:</span>
                subject <span class="token operator">=</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                subject_lengths<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 提取关键词（简单分词）</span>
                words <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\b\w{2,}\b'</span><span class="token punctuation">,</span> subject<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>  <span class="token comment"># 过滤短词</span>
                        keyword_count<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token keyword">if</span> subject_lengths<span class="token punctuation">:</span>
                avg_length <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>subject_lengths<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>subject_lengths<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     平均主题长度: </span><span class="token interpolation"><span class="token punctuation">{</span>avg_length<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string"> 字符&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     最长主题: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">max</span><span class="token punctuation">(</span>subject_lengths<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 字符&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     最短主题: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">min</span><span class="token punctuation">(</span>subject_lengths<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 字符&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 热门关键词</span>
            <span class="token keyword">if</span> keyword_count<span class="token punctuation">:</span>
                top_keywords <span class="token operator">=</span> keyword_count<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     热门关键词:&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>keyword<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>top_keywords<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>keyword<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string"> 次&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">analyze_sizes</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;分析邮件大小&quot;&quot;&quot;</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n   邮件大小分析:&quot;</span><span class="token punctuation">)</span>
            
            sizes <span class="token operator">=</span> <span class="token punctuation">[</span>email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">for</span> email <span class="token keyword">in</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">]</span>
            sizes <span class="token operator">=</span> <span class="token punctuation">[</span>s <span class="token keyword">for</span> s <span class="token keyword">in</span> sizes <span class="token keyword">if</span> s <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 过滤无效大小</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> sizes<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     无大小数据&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            
            total_size <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>sizes<span class="token punctuation">)</span>
            avg_size <span class="token operator">=</span> total_size <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sizes<span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     总大小: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>_format_size<span class="token punctuation">(</span>total_size<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     平均大小: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>_format_size<span class="token punctuation">(</span>avg_size<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     最大邮件: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>_format_size<span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>sizes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     最小邮件: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>_format_size<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span>sizes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 大小分布</span>
            size_ranges <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'&lt; 1KB'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'1KB - 10KB'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'10KB - 100KB'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'100KB - 1MB'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'&gt; 1MB'</span><span class="token punctuation">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">for</span> size <span class="token keyword">in</span> sizes<span class="token punctuation">:</span>
                <span class="token keyword">if</span> size <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">:</span>
                    size_ranges<span class="token punctuation">[</span><span class="token string">'&lt; 1KB'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">elif</span> size <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">:</span>
                    size_ranges<span class="token punctuation">[</span><span class="token string">'1KB - 10KB'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">elif</span> size <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">:</span>
                    size_ranges<span class="token punctuation">[</span><span class="token string">'10KB - 100KB'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">elif</span> size <span class="token operator">&lt;</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">:</span>
                    size_ranges<span class="token punctuation">[</span><span class="token string">'100KB - 1MB'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    size_ranges<span class="token punctuation">[</span><span class="token string">'&gt; 1MB'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     大小分布:&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> range_name<span class="token punctuation">,</span> count <span class="token keyword">in</span> size_ranges<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                percentage <span class="token operator">=</span> <span class="token punctuation">(</span>count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sizes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       </span><span class="token interpolation"><span class="token punctuation">{</span>range_name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string"> 封 (</span><span class="token interpolation"><span class="token punctuation">{</span>percentage<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">%)&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_format_size</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> size_bytes<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;格式化文件大小&quot;&quot;&quot;</span>
            <span class="token keyword">for</span> unit <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'KB'</span><span class="token punctuation">,</span> <span class="token string">'MB'</span><span class="token punctuation">,</span> <span class="token string">'GB'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> size_bytes <span class="token operator">&lt;</span> <span class="token number">1024.0</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>size_bytes<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>unit<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                size_bytes <span class="token operator">/=</span> <span class="token number">1024.0</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>size_bytes<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string"> TB&quot;</span></span>
        
        <span class="token keyword">def</span> <span class="token function">generate_report</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;生成分析报告&quot;&quot;&quot;</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n   生成邮件分析报告:&quot;</span><span class="token punctuation">)</span>
            
            report <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'generated_at'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'total_emails'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>emails<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'analysis_period'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_get_date_range<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'summary'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_generate_summary<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     报告生成时间: </span><span class="token interpolation"><span class="token punctuation">{</span>report<span class="token punctuation">[</span><span class="token string">'generated_at'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     分析期间: </span><span class="token interpolation"><span class="token punctuation">{</span>report<span class="token punctuation">[</span><span class="token string">'analysis_period'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     邮件总数: </span><span class="token interpolation"><span class="token punctuation">{</span>report<span class="token punctuation">[</span><span class="token string">'total_emails'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> report
        
        <span class="token keyword">def</span> <span class="token function">_get_date_range</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取日期范围&quot;&quot;&quot;</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string">&quot;无数据&quot;</span>
            
            dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> email <span class="token keyword">in</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    dt <span class="token operator">=</span> datetime<span class="token punctuation">.</span>fromisoformat<span class="token punctuation">(</span>email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>dt<span class="token punctuation">)</span>
                <span class="token keyword">except</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
            
            <span class="token keyword">if</span> dates<span class="token punctuation">:</span>
                start_date <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>dates<span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span>
                end_date <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>dates<span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>start_date<span class="token punctuation">}</span></span><span class="token string"> 至 </span><span class="token interpolation"><span class="token punctuation">{</span>end_date<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            
            <span class="token keyword">return</span> <span class="token string">&quot;日期解析失败&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">_generate_summary</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;生成摘要&quot;&quot;&quot;</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string">&quot;无邮件数据&quot;</span>
            
            <span class="token comment"># 计算基本统计</span>
            total <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>emails<span class="token punctuation">)</span>
            
            <span class="token comment"># 发件人统计</span>
            senders <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">for</span> email <span class="token keyword">in</span> self<span class="token punctuation">.</span>emails<span class="token punctuation">)</span>
            unique_senders <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>senders<span class="token punctuation">)</span>
            
            <span class="token comment"># 大小统计</span>
            sizes <span class="token operator">=</span> <span class="token punctuation">[</span>email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">for</span> email <span class="token keyword">in</span> self<span class="token punctuation">.</span>emails <span class="token keyword">if</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span>
            avg_size <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>sizes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sizes<span class="token punctuation">)</span> <span class="token keyword">if</span> sizes <span class="token keyword">else</span> <span class="token number">0</span>
            
            summary <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;共分析 </span><span class="token interpolation"><span class="token punctuation">{</span>total<span class="token punctuation">}</span></span><span class="token string"> 封邮件，来自 </span><span class="token interpolation"><span class="token punctuation">{</span>unique_senders<span class="token punctuation">}</span></span><span class="token string"> 个不同发件人，平均大小 </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>_format_size<span class="token punctuation">(</span>avg_size<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            
            <span class="token keyword">return</span> summary
    
    <span class="token comment"># 2. 生成测试数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 生成测试数据:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_test_emails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;生成测试邮件数据&quot;&quot;&quot;</span>
        <span class="token keyword">import</span> random
        
        senders <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">'boss@company.com'</span><span class="token punctuation">,</span>
            <span class="token string">'colleague@company.com'</span><span class="token punctuation">,</span>
            <span class="token string">'client@customer.com'</span><span class="token punctuation">,</span>
            <span class="token string">'support@vendor.com'</span><span class="token punctuation">,</span>
            <span class="token string">'newsletter@news.com'</span><span class="token punctuation">,</span>
            <span class="token string">'spam@promo.com'</span>
        <span class="token punctuation">]</span>
        
        subjects <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">'会议通知'</span><span class="token punctuation">,</span>
            <span class="token string">'项目进度更新'</span><span class="token punctuation">,</span>
            <span class="token string">'客户反馈'</span><span class="token punctuation">,</span>
            <span class="token string">'系统维护通知'</span><span class="token punctuation">,</span>
            <span class="token string">'新闻简报'</span><span class="token punctuation">,</span>
            <span class="token string">'促销活动'</span><span class="token punctuation">,</span>
            <span class="token string">'技术支持'</span><span class="token punctuation">,</span>
            <span class="token string">'发票确认'</span><span class="token punctuation">,</span>
            <span class="token string">'培训邀请'</span><span class="token punctuation">,</span>
            <span class="token string">'重要通知'</span>
        <span class="token punctuation">]</span>
        
        emails <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        base_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 随机日期（最近30天）</span>
            random_days <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
            random_hours <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span>
            email_date <span class="token operator">=</span> base_date <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>random_days<span class="token punctuation">,</span> hours<span class="token operator">=</span>random_hours<span class="token punctuation">)</span>
            
            email <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>senders<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>subjects<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'date'</span><span class="token punctuation">:</span> email_date<span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 500B - 50KB</span>
                <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;这是第</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">封测试邮件的内容&quot;</span></span>
            <span class="token punctuation">}</span>
            
            emails<span class="token punctuation">.</span>append<span class="token punctuation">(</span>email<span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   生成了 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>emails<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 封测试邮件&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> emails
    
    <span class="token comment"># 3. 执行分析</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 执行邮件分析:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run_analysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;运行邮件分析&quot;&quot;&quot;</span>
        <span class="token comment"># 创建分析器</span>
        analytics <span class="token operator">=</span> EmailAnalytics<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 添加测试数据</span>
        test_emails <span class="token operator">=</span> generate_test_emails<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> email <span class="token keyword">in</span> test_emails<span class="token punctuation">:</span>
            analytics<span class="token punctuation">.</span>add_email<span class="token punctuation">(</span>email<span class="token punctuation">)</span>
        
        <span class="token comment"># 执行各项分析</span>
        analytics<span class="token punctuation">.</span>analyze_volume<span class="token punctuation">(</span><span class="token punctuation">)</span>
        analytics<span class="token punctuation">.</span>analyze_senders<span class="token punctuation">(</span><span class="token punctuation">)</span>
        analytics<span class="token punctuation">.</span>analyze_subjects<span class="token punctuation">(</span><span class="token punctuation">)</span>
        analytics<span class="token punctuation">.</span>analyze_sizes<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 生成报告</span>
        report <span class="token operator">=</span> analytics<span class="token punctuation">.</span>generate_report<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> analytics<span class="token punctuation">,</span> report
    
    analytics<span class="token punctuation">,</span> report <span class="token operator">=</span> run_analysis<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n   分析完成！&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   报告摘要: </span><span class="token interpolation"><span class="token punctuation">{</span>report<span class="token punctuation">[</span><span class="token string">'summary'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行邮件分析演示</span>
email_analytics_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_5-实际应用案例"><a href="#_5-实际应用案例" class="header-anchor">#</a> 5. 实际应用案例</h2> <h3 id="_5-1-邮件备份系统"><a href="#_5-1-邮件备份系统" class="header-anchor">#</a> 5.1 邮件备份系统</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> os
<span class="token keyword">import</span> json
<span class="token keyword">import</span> sqlite3
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> hashlib

<span class="token keyword">def</span> <span class="token function">email_backup_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件备份系统演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 邮件备份系统演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 邮件备份类</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 邮件备份系统:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">EmailBackupSystem</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件备份系统&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> backup_dir<span class="token operator">=</span><span class="token string">&quot;email_backup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>backup_dir <span class="token operator">=</span> backup_dir
            self<span class="token punctuation">.</span>db_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>backup_dir<span class="token punctuation">,</span> <span class="token string">&quot;emails.db&quot;</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_init_backup_dir<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_init_database<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_init_backup_dir</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;初始化备份目录&quot;&quot;&quot;</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>backup_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>self<span class="token punctuation">.</span>backup_dir<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 创建备份目录: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>backup_dir<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 创建子目录</span>
            subdirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'attachments'</span><span class="token punctuation">,</span> <span class="token string">'exports'</span><span class="token punctuation">,</span> <span class="token string">'logs'</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> subdir <span class="token keyword">in</span> subdirs<span class="token punctuation">:</span>
                subdir_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>backup_dir<span class="token punctuation">,</span> subdir<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>subdir_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>subdir_path<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_init_database</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;初始化数据库&quot;&quot;&quot;</span>
            conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>db_path<span class="token punctuation">)</span>
            cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 创建邮件表</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
                CREATE TABLE IF NOT EXISTS emails (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    message_id TEXT UNIQUE,
                    sender TEXT,
                    recipients TEXT,
                    subject TEXT,
                    date_sent TEXT,
                    date_received TEXT,
                    body_text TEXT,
                    body_html TEXT,
                    attachments TEXT,
                    size INTEGER,
                    hash TEXT,
                    backup_date TEXT
                )
            '''</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 创建附件表</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
                CREATE TABLE IF NOT EXISTS attachments (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    email_id INTEGER,
                    filename TEXT,
                    content_type TEXT,
                    size INTEGER,
                    file_path TEXT,
                    hash TEXT,
                    FOREIGN KEY (email_id) REFERENCES emails (id)
                )
            '''</span><span class="token punctuation">)</span>
            
            conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 初始化数据库: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>db_path<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">backup_email</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;备份单封邮件&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 计算邮件哈希</span>
                email_hash <span class="token operator">=</span> self<span class="token punctuation">.</span>_calculate_email_hash<span class="token punctuation">(</span>email_data<span class="token punctuation">)</span>
                
                <span class="token comment"># 检查是否已备份</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>_is_email_backed_up<span class="token punctuation">(</span>email_hash<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   邮件已存在，跳过: </span><span class="token interpolation"><span class="token punctuation">{</span>email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">'No Subject'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">50]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
                
                conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>db_path<span class="token punctuation">)</span>
                cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 插入邮件记录</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
                    INSERT INTO emails (
                        message_id, sender, recipients, subject, date_sent,
                        date_received, body_text, body_html, attachments,
                        size, hash, backup_date
                    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                '''</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
                    email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message_id'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'to'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'body_text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'body_html'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'attachments'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    email_hash<span class="token punctuation">,</span>
                    datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                email_id <span class="token operator">=</span> cursor<span class="token punctuation">.</span>lastrowid
                
                <span class="token comment"># 备份附件</span>
                <span class="token keyword">if</span> <span class="token string">'attachments'</span> <span class="token keyword">in</span> email_data<span class="token punctuation">:</span>
                    <span class="token keyword">for</span> attachment <span class="token keyword">in</span> email_data<span class="token punctuation">[</span><span class="token string">'attachments'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>_backup_attachment<span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> email_id<span class="token punctuation">,</span> attachment<span class="token punctuation">)</span>
                
                conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 备份邮件: </span><span class="token interpolation"><span class="token punctuation">{</span>email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">'No Subject'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">50]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 备份失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">def</span> <span class="token function">_calculate_email_hash</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;计算邮件哈希值&quot;&quot;&quot;</span>
            <span class="token comment"># 使用关键字段计算哈希</span>
            key_fields <span class="token operator">=</span> <span class="token punctuation">[</span>
                email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message_id'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'body_text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
            
            content <span class="token operator">=</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>key_fields<span class="token punctuation">)</span>
            <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_is_email_backed_up</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_hash<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;检查邮件是否已备份&quot;&quot;&quot;</span>
            conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>db_path<span class="token punctuation">)</span>
            cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT id FROM emails WHERE hash = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>email_hash<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            result <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> result <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        
        <span class="token keyword">def</span> <span class="token function">_backup_attachment</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cursor<span class="token punctuation">,</span> email_id<span class="token punctuation">,</span> attachment<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;备份附件&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                filename <span class="token operator">=</span> attachment<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">,</span> <span class="token string">'unknown'</span><span class="token punctuation">)</span>
                content <span class="token operator">=</span> attachment<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 生成安全的文件名</span>
                safe_filename <span class="token operator">=</span> self<span class="token punctuation">.</span>_generate_safe_filename<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
                file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>backup_dir<span class="token punctuation">,</span> <span class="token string">'attachments'</span><span class="token punctuation">,</span> safe_filename<span class="token punctuation">)</span>
                
                <span class="token comment"># 保存附件文件</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
                
                <span class="token comment"># 计算文件哈希</span>
                file_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 插入附件记录</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
                    INSERT INTO attachments (
                        email_id, filename, content_type, size, file_path, hash
                    ) VALUES (?, ?, ?, ?, ?, ?)
                '''</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
                    email_id<span class="token punctuation">,</span>
                    filename<span class="token punctuation">,</span>
                    attachment<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'content_type'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    file_path<span class="token punctuation">,</span>
                    file_hash
                <span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     ✓ 备份附件: </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     ✗ 附件备份失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_generate_safe_filename</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;生成安全的文件名&quot;&quot;&quot;</span>
            <span class="token comment"># 移除危险字符</span>
            safe_chars <span class="token operator">=</span> <span class="token string">&quot;-_.() abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>
            safe_filename <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> filename <span class="token keyword">if</span> c <span class="token keyword">in</span> safe_chars<span class="token punctuation">)</span>
            
            <span class="token comment"># 添加时间戳避免冲突</span>
            timestamp <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d_%H%M%S'</span><span class="token punctuation">)</span>
            name<span class="token punctuation">,</span> ext <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>safe_filename<span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{</span>timestamp<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
        
        <span class="token keyword">def</span> <span class="token function">search_emails</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">,</span> search_type<span class="token operator">=</span><span class="token string">'subject'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;搜索邮件&quot;&quot;&quot;</span>
            conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>db_path<span class="token punctuation">)</span>
            cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> search_type <span class="token operator">==</span> <span class="token string">'subject'</span><span class="token punctuation">:</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
                    <span class="token string">'SELECT * FROM emails WHERE subject LIKE ?'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'%</span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">%'</span></span><span class="token punctuation">,</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token keyword">elif</span> search_type <span class="token operator">==</span> <span class="token string">'sender'</span><span class="token punctuation">:</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
                    <span class="token string">'SELECT * FROM emails WHERE sender LIKE ?'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'%</span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">%'</span></span><span class="token punctuation">,</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token keyword">elif</span> search_type <span class="token operator">==</span> <span class="token string">'content'</span><span class="token punctuation">:</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
                    <span class="token string">'SELECT * FROM emails WHERE body_text LIKE ? OR body_html LIKE ?'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'%</span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">%'</span></span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'%</span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">%'</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM emails'</span><span class="token punctuation">)</span>
            
            results <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> results
        
        <span class="token keyword">def</span> <span class="token function">export_emails</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> output_format<span class="token operator">=</span><span class="token string">'json'</span><span class="token punctuation">,</span> date_range<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;导出邮件&quot;&quot;&quot;</span>
            conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>db_path<span class="token punctuation">)</span>
            cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 构建查询</span>
            query <span class="token operator">=</span> <span class="token string">'SELECT * FROM emails'</span>
            params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token keyword">if</span> date_range<span class="token punctuation">:</span>
                query <span class="token operator">+=</span> <span class="token string">' WHERE date_sent BETWEEN ? AND ?'</span>
                params<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>date_range<span class="token punctuation">)</span>
            
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>query<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
            emails <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 获取列名</span>
            columns <span class="token operator">=</span> <span class="token punctuation">[</span>description<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> description <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>description<span class="token punctuation">]</span>
            
            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 转换为字典列表</span>
            email_dicts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> email <span class="token keyword">in</span> emails<span class="token punctuation">:</span>
                email_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>columns<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">)</span>
                email_dicts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>email_dict<span class="token punctuation">)</span>
            
            <span class="token comment"># 导出文件</span>
            timestamp <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d_%H%M%S'</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> output_format <span class="token operator">==</span> <span class="token string">'json'</span><span class="token punctuation">:</span>
                filename <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;emails_export_</span><span class="token interpolation"><span class="token punctuation">{</span>timestamp<span class="token punctuation">}</span></span><span class="token string">.json&quot;</span></span>
                filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>backup_dir<span class="token punctuation">,</span> <span class="token string">'exports'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
                
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>email_dicts<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
            
            <span class="token keyword">elif</span> output_format <span class="token operator">==</span> <span class="token string">'csv'</span><span class="token punctuation">:</span>
                <span class="token keyword">import</span> csv
                filename <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;emails_export_</span><span class="token interpolation"><span class="token punctuation">{</span>timestamp<span class="token punctuation">}</span></span><span class="token string">.csv&quot;</span></span>
                filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>backup_dir<span class="token punctuation">,</span> <span class="token string">'exports'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
                
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> email_dicts<span class="token punctuation">:</span>
                        writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span>columns<span class="token punctuation">)</span>
                        writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        writer<span class="token punctuation">.</span>writerows<span class="token punctuation">(</span>email_dicts<span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 导出完成: </span><span class="token interpolation"><span class="token punctuation">{</span>filepath<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> filepath
        
        <span class="token keyword">def</span> <span class="token function">get_backup_stats</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取备份统计&quot;&quot;&quot;</span>
            conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>db_path<span class="token punctuation">)</span>
            cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 邮件统计</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT COUNT(*) FROM emails'</span><span class="token punctuation">)</span>
            total_emails <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT SUM(size) FROM emails'</span><span class="token punctuation">)</span>
            total_size <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token number">0</span>
            
            <span class="token comment"># 附件统计</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT COUNT(*) FROM attachments'</span><span class="token punctuation">)</span>
            total_attachments <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT SUM(size) FROM attachments'</span><span class="token punctuation">)</span>
            attachments_size <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token number">0</span>
            
            <span class="token comment"># 日期范围</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT MIN(date_sent), MAX(date_sent) FROM emails'</span><span class="token punctuation">)</span>
            date_range <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            stats <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'total_emails'</span><span class="token punctuation">:</span> total_emails<span class="token punctuation">,</span>
                <span class="token string">'total_size'</span><span class="token punctuation">:</span> total_size<span class="token punctuation">,</span>
                <span class="token string">'total_attachments'</span><span class="token punctuation">:</span> total_attachments<span class="token punctuation">,</span>
                <span class="token string">'attachments_size'</span><span class="token punctuation">:</span> attachments_size<span class="token punctuation">,</span>
                <span class="token string">'date_range'</span><span class="token punctuation">:</span> date_range<span class="token punctuation">,</span>
                <span class="token string">'backup_dir'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>backup_dir
            <span class="token punctuation">}</span>
            
            <span class="token keyword">return</span> stats
    
    <span class="token comment"># 2. 测试备份系统</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 测试备份系统:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">test_backup_system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;测试备份系统&quot;&quot;&quot;</span>
        <span class="token comment"># 创建备份系统</span>
        backup_system <span class="token operator">=</span> EmailBackupSystem<span class="token punctuation">(</span><span class="token string">&quot;test_backup&quot;</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 生成测试邮件</span>
        test_emails <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">'message_id'</span><span class="token punctuation">:</span> <span class="token string">'msg001@example.com'</span><span class="token punctuation">,</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'sender1@example.com'</span><span class="token punctuation">,</span>
                <span class="token string">'to'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'recipient@example.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'重要会议通知'</span><span class="token punctuation">,</span>
                <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'2024-01-15T10:30:00'</span><span class="token punctuation">,</span>
                <span class="token string">'body_text'</span><span class="token punctuation">:</span> <span class="token string">'明天下午2点开会，请准时参加。'</span><span class="token punctuation">,</span>
                <span class="token string">'body_html'</span><span class="token punctuation">:</span> <span class="token string">'&lt;p&gt;明天下午2点开会，请准时参加。&lt;/p&gt;'</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
                <span class="token string">'attachments'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">'filename'</span><span class="token punctuation">:</span> <span class="token string">'agenda.pdf'</span><span class="token punctuation">,</span>
                        <span class="token string">'content_type'</span><span class="token punctuation">:</span> <span class="token string">'application/pdf'</span><span class="token punctuation">,</span>
                        <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">b'PDF content here'</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'message_id'</span><span class="token punctuation">:</span> <span class="token string">'msg002@example.com'</span><span class="token punctuation">,</span>
                <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'sender2@example.com'</span><span class="token punctuation">,</span>
                <span class="token string">'to'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'recipient@example.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'项目进度报告'</span><span class="token punctuation">,</span>
                <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'2024-01-16T14:20:00'</span><span class="token punctuation">,</span>
                <span class="token string">'body_text'</span><span class="token punctuation">:</span> <span class="token string">'本周项目进度如下...'</span><span class="token punctuation">,</span>
                <span class="token string">'body_html'</span><span class="token punctuation">:</span> <span class="token string">'&lt;p&gt;本周项目进度如下...&lt;/p&gt;'</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">2048</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
        
        <span class="token comment"># 备份邮件</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   备份邮件:&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> email <span class="token keyword">in</span> test_emails<span class="token punctuation">:</span>
            backup_system<span class="token punctuation">.</span>backup_email<span class="token punctuation">(</span>email<span class="token punctuation">)</span>
        
        <span class="token comment"># 重复备份测试（应该跳过）</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n   重复备份测试:&quot;</span><span class="token punctuation">)</span>
        backup_system<span class="token punctuation">.</span>backup_email<span class="token punctuation">(</span>test_emails<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 搜索测试</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n   搜索测试:&quot;</span><span class="token punctuation">)</span>
        results <span class="token operator">=</span> backup_system<span class="token punctuation">.</span>search_emails<span class="token punctuation">(</span><span class="token string">'会议'</span><span class="token punctuation">,</span> <span class="token string">'subject'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     找到 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 封包含'会议'的邮件&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 导出测试</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n   导出测试:&quot;</span><span class="token punctuation">)</span>
        json_file <span class="token operator">=</span> backup_system<span class="token punctuation">.</span>export_emails<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 统计信息</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n   备份统计:&quot;</span><span class="token punctuation">)</span>
        stats <span class="token operator">=</span> backup_system<span class="token punctuation">.</span>get_backup_stats<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     总邮件数: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'total_emails'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     总大小: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'total_size'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 字节&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     附件数: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'total_attachments'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     日期范围: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'date_range'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 至 </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'date_range'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    test_backup_system<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 运行邮件备份演示</span>
email_backup_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-2-邮件监控系统"><a href="#_5-2-邮件监控系统" class="header-anchor">#</a> 5.2 邮件监控系统</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">import</span> threading
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta
<span class="token keyword">import</span> logging

<span class="token keyword">def</span> <span class="token function">email_monitoring_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件监控系统演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 邮件监控系统演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 邮件监控类</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 邮件监控系统:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">EmailMonitor</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件监控系统&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> check_interval<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>check_interval <span class="token operator">=</span> check_interval  <span class="token comment"># 检查间隔（秒）</span>
            self<span class="token punctuation">.</span>is_running <span class="token operator">=</span> <span class="token boolean">False</span>
            self<span class="token punctuation">.</span>monitor_thread <span class="token operator">=</span> <span class="token boolean">None</span>
            self<span class="token punctuation">.</span>alerts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>stats <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'total_checked'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'alerts_triggered'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'last_check'</span><span class="token punctuation">:</span> <span class="token boolean">None</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment"># 配置日志</span>
            logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
                level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span>
                <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(levelname)s - %(message)s'</span>
            <span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">add_rule</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> condition<span class="token punctuation">,</span> alert_type<span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;添加监控规则&quot;&quot;&quot;</span>
            rule <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'name'</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
                <span class="token string">'condition'</span><span class="token punctuation">:</span> condition<span class="token punctuation">,</span>
                <span class="token string">'alert_type'</span><span class="token punctuation">:</span> alert_type<span class="token punctuation">,</span>
                <span class="token string">'threshold'</span><span class="token punctuation">:</span> threshold<span class="token punctuation">,</span>
                <span class="token string">'enabled'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">'last_triggered'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                <span class="token string">'trigger_count'</span><span class="token punctuation">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rule<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 添加监控规则: </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">start_monitoring</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;开始监控&quot;&quot;&quot;</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_running<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   监控已在运行中&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            
            self<span class="token punctuation">.</span>is_running <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>monitor_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>_monitor_loop<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>monitor_thread<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>monitor_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 开始邮件监控，检查间隔: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>check_interval<span class="token punctuation">}</span></span><span class="token string"> 秒&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">stop_monitoring</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;停止监控&quot;&quot;&quot;</span>
            self<span class="token punctuation">.</span>is_running <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>monitor_thread<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>monitor_thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   ✓ 停止邮件监控&quot;</span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_monitor_loop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;监控循环&quot;&quot;&quot;</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>is_running<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>_check_emails<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'last_check'</span><span class="token punctuation">]</span> <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>check_interval<span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;监控检查失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>check_interval<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_check_emails</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;检查邮件&quot;&quot;&quot;</span>
            <span class="token comment"># 模拟获取新邮件</span>
            new_emails <span class="token operator">=</span> self<span class="token punctuation">.</span>_fetch_new_emails<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'total_checked'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>new_emails<span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> email <span class="token keyword">in</span> new_emails<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_evaluate_rules<span class="token punctuation">(</span>email<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_fetch_new_emails</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取新邮件（模拟）&quot;&quot;&quot;</span>
            <span class="token comment"># 这里应该连接到实际的邮件服务器</span>
            <span class="token comment"># 为演示目的，返回模拟数据</span>
            <span class="token keyword">import</span> random
            
            <span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.3</span><span class="token punctuation">:</span>  <span class="token comment"># 30% 概率有新邮件</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">'from'</span><span class="token punctuation">:</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span>
                            <span class="token string">'important@company.com'</span><span class="token punctuation">,</span>
                            <span class="token string">'spam@suspicious.com'</span><span class="token punctuation">,</span>
                            <span class="token string">'client@customer.com'</span>
                        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">'subject'</span><span class="token punctuation">:</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span>
                            <span class="token string">'紧急：系统故障'</span><span class="token punctuation">,</span>
                            <span class="token string">'免费赠品！'</span><span class="token punctuation">,</span>
                            <span class="token string">'会议邀请'</span><span class="token punctuation">,</span>
                            <span class="token string">'发票确认'</span>
                        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">'size'</span><span class="token punctuation">:</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">'date'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'邮件内容...'</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">def</span> <span class="token function">_evaluate_rules</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;评估监控规则&quot;&quot;&quot;</span>
            <span class="token keyword">for</span> rule <span class="token keyword">in</span> self<span class="token punctuation">.</span>rules<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> rule<span class="token punctuation">[</span><span class="token string">'enabled'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>_check_rule_condition<span class="token punctuation">(</span>email<span class="token punctuation">,</span> rule<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>_trigger_alert<span class="token punctuation">(</span>email<span class="token punctuation">,</span> rule<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_check_rule_condition</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email<span class="token punctuation">,</span> rule<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;检查规则条件&quot;&quot;&quot;</span>
            condition <span class="token operator">=</span> rule<span class="token punctuation">[</span><span class="token string">'condition'</span><span class="token punctuation">]</span>
            condition_type <span class="token operator">=</span> condition<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>
            
            <span class="token keyword">if</span> condition_type <span class="token operator">==</span> <span class="token string">'sender_suspicious'</span><span class="token punctuation">:</span>
                suspicious_domains <span class="token operator">=</span> condition<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'domains'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                sender <span class="token operator">=</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>domain <span class="token keyword">in</span> sender <span class="token keyword">for</span> domain <span class="token keyword">in</span> suspicious_domains<span class="token punctuation">)</span>
            
            <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'large_email'</span><span class="token punctuation">:</span>
                threshold <span class="token operator">=</span> rule<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'threshold'</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 10MB</span>
                <span class="token keyword">return</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> threshold
            
            <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'keyword_alert'</span><span class="token punctuation">:</span>
                keywords <span class="token operator">=</span> condition<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'keywords'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
                <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> text<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> keywords<span class="token punctuation">)</span>
            
            <span class="token keyword">elif</span> condition_type <span class="token operator">==</span> <span class="token string">'high_volume'</span><span class="token punctuation">:</span>
                <span class="token comment"># 检查短时间内的邮件量</span>
                threshold <span class="token operator">=</span> rule<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'threshold'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
                time_window <span class="token operator">=</span> condition<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'time_window'</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>  <span class="token comment"># 5分钟</span>
                
                <span class="token comment"># 这里应该检查实际的邮件量</span>
                <span class="token comment"># 为演示目的，随机返回</span>
                <span class="token keyword">import</span> random
                <span class="token keyword">return</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.1</span>  <span class="token comment"># 10% 概率触发</span>
            
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">def</span> <span class="token function">_trigger_alert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email<span class="token punctuation">,</span> rule<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;触发警报&quot;&quot;&quot;</span>
            alert <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alerts<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">'rule_name'</span><span class="token punctuation">:</span> rule<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'alert_type'</span><span class="token punctuation">:</span> rule<span class="token punctuation">[</span><span class="token string">'alert_type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'email_info'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'from'</span><span class="token punctuation">:</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'subject'</span><span class="token punctuation">:</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'date'</span><span class="token punctuation">:</span> email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">'triggered_at'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'severity'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_get_alert_severity<span class="token punctuation">(</span>rule<span class="token punctuation">[</span><span class="token string">'alert_type'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            
            self<span class="token punctuation">.</span>alerts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>alert<span class="token punctuation">)</span>
            rule<span class="token punctuation">[</span><span class="token string">'last_triggered'</span><span class="token punctuation">]</span> <span class="token operator">=</span> alert<span class="token punctuation">[</span><span class="token string">'triggered_at'</span><span class="token punctuation">]</span>
            rule<span class="token punctuation">[</span><span class="token string">'trigger_count'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>stats<span class="token punctuation">[</span><span class="token string">'alerts_triggered'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token comment"># 记录日志</span>
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>
                <span class="token string-interpolation"><span class="token string">f&quot;警报触发: </span><span class="token interpolation"><span class="token punctuation">{</span>rule<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">'No Subject'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            <span class="token punctuation">)</span>
            
            <span class="token comment"># 发送通知</span>
            self<span class="token punctuation">.</span>_send_notification<span class="token punctuation">(</span>alert<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_get_alert_severity</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> alert_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取警报严重级别&quot;&quot;&quot;</span>
            severity_map <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'security'</span><span class="token punctuation">:</span> <span class="token string">'HIGH'</span><span class="token punctuation">,</span>
                <span class="token string">'spam'</span><span class="token punctuation">:</span> <span class="token string">'MEDIUM'</span><span class="token punctuation">,</span>
                <span class="token string">'volume'</span><span class="token punctuation">:</span> <span class="token string">'MEDIUM'</span><span class="token punctuation">,</span>
                <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token string">'LOW'</span><span class="token punctuation">,</span>
                <span class="token string">'keyword'</span><span class="token punctuation">:</span> <span class="token string">'MEDIUM'</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> severity_map<span class="token punctuation">.</span>get<span class="token punctuation">(</span>alert_type<span class="token punctuation">,</span> <span class="token string">'LOW'</span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">_send_notification</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> alert<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;发送通知&quot;&quot;&quot;</span>
            <span class="token comment"># 这里可以实现各种通知方式：</span>
            <span class="token comment"># - 邮件通知</span>
            <span class="token comment"># - 短信通知</span>
            <span class="token comment"># - 即时消息</span>
            <span class="token comment"># - 系统通知</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   🚨 </span><span class="token interpolation"><span class="token punctuation">{</span>alert<span class="token punctuation">[</span><span class="token string">'severity'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 警报: </span><span class="token interpolation"><span class="token punctuation">{</span>alert<span class="token punctuation">[</span><span class="token string">'rule_name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;      邮件: </span><span class="token interpolation"><span class="token punctuation">{</span>alert<span class="token punctuation">[</span><span class="token string">'email_info'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;      发件人: </span><span class="token interpolation"><span class="token punctuation">{</span>alert<span class="token punctuation">[</span><span class="token string">'email_info'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'from'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">get_alerts</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> severity<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取警报列表&quot;&quot;&quot;</span>
            alerts <span class="token operator">=</span> self<span class="token punctuation">.</span>alerts
            
            <span class="token keyword">if</span> severity<span class="token punctuation">:</span>
                alerts <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token keyword">for</span> a <span class="token keyword">in</span> alerts <span class="token keyword">if</span> a<span class="token punctuation">[</span><span class="token string">'severity'</span><span class="token punctuation">]</span> <span class="token operator">==</span> severity<span class="token punctuation">]</span>
            
            <span class="token keyword">if</span> limit<span class="token punctuation">:</span>
                alerts <span class="token operator">=</span> alerts<span class="token punctuation">[</span><span class="token operator">-</span>limit<span class="token punctuation">:</span><span class="token punctuation">]</span>
            
            <span class="token keyword">return</span> alerts
        
        <span class="token keyword">def</span> <span class="token function">clear_alerts</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> older_than_days<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;清理警报&quot;&quot;&quot;</span>
            <span class="token keyword">if</span> older_than_days<span class="token punctuation">:</span>
                cutoff_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>older_than_days<span class="token punctuation">)</span>
                cutoff_str <span class="token operator">=</span> cutoff_date<span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                original_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alerts<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>alerts <span class="token operator">=</span> <span class="token punctuation">[</span>
                    alert <span class="token keyword">for</span> alert <span class="token keyword">in</span> self<span class="token punctuation">.</span>alerts
                    <span class="token keyword">if</span> alert<span class="token punctuation">[</span><span class="token string">'triggered_at'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> cutoff_str
                <span class="token punctuation">]</span>
                cleared_count <span class="token operator">=</span> original_count <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alerts<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 清理了 </span><span class="token interpolation"><span class="token punctuation">{</span>cleared_count<span class="token punctuation">}</span></span><span class="token string"> 个旧警报&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                cleared_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alerts<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>alerts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 清理了所有 </span><span class="token interpolation"><span class="token punctuation">{</span>cleared_count<span class="token punctuation">}</span></span><span class="token string"> 个警报&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">get_stats</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取监控统计&quot;&quot;&quot;</span>
            stats <span class="token operator">=</span> self<span class="token punctuation">.</span>stats<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
            stats<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">'active_rules'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r <span class="token keyword">for</span> r <span class="token keyword">in</span> self<span class="token punctuation">.</span>rules <span class="token keyword">if</span> r<span class="token punctuation">[</span><span class="token string">'enabled'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'total_rules'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>rules<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'pending_alerts'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alerts<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'is_running'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>is_running
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> stats
    
    <span class="token comment"># 2. 配置监控规则</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 配置监控规则:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">setup_monitoring_rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;设置监控规则&quot;&quot;&quot;</span>
        monitor <span class="token operator">=</span> EmailMonitor<span class="token punctuation">(</span>check_interval<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 5秒检查一次（演示用）</span>
        
        <span class="token comment"># 可疑发件人监控</span>
        monitor<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;可疑发件人检测&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'sender_suspicious'</span><span class="token punctuation">,</span>
                <span class="token string">'domains'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'suspicious.com'</span><span class="token punctuation">,</span> <span class="token string">'spam.net'</span><span class="token punctuation">,</span> <span class="token string">'phishing.org'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'security'</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 大邮件监控</span>
        monitor<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;大邮件检测&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'large_email'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'size'</span><span class="token punctuation">,</span>
            threshold<span class="token operator">=</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>  <span class="token comment"># 5MB</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 关键词警报</span>
        monitor<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;敏感关键词检测&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'keyword_alert'</span><span class="token punctuation">,</span>
                <span class="token string">'keywords'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'紧急'</span><span class="token punctuation">,</span> <span class="token string">'故障'</span><span class="token punctuation">,</span> <span class="token string">'病毒'</span><span class="token punctuation">,</span> <span class="token string">'攻击'</span><span class="token punctuation">,</span> <span class="token string">'urgent'</span><span class="token punctuation">,</span> <span class="token string">'critical'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'keyword'</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 邮件量异常监控</span>
        monitor<span class="token punctuation">.</span>add_rule<span class="token punctuation">(</span>
            <span class="token string">&quot;邮件量异常检测&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'high_volume'</span><span class="token punctuation">,</span>
                <span class="token string">'time_window'</span><span class="token punctuation">:</span> <span class="token number">300</span>  <span class="token comment"># 5分钟</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'volume'</span><span class="token punctuation">,</span>
            threshold<span class="token operator">=</span><span class="token number">20</span>  <span class="token comment"># 5分钟内超过20封</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> monitor
    
    <span class="token comment"># 3. 测试监控系统</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 测试监控系统:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">test_monitoring_system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;测试监控系统&quot;&quot;&quot;</span>
        monitor <span class="token operator">=</span> setup_monitoring_rules<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 开始监控</span>
        monitor<span class="token punctuation">.</span>start_monitoring<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   监控运行中，等待警报...&quot;</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 运行一段时间</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 检查统计</span>
        stats <span class="token operator">=</span> monitor<span class="token punctuation">.</span>get_stats<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n   监控统计:&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     检查的邮件数: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'total_checked'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     触发的警报数: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'alerts_triggered'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     活跃规则数: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'active_rules'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     最后检查时间: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'last_check'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 显示警报</span>
        alerts <span class="token operator">=</span> monitor<span class="token punctuation">.</span>get_alerts<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> alerts<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n   最近的警报:&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> alert <span class="token keyword">in</span> alerts<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 显示最近5个</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     </span><span class="token interpolation"><span class="token punctuation">{</span>alert<span class="token punctuation">[</span><span class="token string">'severity'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>alert<span class="token punctuation">[</span><span class="token string">'rule_name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       </span><span class="token interpolation"><span class="token punctuation">{</span>alert<span class="token punctuation">[</span><span class="token string">'email_info'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 停止监控</span>
        monitor<span class="token punctuation">.</span>stop_monitoring<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    test_monitoring_system<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 运行邮件监控演示</span>
email_monitoring_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_6-最佳实践和安全"><a href="#_6-最佳实践和安全" class="header-anchor">#</a> 6. 最佳实践和安全</h2> <h3 id="_6-1-邮件安全最佳实践"><a href="#_6-1-邮件安全最佳实践" class="header-anchor">#</a> 6.1 邮件安全最佳实践</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> ssl
<span class="token keyword">import</span> base64
<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>fernet <span class="token keyword">import</span> Fernet
<span class="token keyword">import</span> keyring

<span class="token keyword">def</span> <span class="token function">email_security_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件安全最佳实践演示&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== 邮件安全最佳实践演示 ===&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. 安全连接配置</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. 安全连接配置:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_secure_smtp_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;创建安全的SMTP连接&quot;&quot;&quot;</span>
        <span class="token keyword">import</span> smtplib
        
        <span class="token comment"># 创建SSL上下文</span>
        context <span class="token operator">=</span> ssl<span class="token punctuation">.</span>create_default_context<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 配置SSL选项</span>
        context<span class="token punctuation">.</span>check_hostname <span class="token operator">=</span> <span class="token boolean">True</span>
        context<span class="token punctuation">.</span>verify_mode <span class="token operator">=</span> ssl<span class="token punctuation">.</span>CERT_REQUIRED
        
        <span class="token comment"># 禁用不安全的协议</span>
        context<span class="token punctuation">.</span>options <span class="token operator">|</span><span class="token operator">=</span> ssl<span class="token punctuation">.</span>OP_NO_SSLv2
        context<span class="token punctuation">.</span>options <span class="token operator">|</span><span class="token operator">=</span> ssl<span class="token punctuation">.</span>OP_NO_SSLv3
        context<span class="token punctuation">.</span>options <span class="token operator">|</span><span class="token operator">=</span> ssl<span class="token punctuation">.</span>OP_NO_TLSv1
        context<span class="token punctuation">.</span>options <span class="token operator">|</span><span class="token operator">=</span> ssl<span class="token punctuation">.</span>OP_NO_TLSv1_1
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   ✓ 创建安全SSL上下文&quot;</span><span class="token punctuation">)</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 使用SMTP_SSL直接建立加密连接</span>
            server <span class="token operator">=</span> smtplib<span class="token punctuation">.</span>SMTP_SSL<span class="token punctuation">(</span><span class="token string">'smtp.gmail.com'</span><span class="token punctuation">,</span> <span class="token number">465</span><span class="token punctuation">,</span> context<span class="token operator">=</span>context<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   ✓ 建立SSL加密连接&quot;</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 或者使用STARTTLS</span>
            <span class="token comment"># server = smtplib.SMTP('smtp.gmail.com', 587)</span>
            <span class="token comment"># server.starttls(context=context)</span>
            
            <span class="token keyword">return</span> server
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 连接失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">create_secure_imap_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;创建安全的IMAP连接&quot;&quot;&quot;</span>
        <span class="token keyword">import</span> imaplib
        
        <span class="token comment"># 创建SSL上下文</span>
        context <span class="token operator">=</span> ssl<span class="token punctuation">.</span>create_default_context<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 使用IMAP4_SSL</span>
            server <span class="token operator">=</span> imaplib<span class="token punctuation">.</span>IMAP4_SSL<span class="token punctuation">(</span><span class="token string">'imap.gmail.com'</span><span class="token punctuation">,</span> <span class="token number">993</span><span class="token punctuation">,</span> ssl_context<span class="token operator">=</span>context<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   ✓ 建立IMAP SSL连接&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> server
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ IMAP连接失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
    
    <span class="token comment"># 测试安全连接</span>
    smtp_server <span class="token operator">=</span> create_secure_smtp_connection<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> smtp_server<span class="token punctuation">:</span>
        smtp_server<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    imap_server <span class="token operator">=</span> create_secure_imap_connection<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> imap_server<span class="token punctuation">:</span>
        imap_server<span class="token punctuation">.</span>logout<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 2. 密码安全管理</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. 密码安全管理:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">SecureCredentialManager</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;安全凭据管理器&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> service_name<span class="token operator">=</span><span class="token string">&quot;email_client&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>service_name <span class="token operator">=</span> service_name
        
        <span class="token keyword">def</span> <span class="token function">store_credentials</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;安全存储凭据&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 使用系统密钥环存储密码</span>
                keyring<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>self<span class="token punctuation">.</span>service_name<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 安全存储凭据: </span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 存储失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">def</span> <span class="token function">get_credentials</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;获取存储的凭据&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                password <span class="token operator">=</span> keyring<span class="token punctuation">.</span>get_password<span class="token punctuation">(</span>self<span class="token punctuation">.</span>service_name<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
                <span class="token keyword">if</span> password<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 获取凭据: </span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> password
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 未找到凭据: </span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">None</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 获取失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">None</span>
        
        <span class="token keyword">def</span> <span class="token function">delete_credentials</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;删除存储的凭据&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                keyring<span class="token punctuation">.</span>delete_password<span class="token punctuation">(</span>self<span class="token punctuation">.</span>service_name<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ 删除凭据: </span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 删除失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">def</span> <span class="token function">encrypt_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;加密敏感数据&quot;&quot;&quot;</span>
            <span class="token comment"># 生成密钥</span>
            key <span class="token operator">=</span> Fernet<span class="token punctuation">.</span>generate_key<span class="token punctuation">(</span><span class="token punctuation">)</span>
            cipher <span class="token operator">=</span> Fernet<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
            
            <span class="token comment"># 加密数据</span>
            encrypted_data <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   ✓ 数据已加密&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> key<span class="token punctuation">,</span> encrypted_data
        
        <span class="token keyword">def</span> <span class="token function">decrypt_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> encrypted_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;解密数据&quot;&quot;&quot;</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                cipher <span class="token operator">=</span> Fernet<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
                decrypted_data <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>encrypted_data<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   ✓ 数据已解密&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> decrypted_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ 解密失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">None</span>
    
    <span class="token comment"># 测试凭据管理</span>
    cred_manager <span class="token operator">=</span> SecureCredentialManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 注意：实际使用时不要在代码中硬编码密码</span>
    test_username <span class="token operator">=</span> <span class="token string">&quot;test@example.com&quot;</span>
    test_password <span class="token operator">=</span> <span class="token string">&quot;secure_password_123&quot;</span>
    
    <span class="token comment"># 存储和获取凭据（仅演示，实际环境中谨慎使用）</span>
    <span class="token comment"># cred_manager.store_credentials(test_username, test_password)</span>
    <span class="token comment"># retrieved_password = cred_manager.get_credentials(test_username)</span>
    
    <span class="token comment"># 测试数据加密</span>
    sensitive_data <span class="token operator">=</span> <span class="token string">&quot;这是敏感的邮件内容&quot;</span>
    key<span class="token punctuation">,</span> encrypted <span class="token operator">=</span> cred_manager<span class="token punctuation">.</span>encrypt_data<span class="token punctuation">(</span>sensitive_data<span class="token punctuation">)</span>
    decrypted <span class="token operator">=</span> cred_manager<span class="token punctuation">.</span>decrypt_data<span class="token punctuation">(</span>key<span class="token punctuation">,</span> encrypted<span class="token punctuation">)</span>
    
    <span class="token comment"># 3. 邮件内容安全</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. 邮件内容安全:&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">EmailSecurityValidator</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;邮件安全验证器&quot;&quot;&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>suspicious_patterns <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string">r'(?i)password.*reset'</span><span class="token punctuation">,</span>
                <span class="token string">r'(?i)click.*here.*urgent'</span><span class="token punctuation">,</span>
                <span class="token string">r'(?i)verify.*account.*immediately'</span><span class="token punctuation">,</span>
                <span class="token string">r'(?i)suspended.*account'</span><span class="token punctuation">,</span>
                <span class="token string">r'(?i)winner.*lottery'</span><span class="token punctuation">,</span>
                <span class="token string">r'(?i)free.*money'</span><span class="token punctuation">,</span>
                <span class="token string">r'(?i)nigerian.*prince'</span>
            <span class="token punctuation">]</span>
            
            self<span class="token punctuation">.</span>safe_domains <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string">'gmail.com'</span><span class="token punctuation">,</span> <span class="token string">'outlook.com'</span><span class="token punctuation">,</span> <span class="token string">'yahoo.com'</span><span class="token punctuation">,</span>
                <span class="token string">'company.com'</span>  <span class="token comment"># 添加你信任的域名</span>
            <span class="token punctuation">]</span>
        
        <span class="token keyword">def</span> <span class="token function">validate_sender</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sender_email<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;验证发件人&quot;&quot;&quot;</span>
            <span class="token keyword">import</span> re
            
            <span class="token comment"># 检查邮箱格式</span>
            email_pattern <span class="token operator">=</span> <span class="token string">r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>email_pattern<span class="token punctuation">,</span> sender_email<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">&quot;邮箱格式无效&quot;</span>
            
            <span class="token comment"># 检查域名</span>
            domain <span class="token operator">=</span> sender_email<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> domain <span class="token keyword">in</span> self<span class="token punctuation">.</span>safe_domains<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">&quot;可信域名&quot;</span>
            
            <span class="token comment"># 检查可疑域名特征</span>
            suspicious_domain_patterns <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string">r'.*\d{4,}.*'</span><span class="token punctuation">,</span>  <span class="token comment"># 包含4位以上数字</span>
                <span class="token string">r'.*-.*-.*'</span><span class="token punctuation">,</span>    <span class="token comment"># 多个连字符</span>
                <span class="token string">r'.{20,}'</span><span class="token punctuation">,</span>      <span class="token comment"># 域名过长</span>
            <span class="token punctuation">]</span>
            
            <span class="token keyword">for</span> pattern <span class="token keyword">in</span> suspicious_domain_patterns<span class="token punctuation">:</span>
                <span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f&quot;可疑域名模式: </span><span class="token interpolation"><span class="token punctuation">{</span>pattern<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">&quot;域名检查通过&quot;</span>
        
        <span class="token keyword">def</span> <span class="token function">scan_content</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;扫描邮件内容&quot;&quot;&quot;</span>
            <span class="token keyword">import</span> re
            
            content <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>subject<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>body<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            threats <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 检查可疑模式</span>
            <span class="token keyword">for</span> pattern <span class="token keyword">in</span> self<span class="token punctuation">.</span>suspicious_patterns<span class="token punctuation">:</span>
                <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    threats<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;可疑模式: </span><span class="token interpolation"><span class="token punctuation">{</span>pattern<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 检查URL</span>
            url_pattern <span class="token operator">=</span> <span class="token string">r'https?://[^\s]+'</span>
            urls <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>url_pattern<span class="token punctuation">,</span> content<span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>_is_suspicious_url<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    threats<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;可疑链接: </span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 检查附件提及</span>
            attachment_patterns <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string">r'(?i)attachment.*exe'</span><span class="token punctuation">,</span>
                <span class="token string">r'(?i)download.*file'</span><span class="token punctuation">,</span>
                <span class="token string">r'(?i)open.*document'</span>
            <span class="token punctuation">]</span>
            
            <span class="token keyword">for</span> pattern <span class="token keyword">in</span> attachment_patterns<span class="token punctuation">:</span>
                <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    threats<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;可疑附件提及: </span><span class="token interpolation"><span class="token punctuation">{</span>pattern<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> threats
        
        <span class="token keyword">def</span> <span class="token function">_is_suspicious_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;检查URL是否可疑&quot;&quot;&quot;</span>
            <span class="token keyword">import</span> re
            
            suspicious_url_patterns <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string">r'.*bit\.ly.*'</span><span class="token punctuation">,</span>
                <span class="token string">r'.*tinyurl.*'</span><span class="token punctuation">,</span>
                <span class="token string">r'.*[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}.*'</span><span class="token punctuation">,</span>  <span class="token comment"># IP地址</span>
                <span class="token string">r'.*[a-z]{20,}\.[a-z]{2,3}.*'</span><span class="token punctuation">,</span>  <span class="token comment"># 随机长域名</span>
            <span class="token punctuation">]</span>
            
            <span class="token keyword">for</span> pattern <span class="token keyword">in</span> suspicious_url_patterns<span class="token punctuation">:</span>
                <span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
            
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">def</span> <span class="token function">validate_email</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;综合验证邮件&quot;&quot;&quot;</span>
            results <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'is_safe'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">'warnings'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'threats'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment"># 验证发件人</span>
            sender_valid<span class="token punctuation">,</span> sender_msg <span class="token operator">=</span> self<span class="token punctuation">.</span>validate_sender<span class="token punctuation">(</span>email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> sender_valid<span class="token punctuation">:</span>
                results<span class="token punctuation">[</span><span class="token string">'threats'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;发件人验证失败: </span><span class="token interpolation"><span class="token punctuation">{</span>sender_msg<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                results<span class="token punctuation">[</span><span class="token string">'is_safe'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
            
            <span class="token comment"># 扫描内容</span>
            content_threats <span class="token operator">=</span> self<span class="token punctuation">.</span>scan_content<span class="token punctuation">(</span>
                email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> content_threats<span class="token punctuation">:</span>
                results<span class="token punctuation">[</span><span class="token string">'threats'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>content_threats<span class="token punctuation">)</span>
                results<span class="token punctuation">[</span><span class="token string">'is_safe'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
            
            <span class="token comment"># 检查附件</span>
            attachments <span class="token operator">=</span> email_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'attachments'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> attachment <span class="token keyword">in</span> attachments<span class="token punctuation">:</span>
                filename <span class="token operator">=</span> attachment<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>_is_dangerous_attachment<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    results<span class="token punctuation">[</span><span class="token string">'threats'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;危险附件: </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    results<span class="token punctuation">[</span><span class="token string">'is_safe'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
            
            <span class="token keyword">return</span> results
        
        <span class="token keyword">def</span> <span class="token function">_is_dangerous_attachment</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot;检查附件是否危险&quot;&quot;&quot;</span>
            dangerous_extensions <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string">'.exe'</span><span class="token punctuation">,</span> <span class="token string">'.scr'</span><span class="token punctuation">,</span> <span class="token string">'.bat'</span><span class="token punctuation">,</span> <span class="token string">'.cmd'</span><span class="token punctuation">,</span> <span class="token string">'.com'</span><span class="token punctuation">,</span> <span class="token string">'.pif'</span><span class="token punctuation">,</span>
                <span class="token string">'.vbs'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jar'</span><span class="token punctuation">,</span> <span class="token string">'.zip'</span><span class="token punctuation">,</span> <span class="token string">'.rar'</span>
            <span class="token punctuation">]</span>
            
            filename_lower <span class="token operator">=</span> filename<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>filename_lower<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span>ext<span class="token punctuation">)</span> <span class="token keyword">for</span> ext <span class="token keyword">in</span> dangerous_extensions<span class="token punctuation">)</span>
    
    <span class="token comment"># 测试安全验证</span>
    validator <span class="token operator">=</span> EmailSecurityValidator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 测试邮件</span>
    test_emails <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'legitimate@company.com'</span><span class="token punctuation">,</span>
            <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'会议通知'</span><span class="token punctuation">,</span>
            <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'明天下午2点开会'</span><span class="token punctuation">,</span>
            <span class="token string">'attachments'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'suspicious123456@random-domain.com'</span><span class="token punctuation">,</span>
            <span class="token string">'subject'</span><span class="token punctuation">:</span> <span class="token string">'URGENT: Verify your account immediately!'</span><span class="token punctuation">,</span>
            <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">'Click here to reset your password: http://bit.ly/suspicious'</span><span class="token punctuation">,</span>
            <span class="token string">'attachments'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'filename'</span><span class="token punctuation">:</span> <span class="token string">'document.exe'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   邮件安全验证:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> email <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>test_emails<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n   邮件 </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>email<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> validator<span class="token punctuation">.</span>validate_email<span class="token punctuation">(</span>email<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token string">'is_safe'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     ✓ 邮件安全&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     ⚠️ 发现威胁:&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> threat <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'threats'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;       • </span><span class="token interpolation"><span class="token punctuation">{</span>threat<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行邮件安全演示</span>
email_security_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_7-学习建议和总结"><a href="#_7-学习建议和总结" class="header-anchor">#</a> 7. 学习建议和总结</h2> <h3 id="_7-1-学习路径"><a href="#_7-1-学习路径" class="header-anchor">#</a> 7.1 学习路径</h3> <ol><li><p><strong>基础知识</strong></p> <ul><li>理解邮件协议（SMTP、POP3、IMAP）</li> <li>掌握Python邮件模块的基本用法</li> <li>学习邮件格式和编码</li></ul></li> <li><p><strong>进阶应用</strong></p> <ul><li>邮件内容解析和处理</li> <li>附件处理和文件操作</li> <li>邮件过滤和自动化</li></ul></li> <li><p><strong>实际项目</strong></p> <ul><li>构建邮件客户端</li> <li>实现邮件监控系统</li> <li>开发邮件备份工具</li></ul></li></ol> <h3 id="_7-2-最佳实践"><a href="#_7-2-最佳实践" class="header-anchor">#</a> 7.2 最佳实践</h3> <ol><li><p><strong>安全性</strong></p> <ul><li>使用SSL/TLS加密连接</li> <li>安全存储邮箱密码</li> <li>验证邮件来源和内容</li></ul></li> <li><p><strong>性能优化</strong></p> <ul><li>合理使用连接池</li> <li>批量处理邮件</li> <li>异步处理大量邮件</li></ul></li> <li><p><strong>错误处理</strong></p> <ul><li>完善的异常处理机制</li> <li>重试机制和超时设置</li> <li>详细的日志记录</li></ul></li></ol> <h3 id="_7-3-常见陷阱和解决方案"><a href="#_7-3-常见陷阱和解决方案" class="header-anchor">#</a> 7.3 常见陷阱和解决方案</h3> <ol><li><p><strong>编码问题</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 问题：邮件内容乱码</span>
<span class="token comment"># 解决：正确处理字符编码</span>
<span class="token keyword">import</span> chardet

<span class="token keyword">def</span> <span class="token function">decode_email_content</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        encoding <span class="token operator">=</span> chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'encoding'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding <span class="token keyword">or</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> content
</code></pre></div></li> <li><p><strong>连接超时</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 问题：邮件服务器连接超时</span>
<span class="token comment"># 解决：设置合理的超时时间</span>
<span class="token keyword">import</span> socket

<span class="token comment"># 设置全局超时</span>
socket<span class="token punctuation">.</span>setdefaulttimeout<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>

<span class="token comment"># 或在连接时设置</span>
server <span class="token operator">=</span> smtplib<span class="token punctuation">.</span>SMTP<span class="token punctuation">(</span><span class="token string">'smtp.gmail.com'</span><span class="token punctuation">,</span> <span class="token number">587</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>内存占用</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 问题：处理大量邮件时内存占用过高</span>
<span class="token comment"># 解决：使用生成器和流式处理</span>
<span class="token keyword">def</span> <span class="token function">process_emails_efficiently</span><span class="token punctuation">(</span>email_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> email <span class="token keyword">in</span> email_list<span class="token punctuation">:</span>
        <span class="token comment"># 处理单封邮件</span>
        process_single_email<span class="token punctuation">(</span>email<span class="token punctuation">)</span>
        <span class="token comment"># 及时释放内存</span>
        <span class="token keyword">del</span> email
</code></pre></div></li></ol> <h3 id="_7-4-本章总结"><a href="#_7-4-本章总结" class="header-anchor">#</a> 7.4 本章总结</h3> <p>本章详细介绍了Python电子邮件编程的各个方面：</p> <ol><li><strong>邮件基础</strong>：学习了SMTP、POP3、IMAP协议的基本概念和Python实现</li> <li><strong>发送邮件</strong>：掌握了文本邮件、HTML邮件、附件邮件的发送方法</li> <li><strong>接收邮件</strong>：学会了连接邮件服务器、下载和解析邮件内容</li> <li><strong>邮件处理</strong>：实现了邮件过滤、自动回复、统计分析等高级功能</li> <li><strong>实际应用</strong>：构建了邮件备份系统和监控系统</li> <li><strong>安全实践</strong>：了解了邮件安全的重要性和实现方法</li></ol> <p>通过本章的学习，你应该能够：</p> <ul><li>使用Python发送和接收各种类型的邮件</li> <li>解析和处理邮件内容和附件</li> <li>实现邮件自动化处理功能</li> <li>构建实用的邮件应用系统</li> <li>确保邮件操作的安全性</li></ul> <p>邮件编程是Python的重要应用领域，掌握这些技能将为你的项目开发提供强大的通信能力。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/JavaPlusDoc/Python/18.html" class="prev">
          第18天-网络编程
        </a></span> <span class="next"><a href="/JavaPlusDoc/Python/20.html">
          第20天-访问数据库
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_1-电子邮件基础" class="sidebar-link reco-side-_1-电子邮件基础" data-v-b57cc07c>1. 电子邮件基础</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_1-1-电子邮件协议概述" class="sidebar-link reco-side-_1-1-电子邮件协议概述" data-v-b57cc07c>1.1 电子邮件协议概述</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_1-2-python邮件模块介绍" class="sidebar-link reco-side-_1-2-python邮件模块介绍" data-v-b57cc07c>1.2 Python邮件模块介绍</a></li><li class="level-2" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_2-发送邮件" class="sidebar-link reco-side-_2-发送邮件" data-v-b57cc07c>2. 发送邮件</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_2-1-smtp基础发送" class="sidebar-link reco-side-_2-1-smtp基础发送" data-v-b57cc07c>2.1 SMTP基础发送</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_2-2-邮件附件处理" class="sidebar-link reco-side-_2-2-邮件附件处理" data-v-b57cc07c>2.2 邮件附件处理</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_2-3-高级发送功能" class="sidebar-link reco-side-_2-3-高级发送功能" data-v-b57cc07c>2.3 高级发送功能</a></li><li class="level-2" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_3-接收邮件" class="sidebar-link reco-side-_3-接收邮件" data-v-b57cc07c>3. 接收邮件</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_3-1-pop3接收邮件" class="sidebar-link reco-side-_3-1-pop3接收邮件" data-v-b57cc07c>3.1 POP3接收邮件</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_3-2-imap接收邮件" class="sidebar-link reco-side-_3-2-imap接收邮件" data-v-b57cc07c>3.2 IMAP接收邮件</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_3-3-邮件内容解析" class="sidebar-link reco-side-_3-3-邮件内容解析" data-v-b57cc07c>3.3 邮件内容解析</a></li><li class="level-2" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_4-邮件处理和管理" class="sidebar-link reco-side-_4-邮件处理和管理" data-v-b57cc07c>4. 邮件处理和管理</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_4-1-邮件过滤和分类" class="sidebar-link reco-side-_4-1-邮件过滤和分类" data-v-b57cc07c>4.1 邮件过滤和分类</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_4-2-邮件自动回复" class="sidebar-link reco-side-_4-2-邮件自动回复" data-v-b57cc07c>4.2 邮件自动回复</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_4-3-邮件统计和分析" class="sidebar-link reco-side-_4-3-邮件统计和分析" data-v-b57cc07c>4.3 邮件统计和分析</a></li><li class="level-2" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_5-实际应用案例" class="sidebar-link reco-side-_5-实际应用案例" data-v-b57cc07c>5. 实际应用案例</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_5-1-邮件备份系统" class="sidebar-link reco-side-_5-1-邮件备份系统" data-v-b57cc07c>5.1 邮件备份系统</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_5-2-邮件监控系统" class="sidebar-link reco-side-_5-2-邮件监控系统" data-v-b57cc07c>5.2 邮件监控系统</a></li><li class="level-2" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_6-最佳实践和安全" class="sidebar-link reco-side-_6-最佳实践和安全" data-v-b57cc07c>6. 最佳实践和安全</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_6-1-邮件安全最佳实践" class="sidebar-link reco-side-_6-1-邮件安全最佳实践" data-v-b57cc07c>6.1 邮件安全最佳实践</a></li><li class="level-2" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_7-学习建议和总结" class="sidebar-link reco-side-_7-学习建议和总结" data-v-b57cc07c>7. 学习建议和总结</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_7-1-学习路径" class="sidebar-link reco-side-_7-1-学习路径" data-v-b57cc07c>7.1 学习路径</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_7-2-最佳实践" class="sidebar-link reco-side-_7-2-最佳实践" data-v-b57cc07c>7.2 最佳实践</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_7-3-常见陷阱和解决方案" class="sidebar-link reco-side-_7-3-常见陷阱和解决方案" data-v-b57cc07c>7.3 常见陷阱和解决方案</a></li><li class="level-3" data-v-b57cc07c><a href="/JavaPlusDoc/Python/19.html#_7-4-本章总结" class="sidebar-link reco-side-_7-4-本章总结" data-v-b57cc07c>7.4 本章总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 Jeskson-微服务分布式
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="260" class="live2d" style="width:100px;position:fixed;right:0px;bottom:0px;opacity:0.9;z-index:99999;object-fit:cover;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/JavaPlusDoc/assets/js/app.ff4b1912.js" defer></script><script src="/JavaPlusDoc/assets/js/7.dfc0397a.js" defer></script><script src="/JavaPlusDoc/assets/js/2.cfbace72.js" defer></script><script src="/JavaPlusDoc/assets/js/1.d59a348b.js" defer></script><script src="/JavaPlusDoc/assets/js/136.51486790.js" defer></script>
  </body>
</html>
